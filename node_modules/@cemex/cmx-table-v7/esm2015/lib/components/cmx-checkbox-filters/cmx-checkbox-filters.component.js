/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, Input, ViewChildren, QueryList, forwardRef, Host, } from '@angular/core';
import { BehaviorSubject } from 'rxjs';
import { CmxCheckboxComponent } from '@cemex/cmx-checkbox-v4';
import { Filter } from '../../classes/filter.class';
import { WatcherService } from '../../services/watcher.service';
import { CmxTableComponent } from '../cmx-table/cmx-table.component';
export class CmxCheckboxFiltersComponent {
    /**
     * @param {?} watcher
     * @param {?} parent
     */
    constructor(watcher, parent) {
        this.watcher = watcher;
        this.parent = parent;
        this.showAllOption = false;
        this.allOptionName = '';
        this.searchPlaceholder = '';
        this.enableSearch = false;
        this.searchTerm = '';
        this.allFilter = new Filter('All', null, false, null);
        this.isRtl = false;
        this.activeFilters = new BehaviorSubject(false);
        this.checkboxSubscriptions = [];
        this.isRtl = this.parent.rtl;
    }
    /**
     * @param {?} $value
     * @return {?}
     */
    set filters($value) {
        if ($value !== undefined && $value !== null) {
            this._filters = $value;
        }
    }
    /**
     * @return {?}
     */
    get filters() {
        return this._filters;
    }
    /**
     * @return {?}
     */
    ngAfterViewInit() {
        this.listenToCheckboxes();
    }
    /**
     * @return {?}
     */
    ngOnDestroy() {
        this.dropSubscriptions();
    }
    /**
     * @return {?}
     */
    listenToActiveFilters() {
        return this.activeFilters.asObservable();
    }
    /**
     * \@description Checks all filters when the 'All' checkbox is clicked.
     * @param {?} $event
     * @return {?}
     */
    toggleAll($event) {
        if (typeof $event === 'boolean') {
            this.allFilter.active = $event;
            this._filters.forEach((/**
             * @param {?} filter
             * @return {?}
             */
            (filter) => {
                if (filter.visible) {
                    filter.active = $event;
                }
            }));
        }
    }
    /**
     * \@description Toggles the 'active' attribute of a filter to enable or disable.
     * @param {?} filter
     * @param {?} $event
     * @return {?}
     */
    toggleFilter(filter, $event) {
        if (typeof $event === 'boolean') {
            filter.active = $event;
            if (!this.showAllOption) {
                return;
            }
            if (!$event) {
                this.allFilter.active = false;
            }
            else {
                /** @type {?} */
                let $filtersOnFalse = 0;
                this.filters.forEach((/**
                 * @param {?} $filter
                 * @return {?}
                 */
                ($filter) => {
                    if ($filter.active === false) {
                        $filtersOnFalse++;
                    }
                }));
                this.allFilter.active = ($filtersOnFalse === 0) ? true : false;
                // let $hasAllFilterActive: boolean = false;
                // $hasAllFilterActive = this._filters.every(function($filter) {
                //     return $filter.active;
                // });
                // this.allFilter.active = $hasAllFilterActive;
            }
        }
    }
    /**
     * @return {?}
     */
    clearSearch() {
        this.searchTerm = '';
        this.filters.forEach((/**
         * @param {?} $filter
         * @return {?}
         */
        ($filter) => {
            $filter.visible = true;
        }));
    }
    /**
     * @param {?} term
     * @return {?}
     */
    searchInFilter(term) {
        if (term.length >= 4 || term === '') {
            /** @type {?} */
            const aux = term.toLowerCase();
            if (aux !== '') {
                this.filters.filter((/**
                 * @param {?} row
                 * @return {?}
                 */
                (row) => {
                    if (row.name && row.name.toLowerCase().includes(aux)) {
                        row.visible = true;
                    }
                    else {
                        row.visible = false;
                    }
                }));
            }
            else {
                this.clearSearch();
            }
        }
    }
    /**
     * @private
     * @return {?}
     */
    emitFilters() {
        this.watcher.emitActiveFilters(this.parent.assignedId, this._filters);
    }
    /**
     * @private
     * @return {?}
     */
    emitActiveCheckboxes() {
        /** @type {?} */
        const activeFilters = [];
        this._filters.forEach((/**
         * @param {?} filter
         * @return {?}
         */
        (filter) => {
            if (filter.active) {
                activeFilters.push(filter);
            }
        }));
        if (activeFilters.length > 0) {
            this.activeFilters.next(true);
        }
        else {
            this.activeFilters.next(false);
        }
    }
    /**
     * @private
     * @return {?}
     */
    listenToCheckboxes() {
        this.checkboxes.forEach((/**
         * @param {?} $checkbox
         * @return {?}
         */
        ($checkbox) => {
            /** @type {?} */
            const $subscription = $checkbox.change.subscribe((/**
             * @param {?} $checked
             * @return {?}
             */
            ($checked) => {
                this.emitFilters();
                this.emitActiveCheckboxes();
            }));
            this.checkboxSubscriptions.push($subscription);
        }));
    }
    /**
     * @private
     * @return {?}
     */
    dropSubscriptions() {
        this.checkboxSubscriptions.forEach((/**
         * @param {?} $sub
         * @return {?}
         */
        ($sub) => $sub.unsubscribe()));
        this.checkboxSubscriptions = [];
    }
}
CmxCheckboxFiltersComponent.decorators = [
    { type: Component, args: [{
                selector: 'cmx-checkbox-filters',
                template: "<div class=\"search-container\" *ngIf=\"enableSearch\">\r\n    <div id=\"cmx-checkbox-filter-search-input\" [dir]=\"isRtl ? 'rtl':'auto'\" class=\"filterSearchBox\" fxLayoutAlign=\"center center\" fxLayout=\"row\">\r\n        <input fxFlex class=\"search-input\" type=\"text\" placeholder=\"{{ searchPlaceholder }}\" [(ngModel)]=\"searchTerm\" (keyup)=\"searchInFilter(searchTerm)\">\r\n        <span fxFlex=\"35px\" class=\"cmx-icon-search search-input-icon\" aria-hidden=\"true\" *ngIf=\"searchTerm === ''\"></span>\r\n        <span fxFlex=\"35px\" class=\"cmx-icon-close search-input-icon\" aria-hidden=\"true\"  *ngIf=\"searchTerm !== ''\" (click)=\"clearSearch()\"></span>\r\n    </div>\r\n</div>\r\n<div *ngIf=\"showAllOption\" class=\"checkbox-container\" [dir]=\"isRtl ? 'rtl':'auto'\">\r\n    <cmx-checkbox [checked]=\"allFilter.active\" (change)=\"toggleAll($event)\" [rtl]=\"isRtl\">\r\n        {{ allOptionName }}\r\n    </cmx-checkbox>\r\n</div>\r\n<ng-container *ngFor=\"let filter of _filters; let $index = index;\">\r\n    <div [hidden]=\"!filter.visible\" class=\"checkbox-container\" [dir]=\"isRtl ? 'rtl':'auto'\">\r\n        <cmx-checkbox [id]=\"'checkbox-' + filter.columnKey + $index\" [checked]=\"filter.active\" (change)=\"toggleFilter(filter, $event)\" [rtl]=\"isRtl\">\r\n            {{ filter.name }}\r\n        </cmx-checkbox>\r\n    </div>\r\n</ng-container>",
                styles: [".roboto-bold{font-weight:700}.roboto-medium{font-weight:500}.roboto-regular{font-weight:400}.roboto-light{font-weight:300}.roboto-thin{font-weight:100}.h1-role,h1{font-family:Roboto,sans-serif;font-size:3rem;line-height:3rem;font-weight:700;color:#001b3a}.h2-role,.h3-role,h2,h3{font-family:Roboto,sans-serif;font-size:1.625rem;line-height:2rem;font-weight:400;color:#001b3a}.h4-role,h4{font-family:Roboto,sans-serif;font-size:2rem;line-height:2rem;font-weight:500;color:#001b3a}.h5-role,h5{font-family:Roboto,sans-serif;font-size:1.25rem;line-height:1.5rem;font-weight:400;color:#001b3a}.h6-role,h6{font-family:Roboto,sans-serif;font-size:.875rem;line-height:1rem;font-weight:700;color:#001b3a;text-transform:uppercase}.table-entry{font-family:Roboto,sans-serif;font-size:.875rem;line-height:1rem}.table-entry-strong{font-family:Roboto,sans-serif;font-size:.875rem;line-height:1rem;color:#333;font-weight:700}.link,.table-entry,a{text-decoration:none;color:#3fa9f5}a:hover{text-decoration:underline}.input-placeholder{font-family:Roboto,sans-serif;font-size:.875rem;line-height:1rem;color:#666}.input-text{font-family:Roboto,sans-serif;font-size:.875rem;line-height:1rem;color:#333}.size-15{font-size:.9375rem}.size-24{font-size:1.5rem}.text-left{text-align:left!important}.text-right{text-align:right!important}.text-center{text-align:center!important}.flex-first{order:-1}.flex-last{order:1}.flex-unordered{order:0}.flex-row{flex-direction:row!important}.flex-column{flex-direction:column!important}.flex-row-reverse{flex-direction:row-reverse!important}.flex-column-reverse{flex-direction:column-reverse!important}.flex-wrap{flex-wrap:wrap!important}.flex-nowrap{flex-wrap:nowrap!important}.flex-wrap-reverse{flex-wrap:wrap-reverse!important}.justify-content-start{justify-content:flex-start!important}.justify-content-end{justify-content:flex-end!important}.justify-content-center{justify-content:center!important}.justify-content-between{justify-content:space-between!important}.justify-content-around{justify-content:space-around!important}.align-items-start{align-items:flex-start!important}.align-items-end{align-items:flex-end!important}.align-items-center{align-items:center!important}.align-items-baseline{align-items:baseline!important}.align-items-stretch{align-items:stretch!important}.align-content-start{align-content:flex-start!important}.align-content-end{align-content:flex-end!important}.align-content-center{align-content:center!important}.align-content-between{align-content:space-between!important}.align-content-around{align-content:space-around!important}.align-content-stretch{align-content:stretch!important}.align-self-auto{-ms-grid-row-align:auto!important;align-self:auto!important}.align-self-start{align-self:flex-start!important}.align-self-end{align-self:flex-end!important}.align-self-center{-ms-grid-row-align:center!important;align-self:center!important}.align-self-baseline{align-self:baseline!important}.align-self-stretch{-ms-grid-row-align:stretch!important;align-self:stretch!important}@media (min-width:576px){.text-xs-left{text-align:left!important}.text-xs-right{text-align:right!important}.text-xs-center{text-align:center!important}.flex-xs-first{order:-1}.flex-xs-last{order:1}.flex-xs-unordered{order:0}.flex-xs-row{flex-direction:row!important}.flex-xs-column{flex-direction:column!important}.flex-xs-row-reverse{flex-direction:row-reverse!important}.flex-xs-column-reverse{flex-direction:column-reverse!important}.flex-xs-wrap{flex-wrap:wrap!important}.flex-xs-nowrap{flex-wrap:nowrap!important}.flex-xs-wrap-reverse{flex-wrap:wrap-reverse!important}.justify-content-xs-start{justify-content:flex-start!important}.justify-content-xs-end{justify-content:flex-end!important}.justify-content-xs-center{justify-content:center!important}.justify-content-xs-between{justify-content:space-between!important}.justify-content-xs-around{justify-content:space-around!important}.align-items-xs-start{align-items:flex-start!important}.align-items-xs-end{align-items:flex-end!important}.align-items-xs-center{align-items:center!important}.align-items-xs-baseline{align-items:baseline!important}.align-items-xs-stretch{align-items:stretch!important}.align-content-xs-start{align-content:flex-start!important}.align-content-xs-end{align-content:flex-end!important}.align-content-xs-center{align-content:center!important}.align-content-xs-between{align-content:space-between!important}.align-content-xs-around{align-content:space-around!important}.align-content-xs-stretch{align-content:stretch!important}.align-self-xs-auto{-ms-grid-row-align:auto!important;align-self:auto!important}.align-self-xs-start{align-self:flex-start!important}.align-self-xs-end{align-self:flex-end!important}.align-self-xs-center{-ms-grid-row-align:center!important;align-self:center!important}.align-self-xs-baseline{align-self:baseline!important}.align-self-xs-stretch{-ms-grid-row-align:stretch!important;align-self:stretch!important}}@media (min-width:768px){.text-sm-left{text-align:left!important}.text-sm-right{text-align:right!important}.text-sm-center{text-align:center!important}.flex-sm-first{order:-1}.flex-sm-last{order:1}.flex-sm-unordered{order:0}.flex-sm-row{flex-direction:row!important}.flex-sm-column{flex-direction:column!important}.flex-sm-row-reverse{flex-direction:row-reverse!important}.flex-sm-column-reverse{flex-direction:column-reverse!important}.flex-sm-wrap{flex-wrap:wrap!important}.flex-sm-nowrap{flex-wrap:nowrap!important}.flex-sm-wrap-reverse{flex-wrap:wrap-reverse!important}.justify-content-sm-start{justify-content:flex-start!important}.justify-content-sm-end{justify-content:flex-end!important}.justify-content-sm-center{justify-content:center!important}.justify-content-sm-between{justify-content:space-between!important}.justify-content-sm-around{justify-content:space-around!important}.align-items-sm-start{align-items:flex-start!important}.align-items-sm-end{align-items:flex-end!important}.align-items-sm-center{align-items:center!important}.align-items-sm-baseline{align-items:baseline!important}.align-items-sm-stretch{align-items:stretch!important}.align-content-sm-start{align-content:flex-start!important}.align-content-sm-end{align-content:flex-end!important}.align-content-sm-center{align-content:center!important}.align-content-sm-between{align-content:space-between!important}.align-content-sm-around{align-content:space-around!important}.align-content-sm-stretch{align-content:stretch!important}.align-self-sm-auto{-ms-grid-row-align:auto!important;align-self:auto!important}.align-self-sm-start{align-self:flex-start!important}.align-self-sm-end{align-self:flex-end!important}.align-self-sm-center{-ms-grid-row-align:center!important;align-self:center!important}.align-self-sm-baseline{align-self:baseline!important}.align-self-sm-stretch{-ms-grid-row-align:stretch!important;align-self:stretch!important}}@media (min-width:1080px){.text-md-left{text-align:left!important}.text-md-right{text-align:right!important}.text-md-center{text-align:center!important}.flex-md-first{order:-1}.flex-md-last{order:1}.flex-md-unordered{order:0}.flex-md-row{flex-direction:row!important}.flex-md-column{flex-direction:column!important}.flex-md-row-reverse{flex-direction:row-reverse!important}.flex-md-column-reverse{flex-direction:column-reverse!important}.flex-md-wrap{flex-wrap:wrap!important}.flex-md-nowrap{flex-wrap:nowrap!important}.flex-md-wrap-reverse{flex-wrap:wrap-reverse!important}.justify-content-md-start{justify-content:flex-start!important}.justify-content-md-end{justify-content:flex-end!important}.justify-content-md-center{justify-content:center!important}.justify-content-md-between{justify-content:space-between!important}.justify-content-md-around{justify-content:space-around!important}.align-items-md-start{align-items:flex-start!important}.align-items-md-end{align-items:flex-end!important}.align-items-md-center{align-items:center!important}.align-items-md-baseline{align-items:baseline!important}.align-items-md-stretch{align-items:stretch!important}.align-content-md-start{align-content:flex-start!important}.align-content-md-end{align-content:flex-end!important}.align-content-md-center{align-content:center!important}.align-content-md-between{align-content:space-between!important}.align-content-md-around{align-content:space-around!important}.align-content-md-stretch{align-content:stretch!important}.align-self-md-auto{-ms-grid-row-align:auto!important;align-self:auto!important}.align-self-md-start{align-self:flex-start!important}.align-self-md-end{align-self:flex-end!important}.align-self-md-center{-ms-grid-row-align:center!important;align-self:center!important}.align-self-md-baseline{align-self:baseline!important}.align-self-md-stretch{-ms-grid-row-align:stretch!important;align-self:stretch!important}}@media (min-width:1320px){.text-lg-left{text-align:left!important}.text-lg-right{text-align:right!important}.text-lg-center{text-align:center!important}.flex-lg-first{order:-1}.flex-lg-last{order:1}.flex-lg-unordered{order:0}.flex-lg-row{flex-direction:row!important}.flex-lg-column{flex-direction:column!important}.flex-lg-row-reverse{flex-direction:row-reverse!important}.flex-lg-column-reverse{flex-direction:column-reverse!important}.flex-lg-wrap{flex-wrap:wrap!important}.flex-lg-nowrap{flex-wrap:nowrap!important}.flex-lg-wrap-reverse{flex-wrap:wrap-reverse!important}.justify-content-lg-start{justify-content:flex-start!important}.justify-content-lg-end{justify-content:flex-end!important}.justify-content-lg-center{justify-content:center!important}.justify-content-lg-between{justify-content:space-between!important}.justify-content-lg-around{justify-content:space-around!important}.align-items-lg-start{align-items:flex-start!important}.align-items-lg-end{align-items:flex-end!important}.align-items-lg-center{align-items:center!important}.align-items-lg-baseline{align-items:baseline!important}.align-items-lg-stretch{align-items:stretch!important}.align-content-lg-start{align-content:flex-start!important}.align-content-lg-end{align-content:flex-end!important}.align-content-lg-center{align-content:center!important}.align-content-lg-between{align-content:space-between!important}.align-content-lg-around{align-content:space-around!important}.align-content-lg-stretch{align-content:stretch!important}.align-self-lg-auto{-ms-grid-row-align:auto!important;align-self:auto!important}.align-self-lg-start{align-self:flex-start!important}.align-self-lg-end{align-self:flex-end!important}.align-self-lg-center{-ms-grid-row-align:center!important;align-self:center!important}.align-self-lg-baseline{align-self:baseline!important}.align-self-lg-stretch{-ms-grid-row-align:stretch!important;align-self:stretch!important}}@media (min-width:1560px){.text-xlg-left{text-align:left!important}.text-xlg-right{text-align:right!important}.text-xlg-center{text-align:center!important}.flex-xlg-first{order:-1}.flex-xlg-last{order:1}.flex-xlg-unordered{order:0}.flex-xlg-row{flex-direction:row!important}.flex-xlg-column{flex-direction:column!important}.flex-xlg-row-reverse{flex-direction:row-reverse!important}.flex-xlg-column-reverse{flex-direction:column-reverse!important}.flex-xlg-wrap{flex-wrap:wrap!important}.flex-xlg-nowrap{flex-wrap:nowrap!important}.flex-xlg-wrap-reverse{flex-wrap:wrap-reverse!important}.justify-content-xlg-start{justify-content:flex-start!important}.justify-content-xlg-end{justify-content:flex-end!important}.justify-content-xlg-center{justify-content:center!important}.justify-content-xlg-between{justify-content:space-between!important}.justify-content-xlg-around{justify-content:space-around!important}.align-items-xlg-start{align-items:flex-start!important}.align-items-xlg-end{align-items:flex-end!important}.align-items-xlg-center{align-items:center!important}.align-items-xlg-baseline{align-items:baseline!important}.align-items-xlg-stretch{align-items:stretch!important}.align-content-xlg-start{align-content:flex-start!important}.align-content-xlg-end{align-content:flex-end!important}.align-content-xlg-center{align-content:center!important}.align-content-xlg-between{align-content:space-between!important}.align-content-xlg-around{align-content:space-around!important}.align-content-xlg-stretch{align-content:stretch!important}.align-self-xlg-auto{-ms-grid-row-align:auto!important;align-self:auto!important}.align-self-xlg-start{align-self:flex-start!important}.align-self-xlg-end{align-self:flex-end!important}.align-self-xlg-center{-ms-grid-row-align:center!important;align-self:center!important}.align-self-xlg-baseline{align-self:baseline!important}.align-self-xlg-stretch{-ms-grid-row-align:stretch!important;align-self:stretch!important}}:host{display:block;max-height:196px;overflow-x:hidden;overflow-y:auto;border-top:3px solid #3fa9f5;cursor:default}.checkbox-container{margin:20px 0;padding:0 12px;white-space:nowrap;text-align:start}.filterSearchBox{border:1px solid #ccc;border-radius:4px;transition:.2s}.search-input{border:none;height:40px;padding-right:10px;padding-left:10px}.search-container{padding:0 12px;margin:20px 0}.search-input-icon{color:#3fa9f5;font-size:2em}"]
            }] }
];
/** @nocollapse */
CmxCheckboxFiltersComponent.ctorParameters = () => [
    { type: WatcherService },
    { type: CmxTableComponent, decorators: [{ type: Host }] }
];
CmxCheckboxFiltersComponent.propDecorators = {
    filters: [{ type: Input }],
    showAllOption: [{ type: Input }],
    allOptionName: [{ type: Input }],
    searchPlaceholder: [{ type: Input }],
    enableSearch: [{ type: Input }],
    checkboxes: [{ type: ViewChildren, args: [forwardRef((/**
                 * @return {?}
                 */
                () => CmxCheckboxComponent)),] }]
};
if (false) {
    /** @type {?} */
    CmxCheckboxFiltersComponent.prototype.showAllOption;
    /** @type {?} */
    CmxCheckboxFiltersComponent.prototype.allOptionName;
    /** @type {?} */
    CmxCheckboxFiltersComponent.prototype.searchPlaceholder;
    /** @type {?} */
    CmxCheckboxFiltersComponent.prototype.enableSearch;
    /** @type {?} */
    CmxCheckboxFiltersComponent.prototype.checkboxes;
    /** @type {?} */
    CmxCheckboxFiltersComponent.prototype.searchTerm;
    /** @type {?} */
    CmxCheckboxFiltersComponent.prototype.allFilter;
    /** @type {?} */
    CmxCheckboxFiltersComponent.prototype._filters;
    /** @type {?} */
    CmxCheckboxFiltersComponent.prototype.isRtl;
    /**
     * @type {?}
     * @private
     */
    CmxCheckboxFiltersComponent.prototype.activeFilters;
    /**
     * @type {?}
     * @private
     */
    CmxCheckboxFiltersComponent.prototype.checkboxSubscriptions;
    /**
     * @type {?}
     * @private
     */
    CmxCheckboxFiltersComponent.prototype.watcher;
    /**
     * @type {?}
     * @private
     */
    CmxCheckboxFiltersComponent.prototype.parent;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY214LWNoZWNrYm94LWZpbHRlcnMuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGNlbWV4L2NteC10YWJsZS12Ny8iLCJzb3VyY2VzIjpbImxpYi9jb21wb25lbnRzL2NteC1jaGVja2JveC1maWx0ZXJzL2NteC1jaGVja2JveC1maWx0ZXJzLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O0FBQUEsT0FBTyxFQUNILFNBQVMsRUFBRSxLQUFLLEVBQ2hCLFlBQVksRUFBRSxTQUFTLEVBQUUsVUFBVSxFQUFFLElBQUksR0FDNUMsTUFBTSxlQUFlLENBQUM7QUFFdkIsT0FBTyxFQUFnQixlQUFlLEVBQWMsTUFBTSxNQUFNLENBQUM7QUFFakUsT0FBTyxFQUFFLG9CQUFvQixFQUFFLE1BQU0sd0JBQXdCLENBQUM7QUFFOUQsT0FBTyxFQUFFLE1BQU0sRUFBRSxNQUFNLDRCQUE0QixDQUFDO0FBQ3BELE9BQU8sRUFBRSxjQUFjLEVBQUUsTUFBTSxnQ0FBZ0MsQ0FBQztBQUNoRSxPQUFPLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSxrQ0FBa0MsQ0FBQztBQU9yRSxNQUFNLE9BQU8sMkJBQTJCOzs7OztJQTBCcEMsWUFBb0IsT0FBdUIsRUFBa0IsTUFBeUI7UUFBbEUsWUFBTyxHQUFQLE9BQU8sQ0FBZ0I7UUFBa0IsV0FBTSxHQUFOLE1BQU0sQ0FBbUI7UUFoQnRFLGtCQUFhLEdBQUcsS0FBSyxDQUFDO1FBQ3RCLGtCQUFhLEdBQUcsRUFBRSxDQUFDO1FBQ25CLHNCQUFpQixHQUFHLEVBQUUsQ0FBQztRQUN2QixpQkFBWSxHQUFHLEtBQUssQ0FBQztRQUk5QixlQUFVLEdBQUcsRUFBRSxDQUFDO1FBRWhCLGNBQVMsR0FBVyxJQUFJLE1BQU0sQ0FBQyxLQUFLLEVBQUUsSUFBSSxFQUFFLEtBQUssRUFBRSxJQUFJLENBQUMsQ0FBQztRQUV6RCxVQUFLLEdBQUcsS0FBSyxDQUFDO1FBRWIsa0JBQWEsR0FBNkIsSUFBSSxlQUFlLENBQVUs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bkIsSUFBSSxDQUFDLG9CQUFvQixFQUFFLENBQUM7WUFDaEMsQ0FBQyxFQUFDO1lBQ0YsSUFBSSxDQUFDLHFCQUFxQixDQUFDLElBQUksQ0FBQyxhQUFhLENBQUMsQ0FBQztRQUNuRCxDQUFDLEVBQUMsQ0FBQztJQUNQLENBQUM7Ozs7O0lBRU8saUJBQWlCO1FBQ3JCLElBQUksQ0FBQyxxQkFBcUIsQ0FBQyxPQUFPOzs7O1FBQUMsQ0FBQyxJQUFrQixFQUFFLEVBQUUsQ0FBQyxJQUFJLENBQUMsV0FBVyxFQUFFLEVBQUMsQ0FBQztRQUMvRSxJQUFJLENBQUMscUJBQXFCLEdBQUcsRUFBRSxDQUFDO0lBQ3BDLENBQUM7OztZQW5KSixTQUFTLFNBQUM7Z0JBQ1AsUUFBUSxFQUFFLHNCQUFzQjtnQkFDaEMsdTNDQUFvRDs7YUFFdkQ7Ozs7WUFQUSxjQUFjO1lBQ2QsaUJBQWlCLHVCQWlDd0IsSUFBSTs7O3NCQXpCakQsS0FBSzs0QkFTTCxLQUFLOzRCQUNMLEtBQUs7Z0NBQ0wsS0FBSzsyQkFDTCxLQUFLO3lCQUVMLFlBQVksU0FBQyxVQUFVOzs7Z0JBQUMsR0FBRyxFQUFFLENBQUMsb0JBQW9CLEVBQUM7Ozs7SUFMcEQsb0RBQXNDOztJQUN0QyxvREFBbUM7O0lBQ25DLHdEQUF1Qzs7SUFDdkMsbURBQXFDOztJQUVyQyxpREFDbUQ7O0lBQ25ELGlEQUF1Qjs7SUFFdkIsZ0RBQWdFOztJQUNoRSwrQ0FBMEI7O0lBQzFCLDRDQUFxQjs7Ozs7SUFFckIsb0RBQXNGOzs7OztJQUN0Riw0REFBbUQ7Ozs7O0lBRXZDLDhDQUErQjs7Ozs7SUFBRSw2Q0FBeUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xyXG4gICAgQ29tcG9uZW50LCBJbnB1dCwgT25EZXN0cm95LCBBZnRlclZpZXdJbml0LFxyXG4gICAgVmlld0NoaWxkcmVuLCBRdWVyeUxpc3QsIGZvcndhcmRSZWYsIEhvc3QsXHJcbn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcblxyXG5pbXBvcnQgeyBTdWJzY3JpcHRpb24sIEJlaGF2aW9yU3ViamVjdCwgT2JzZXJ2YWJsZSB9IGZyb20gJ3J4anMnO1xyXG5cclxuaW1wb3J0IHsgQ214Q2hlY2tib3hDb21wb25lbnQgfSBmcm9tICdAY2VtZXgvY214LWNoZWNrYm94LXY0JztcclxuXHJcbmltcG9ydCB7IEZpbHRlciB9IGZyb20gJy4uLy4uL2NsYXNzZXMvZmlsdGVyLmNsYXNzJztcclxuaW1wb3J0IHsgV2F0Y2hlclNlcnZpY2UgfSBmcm9tICcuLi8uLi9zZXJ2aWNlcy93YXRjaGVyLnNlcnZpY2UnO1xyXG5pbXBvcnQgeyBDbXhUYWJsZUNvbXBvbmVudCB9IGZyb20gJy4uL2NteC10YWJsZS9jbXgtdGFibGUuY29tcG9uZW50JztcclxuXHJcbkBDb21wb25lbnQoe1xyXG4gICAgc2VsZWN0b3I6ICdjbXgtY2hlY2tib3gtZmlsdGVycycsXHJcbiAgICB0ZW1wbGF0ZVVybDogJy4vY214LWNoZWNrYm94LWZpbHRlcnMuY29tcG9uZW50Lmh0bWwnLFxyXG4gICAgc3R5bGVVcmxzOiBbJy4vLi4vLi4vLi4vLi4vLi4vLi4vLi4vLi4vLi4vc2Nzcy9jbXgtdGFibGUvdjEvY214LWNoZWNrYm94LWZpbHRlcnMuY29tcG9uZW50LnNjc3MnXVxyXG59KVxyXG5leHBvcnQgY2xhc3MgQ214Q2hlY2tib3hGaWx0ZXJzQ29tcG9uZW50IGltcGxlbWVudHMgQWZ0ZXJWaWV3SW5pdCwgT25EZXN0cm95IHtcclxuICAgIEBJbnB1dCgpXHJcbiAgICBzZXQgZmlsdGVycygkdmFsdWU6IEZpbHRlcltdKSB7XHJcbiAgICAgICAgaWYgKCR2YWx1ZSAhPT0gdW5kZWZpbmVkICYmICR2YWx1ZSAhPT0gbnVsbCkge1xyXG4gICAgICAgICAgICB0aGlzLl9maWx0ZXJzID0gJHZhbHVlO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIGdldCBmaWx0ZXJzKCk6IEZpbHRlcltdIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5fZmlsdGVycztcclxuICAgIH1cclxuICAgIEBJbnB1dCgpIHB1YmxpYyBzaG93QWxsT3B0aW9uID0gZmFsc2U7XHJcbiAgICBASW5wdXQoKSBwdWJsaWMgYWxsT3B0aW9uTmFtZSA9ICcnO1xyXG4gICAgQElucHV0KCkgcHVibGljIHNlYXJjaFBsYWNlaG9sZGVyID0gJyc7XHJcbiAgICBASW5wdXQoKSBwdWJsaWMgZW5hYmxlU2VhcmNoID0gZmFsc2U7XHJcblxyXG4gICAgQFZpZXdDaGlsZHJlbihmb3J3YXJkUmVmKCgpID0+IENteENoZWNrYm94Q29tcG9uZW50KSlcclxuICAgIHB1YmxpYyBjaGVja2JveGVzOiBRdWVyeUxpc3Q8Q214Q2hlY2tib3hDb21wb25lbnQ+O1xyXG4gICAgcHVibGljIHNlYXJjaFRlcm0gPSAnJztcclxuXHJcbiAgICBwdWJsaWMgYWxsRmlsdGVyOiBGaWx0ZXIgPSBuZXcgRmlsdGVyKCdBbGwnLCBudWxsLCBmYWxzZSwgbnVsbCk7XHJcbiAgICBwdWJsaWMgX2ZpbHRlcnM6IEZpbHRlcltdO1xyXG4gICAgcHVibGljIGlzUnRsID0gZmFsc2U7XHJcblxyXG4gICAgcHJpdmF0ZSBhY3RpdmVGaWx0ZXJzOiBCZWhhdmlvclN1YmplY3Q8Ym9vbGVhbj4gPSBuZXcgQmVoYXZpb3JTdWJqZWN0PGJvb2xlYW4+KGZhbHNlKTtcclxuICAgIHByaXZhdGUgY2hlY2tib3hTdWJzY3JpcHRpb25zOiBTdWJzY3JpcHRpb25bXSA9IFtdO1xyXG5cclxuICAgIGNvbnN0cnVjdG9yKHByaXZhdGUgd2F0Y2hlcjogV2F0Y2hlclNlcnZpY2UsIEBIb3N0KCkgcHJpdmF0ZSBwYXJlbnQ6IENteFRhYmxlQ29tcG9uZW50KSB7XHJcbiAgICAgICAgdGhpcy5pc1J0bCA9IHRoaXMucGFyZW50LnJ0bDtcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgbmdBZnRlclZpZXdJbml0KCk6IHZvaWQge1xyXG4gICAgICAgIHRoaXMubGlzdGVuVG9DaGVja2JveGVzKCk7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIG5nT25EZXN0cm95KCk6IHZvaWQge1xyXG4gICAgICAgIHRoaXMuZHJvcFN1YnNjcmlwdGlvbnMoKTtcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgbGlzdGVuVG9BY3RpdmVGaWx0ZXJzKCk6IE9ic2VydmFibGU8Ym9vbGVhbj4ge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmFjdGl2ZUZpbHRlcnMuYXNPYnNlcnZhYmxlKCk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBAZGVzY3JpcHRpb24gQ2hlY2tzIGFsbCBmaWx0ZXJzIHdoZW4gdGhlICdBbGwnIGNoZWNrYm94IGlzIGNsaWNrZWQuXHJcbiAgICAgKiBAcGFyYW0gYm9vbGVhbiAkZXZlbnQ6IFRoZSBldmVudCByZWNlaXZlZCBieSB0aGUgY2hhbmdlIGV2ZW50IG9mIHRoZSBjaGVja2JveC5cclxuICAgICAqL1xyXG4gICAgcHVibGljIHRvZ2dsZUFsbCgkZXZlbnQ6IGJvb2xlYW4pOiB2b2lkIHtcclxuICAgICAgICBpZiAodHlwZW9mICRldmVudCA9PT0gJ2Jvb2xlYW4nKSB7XHJcbiAgICAgICAgICAgIHRoaXMuYWxsRmlsdGVyLmFjdGl2ZSA9ICRldmVudDtcclxuICAgICAgICAgICAgdGhpcy5fZmlsdGVycy5mb3JFYWNoKChmaWx0ZXIpID0+IHtcclxuICAgICAgICAgICAgICAgIGlmIChmaWx0ZXIudmlzaWJsZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGZpbHRlci5hY3RpdmUgPSAkZXZlbnQ7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIEBkZXNjcmlwdGlvbiBUb2dnbGVzIHRoZSAnYWN0aXZlJyBhdHRyaWJ1dGUgb2YgYSBmaWx0ZXIgdG8gZW5hYmxlIG9yIGRpc2FibGUuXHJcbiAgICAgKiBAcGFyYW0gRmlsdGVyIGZpbHRlcjogVGhlIEZpbHRlciBvYmplY3QgdG8gdG9nZ2xlLlxyXG4gICAgICogQHBhcmFtIGJvb2xlYW4gJGV2ZW50OiBUaGUgZXZlbnQgcmVjZWl2ZWQgYnkgdGhlIGNoYW5nZSBldmVudCBvZiB0aGUgY2hlY2tib3guXHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyB0b2dnbGVGaWx0ZXIoZmlsdGVyOiBGaWx0ZXIsICRldmVudDogYm9vbGVhbikge1xyXG4gICAgICAgIGlmICh0eXBlb2YgJGV2ZW50ID09PSAnYm9vbGVhbicpIHtcclxuICAgICAgICAgICAgZmlsdGVyLmFjdGl2ZSA9ICRldmVudDtcclxuICAgICAgICAgICAgaWYgKCF0aGlzLnNob3dBbGxPcHRpb24pIHtcclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAoISRldmVudCkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5hbGxGaWx0ZXIuYWN0aXZlID0gZmFsc2U7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBsZXQgJGZpbHRlcnNPbkZhbHNlID0gMDtcclxuICAgICAgICAgICAgICAgIHRoaXMuZmlsdGVycy5mb3JFYWNoKCgkZmlsdGVyKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCRmaWx0ZXIuYWN0aXZlID09PSBmYWxzZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkZmlsdGVyc09uRmFsc2UrKztcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIHRoaXMuYWxsRmlsdGVyLmFjdGl2ZSA9ICgkZmlsdGVyc09uRmFsc2UgPT09IDApID8gdHJ1ZSA6IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgLy8gbGV0ICRoYXNBbGxGaWx0ZXJBY3RpdmU6IGJvb2xlYW4gPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgIC8vICRoYXNBbGxGaWx0ZXJBY3RpdmUgPSB0aGlzLl9maWx0ZXJzLmV2ZXJ5KGZ1bmN0aW9uKCRmaWx0ZXIpIHtcclxuICAgICAgICAgICAgICAgIC8vICAgICByZXR1cm4gJGZpbHRlci5hY3RpdmU7XHJcbiAgICAgICAgICAgICAgICAvLyB9KTtcclxuICAgICAgICAgICAgICAgIC8vIHRoaXMuYWxsRmlsdGVyLmFjdGl2ZSA9ICRoYXNBbGxGaWx0ZXJBY3RpdmU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIGNsZWFyU2VhcmNoKCk6IHZvaWQge1xyXG4gICAgICAgIHRoaXMuc2VhcmNoVGVybSA9ICcnO1xyXG4gICAgICAgIHRoaXMuZmlsdGVycy5mb3JFYWNoKCgkZmlsdGVyKSA9PiB7XHJcbiAgICAgICAgICAgICRmaWx0ZXIudmlzaWJsZSA9IHRydWU7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIHNlYXJjaEluRmlsdGVyKHRlcm06IHN0cmluZykge1xyXG4gICAgICAgIGlmICh0ZXJtLmxlbmd0aCA+PSA0IHx8IHRlcm0gPT09ICcnKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IGF1eCA9IHRlcm0udG9Mb3dlckNhc2UoKTtcclxuICAgICAgICAgICAgaWYgKGF1eCAhPT0gJycpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuZmlsdGVycy5maWx0ZXIoKHJvdykgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChyb3cubmFtZSAmJiByb3cubmFtZS50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKGF1eCkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcm93LnZpc2libGUgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJvdy52aXNpYmxlID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmNsZWFyU2VhcmNoKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBlbWl0RmlsdGVycygpOiB2b2lkIHtcclxuICAgICAgICB0aGlzLndhdGNoZXIuZW1pdEFjdGl2ZUZpbHRlcnModGhpcy5wYXJlbnQuYXNzaWduZWRJZCwgdGhpcy5fZmlsdGVycyk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBlbWl0QWN0aXZlQ2hlY2tib3hlcygpOiB2b2lkIHtcclxuICAgICAgICBjb25zdCBhY3RpdmVGaWx0ZXJzOiBhbnlbXSA9IFtdO1xyXG4gICAgICAgIHRoaXMuX2ZpbHRlcnMuZm9yRWFjaCggKCBmaWx0ZXIgKSA9PiB7XHJcbiAgICAgICAgICAgIGlmIChmaWx0ZXIuYWN0aXZlKSB7XHJcbiAgICAgICAgICAgICAgICBhY3RpdmVGaWx0ZXJzLnB1c2goIGZpbHRlciApO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgaWYgKGFjdGl2ZUZpbHRlcnMubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICB0aGlzLmFjdGl2ZUZpbHRlcnMubmV4dCh0cnVlKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICB0aGlzLmFjdGl2ZUZpbHRlcnMubmV4dChmYWxzZSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgbGlzdGVuVG9DaGVja2JveGVzKCk6IHZvaWQge1xyXG4gICAgICAgIHRoaXMuY2hlY2tib3hlcy5mb3JFYWNoKCgkY2hlY2tib3g6IENteENoZWNrYm94Q29tcG9uZW50KSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0ICRzdWJzY3JpcHRpb24gPSAkY2hlY2tib3guY2hhbmdlLnN1YnNjcmliZSgoJGNoZWNrZWQ6IGFueSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5lbWl0RmlsdGVycygpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5lbWl0QWN0aXZlQ2hlY2tib3hlcygpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgdGhpcy5jaGVja2JveFN1YnNjcmlwdGlvbnMucHVzaCgkc3Vic2NyaXB0aW9uKTtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGRyb3BTdWJzY3JpcHRpb25zKCk6IHZvaWQge1xyXG4gICAgICAgIHRoaXMuY2hlY2tib3hTdWJzY3JpcHRpb25zLmZvckVhY2goKCRzdWI6IFN1YnNjcmlwdGlvbikgPT4gJHN1Yi51bnN1YnNjcmliZSgpKTtcclxuICAgICAgICB0aGlzLmNoZWNrYm94U3Vic2NyaXB0aW9ucyA9IFtdO1xyXG4gICAgfVxyXG59XHJcbiJdfQ==
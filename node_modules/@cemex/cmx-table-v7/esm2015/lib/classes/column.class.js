/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Filter } from './filter.class';
export class Column {
    /**
     * @param {?} _name
     * @param {?} _columnKey
     * @param {?} _active
     * @param {?} _on
     * @param {?=} _nameValueKey
     * @param {?=} _filterValueKey
     * @param {?=} _hide
     */
    constructor(_name, _columnKey, _active, _on, _nameValueKey, _filterValueKey, _hide) {
        this.name = _name;
        this.columnKey = _columnKey;
        this.active = _active;
        this.on = _on;
        this.filters = [];
        this.nameValueKey = _nameValueKey;
        this.filterValueKey = _filterValueKey;
        this.hide = _hide;
    }
    /**
     * @return {?}
     */
    addDateFilter() {
        if (this.nameValueKey) {
            /** @type {?} */
            const dates = {
                min: new Date(),
                max: new Date()
            };
            /** @type {?} */
            const aux = new Filter(this.nameValueKey, dates, false, this.columnKey);
            this.dateFilter = aux;
        }
    }
    /**
     * @param {?} item
     * @param {?=} isDate
     * @return {?}
     */
    addFilter(item, isDate) {
        if (this.nameValueKey && this.filterValueKey) {
            /** @type {?} */
            const filter = this.filters.find((/**
             * @param {?} $element
             * @return {?}
             */
            ($element) => $element.value === item[this.filterValueKey]));
            if (filter === undefined) {
                /** @type {?} */
                const aux = new Filter(item[this.nameValueKey], item[this.filterValueKey], false, this.columnKey);
                this.filters.push(aux);
            }
        }
    }
    /**
     * @return {?}
     */
    getName() {
        return this.name;
    }
    /**
     * @return {?}
     */
    getKey() {
        return this.columnKey;
    }
    /**
     * @return {?}
     */
    getFilterNameKey() {
        return this.nameValueKey;
    }
    /**
     * @return {?}
     */
    getFilterValueKey() {
        return this.filterValueKey;
    }
    /**
     * @return {?}
     */
    getFilters() {
        return this.filters;
    }
    /**
     * @param {?} $filters
     * @return {?}
     */
    setFilters($filters) {
        this.filters = $filters;
    }
    /**
     * @return {?}
     */
    getDateFilter() {
        return this.dateFilter;
    }
    /**
     * @param {?} filter
     * @return {?}
     */
    getFilterFunction(filter) {
        if (this.filters.length > 0) {
            /** @type {?} */
            const aux = this.filters[0].value;
            if (typeof aux === 'number' && isFinite(aux)) {
                return this.numericFilterFunction(filter);
            }
            else {
                return this.commonFilterFunction(filter);
            }
            // array value && typeof value === 'object' && value.constructor === Array
            // object value && typeof value === 'object' && value.constructor === Object
        }
        if (this.dateFilter) {
            return this.dateFilterFunction(filter);
        }
        return undefined;
    }
    /**
     * @param {?} filter
     * @return {?}
     */
    commonFilterFunction(filter) {
        return (/**
         * @param {?} item
         * @return {?}
         */
        (item) => {
            return item[this.filterValueKey] === filter.value;
        });
    }
    /**
     * @param {?} filter
     * @return {?}
     */
    dateFilterFunction(filter) {
        return (/**
         * @param {?} item
         * @return {?}
         */
        (item) => {
            if (typeof filter.value.min === 'string') {
                filter.value.min = this.getDateObject(filter.value.min);
            }
            if (typeof filter.value.max === 'string') {
                filter.value.max = this.getDateObject(filter.value.max);
            }
            /** @type {?} */
            const min = filter.value.min.getTime();
            /** @type {?} */
            const max = filter.value.max.getTime();
            return (item[this.filterValueKey] !== undefined &&
                min <= item[this.filterValueKey].getTime() &&
                item[this.filterValueKey].getTime() <= max);
        });
    }
    /**
     * @param {?} filter
     * @return {?}
     */
    numericFilterFunction(filter) {
        return (/**
         * @param {?} item
         * @return {?}
         */
        (item) => {
            return item[this.filterValueKey] === filter.value;
            // return filter.value.min <= item[ this.filterValueKey ] &&
            // item[ this.filterValueKey ] <= filter.value.max;
        });
    }
    /**
     * @return {?}
     */
    clearFilters() {
        this.filters = [];
    }
    /**
     * @param {?} ASC
     * @return {?}
     */
    getSortFunction(ASC) {
        if (this.filters.length > 0) {
            /** @type {?} */
            const aux = this.filters[0].value;
            if (typeof aux === 'string' || aux instanceof String) {
                return this.stringSortFunction(ASC);
            }
            if (typeof aux === 'number' && isFinite(aux)) {
                return this.numericSortFunction(ASC);
            }
            if (typeof aux === 'boolean') {
                return this.booleanSortFunction(ASC);
            }
            // array value && typeof value === 'object' && value.constructor === Array
            // object value && typeof value === 'object' && value.constructor === Object
        }
        if (this.dateFilter) {
            return this.dateSortFunction(ASC);
        }
        return undefined;
    }
    /**
     * @private
     * @param {?} ASC
     * @return {?}
     */
    stringSortFunction(ASC) {
        return (/**
         * @param {?} a
         * @param {?} b
         * @return {?}
         */
        (a, b) => {
            if (a[this.filterValueKey] === undefined) {
                return 1;
            }
            /** @type {?} */
            const order = (ASC) ? 1 : -1;
            return order * a[this.filterValueKey].localeCompare(b[this.filterValueKey]);
        });
    }
    /**
     * @private
     * @param {?} ASC
     * @return {?}
     */
    numericSortFunction(ASC) {
        return (/**
         * @param {?} a
         * @param {?} b
         * @return {?}
         */
        (a, b) => {
            if (a[this.filterValueKey] === undefined) {
                /** @type {?} */
                const order = (ASC) ? 1 : -1;
                return order;
            }
            if (b[this.filterValueKey] === undefined) {
                /** @type {?} */
                const order = (ASC) ? -1 : 1;
                return order;
            }
            if (a[this.filterValueKey] < b[this.filterValueKey]) {
                /** @type {?} */
                const order = (ASC) ? -1 : 1;
                return order;
            }
            if (a[this.filterValueKey] > b[this.filterValueKey]) {
                /** @type {?} */
                const order = (ASC) ? 1 : -1;
                return order;
            }
            return 0;
        });
    }
    /**
     * @private
     * @param {?} ASC
     * @return {?}
     */
    booleanSortFunction(ASC) {
        return (/**
         * @param {?} a
         * @param {?} b
         * @return {?}
         */
        (a, b) => {
            if (a[this.filterValueKey] === undefined) {
                return 1;
            }
            if (a[this.filterValueKey] === true && b[this.filterValueKey] === false) {
                /** @type {?} */
                const order = (ASC) ? -1 : 1;
                return order;
            }
            if (a[this.filterValueKey] === false && b[this.filterValueKey] === true) {
                /** @type {?} */
                const order = (ASC) ? 1 : -1;
                return order;
            }
            return 0;
        });
    }
    /**
     * @private
     * @param {?} ASC
     * @return {?}
     */
    dateSortFunction(ASC) {
        return (/**
         * @param {?} a
         * @param {?} b
         * @return {?}
         */
        (a, b) => {
            if (a[this.filterValueKey] === undefined) {
                /** @type {?} */
                const order = (ASC) ? 1 : -1;
                return order;
            }
            if (b[this.filterValueKey] === undefined) {
                /** @type {?} */
                const order = (ASC) ? -1 : 1;
                return order;
            }
            if (a[this.filterValueKey].getTime() < b[this.filterValueKey].getTime()) {
                /** @type {?} */
                const order = (ASC) ? -1 : 1;
                return order;
            }
            if (a[this.filterValueKey].getTime() > b[this.filterValueKey].getTime()) {
                /** @type {?} */
                const order = (ASC) ? 1 : -1;
                return order;
            }
            return 0;
        });
    }
    /**
     * @private
     * @param {?} date
     * @return {?}
     */
    getDateObject(date) {
        /** @type {?} */
        const auxDate = date.replace(/-g/, '/');
        /** @type {?} */
        const bits = auxDate.split(/\D/);
        /** @type {?} */
        const month = parseInt(bits[1], 10) - 1;
        return new Date(bits[0], month, bits[2], bits[3], bits[4], bits[5]);
    }
}
if (false) {
    /** @type {?} */
    Column.prototype.active;
    /** @type {?} */
    Column.prototype.on;
    /** @type {?} */
    Column.prototype.hide;
    /**
     * @type {?}
     * @private
     */
    Column.prototype.name;
    /**
     * @type {?}
     * @private
     */
    Column.prototype.columnKey;
    /**
     * @type {?}
     * @private
     */
    Column.prototype.filters;
    /**
     * @type {?}
     * @private
     */
    Column.prototype.dateFilter;
    /**
     * @type {?}
     * @private
     */
    Column.prototype.nameValueKey;
    /**
     * @type {?}
     * @private
     */
    Column.prototype.filterValueKey;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29sdW1uLmNsYXNzLmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGNlbWV4L2NteC10YWJsZS12Ny8iLCJzb3VyY2VzIjpbImxpYi9jbGFzc2VzL2NvbHVtbi5jbGFzcy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O0FBQUEsT0FBTyxFQUFFLE1BQU0sRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBRXhDLE1BQU0sT0FBTyxNQUFNOzs7Ozs7Ozs7O0lBWWYsWUFDQSxLQUFhLEVBQUUsVUFBa0IsRUFBRSxPQUFnQixFQUFFLEdBQVksRUFDakUsYUFBc0IsRUFBRSxlQUF3QixFQUFFLEtBQWU7UUFDN0QsSUFBSSxDQUFDLElBQUksR0FBRyxLQUFLLENBQUM7UUFDbEIsSUFBSSxDQUFDLFNBQVMsR0FBRyxVQUFVLENBQUM7UUFDNUIsSUFBSSxDQUFDLE1BQU0sR0FBRyxPQUFPLENBQUM7UUFDdEIsSUFBSSxDQUFDLEVBQUUsR0FBRyxHQUFHLENBQUM7UUFDZCxJQUFJLENBQUMsT0FBTyxHQUFHLEVBQUUsQ0FBQztRQUNsQixJQUFJLENBQUMsWUFBWSxHQUFHLGFBQWEsQ0FBQztRQUNsQyxJQUFJLENBQUMsY0FBYyxHQUFHLGVBQWUsQ0FBQztRQUN0QyxJQUFJLENBQUMsSUFBSSxHQUFHLEtBQUssQ0FBQztJQUN0QixDQUFDOzs7O0lBRU0sYUFBYTtRQUNoQixJQUFLLElBQUksQ0FBQyxZQUFZLEVBQUc7O2tCQUNmLEtBQUssR0FBRztnQkFDVixHQUFHLEVBQUUsSUFBSSxJQUFJLEVBQUU7Z0JBQ2YsR0FBRyxFQUFFLElBQUksSUFBSSxFQUFFO2FBQ2xCOztrQkFDSyxHQUFHLEdBQUcsSUFBSSxNQUFNLENBQUUsSUFBSSxDQUFDLFlBQVksRUFBRSxLQUFLLEVBQUUsS0FBSyxFQUFFLElBQUksQ0FBQyxTQUFTLENBQUU7WUFDekUsSUFBSSxDQUFDLFVBQVUsR0FBRyxHQUFHLENBQUM7U0FDekI7SUFDTCxDQUFDOzs7Ozs7SUFFTSxTQUFTLENBQUUsSUFBUyxFQUFF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QUFjLENBQUUsQ0FBQyxPQUFPLEVBQUUsR0FBRyxDQUFDLENBQUUsSUFBSSxDQUFDLGNBQWMsQ0FBRSxDQUFDLE9BQU8sRUFBRSxFQUFHOztzQkFDckUsS0FBSyxHQUFHLENBQUUsR0FBRyxDQUFFLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO2dCQUM5QixPQUFPLEtBQUssQ0FBQzthQUNoQjtZQUNELE9BQU8sQ0FBQyxDQUFDO1FBQ2IsQ0FBQyxFQUFDO0lBQ04sQ0FBQzs7Ozs7O0lBRU8sYUFBYSxDQUFFLElBQVk7O2NBQ3pCLE9BQU8sR0FBRyxJQUFJLENBQUMsT0FBTyxDQUFFLElBQUksRUFBRSxHQUFHLENBQUU7O2NBQ25DLElBQUksR0FBUSxPQUFPLENBQUMsS0FBSyxDQUFFLElBQUksQ0FBRTs7Y0FDakMsS0FBSyxHQUFHLFFBQVEsQ0FBRSxJQUFJLENBQUMsQ0FBQyxDQUFDLEVBQUUsRUFBRSxDQUFFLEdBQUcsQ0FBQztRQUN6QyxPQUFPLElBQUksSUFBSSxDQUFFLElBQUksQ0FBQyxDQUFDLENBQUMsRUFBRSxLQUFLLEVBQUUsSUFBSSxDQUFDLENBQUMsQ0FBQyxFQUFFLElBQUksQ0FBQyxDQUFDLENBQUMsRUFBRSxJQUFJLENBQUMsQ0FBQyxDQUFDLEVBQUUsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFFLENBQUM7SUFDMUUsQ0FBQztDQUNKOzs7SUFsT0csd0JBQXVCOztJQUN2QixvQkFBbUI7O0lBQ25CLHNCQUFxQjs7Ozs7SUFFckIsc0JBQXFCOzs7OztJQUNyQiwyQkFBMEI7Ozs7O0lBQzFCLHlCQUEwQjs7Ozs7SUFDMUIsNEJBQTJCOzs7OztJQUMzQiw4QkFBNkI7Ozs7O0lBQzdCLGdDQUErQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEZpbHRlciB9IGZyb20gJy4vZmlsdGVyLmNsYXNzJztcclxuXHJcbmV4cG9ydCBjbGFzcyBDb2x1bW4ge1xyXG4gICAgcHVibGljIGFjdGl2ZTogYm9vbGVhbjtcclxuICAgIHB1YmxpYyBvbjogYm9vbGVhbjtcclxuICAgIHB1YmxpYyBoaWRlOiBib29sZWFuO1xyXG5cclxuICAgIHByaXZhdGUgbmFtZTogc3RyaW5nO1xyXG4gICAgcHJpdmF0ZSBjb2x1bW5LZXk6IHN0cmluZztcclxuICAgIHByaXZhdGUgZmlsdGVyczogRmlsdGVyW107XHJcbiAgICBwcml2YXRlIGRhdGVGaWx0ZXI6IEZpbHRlcjtcclxuICAgIHByaXZhdGUgbmFtZVZhbHVlS2V5OiBzdHJpbmc7XHJcbiAgICBwcml2YXRlIGZpbHRlclZhbHVlS2V5OiBzdHJpbmc7XHJcblxyXG4gICAgY29uc3RydWN0b3IoXHJcbiAgICBfbmFtZTogc3RyaW5nLCBfY29sdW1uS2V5OiBzdHJpbmcsIF9hY3RpdmU6IGJvb2xlYW4sIF9vbjogYm9vbGVhbixcclxuICAgIF9uYW1lVmFsdWVLZXk/OiBzdHJpbmcsIF9maWx0ZXJWYWx1ZUtleT86IHN0cmluZywgX2hpZGU/OiBib29sZWFuICkge1xyXG4gICAgICAgIHRoaXMubmFtZSA9IF9uYW1lO1xyXG4gICAgICAgIHRoaXMuY29sdW1uS2V5ID0gX2NvbHVtbktleTtcclxuICAgICAgICB0aGlzLmFjdGl2ZSA9IF9hY3RpdmU7XHJcbiAgICAgICAgdGhpcy5vbiA9IF9vbjtcclxuICAgICAgICB0aGlzLmZpbHRlcnMgPSBbXTtcclxuICAgICAgICB0aGlzLm5hbWVWYWx1ZUtleSA9IF9uYW1lVmFsdWVLZXk7XHJcbiAgICAgICAgdGhpcy5maWx0ZXJWYWx1ZUtleSA9IF9maWx0ZXJWYWx1ZUtleTtcclxuICAgICAgICB0aGlzLmhpZGUgPSBfaGlkZTtcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgYWRkRGF0ZUZpbHRlcigpOiB2b2lkIHtcclxuICAgICAgICBpZiAoIHRoaXMubmFtZVZhbHVlS2V5ICkge1xyXG4gICAgICAgICAgICBjb25zdCBkYXRlcyA9IHtcclxuICAgICAgICAgICAgICAgIG1pbjogbmV3IERhdGUoKSxcclxuICAgICAgICAgICAgICAgIG1heDogbmV3IERhdGUoKVxyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICBjb25zdCBhdXggPSBuZXcgRmlsdGVyKCB0aGlzLm5hbWVWYWx1ZUtleSwgZGF0ZXMsIGZhbHNlLCB0aGlzLmNvbHVtbktleSApO1xyXG4gICAgICAgICAgICB0aGlzLmRhdGVGaWx0ZXIgPSBhdXg7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBhZGRGaWx0ZXIoIGl0ZW06IGFueSwgaXNEYXRlPzogYm9vbGVhbiApOiB2b2lkIHtcclxuICAgICAgICBpZiAoIHRoaXMubmFtZVZhbHVlS2V5ICYmIHRoaXMuZmlsdGVyVmFsdWVLZXkgKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IGZpbHRlciA9IHRoaXMuZmlsdGVycy5maW5kKFxyXG4gICAgICAgICAgICAgICAgKCAkZWxlbWVudCApID0+ICRlbGVtZW50LnZhbHVlID09PSBpdGVtWyB0aGlzLmZpbHRlclZhbHVlS2V5IF1cclxuICAgICAgICAgICAgKTtcclxuICAgICAgICAgICAgaWYgKCBmaWx0ZXIgPT09IHVuZGVmaW5lZCApIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGF1eCA9IG5ldyBGaWx0ZXIoXHJcbiAgICAgICAgICAgICAgICAgICAgaXRlbVsgdGhpcy5uYW1lVmFsdWVLZXkgXSwgaXRlbVsgdGhpcy5maWx0ZXJWYWx1ZUtleSBdLCBmYWxzZSwgdGhpcy5jb2x1bW5LZXlcclxuICAgICAgICAgICAgICAgICk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmZpbHRlcnMucHVzaCggYXV4ICk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIGdldE5hbWUoKTogc3RyaW5nIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5uYW1lO1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBnZXRLZXkoKTogc3RyaW5nIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5jb2x1bW5LZXk7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIGdldEZpbHRlck5hbWVLZXkoKTogc3RyaW5nIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5uYW1lVmFsdWVLZXk7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIGdldEZpbHRlclZhbHVlS2V5KCk6IHN0cmluZyB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuZmlsdGVyVmFsdWVLZXk7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIGdldEZpbHRlcnMoKTogRmlsdGVyW10ge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmZpbHRlcnM7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIHNldEZpbHRlcnMoICRmaWx0ZXJzOiBGaWx0ZXJbXSApOiB2b2lkIHtcclxuICAgICAgICB0aGlzLmZpbHRlcnMgPSAkZmlsdGVycztcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgZ2V0RGF0ZUZpbHRlcigpOiBGaWx0ZXIge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmRhdGVGaWx0ZXI7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIGdldEZpbHRlckZ1bmN0aW9uKCBmaWx0ZXI6IEZpbHRlciApOiBhbnkge1xyXG4gICAgICAgIGlmICggdGhpcy5maWx0ZXJzLmxlbmd0aCA+IDAgKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IGF1eDogRmlsdGVyID0gdGhpcy5maWx0ZXJzWyAwIF0udmFsdWU7XHJcbiAgICAgICAgICAgIGlmICggdHlwZW9mIGF1eCA9PT0gJ251bWJlcicgJiYgaXNGaW5pdGUoIGF1eCApICkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMubnVtZXJpY0ZpbHRlckZ1bmN0aW9uKCBmaWx0ZXIgKTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmNvbW1vbkZpbHRlckZ1bmN0aW9uKCBmaWx0ZXIgKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAvLyBhcnJheSB2YWx1ZSAmJiB0eXBlb2YgdmFsdWUgPT09ICdvYmplY3QnICYmIHZhbHVlLmNvbnN0cnVjdG9yID09PSBBcnJheVxyXG4gICAgICAgICAgICAvLyBvYmplY3QgdmFsdWUgJiYgdHlwZW9mIHZhbHVlID09PSAnb2JqZWN0JyAmJiB2YWx1ZS5jb25zdHJ1Y3RvciA9PT0gT2JqZWN0XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICggdGhpcy5kYXRlRmlsdGVyICkge1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5kYXRlRmlsdGVyRnVuY3Rpb24oIGZpbHRlciApO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gdW5kZWZpbmVkO1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBjb21tb25GaWx0ZXJGdW5jdGlvbiggZmlsdGVyOiBGaWx0ZXIgKSB7XHJcbiAgICAgICAgcmV0dXJuICggaXRlbTogYW55ICkgPT4ge1xyXG4gICAgICAgICAgICByZXR1cm4gaXRlbVsgdGhpcy5maWx0ZXJWYWx1ZUtleSBdID09PSBmaWx0ZXIudmFsdWU7XHJcbiAgICAgICAgfTtcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgZGF0ZUZpbHRlckZ1bmN0aW9uKCBmaWx0ZXI6IEZpbHRlciApIHtcclxuICAgICAgICByZXR1cm4gKCBpdGVtOiBhbnkgKSA9PiB7XHJcbiAgICAgICAgICAgIGlmICggdHlwZW9mIGZpbHRlci52YWx1ZS5taW4gPT09ICdzdHJpbmcnICkge1xyXG4gICAgICAgICAgICAgICAgZmlsdGVyLnZhbHVlLm1pbiA9IHRoaXMuZ2V0RGF0ZU9iamVjdCggZmlsdGVyLnZhbHVlLm1pbiApO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmICggdHlwZW9mIGZpbHRlci52YWx1ZS5tYXggPT09ICdzdHJpbmcnICkge1xyXG4gICAgICAgICAgICAgICAgZmlsdGVyLnZhbHVlLm1heCA9IHRoaXMuZ2V0RGF0ZU9iamVjdCggZmlsdGVyLnZhbHVlLm1heCApO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGNvbnN0IG1pbiA9IGZpbHRlci52YWx1ZS5taW4uZ2V0VGltZSgpO1xyXG4gICAgICAgICAgICBjb25zdCBtYXggPSBmaWx0ZXIudmFsdWUubWF4LmdldFRpbWUoKTtcclxuICAgICAgICAgICAgcmV0dXJuICggaXRlbVsgdGhpcy5maWx0ZXJWYWx1ZUtleSBdICE9PSB1bmRlZmluZWQgJiZcclxuICAgICAgICAgICAgbWluIDw9IGl0ZW1bIHRoaXMuZmlsdGVyVmFsdWVLZXkgXS5nZXRUaW1lKCkgJiZcclxuICAgICAgICAgICAgaXRlbVsgdGhpcy5maWx0ZXJWYWx1ZUtleSBdLmdldFRpbWUoKSA8PSBtYXggKTtcclxuICAgICAgICB9O1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBudW1lcmljRmlsdGVyRnVuY3Rpb24oIGZpbHRlcjogRmlsdGVyICkge1xyXG4gICAgICAgIHJldHVybiAoIGl0ZW06IGFueSApID0+IHtcclxuICAgICAgICAgICAgcmV0dXJuIGl0ZW1bIHRoaXMuZmlsdGVyVmFsdWVLZXkgXSA9PT0gZmlsdGVyLnZhbHVlO1xyXG4gICAgICAgICAgICAvLyByZXR1cm4gZmlsdGVyLnZhbHVlLm1pbiA8PSBpdGVtWyB0aGlzLmZpbHRlclZhbHVlS2V5IF0gJiZcclxuICAgICAgICAgICAgLy8gaXRlbVsgdGhpcy5maWx0ZXJWYWx1ZUtleSBdIDw9IGZpbHRlci52YWx1ZS5tYXg7XHJcbiAgICAgICAgfTtcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgY2xlYXJGaWx0ZXJzKCk6IHZvaWQge1xyXG4gICAgICAgIHRoaXMuZmlsdGVycyA9IFtdO1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBnZXRTb3J0RnVuY3Rpb24oIEFTQzogYm9vbGVhbiApOiBhbnkge1xyXG4gICAgICAgIGlmICggdGhpcy5maWx0ZXJzLmxlbmd0aCA+IDAgKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IGF1eCA9IHRoaXMuZmlsdGVyc1sgMCBdLnZhbHVlO1xyXG4gICAgICAgICAgICBpZiAoIHR5cGVvZiBhdXggPT09ICdzdHJpbmcnIHx8IGF1eCBpbnN0YW5jZW9mIFN0cmluZyApIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnN0cmluZ1NvcnRGdW5jdGlvbiggQVNDICk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKCB0eXBlb2YgYXV4ID09PSAnbnVtYmVyJyAmJiBpc0Zpbml0ZSggYXV4ICkgKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5udW1lcmljU29ydEZ1bmN0aW9uKCBBU0MgKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAoIHR5cGVvZiBhdXggPT09ICdib29sZWFuJyApIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmJvb2xlYW5Tb3J0RnVuY3Rpb24oIEFTQyApO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIC8vIGFycmF5IHZhbHVlICYmIHR5cGVvZiB2YWx1ZSA9PT0gJ29iamVjdCcgJiYgdmFsdWUuY29uc3RydWN0b3IgPT09IEFycmF5XHJcbiAgICAgICAgICAgIC8vIG9iamVjdCB2YWx1ZSAmJiB0eXBlb2YgdmFsdWUgPT09ICdvYmplY3QnICYmIHZhbHVlLmNvbnN0cnVjdG9yID09PSBPYmplY3RcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKCB0aGlzLmRhdGVGaWx0ZXIgKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmRhdGVTb3J0RnVuY3Rpb24oIEFTQyApO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gdW5kZWZpbmVkO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgc3RyaW5nU29ydEZ1bmN0aW9uKCBBU0M6IGJvb2xlYW4gKSB7XHJcbiAgICAgICAgcmV0dXJuICggYTogYW55LCBiOiBhbnkgKSA9PiB7XHJcbiAgICAgICAgICAgIGlmICggYVsgdGhpcy5maWx0ZXJWYWx1ZUtleSBdID09PSB1bmRlZmluZWQgKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gMTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBjb25zdCBvcmRlciA9ICggQVNDICkgPyAxIDogLTE7XHJcbiAgICAgICAgICAgIHJldHVybiBvcmRlciAqIGFbIHRoaXMuZmlsdGVyVmFsdWVLZXkgXS5sb2NhbGVDb21wYXJlKCBiWyB0aGlzLmZpbHRlclZhbHVlS2V5IF0gKTtcclxuICAgICAgICB9O1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgbnVtZXJpY1NvcnRGdW5jdGlvbiggQVNDOiBib29sZWFuICkge1xyXG4gICAgICAgIHJldHVybiAoIGE6IGFueSwgYjogYW55ICkgPT4ge1xyXG4gICAgICAgICAgICBpZiAoIGFbIHRoaXMuZmlsdGVyVmFsdWVLZXkgXSA9PT0gdW5kZWZpbmVkICkge1xyXG4gICAgICAgICAgICAgICAgY29uc3Qgb3JkZXIgPSAoIEFTQyApID8gMSA6IC0xO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIG9yZGVyO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmICggYlsgdGhpcy5maWx0ZXJWYWx1ZUtleSBdID09PSB1bmRlZmluZWQgKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBvcmRlciA9ICggQVNDICkgPyAtMSA6IDE7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gb3JkZXI7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKCBhWyB0aGlzLmZpbHRlclZhbHVlS2V5IF0gPCBiWyB0aGlzLmZpbHRlclZhbHVlS2V5IF0gKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBvcmRlciA9ICggQVNDICkgPyAtMSA6IDE7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gb3JkZXI7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKCBhWyB0aGlzLmZpbHRlclZhbHVlS2V5IF0gPiBiWyB0aGlzLmZpbHRlclZhbHVlS2V5IF0gKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBvcmRlciA9ICggQVNDICkgPyAxIDogLTE7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gb3JkZXI7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIDA7XHJcbiAgICAgICAgfTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGJvb2xlYW5Tb3J0RnVuY3Rpb24oIEFTQzogYm9vbGVhbiApIHtcclxuICAgICAgICByZXR1cm4gKCBhOiBhbnksIGI6IGFueSApID0+IHtcclxuICAgICAgICAgICAgaWYgKCBhWyB0aGlzLmZpbHRlclZhbHVlS2V5IF0gPT09IHVuZGVmaW5lZCApIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiAxO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmICggYVsgdGhpcy5maWx0ZXJWYWx1ZUtleSBdID09PSB0cnVlICYmIGJbIHRoaXMuZmlsdGVyVmFsdWVLZXkgXSA9PT0gZmFsc2UgKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBvcmRlciA9ICggQVNDICkgPyAtMSA6IDE7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gb3JkZXI7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKCBhWyB0aGlzLmZpbHRlclZhbHVlS2V5IF0gPT09IGZhbHNlICYmIGJbIHRoaXMuZmlsdGVyVmFsdWVLZXkgXSA9PT0gdHJ1ZSApIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IG9yZGVyID0gKCBBU0MgKSA/IDEgOiAtMTtcclxuICAgICAgICAgICAgICAgIHJldHVybiBvcmRlcjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gMDtcclxuICAgICAgICB9O1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgZGF0ZVNvcnRGdW5jdGlvbiggQVNDOiBib29sZWFuICkge1xyXG4gICAgICAgIHJldHVybiAoIGE6IGFueSwgYjogYW55ICkgPT4ge1xyXG4gICAgICAgICAgICBpZiAoIGFbIHRoaXMuZmlsdGVyVmFsdWVLZXkgXSA9PT0gdW5kZWZpbmVkICkge1xyXG4gICAgICAgICAgICAgICAgY29uc3Qgb3JkZXIgPSAoIEFTQyApID8gMSA6IC0xO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIG9yZGVyO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmICggYlsgdGhpcy5maWx0ZXJWYWx1ZUtleSBdID09PSB1bmRlZmluZWQgKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBvcmRlciA9ICggQVNDICkgPyAtMSA6IDE7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gb3JkZXI7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKCBhWyB0aGlzLmZpbHRlclZhbHVlS2V5IF0uZ2V0VGltZSgpIDwgYlsgdGhpcy5maWx0ZXJWYWx1ZUtleSBdLmdldFRpbWUoKSApIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IG9yZGVyID0gKCBBU0MgKSA/IC0xIDogMTtcclxuICAgICAgICAgICAgICAgIHJldHVybiBvcmRlcjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAoIGFbIHRoaXMuZmlsdGVyVmFsdWVLZXkgXS5nZXRUaW1lKCkgPiBiWyB0aGlzLmZpbHRlclZhbHVlS2V5IF0uZ2V0VGltZSgpICkge1xyXG4gICAgICAgICAgICAgICAgY29uc3Qgb3JkZXIgPSAoIEFTQyApID8gMSA6IC0xO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIG9yZGVyO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiAwO1xyXG4gICAgICAgIH07XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBnZXREYXRlT2JqZWN0KCBkYXRlOiBzdHJpbmcgKTogRGF0ZSB7XHJcbiAgICAgICAgY29uc3QgYXV4RGF0ZSA9IGRhdGUucmVwbGFjZSggLy1nLywgJy8nICk7XHJcbiAgICAgICAgY29uc3QgYml0czogYW55ID0gYXV4RGF0ZS5zcGxpdCggL1xcRC8gKTtcclxuICAgICAgICBjb25zdCBtb250aCA9IHBhcnNlSW50KCBiaXRzWzFdLCAxMCApIC0gMTtcclxuICAgICAgICByZXR1cm4gbmV3IERhdGUoIGJpdHNbMF0sIG1vbnRoLCBiaXRzWzJdLCBiaXRzWzNdLCBiaXRzWzRdLCBiaXRzWzVdICk7XHJcbiAgICB9XHJcbn1cclxuIl19
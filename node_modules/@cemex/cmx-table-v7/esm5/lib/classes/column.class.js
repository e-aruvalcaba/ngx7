/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Filter } from './filter.class';
var Column = /** @class */ (function () {
    function Column(_name, _columnKey, _active, _on, _nameValueKey, _filterValueKey, _hide) {
        this.name = _name;
        this.columnKey = _columnKey;
        this.active = _active;
        this.on = _on;
        this.filters = [];
        this.nameValueKey = _nameValueKey;
        this.filterValueKey = _filterValueKey;
        this.hide = _hide;
    }
    /**
     * @return {?}
     */
    Column.prototype.addDateFilter = /**
     * @return {?}
     */
    function () {
        if (this.nameValueKey) {
            /** @type {?} */
            var dates = {
                min: new Date(),
                max: new Date()
            };
            /** @type {?} */
            var aux = new Filter(this.nameValueKey, dates, false, this.columnKey);
            this.dateFilter = aux;
        }
    };
    /**
     * @param {?} item
     * @param {?=} isDate
     * @return {?}
     */
    Column.prototype.addFilter = /**
     * @param {?} item
     * @param {?=} isDate
     * @return {?}
     */
    function (item, isDate) {
        var _this = this;
        if (this.nameValueKey && this.filterValueKey) {
            /** @type {?} */
            var filter = this.filters.find((/**
             * @param {?} $element
             * @return {?}
             */
            function ($element) { return $element.value === item[_this.filterValueKey]; }));
            if (filter === undefined) {
                /** @type {?} */
                var aux = new Filter(item[this.nameValueKey], item[this.filterValueKey], false, this.columnKey);
                this.filters.push(aux);
            }
        }
    };
    /**
     * @return {?}
     */
    Column.prototype.getName = /**
     * @return {?}
     */
    function () {
        return this.name;
    };
    /**
     * @return {?}
     */
    Column.prototype.getKey = /**
     * @return {?}
     */
    function () {
        return this.columnKey;
    };
    /**
     * @return {?}
     */
    Column.prototype.getFilterNameKey = /**
     * @return {?}
     */
    function () {
        return this.nameValueKey;
    };
    /**
     * @return {?}
     */
    Column.prototype.getFilterValueKey = /**
     * @return {?}
     */
    function () {
        return this.filterValueKey;
    };
    /**
     * @return {?}
     */
    Column.prototype.getFilters = /**
     * @return {?}
     */
    function () {
        return this.filters;
    };
    /**
     * @param {?} $filters
     * @return {?}
     */
    Column.prototype.setFilters = /**
     * @param {?} $filters
     * @return {?}
     */
    function ($filters) {
        this.filters = $filters;
    };
    /**
     * @return {?}
     */
    Column.prototype.getDateFilter = /**
     * @return {?}
     */
    function () {
        return this.dateFilter;
    };
    /**
     * @param {?} filter
     * @return {?}
     */
    Column.prototype.getFilterFunction = /**
     * @param {?} filter
     * @return {?}
     */
    function (filter) {
        if (this.filters.length > 0) {
            /** @type {?} */
            var aux = this.filters[0].value;
            if (typeof aux === 'number' && isFinite(aux)) {
                return this.numericFilterFunction(filter);
            }
            else {
                return this.commonFilterFunction(filter);
            }
            // array value && typeof value === 'object' && value.constructor === Array
            // object value && typeof value === 'object' && value.constructor === Object
        }
        if (this.dateFilter) {
            return this.dateFilterFunction(filter);
        }
        return undefined;
    };
    /**
     * @param {?} filter
     * @return {?}
     */
    Column.prototype.commonFilterFunction = /**
     * @param {?} filter
     * @return {?}
     */
    function (filter) {
        var _this = this;
        return (/**
         * @param {?} item
         * @return {?}
         */
        function (item) {
            return item[_this.filterValueKey] === filter.value;
        });
    };
    /**
     * @param {?} filter
     * @return {?}
     */
    Column.prototype.dateFilterFunction = /**
     * @param {?} filter
     * @return {?}
     */
    function (filter) {
        var _this = this;
        return (/**
         * @param {?} item
         * @return {?}
         */
        function (item) {
            if (typeof filter.value.min === 'string') {
                filter.value.min = _this.getDateObject(filter.value.min);
            }
            if (typeof filter.value.max === 'string') {
                filter.value.max = _this.getDateObject(filter.value.max);
            }
            /** @type {?} */
            var min = filter.value.min.getTime();
            /** @type {?} */
            var max = filter.value.max.getTime();
            return (item[_this.filterValueKey] !== undefined &&
                min <= item[_this.filterValueKey].getTime() &&
                item[_this.filterValueKey].getTime() <= max);
        });
    };
    /**
     * @param {?} filter
     * @return {?}
     */
    Column.prototype.numericFilterFunction = /**
     * @param {?} filter
     * @return {?}
     */
    function (filter) {
        var _this = this;
        return (/**
         * @param {?} item
         * @return {?}
         */
        function (item) {
            return item[_this.filterValueKey] === filter.value;
            // return filter.value.min <= item[ this.filterValueKey ] &&
            // item[ this.filterValueKey ] <= filter.value.max;
        });
    };
    /**
     * @return {?}
     */
    Column.prototype.clearFilters = /**
     * @return {?}
     */
    function () {
        this.filters = [];
    };
    /**
     * @param {?} ASC
     * @return {?}
     */
    Column.prototype.getSortFunction = /**
     * @param {?} ASC
     * @return {?}
     */
    function (ASC) {
        if (this.filters.length > 0) {
            /** @type {?} */
            var aux = this.filters[0].value;
            if (typeof aux === 'string' || aux instanceof String) {
                return this.stringSortFunction(ASC);
            }
            if (typeof aux === 'number' && isFinite(aux)) {
                return this.numericSortFunction(ASC);
            }
            if (typeof aux === 'boolean') {
                return this.booleanSortFunction(ASC);
            }
            // array value && typeof value === 'object' && value.constructor === Array
            // object value && typeof value === 'object' && value.constructor === Object
        }
        if (this.dateFilter) {
            return this.dateSortFunction(ASC);
        }
        return undefined;
    };
    /**
     * @private
     * @param {?} ASC
     * @return {?}
     */
    Column.prototype.stringSortFunction = /**
     * @private
     * @param {?} ASC
     * @return {?}
     */
    function (ASC) {
        var _this = this;
        return (/**
         * @param {?} a
         * @param {?} b
         * @return {?}
         */
        function (a, b) {
            if (a[_this.filterValueKey] === undefined) {
                return 1;
            }
            /** @type {?} */
            var order = (ASC) ? 1 : -1;
            return order * a[_this.filterValueKey].localeCompare(b[_this.filterValueKey]);
        });
    };
    /**
     * @private
     * @param {?} ASC
     * @return {?}
     */
    Column.prototype.numericSortFunction = /**
     * @private
     * @param {?} ASC
     * @return {?}
     */
    function (ASC) {
        var _this = this;
        return (/**
         * @param {?} a
         * @param {?} b
         * @return {?}
         */
        function (a, b) {
            if (a[_this.filterValueKey] === undefined) {
                /** @type {?} */
                var order = (ASC) ? 1 : -1;
                return order;
            }
            if (b[_this.filterValueKey] === undefined) {
                /** @type {?} */
                var order = (ASC) ? -1 : 1;
                return order;
            }
            if (a[_this.filterValueKey] < b[_this.filterValueKey]) {
                /** @type {?} */
                var order = (ASC) ? -1 : 1;
                return order;
            }
            if (a[_this.filterValueKey] > b[_this.filterValueKey]) {
                /** @type {?} */
                var order = (ASC) ? 1 : -1;
                return order;
            }
            return 0;
        });
    };
    /**
     * @private
     * @param {?} ASC
     * @return {?}
     */
    Column.prototype.booleanSortFunction = /**
     * @private
     * @param {?} ASC
     * @return {?}
     */
    function (ASC) {
        var _this = this;
        return (/**
         * @param {?} a
         * @param {?} b
         * @return {?}
         */
        function (a, b) {
            if (a[_this.filterValueKey] === undefined) {
                return 1;
            }
            if (a[_this.filterValueKey] === true && b[_this.filterValueKey] === false) {
                /** @type {?} */
                var order = (ASC) ? -1 : 1;
                return order;
            }
            if (a[_this.filterValueKey] === false && b[_this.filterValueKey] === true) {
                /** @type {?} */
                var order = (ASC) ? 1 : -1;
                return order;
            }
            return 0;
        });
    };
    /**
     * @private
     * @param {?} ASC
     * @return {?}
     */
    Column.prototype.dateSortFunction = /**
     * @private
     * @param {?} ASC
     * @return {?}
     */
    function (ASC) {
        var _this = this;
        return (/**
         * @param {?} a
         * @param {?} b
         * @return {?}
         */
        function (a, b) {
            if (a[_this.filterValueKey] === undefined) {
                /** @type {?} */
                var order = (ASC) ? 1 : -1;
                return order;
            }
            if (b[_this.filterValueKey] === undefined) {
                /** @type {?} */
                var order = (ASC) ? -1 : 1;
                return order;
            }
            if (a[_this.filterValueKey].getTime() < b[_this.filterValueKey].getTime()) {
                /** @type {?} */
                var order = (ASC) ? -1 : 1;
                return order;
            }
            if (a[_this.filterValueKey].getTime() > b[_this.filterValueKey].getTime()) {
                /** @type {?} */
                var order = (ASC) ? 1 : -1;
                return order;
            }
            return 0;
        });
    };
    /**
     * @private
     * @param {?} date
     * @return {?}
     */
    Column.prototype.getDateObject = /**
     * @private
     * @param {?} date
     * @return {?}
     */
    function (date) {
        /** @type {?} */
        var auxDate = date.replace(/-g/, '/');
        /** @type {?} */
        var bits = auxDate.split(/\D/);
        /** @type {?} */
        var month = parseInt(bits[1], 10) - 1;
        return new Date(bits[0], month, bits[2], bits[3], bits[4], bits[5]);
    };
    return Column;
}());
export { Column };
if (false) {
    /** @type {?} */
    Column.prototype.active;
    /** @type {?} */
    Column.prototype.on;
    /** @type {?} */
    Column.prototype.hide;
    /**
     * @type {?}
     * @private
     */
    Column.prototype.name;
    /**
     * @type {?}
     * @private
     */
    Column.prototype.columnKey;
    /**
     * @type {?}
     * @private
     */
    Column.prototype.filters;
    /**
     * @type {?}
     * @private
     */
    Column.prototype.dateFilter;
    /**
     * @type {?}
     * @private
     */
    Column.prototype.nameValueKey;
    /**
     * @type {?}
     * @private
     */
    Column.prototype.filterValueKey;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29sdW1uLmNsYXNzLmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGNlbWV4L2NteC10YWJsZS12Ny8iLCJzb3VyY2VzIjpbImxpYi9jbGFzc2VzL2NvbHVtbi5jbGFzcy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O0FBQUEsT0FBTyxFQUFFLE1BQU0sRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBRXhDO0lBWUksZ0JBQ0EsS0FBYSxFQUFFLFVBQWtCLEVBQUUsT0FBZ0IsRUFBRSxHQUFZLEVBQ2pFLGFBQXNCLEVBQUUsZUFBd0IsRUFBRSxLQUFlO1FBQzdELElBQUksQ0FBQyxJQUFJLEdBQUcsS0FBSyxDQUFDO1FBQ2xCLElBQUksQ0FBQyxTQUFTLEdBQUcsVUFBVSxDQUFDO1FBQzVCLElBQUksQ0FBQyxNQUFNLEdBQUcsT0FBTyxDQUFDO1FBQ3RCLElBQUksQ0FBQyxFQUFFLEdBQUcsR0FBRyxDQUFDO1FBQ2QsSUFBSSxDQUFDLE9BQU8sR0FBRyxFQUFFLENBQUM7UUFDbEIsSUFBSSxDQUFDLFlBQVksR0FBRyxhQUFhLENBQUM7UUFDbEMsSUFBSSxDQUFDLGNBQWMsR0FBRyxlQUFlLENBQUM7UUFDdEMsSUFBSSxDQUFDLElBQUksR0FBRyxLQUFLLENBQUM7SUFDdEIsQ0FBQzs7OztJQUVNLDhCQUFhOzs7SUFBcEI7UUFDSSxJQUFLLElBQUksQ0FBQyxZQUFZLEVBQUc7O2dCQUNmLEtBQUssR0FBRztnQkFDVixHQUFHLEVBQUUsSUFBSSxJQUFJLEVBQUU7Z0JBQ2YsR0FBRyxFQUFFLElBQUksSUFBSSxFQUFFO2FBQ2xCOztnQkFDSyxHQUFHLEdBQUcsSUFBSSxNQUFNLENBQUUsSUFBSSxDQUFDLFlBQVksRUFBRSxLQUFLLEVBQUUsS0FBSyxFQUFFLElBQUksQ0FBQyxTQUFTLENBQUU7WUFDekUsSUFBSSxDQUFDLFVBQVUsR0FBRyxHQUFHLENBQUM7U0FDekI7SUFDTCxDQUFDOzs7Ozs7SUFFTSwwQkFBUzs7Ozs7SUFBaEIsVUFBa0IsSUFBUyxFQUFFLE1B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OztJQUNyQiwyQkFBMEI7Ozs7O0lBQzFCLHlCQUEwQjs7Ozs7SUFDMUIsNEJBQTJCOzs7OztJQUMzQiw4QkFBNkI7Ozs7O0lBQzdCLGdDQUErQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEZpbHRlciB9IGZyb20gJy4vZmlsdGVyLmNsYXNzJztcclxuXHJcbmV4cG9ydCBjbGFzcyBDb2x1bW4ge1xyXG4gICAgcHVibGljIGFjdGl2ZTogYm9vbGVhbjtcclxuICAgIHB1YmxpYyBvbjogYm9vbGVhbjtcclxuICAgIHB1YmxpYyBoaWRlOiBib29sZWFuO1xyXG5cclxuICAgIHByaXZhdGUgbmFtZTogc3RyaW5nO1xyXG4gICAgcHJpdmF0ZSBjb2x1bW5LZXk6IHN0cmluZztcclxuICAgIHByaXZhdGUgZmlsdGVyczogRmlsdGVyW107XHJcbiAgICBwcml2YXRlIGRhdGVGaWx0ZXI6IEZpbHRlcjtcclxuICAgIHByaXZhdGUgbmFtZVZhbHVlS2V5OiBzdHJpbmc7XHJcbiAgICBwcml2YXRlIGZpbHRlclZhbHVlS2V5OiBzdHJpbmc7XHJcblxyXG4gICAgY29uc3RydWN0b3IoXHJcbiAgICBfbmFtZTogc3RyaW5nLCBfY29sdW1uS2V5OiBzdHJpbmcsIF9hY3RpdmU6IGJvb2xlYW4sIF9vbjogYm9vbGVhbixcclxuICAgIF9uYW1lVmFsdWVLZXk/OiBzdHJpbmcsIF9maWx0ZXJWYWx1ZUtleT86IHN0cmluZywgX2hpZGU/OiBib29sZWFuICkge1xyXG4gICAgICAgIHRoaXMubmFtZSA9IF9uYW1lO1xyXG4gICAgICAgIHRoaXMuY29sdW1uS2V5ID0gX2NvbHVtbktleTtcclxuICAgICAgICB0aGlzLmFjdGl2ZSA9IF9hY3RpdmU7XHJcbiAgICAgICAgdGhpcy5vbiA9IF9vbjtcclxuICAgICAgICB0aGlzLmZpbHRlcnMgPSBbXTtcclxuICAgICAgICB0aGlzLm5hbWVWYWx1ZUtleSA9IF9uYW1lVmFsdWVLZXk7XHJcbiAgICAgICAgdGhpcy5maWx0ZXJWYWx1ZUtleSA9IF9maWx0ZXJWYWx1ZUtleTtcclxuICAgICAgICB0aGlzLmhpZGUgPSBfaGlkZTtcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgYWRkRGF0ZUZpbHRlcigpOiB2b2lkIHtcclxuICAgICAgICBpZiAoIHRoaXMubmFtZVZhbHVlS2V5ICkge1xyXG4gICAgICAgICAgICBjb25zdCBkYXRlcyA9IHtcclxuICAgICAgICAgICAgICAgIG1pbjogbmV3IERhdGUoKSxcclxuICAgICAgICAgICAgICAgIG1heDogbmV3IERhdGUoKVxyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICBjb25zdCBhdXggPSBuZXcgRmlsdGVyKCB0aGlzLm5hbWVWYWx1ZUtleSwgZGF0ZXMsIGZhbHNlLCB0aGlzLmNvbHVtbktleSApO1xyXG4gICAgICAgICAgICB0aGlzLmRhdGVGaWx0ZXIgPSBhdXg7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBhZGRGaWx0ZXIoIGl0ZW06IGFueSwgaXNEYXRlPzogYm9vbGVhbiApOiB2b2lkIHtcclxuICAgICAgICBpZiAoIHRoaXMubmFtZVZhbHVlS2V5ICYmIHRoaXMuZmlsdGVyVmFsdWVLZXkgKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IGZpbHRlciA9IHRoaXMuZmlsdGVycy5maW5kKFxyXG4gICAgICAgICAgICAgICAgKCAkZWxlbWVudCApID0+ICRlbGVtZW50LnZhbHVlID09PSBpdGVtWyB0aGlzLmZpbHRlclZhbHVlS2V5IF1cclxuICAgICAgICAgICAgKTtcclxuICAgICAgICAgICAgaWYgKCBmaWx0ZXIgPT09IHVuZGVmaW5lZCApIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGF1eCA9IG5ldyBGaWx0ZXIoXHJcbiAgICAgICAgICAgICAgICAgICAgaXRlbVsgdGhpcy5uYW1lVmFsdWVLZXkgXSwgaXRlbVsgdGhpcy5maWx0ZXJWYWx1ZUtleSBdLCBmYWxzZSwgdGhpcy5jb2x1bW5LZXlcclxuICAgICAgICAgICAgICAgICk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmZpbHRlcnMucHVzaCggYXV4ICk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIGdldE5hbWUoKTogc3RyaW5nIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5uYW1lO1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBnZXRLZXkoKTogc3RyaW5nIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5jb2x1bW5LZXk7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIGdldEZpbHRlck5hbWVLZXkoKTogc3RyaW5nIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5uYW1lVmFsdWVLZXk7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIGdldEZpbHRlclZhbHVlS2V5KCk6IHN0cmluZyB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuZmlsdGVyVmFsdWVLZXk7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIGdldEZpbHRlcnMoKTogRmlsdGVyW10ge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmZpbHRlcnM7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIHNldEZpbHRlcnMoICRmaWx0ZXJzOiBGaWx0ZXJbXSApOiB2b2lkIHtcclxuICAgICAgICB0aGlzLmZpbHRlcnMgPSAkZmlsdGVycztcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgZ2V0RGF0ZUZpbHRlcigpOiBGaWx0ZXIge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmRhdGVGaWx0ZXI7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIGdldEZpbHRlckZ1bmN0aW9uKCBmaWx0ZXI6IEZpbHRlciApOiBhbnkge1xyXG4gICAgICAgIGlmICggdGhpcy5maWx0ZXJzLmxlbmd0aCA+IDAgKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IGF1eDogRmlsdGVyID0gdGhpcy5maWx0ZXJzWyAwIF0udmFsdWU7XHJcbiAgICAgICAgICAgIGlmICggdHlwZW9mIGF1eCA9PT0gJ251bWJlcicgJiYgaXNGaW5pdGUoIGF1eCApICkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMubnVtZXJpY0ZpbHRlckZ1bmN0aW9uKCBmaWx0ZXIgKTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmNvbW1vbkZpbHRlckZ1bmN0aW9uKCBmaWx0ZXIgKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAvLyBhcnJheSB2YWx1ZSAmJiB0eXBlb2YgdmFsdWUgPT09ICdvYmplY3QnICYmIHZhbHVlLmNvbnN0cnVjdG9yID09PSBBcnJheVxyXG4gICAgICAgICAgICAvLyBvYmplY3QgdmFsdWUgJiYgdHlwZW9mIHZhbHVlID09PSAnb2JqZWN0JyAmJiB2YWx1ZS5jb25zdHJ1Y3RvciA9PT0gT2JqZWN0XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICggdGhpcy5kYXRlRmlsdGVyICkge1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5kYXRlRmlsdGVyRnVuY3Rpb24oIGZpbHRlciApO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gdW5kZWZpbmVkO1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBjb21tb25GaWx0ZXJGdW5jdGlvbiggZmlsdGVyOiBGaWx0ZXIgKSB7XHJcbiAgICAgICAgcmV0dXJuICggaXRlbTogYW55ICkgPT4ge1xyXG4gICAgICAgICAgICByZXR1cm4gaXRlbVsgdGhpcy5maWx0ZXJWYWx1ZUtleSBdID09PSBmaWx0ZXIudmFsdWU7XHJcbiAgICAgICAgfTtcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgZGF0ZUZpbHRlckZ1bmN0aW9uKCBmaWx0ZXI6IEZpbHRlciApIHtcclxuICAgICAgICByZXR1cm4gKCBpdGVtOiBhbnkgKSA9PiB7XHJcbiAgICAgICAgICAgIGlmICggdHlwZW9mIGZpbHRlci52YWx1ZS5taW4gPT09ICdzdHJpbmcnICkge1xyXG4gICAgICAgICAgICAgICAgZmlsdGVyLnZhbHVlLm1pbiA9IHRoaXMuZ2V0RGF0ZU9iamVjdCggZmlsdGVyLnZhbHVlLm1pbiApO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmICggdHlwZW9mIGZpbHRlci52YWx1ZS5tYXggPT09ICdzdHJpbmcnICkge1xyXG4gICAgICAgICAgICAgICAgZmlsdGVyLnZhbHVlLm1heCA9IHRoaXMuZ2V0RGF0ZU9iamVjdCggZmlsdGVyLnZhbHVlLm1heCApO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGNvbnN0IG1pbiA9IGZpbHRlci52YWx1ZS5taW4uZ2V0VGltZSgpO1xyXG4gICAgICAgICAgICBjb25zdCBtYXggPSBmaWx0ZXIudmFsdWUubWF4LmdldFRpbWUoKTtcclxuICAgICAgICAgICAgcmV0dXJuICggaXRlbVsgdGhpcy5maWx0ZXJWYWx1ZUtleSBdICE9PSB1bmRlZmluZWQgJiZcclxuICAgICAgICAgICAgbWluIDw9IGl0ZW1bIHRoaXMuZmlsdGVyVmFsdWVLZXkgXS5nZXRUaW1lKCkgJiZcclxuICAgICAgICAgICAgaXRlbVsgdGhpcy5maWx0ZXJWYWx1ZUtleSBdLmdldFRpbWUoKSA8PSBtYXggKTtcclxuICAgICAgICB9O1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBudW1lcmljRmlsdGVyRnVuY3Rpb24oIGZpbHRlcjogRmlsdGVyICkge1xyXG4gICAgICAgIHJldHVybiAoIGl0ZW06IGFueSApID0+IHtcclxuICAgICAgICAgICAgcmV0dXJuIGl0ZW1bIHRoaXMuZmlsdGVyVmFsdWVLZXkgXSA9PT0gZmlsdGVyLnZhbHVlO1xyXG4gICAgICAgICAgICAvLyByZXR1cm4gZmlsdGVyLnZhbHVlLm1pbiA8PSBpdGVtWyB0aGlzLmZpbHRlclZhbHVlS2V5IF0gJiZcclxuICAgICAgICAgICAgLy8gaXRlbVsgdGhpcy5maWx0ZXJWYWx1ZUtleSBdIDw9IGZpbHRlci52YWx1ZS5tYXg7XHJcbiAgICAgICAgfTtcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgY2xlYXJGaWx0ZXJzKCk6IHZvaWQge1xyXG4gICAgICAgIHRoaXMuZmlsdGVycyA9IFtdO1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBnZXRTb3J0RnVuY3Rpb24oIEFTQzogYm9vbGVhbiApOiBhbnkge1xyXG4gICAgICAgIGlmICggdGhpcy5maWx0ZXJzLmxlbmd0aCA+IDAgKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IGF1eCA9IHRoaXMuZmlsdGVyc1sgMCBdLnZhbHVlO1xyXG4gICAgICAgICAgICBpZiAoIHR5cGVvZiBhdXggPT09ICdzdHJpbmcnIHx8IGF1eCBpbnN0YW5jZW9mIFN0cmluZyApIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnN0cmluZ1NvcnRGdW5jdGlvbiggQVNDICk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKCB0eXBlb2YgYXV4ID09PSAnbnVtYmVyJyAmJiBpc0Zpbml0ZSggYXV4ICkgKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5udW1lcmljU29ydEZ1bmN0aW9uKCBBU0MgKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAoIHR5cGVvZiBhdXggPT09ICdib29sZWFuJyApIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmJvb2xlYW5Tb3J0RnVuY3Rpb24oIEFTQyApO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIC8vIGFycmF5IHZhbHVlICYmIHR5cGVvZiB2YWx1ZSA9PT0gJ29iamVjdCcgJiYgdmFsdWUuY29uc3RydWN0b3IgPT09IEFycmF5XHJcbiAgICAgICAgICAgIC8vIG9iamVjdCB2YWx1ZSAmJiB0eXBlb2YgdmFsdWUgPT09ICdvYmplY3QnICYmIHZhbHVlLmNvbnN0cnVjdG9yID09PSBPYmplY3RcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKCB0aGlzLmRhdGVGaWx0ZXIgKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmRhdGVTb3J0RnVuY3Rpb24oIEFTQyApO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gdW5kZWZpbmVkO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgc3RyaW5nU29ydEZ1bmN0aW9uKCBBU0M6IGJvb2xlYW4gKSB7XHJcbiAgICAgICAgcmV0dXJuICggYTogYW55LCBiOiBhbnkgKSA9PiB7XHJcbiAgICAgICAgICAgIGlmICggYVsgdGhpcy5maWx0ZXJWYWx1ZUtleSBdID09PSB1bmRlZmluZWQgKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gMTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBjb25zdCBvcmRlciA9ICggQVNDICkgPyAxIDogLTE7XHJcbiAgICAgICAgICAgIHJldHVybiBvcmRlciAqIGFbIHRoaXMuZmlsdGVyVmFsdWVLZXkgXS5sb2NhbGVDb21wYXJlKCBiWyB0aGlzLmZpbHRlclZhbHVlS2V5IF0gKTtcclxuICAgICAgICB9O1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgbnVtZXJpY1NvcnRGdW5jdGlvbiggQVNDOiBib29sZWFuICkge1xyXG4gICAgICAgIHJldHVybiAoIGE6IGFueSwgYjogYW55ICkgPT4ge1xyXG4gICAgICAgICAgICBpZiAoIGFbIHRoaXMuZmlsdGVyVmFsdWVLZXkgXSA9PT0gdW5kZWZpbmVkICkge1xyXG4gICAgICAgICAgICAgICAgY29uc3Qgb3JkZXIgPSAoIEFTQyApID8gMSA6IC0xO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIG9yZGVyO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmICggYlsgdGhpcy5maWx0ZXJWYWx1ZUtleSBdID09PSB1bmRlZmluZWQgKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBvcmRlciA9ICggQVNDICkgPyAtMSA6IDE7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gb3JkZXI7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKCBhWyB0aGlzLmZpbHRlclZhbHVlS2V5IF0gPCBiWyB0aGlzLmZpbHRlclZhbHVlS2V5IF0gKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBvcmRlciA9ICggQVNDICkgPyAtMSA6IDE7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gb3JkZXI7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKCBhWyB0aGlzLmZpbHRlclZhbHVlS2V5IF0gPiBiWyB0aGlzLmZpbHRlclZhbHVlS2V5IF0gKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBvcmRlciA9ICggQVNDICkgPyAxIDogLTE7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gb3JkZXI7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIDA7XHJcbiAgICAgICAgfTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGJvb2xlYW5Tb3J0RnVuY3Rpb24oIEFTQzogYm9vbGVhbiApIHtcclxuICAgICAgICByZXR1cm4gKCBhOiBhbnksIGI6IGFueSApID0+IHtcclxuICAgICAgICAgICAgaWYgKCBhWyB0aGlzLmZpbHRlclZhbHVlS2V5IF0gPT09IHVuZGVmaW5lZCApIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiAxO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmICggYVsgdGhpcy5maWx0ZXJWYWx1ZUtleSBdID09PSB0cnVlICYmIGJbIHRoaXMuZmlsdGVyVmFsdWVLZXkgXSA9PT0gZmFsc2UgKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBvcmRlciA9ICggQVNDICkgPyAtMSA6IDE7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gb3JkZXI7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKCBhWyB0aGlzLmZpbHRlclZhbHVlS2V5IF0gPT09IGZhbHNlICYmIGJbIHRoaXMuZmlsdGVyVmFsdWVLZXkgXSA9PT0gdHJ1ZSApIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IG9yZGVyID0gKCBBU0MgKSA/IDEgOiAtMTtcclxuICAgICAgICAgICAgICAgIHJldHVybiBvcmRlcjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gMDtcclxuICAgICAgICB9O1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgZGF0ZVNvcnRGdW5jdGlvbiggQVNDOiBib29sZWFuICkge1xyXG4gICAgICAgIHJldHVybiAoIGE6IGFueSwgYjogYW55ICkgPT4ge1xyXG4gICAgICAgICAgICBpZiAoIGFbIHRoaXMuZmlsdGVyVmFsdWVLZXkgXSA9PT0gdW5kZWZpbmVkICkge1xyXG4gICAgICAgICAgICAgICAgY29uc3Qgb3JkZXIgPSAoIEFTQyApID8gMSA6IC0xO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIG9yZGVyO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmICggYlsgdGhpcy5maWx0ZXJWYWx1ZUtleSBdID09PSB1bmRlZmluZWQgKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBvcmRlciA9ICggQVNDICkgPyAtMSA6IDE7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gb3JkZXI7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKCBhWyB0aGlzLmZpbHRlclZhbHVlS2V5IF0uZ2V0VGltZSgpIDwgYlsgdGhpcy5maWx0ZXJWYWx1ZUtleSBdLmdldFRpbWUoKSApIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IG9yZGVyID0gKCBBU0MgKSA/IC0xIDogMTtcclxuICAgICAgICAgICAgICAgIHJldHVybiBvcmRlcjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAoIGFbIHRoaXMuZmlsdGVyVmFsdWVLZXkgXS5nZXRUaW1lKCkgPiBiWyB0aGlzLmZpbHRlclZhbHVlS2V5IF0uZ2V0VGltZSgpICkge1xyXG4gICAgICAgICAgICAgICAgY29uc3Qgb3JkZXIgPSAoIEFTQyApID8gMSA6IC0xO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIG9yZGVyO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiAwO1xyXG4gICAgICAgIH07XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBnZXREYXRlT2JqZWN0KCBkYXRlOiBzdHJpbmcgKTogRGF0ZSB7XHJcbiAgICAgICAgY29uc3QgYXV4RGF0ZSA9IGRhdGUucmVwbGFjZSggLy1nLywgJy8nICk7XHJcbiAgICAgICAgY29uc3QgYml0czogYW55ID0gYXV4RGF0ZS5zcGxpdCggL1xcRC8gKTtcclxuICAgICAgICBjb25zdCBtb250aCA9IHBhcnNlSW50KCBiaXRzWzFdLCAxMCApIC0gMTtcclxuICAgICAgICByZXR1cm4gbmV3IERhdGUoIGJpdHNbMF0sIG1vbnRoLCBiaXRzWzJdLCBiaXRzWzNdLCBiaXRzWzRdLCBiaXRzWzVdICk7XHJcbiAgICB9XHJcbn1cclxuIl19
/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Injectable, } from '@angular/core';
import { CmxDialogComponent } from './../components/cmx-dialog/cmx-dialog.component';
import { CmxDialogConfirmationComponent } from '../components/cmx-dialog-confirmation/cmx-dialog-confirmation.component';
import { ConfirmationType } from '../components/cmx-dialog-confirmation/cmx-dialog-confirmation.component';
import * as i0 from "@angular/core";
export class CmxDialogGeneratorService {
    constructor() {
        this.dialogDelay = 100;
        this.defaultSuccessMessage = 'This is a dynamically generated confirmation success dialog';
        this.defaultWarningMessage = 'This is a dynamically generated confirmation warning dialog';
        this.defaultErrorMessage = 'This is a dynamically generated confirmation error dialog';
        this.defaultErrorMessageDetail = 'This is a message detail';
    }
    /**
     * @param {?} viewContainerRef
     * @param {?} componentFactoryResolver
     * @param {?} options
     * @return {?}
     */
    createConfirmationDialog(viewContainerRef, componentFactoryResolver, options) {
        // tslint:disable-next-line:max-line-length
        /** @type {?} */
        const componentFactory = componentFactoryResolver.resolveComponentFactory(CmxDialogConfirmationComponent);
        /** @type {?} */
        const componentRef = viewContainerRef.createComponent(componentFactory);
        // tslint:disable-next-line:typedef
        /** @type {?} */
        const component = ((/** @type {?} */ (componentRef.instance)));
        this.setDialogSubscriptions(options, component.dialog);
        this.openConfirmationDialog(options, component);
        return component;
    }
    /* experimental */
    /**
     * @param {?} viewContainerRef
     * @param {?} componentFactoryResolver
     * @param {?} componentTemplate
     * @param {?} options
     * @return {?}
     */
    createCustomDialog(viewContainerRef, componentFactoryResolver, componentTemplate, options) {
        /** @type {?} */
        const componentFactory = componentFactoryResolver.resolveComponentFactory(CmxDialogComponent);
        /** @type {?} */
        const componentRef = viewContainerRef.createComponent(componentFactory);
        // tslint:disable-next-line:typedef
        /** @type {?} */
        const component = ((/** @type {?} */ (componentRef.instance)));
        if (!(componentTemplate instanceof CmxDialogComponent)) {
            return component;
        }
        this.setDialogComponent(component, componentTemplate);
        this.setDialogComponentTimer(options, component);
        return component;
    }
    /**
     * @private
     * @param {?} options
     * @param {?} component
     * @return {?}
     */
    setDialogSubscriptions(options, component) {
        if (options.afterClosed) {
            component.afterClosed().subscribe(options.afterClosed());
        }
        if (options.afterOpened) {
            component.afterOpened().subscribe(options.afterOpened());
        }
    }
    /**
     * @private
     * @param {?} options
     * @param {?} component
     * @return {?}
     */
    openConfirmationDialog(options, component) {
        if (options.type === ConfirmationType.Success) {
            component.openAsSuccess(options.message ? options.message : this.defaultSuccessMessage);
        }
        else if (options.type === ConfirmationType.Warning) {
            component.openAsWarning(options.message ? options.message : this.defaultWarningMessage);
        }
        else if (options.type === ConfirmationType.Error) {
            component.openAsError(options.message ? options.message : this.defaultErrorMessage, options.messageDetail ? options.messageDetail : this.defaultErrorMessageDetail);
        }
    }
    /**
     * @private
     * @param {?} component
     * @param {?} componentTemplate
     * @return {?}
     */
    setDialogComponent(component, componentTemplate) {
        component.enableHeader = componentTemplate.enableHeader;
        component.enableFooter = componentTemplate.enableFooter;
        component.enableClose = componentTemplate.enableClose;
        component.backgroundColor = componentTemplate.backgroundColor;
        component.rtl = componentTemplate.rtl;
        component.dirAttr = componentTemplate.dirAttr;
        console.log(component);
        if (component.enableHeader) {
            setTimeout((/**
             * @return {?}
             */
            () => {
                component.dialogHeader.nativeElement.innerHTML = componentTemplate.dialogHeader.nativeElement.innerHTML;
            }), this.dialogDelay);
        }
        if (component.enableFooter) {
            setTimeout((/**
             * @return {?}
             */
            () => {
                component.dialogFooter.nativeElement.innerHTML = componentTemplate.dialogFooter.nativeElement.innerHTML;
            }), this.dialogDelay);
        }
        setTimeout((/**
         * @return {?}
         */
        () => {
            component.dialogBody.nativeElement.innerHTML = componentTemplate.dialogBody.nativeElement.innerHTML;
        }), this.dialogDelay);
    }
    /**
     * @private
     * @param {?} options
     * @param {?} component
     * @return {?}
     */
    setDialogComponentTimer(options, component) {
        setTimeout((/**
         * @return {?}
         */
        () => {
            this.setDialogSubscriptions(options, component);
            component.open();
        }), this.dialogDelay);
    }
}
CmxDialogGeneratorService.decorators = [
    { type: Injectable, args: [{
                providedIn: 'root',
            },] }
];
/** @nocollapse */ CmxDialogGeneratorService.ngInjectableDef = i0.defineInjectable({ factory: function CmxDialogGeneratorService_Factory() { return new CmxDialogGeneratorService(); }, token: CmxDialogGeneratorService, providedIn: "root" });
if (false) {
    /**
     * @type {?}
     * @private
     */
    CmxDialogGeneratorService.prototype.dialogDelay;
    /**
     * @type {?}
     * @private
     */
    CmxDialogGeneratorService.prototype.defaultSuccessMessage;
    /**
     * @type {?}
     * @private
     */
    CmxDialogGeneratorService.prototype.defaultWarningMessage;
    /**
     * @type {?}
     * @private
     */
    CmxDialogGeneratorService.prototype.defaultErrorMessage;
    /**
     * @type {?}
     * @private
     */
    CmxDialogGeneratorService.prototype.defaultErrorMessageDetail;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY214LWRpYWxvZy1nZW5lcmF0b3Iuc2VydmljZS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BjZW1leC9jbXgtZGlhbG9nLXY3LyIsInNvdXJjZXMiOlsibGliL3NlcnZpY2VzL2NteC1kaWFsb2ctZ2VuZXJhdG9yLnNlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUFBLE9BQU8sRUFDSCxVQUFVLEdBS2IsTUFBTSxlQUFlLENBQUM7QUFFdkIsT0FBTyxFQUFFLGtCQUFrQixFQUFrQixNQUFNLGlEQUFpRCxDQUFDO0FBQ3JHLE9BQU8sRUFBRSw4QkFBOEIsRUFBRSxNQUFNLHlFQUF5RSxDQUFDO0FBQ3pILE9BQU8sRUFBRSxnQkFBZ0IsRUFBOEIsTUFBTSx5RUFBeUUsQ0FBQzs7QUFLdkksTUFBTSxPQUFPLHlCQUF5QjtJQUh0QztRQUtZLGdCQUFXLEdBQUcsR0FBRyxDQUFDO1FBQ2xCLDBCQUFxQixHQUFHLDZEQUE2RCxDQUFDO1FBQ3RGLDBCQUFxQixHQUFHLDZEQUE2RCxDQUFDO1FBQ3RGLHdCQUFtQixHQUFHLDJEQUEyRCxDQUFDO1FBQ2xGLDhCQUF5QixHQUFHLDBCQUEwQixDQUFDO0tBMkZsRTs7Ozs7OztJQXpGVSx3QkFBd0IsQ0FDM0IsZ0JBQWtDLEVBQ2xDLHdCQUFrRCxFQUNsRCxPQUFtQzs7O2NBRTdCLGdCQUFnQixHQUFxRCx3QkFBd0IsQ0FBQyx1QkFBdUIsQ0FBQyw4QkFBOEIsQ0FBQzs7Y0FDckosWUFBWSxHQUFpRCxnQkFBZ0IsQ0FBQyxlQUFlLENBQUMsZ0JBQWdCLENBQUM7OztjQUcvRyxTQUFTLEdBQUcsQ0FBQyxtQkFBQSxZQUFZLENBQUMsUUFBUSxFQUFrQyxDQUFDO1FBQzNFLElBQUksQ0FBQyxzQkFBc0IsQ0FBQyxPQUFPLEVBQUUsU0FBUyxDQUFDLE1BQU0sQ0FBQyxDQUFDO1FBQ3ZELElBQUksQ0FBQyxzQkFBc0IsQ0FBQyxPQUFPLEVBQUUsU0FBUyxDQUFDLENBQUM7UUFDaEQsT0FBTyxTQUFTLENBQUM7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Q1osU0FBUyxDQUFDLFlBQVksQ0FBQyxhQUFhLENBQUMsU0FBUyxHQUFHLGlCQUFpQixDQUFDLFlBQVksQ0FBQyxhQUFhLENBQUMsU0FBUyxDQUFDO1lBQzVHLENBQUMsR0FBRSxJQUFJLENBQUMsV0FBVyxDQUFDLENBQUM7U0FDeEI7UUFDRCxJQUFJLFNBQVMsQ0FBQyxZQUFZLEVBQUU7WUFDeEIsVUFBVTs7O1lBQUMsR0FBRyxFQUFFO2dCQUNaLFNBQVMsQ0FBQyxZQUFZLENBQUMsYUFBYSxDQUFDLFNBQVMsR0FBRyxpQkFBaUIsQ0FBQyxZQUFZLENBQUMsYUFBYSxDQUFDLFNBQVMsQ0FBQztZQUM1RyxDQUFDLEdBQUUsSUFBSSxDQUFDLFdBQVcsQ0FBQyxDQUFDO1NBQ3hCO1FBRUQsVUFBVTs7O1FBQUMsR0FBRyxFQUFFO1lBQ1osU0FBUyxDQUFDLFVBQVUsQ0FBQyxhQUFhLENBQUMsU0FBUyxHQUFHLGlCQUFpQixDQUFDLFVBQVUsQ0FBQyxhQUFhLENBQUMsU0FBUyxDQUFDO1FBQ3hHLENBQUMsR0FBRSxJQUFJLENBQUMsV0FBVyxDQUFDLENBQUM7SUFFekIsQ0FBQzs7Ozs7OztJQUVPLHVCQUF1QixDQUFDLE9BQVksRUFBRSxTQUFjO1FBQ3hELFVBQVU7OztRQUFDLEdBQUcsRUFBRTtZQUNaLElBQUksQ0FBQyxzQkFBc0IsQ0FBQyxPQUFPLEVBQUUsU0FBUyxDQUFDLENBQUM7WUFDaEQsU0FBUyxDQUFDLElBQUksRUFBRSxDQUFDO1FBQ3JCLENBQUMsR0FBRSxJQUFJLENBQUMsV0FBVyxDQUFDLENBQUM7SUFDekIsQ0FBQzs7O1lBbkdKLFVBQVUsU0FBQztnQkFDUixVQUFVLEVBQUUsTUFBTTthQUNyQjs7Ozs7Ozs7SUFHRyxnREFBMEI7Ozs7O0lBQzFCLDBEQUE4Rjs7Ozs7SUFDOUYsMERBQThGOzs7OztJQUM5Rix3REFBMEY7Ozs7O0lBQzFGLDhEQUErRCIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XG4gICAgSW5qZWN0YWJsZSxcbiAgICBDb21wb25lbnRGYWN0b3J5UmVzb2x2ZXIsXG4gICAgVmlld0NvbnRhaW5lclJlZixcbiAgICBDb21wb25lbnRGYWN0b3J5LFxuICAgIENvbXBvbmVudFJlZixcbn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5cbmltcG9ydCB7IENteERpYWxvZ0NvbXBvbmVudCwgSURpYWxvZ09wdGlvbnMgfSBmcm9tICcuLy4uL2NvbXBvbmVudHMvY214LWRpYWxvZy9jbXgtZGlhbG9nLmNvbXBvbmVudCc7XG5pbXBvcnQgeyBDbXhEaWFsb2dDb25maXJtYXRpb25Db21wb25lbnQgfSBmcm9tICcuLi9jb21wb25lbnRzL2NteC1kaWFsb2ctY29uZmlybWF0aW9uL2NteC1kaWFsb2ctY29uZmlybWF0aW9uLmNvbXBvbmVudCc7XG5pbXBvcnQgeyBDb25maXJtYXRpb25UeXBlLCBJQ29uZmlybWF0aW9uRGlhbG9nT3B0aW9ucyB9IGZyb20gJy4uL2NvbXBvbmVudHMvY214LWRpYWxvZy1jb25maXJtYXRpb24vY214LWRpYWxvZy1jb25maXJtYXRpb24uY29tcG9uZW50JztcblxuQEluamVjdGFibGUoe1xuICAgIHByb3ZpZGVkSW46ICdyb290Jyxcbn0pXG5leHBvcnQgY2xhc3MgQ214RGlhbG9nR2VuZXJhdG9yU2VydmljZSB7XG5cbiAgICBwcml2YXRlIGRpYWxvZ0RlbGF5ID0gMTAwO1xuICAgIHByaXZhdGUgZGVmYXVsdFN1Y2Nlc3NNZXNzYWdlID0gJ1RoaXMgaXMgYSBkeW5hbWljYWxseSBnZW5lcmF0ZWQgY29uZmlybWF0aW9uIHN1Y2Nlc3MgZGlhbG9nJztcbiAgICBwcml2YXRlIGRlZmF1bHRXYXJuaW5nTWVzc2FnZSA9ICdUaGlzIGlzIGEgZHluYW1pY2FsbHkgZ2VuZXJhdGVkIGNvbmZpcm1hdGlvbiB3YXJuaW5nIGRpYWxvZyc7XG4gICAgcHJpdmF0ZSBkZWZhdWx0RXJyb3JNZXNzYWdlID0gJ1RoaXMgaXMgYSBkeW5hbWljYWxseSBnZW5lcmF0ZWQgY29uZmlybWF0aW9uIGVycm9yIGRpYWxvZyc7XG4gICAgcHJpdmF0ZSBkZWZhdWx0RXJyb3JNZXNzYWdlRGV0YWlsID0gJ1RoaXMgaXMgYSBtZXNzYWdlIGRldGFpbCc7XG5cbiAgICBwdWJsaWMgY3JlYXRlQ29uZmlybWF0aW9uRGlhbG9nKFxuICAgICAgICB2aWV3Q29udGFpbmVyUmVmOiBWaWV3Q29udGFpbmVyUmVmLFxuICAgICAgICBjb21wb25lbnRGYWN0b3J5UmVzb2x2ZXI6IENvbXBvbmVudEZhY3RvcnlSZXNvbHZlcixcbiAgICAgICAgb3B0aW9uczogSUNvbmZpcm1hdGlvbkRpYWxvZ09wdGlvbnMpOiBDbXhEaWFsb2dDb25maXJtYXRpb25Db21wb25lbnQge1xuICAgICAgICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6bWF4LWxpbmUtbGVuZ3RoXG4gICAgICAgIGNvbnN0IGNvbXBvbmVudEZhY3Rvcnk6IENvbXBvbmVudEZhY3Rvcnk8Q214RGlhbG9nQ29uZmlybWF0aW9uQ29tcG9uZW50PiA9IGNvbXBvbmVudEZhY3RvcnlSZXNvbHZlci5yZXNvbHZlQ29tcG9uZW50RmFjdG9yeShDbXhEaWFsb2dDb25maXJtYXRpb25Db21wb25lbnQpO1xuICAgICAgICBjb25zdCBjb21wb25lbnRSZWY6IENvbXBvbmVudFJlZjxDbXhEaWFsb2dDb25maXJtYXRpb25Db21wb25lbnQ+ID0gdmlld0NvbnRhaW5lclJlZi5jcmVhdGVDb21wb25lbnQoY29tcG9uZW50RmFjdG9yeSk7XG5cbiAgICAgICAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOnR5cGVkZWZcbiAgICAgICAgY29uc3QgY29tcG9uZW50ID0gKGNvbXBvbmVudFJlZi5pbnN0YW5jZSBhcyBDbXhEaWFsb2dDb25maXJtYXRpb25Db21wb25lbnQpO1xuICAgICAgICB0aGlzLnNldERpYWxvZ1N1YnNjcmlwdGlvbnMob3B0aW9ucywgY29tcG9uZW50LmRpYWxvZyk7XG4gICAgICAgIHRoaXMub3BlbkNvbmZpcm1hdGlvbkRpYWxvZyhvcHRpb25zLCBjb21wb25lbnQpO1xuICAgICAgICByZXR1cm4gY29tcG9uZW50O1xuICAgIH1cblxuICAgIC8qIGV4cGVyaW1lbnRhbCAqL1xuICAgIHB1YmxpYyBjcmVhdGVDdXN0b21EaWFsb2coXG4gICAgICAgIHZpZXdDb250YWluZXJSZWY6IFZpZXdDb250YWluZXJSZWYsXG4gICAgICAgIGNvbXBvbmVudEZhY3RvcnlSZXNvbHZlcjogQ29tcG9uZW50RmFjdG9yeVJlc29sdmVyLFxuICAgICAgICBjb21wb25lbnRUZW1wbGF0ZTogQ214RGlhbG9nQ29tcG9uZW50LFxuICAgICAgICBvcHRpb25zOiBJRGlhbG9nT3B0aW9ucyk6IENteERpYWxvZ0NvbXBvbmVudCB7XG5cbiAgICAgICAgY29uc3QgY29tcG9uZW50RmFjdG9yeTogQ29tcG9uZW50RmFjdG9yeTxDbXhEaWFsb2dDb21wb25lbnQ+ID1cbiAgICAgICAgICAgIGNvbXBvbmVudEZhY3RvcnlSZXNvbHZlci5yZXNvbHZlQ29tcG9uZW50RmFjdG9yeShDbXhEaWFsb2dDb21wb25lbnQpO1xuICAgICAgICBjb25zdCBjb21wb25lbnRSZWY6IENvbXBvbmVudFJlZjxDbXhEaWFsb2dDb21wb25lbnQ+ID0gdmlld0NvbnRhaW5lclJlZi5jcmVhdGVDb21wb25lbnQoY29tcG9uZW50RmFjdG9yeSk7XG4gICAgICAgIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTp0eXBlZGVmXG4gICAgICAgIGNvbnN0IGNvbXBvbmVudCA9IChjb21wb25lbnRSZWYuaW5zdGFuY2UgYXMgQ214RGlhbG9nQ29tcG9uZW50KTtcblxuICAgICAgICBpZiAoIShjb21wb25lbnRUZW1wbGF0ZSBpbnN0YW5jZW9mIENteERpYWxvZ0NvbXBvbmVudCkpIHtcbiAgICAgICAgICAgIHJldHVybiBjb21wb25lbnQ7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5zZXREaWFsb2dDb21wb25lbnQoY29tcG9uZW50LCBjb21wb25lbnRUZW1wbGF0ZSk7XG4gICAgICAgIHRoaXMuc2V0RGlhbG9nQ29tcG9uZW50VGltZXIob3B0aW9ucywgY29tcG9uZW50KTtcbiAgICAgICAgcmV0dXJuIGNvbXBvbmVudDtcbiAgICB9XG5cbiAgICBwcml2YXRlIHNldERpYWxvZ1N1YnNjcmlwdGlvbnMob3B0aW9uczogYW55LCBjb21wb25lbnQ6IGFueSk6IHZvaWQge1xuICAgICAgICBpZiAob3B0aW9ucy5hZnRlckNsb3NlZCkge1xuICAgICAgICAgICAgY29tcG9uZW50LmFmdGVyQ2xvc2VkKCkuc3Vic2NyaWJlKG9wdGlvbnMuYWZ0ZXJDbG9zZWQoKSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKG9wdGlvbnMuYWZ0ZXJPcGVuZWQpIHtcbiAgICAgICAgICAgIGNvbXBvbmVudC5hZnRlck9wZW5lZCgpLnN1YnNjcmliZShvcHRpb25zLmFmdGVyT3BlbmVkKCkpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBvcGVuQ29uZmlybWF0aW9uRGlhbG9nKG9wdGlvbnM6IGFueSwgY29tcG9uZW50OiBhbnkpOiB2b2lkIHtcbiAgICAgICAgaWYgKG9wdGlvbnMudHlwZSA9PT0gQ29uZmlybWF0aW9uVHlwZS5TdWNjZXNzKSB7XG4gICAgICAgICAgICBjb21wb25lbnQub3BlbkFzU3VjY2VzcyhvcHRpb25zLm1lc3NhZ2UgPyBvcHRpb25zLm1lc3NhZ2UgOiB0aGlzLmRlZmF1bHRTdWNjZXNzTWVzc2FnZSk7XG4gICAgICAgIH0gZWxzZSBpZiAob3B0aW9ucy50eXBlID09PSBDb25maXJtYXRpb25UeXBlLldhcm5pbmcpIHtcbiAgICAgICAgICAgIGNvbXBvbmVudC5vcGVuQXNXYXJuaW5nKG9wdGlvbnMubWVzc2FnZSA/IG9wdGlvbnMubWVzc2FnZSA6IHRoaXMuZGVmYXVsdFdhcm5pbmdNZXNzYWdlKTtcbiAgICAgICAgfSBlbHNlIGlmIChvcHRpb25zLnR5cGUgPT09IENvbmZpcm1hdGlvblR5cGUuRXJyb3IpIHtcbiAgICAgICAgICAgIGNvbXBvbmVudC5vcGVuQXNFcnJvcihvcHRpb25zLm1lc3NhZ2UgPyBvcHRpb25zLm1lc3NhZ2UgOiB0aGlzLmRlZmF1bHRFcnJvck1lc3NhZ2UsXG4gICAgICAgICAgICAgICAgb3B0aW9ucy5tZXNzYWdlRGV0YWlsID8gb3B0aW9ucy5tZXNzYWdlRGV0YWlsIDogdGhpcy5kZWZhdWx0RXJyb3JNZXNzYWdlRGV0YWlsKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHByaXZhdGUgc2V0RGlhbG9nQ29tcG9uZW50KGNvbXBvbmVudDogYW55LCBjb21wb25lbnRUZW1wbGF0ZTogYW55KTogdm9pZCB7XG4gICAgICAgIGNvbXBvbmVudC5lbmFibGVIZWFkZXIgPSBjb21wb25lbnRUZW1wbGF0ZS5lbmFibGVIZWFkZXI7XG4gICAgICAgIGNvbXBvbmVudC5lbmFibGVGb290ZXIgPSBjb21wb25lbnRUZW1wbGF0ZS5lbmFibGVGb290ZXI7XG4gICAgICAgIGNvbXBvbmVudC5lbmFibGVDbG9zZSA9IGNvbXBvbmVudFRlbXBsYXRlLmVuYWJsZUNsb3NlO1xuICAgICAgICBjb21wb25lbnQuYmFja2dyb3VuZENvbG9yID0gY29tcG9uZW50VGVtcGxhdGUuYmFja2dyb3VuZENvbG9yO1xuICAgICAgICBjb21wb25lbnQucnRsID0gY29tcG9uZW50VGVtcGxhdGUucnRsO1xuICAgICAgICBjb21wb25lbnQuZGlyQXR0ciA9IGNvbXBvbmVudFRlbXBsYXRlLmRpckF0dHI7XG5cbiAgICAgICAgY29uc29sZS5sb2coY29tcG9uZW50KTtcblxuICAgICAgICBpZiAoY29tcG9uZW50LmVuYWJsZUhlYWRlcikge1xuICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgICAgICAgICAgY29tcG9uZW50LmRpYWxvZ0hlYWRlci5uYXRpdmVFbGVtZW50LmlubmVySFRNTCA9IGNvbXBvbmVudFRlbXBsYXRlLmRpYWxvZ0hlYWRlci5uYXRpdmVFbGVtZW50LmlubmVySFRNTDtcbiAgICAgICAgICAgIH0sIHRoaXMuZGlhbG9nRGVsYXkpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChjb21wb25lbnQuZW5hYmxlRm9vdGVyKSB7XG4gICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgICAgICAgICBjb21wb25lbnQuZGlhbG9nRm9vdGVyLm5hdGl2ZUVsZW1lbnQuaW5uZXJIVE1MID0gY29tcG9uZW50VGVtcGxhdGUuZGlhbG9nRm9vdGVyLm5hdGl2ZUVsZW1lbnQuaW5uZXJIVE1MO1xuICAgICAgICAgICAgfSwgdGhpcy5kaWFsb2dEZWxheSk7XG4gICAgICAgIH1cblxuICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgICAgIGNvbXBvbmVudC5kaWFsb2dCb2R5Lm5hdGl2ZUVsZW1lbnQuaW5uZXJIVE1MID0gY29tcG9uZW50VGVtcGxhdGUuZGlhbG9nQm9keS5uYXRpdmVFbGVtZW50LmlubmVySFRNTDtcbiAgICAgICAgfSwgdGhpcy5kaWFsb2dEZWxheSk7XG5cbiAgICB9XG5cbiAgICBwcml2YXRlIHNldERpYWxvZ0NvbXBvbmVudFRpbWVyKG9wdGlvbnM6IGFueSwgY29tcG9uZW50OiBhbnkpOiB2b2lkIHtcbiAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgICAgICB0aGlzLnNldERpYWxvZ1N1YnNjcmlwdGlvbnMob3B0aW9ucywgY29tcG9uZW50KTtcbiAgICAgICAgICAgIGNvbXBvbmVudC5vcGVuKCk7XG4gICAgICAgIH0sIHRoaXMuZGlhbG9nRGVsYXkpO1xuICAgIH1cbn1cbiJdfQ==
/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Injectable } from '@angular/core';
var DateFormatterService = /** @class */ (function () {
    function DateFormatterService() {
        //
    }
    /**
     * @description Formats a date object to a string given a date format from a language
     * @param value The date value to format
     * @param format The format to comply, e.x. DD MM, YYYY
     * @param daysNames String array of the weekdays' names
     * @param monthsNames String array of the months' names
     * @returns String of the formatted date
     */
    /**
     * \@description Formats a date object to a string given a date format from a language
     * @param {?} $value
     * @param {?} $format
     * @param {?} $daysNames
     * @param {?} $monthsNames
     * @return {?} String of the formatted date
     */
    DateFormatterService.prototype.format = /**
     * \@description Formats a date object to a string given a date format from a language
     * @param {?} $value
     * @param {?} $format
     * @param {?} $daysNames
     * @param {?} $monthsNames
     * @return {?} String of the formatted date
     */
    function ($value, $format, $daysNames, $monthsNames) {
        var _this = this;
        /** @type {?} */
        var dateAsString = '';
        /** @type {?} */
        var $separator = '/';
        /** @type {?} */
        var day;
        /** @type {?} */
        var month;
        /** @type {?} */
        var year;
        /** @type {?} */
        var $formats = $format.split($separator);
        if ($formats.length === 1) {
            $separator = '-';
            $formats = $format.split($separator);
        }
        if ($formats.length === 1) {
            $separator = ' ';
            $formats = $format.split($separator);
        }
        if ($formats.length === 1) {
            $separator = '.';
            $formats = $format.split($separator);
        }
        $formats.forEach((/**
         * @param {?} $formatItem
         * @param {?} $index
         * @return {?}
         */
        function ($formatItem, $index) {
            /** @type {?} */
            var $auxValue = $value;
            /** @type {?} */
            var $formatCode = $formatItem.replace(',', '');
            if ($formatItem.includes('d') || $formatItem.includes('D')) {
                day = _this.getDay($auxValue, $formatCode, $daysNames);
                $formatItem = $formatItem.replace($formatCode, day);
            }
            else if ($formatItem.includes('m') || $formatItem.includes('M')) {
                month = _this.getMonth($auxValue, $formatCode, $monthsNames);
                $formatItem = $formatItem.replace($formatCode, month);
            }
            else if ($formatItem.includes('y') || $formatItem.includes('Y')) {
                year = _this.getYear($auxValue, $formatCode);
                $formatItem = $formatItem.replace($formatCode, year);
            }
            if ($index !== $formats.length - 1) {
                dateAsString += $formatItem + $separator;
            }
            else {
                dateAsString += $formatItem;
            }
        }));
        return dateAsString;
    };
    /**
     * @description Transforms a valid string to a date object
     * @param date The date as string
     * @returns A javascript date object
     */
    /**
     * \@description Transforms a valid string to a date object
     * @param {?} date The date as string
     * @return {?} A javascript date object
     */
    DateFormatterService.prototype.getDateObject = /**
     * \@description Transforms a valid string to a date object
     * @param {?} date The date as string
     * @return {?} A javascript date object
     */
    function (date) {
        try {
            /** @type {?} */
            var auxDate = date.replace(/-g/, '/');
            /** @type {?} */
            var bits = auxDate.split(/\D/);
            /** @type {?} */
            var month = parseInt(bits[1], undefined) - 1;
            if (bits.length === 3) {
                return new Date(bits[0], month, bits[2]);
            }
            else {
                return new Date(bits[0], month, bits[2], bits[3], bits[4], bits[5]);
            }
        }
        catch ($exception) {
            return undefined;
        }
    };
    /**
     * @private
     * @param {?} $number
     * @return {?}
     */
    DateFormatterService.prototype.addZero = /**
     * @private
     * @param {?} $number
     * @return {?}
     */
    function ($number) {
        return $number < 10 ? '0' + $number : $number.toString();
    };
    /**
     * @private
     * @param {?} $date
     * @param {?} $format
     * @param {?} $daysNames
     * @return {?}
     */
    DateFormatterService.prototype.getDay = /**
     * @private
     * @param {?} $date
     * @param {?} $format
     * @param {?} $daysNames
     * @return {?}
     */
    function ($date, $format, $daysNames) {
        /** @type {?} */
        var day;
        if ($format.length === 4) {
            // requires the complete name of the day
            day = $daysNames[$date.getDay()];
        }
        else if ($format.length === 3) {
            // requires an abbreviation of the day's name
            day = $daysNames[$date.getDay()].substring(0, 3);
        }
        else if ($format.length === 2 || $format.length === 1) {
            // requires the value of the day
            day = this.addZero($date.getDate());
        }
        // check if names should use lower or uppercase
        if ($format === $format.toLowerCase()) {
            // the format uses d
            day = day.toLowerCase();
        }
        return day;
    };
    /**
     * @private
     * @param {?} $date
     * @param {?} $format
     * @param {?} $monthsNames
     * @return {?}
     */
    DateFormatterService.prototype.getMonth = /**
     * @private
     * @param {?} $date
     * @param {?} $format
     * @param {?} $monthsNames
     * @return {?}
     */
    function ($date, $format, $monthsNames) {
        /** @type {?} */
        var month;
        if ($format.length === 4) {
            // requires the complete name of the month
            month = $monthsNames[$date.getMonth()];
        }
        else if ($format.length === 3) {
            // requires an abbreviation of the day's name
            month = $monthsNames[$date.getMonth()].substring(0, 3);
        }
        else if ($format.length === 2) {
            // requires the value of the day
            month = this.addZero($date.getMonth() + 1);
        }
        // check if names should use lower or uppercase
        if ($format === $format.toLowerCase()) {
            // the format uses d
            month = month.toLowerCase();
        }
        return month;
    };
    /**
     * @private
     * @param {?} $date
     * @param {?} $format
     * @return {?}
     */
    DateFormatterService.prototype.getYear = /**
     * @private
     * @param {?} $date
     * @param {?} $format
     * @return {?}
     */
    function ($date, $format) {
        /** @type {?} */
        var year;
        if ($format.length === 4) {
            // requires the complete year
            year = '' + $date.getFullYear();
        }
        else {
            // requires only the last 2 numbers of the year value
            year = '' + $date.getFullYear();
            year = year.substring(2);
        }
        return year;
    };
    DateFormatterService.decorators = [
        { type: Injectable }
    ];
    /** @nocollapse */
    DateFormatterService.ctorParameters = function () { return []; };
    return DateFormatterService;
}());
export { DateFormatterService };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGF0ZS1mb3JtYXR0ZXIuc2VydmljZS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BjZW1leC1jb3JlL2FuZ3VsYXItbG9jYWxpemF0aW9uLXY3LyIsInNvdXJjZXMiOlsibGliL3NlcnZpY2VzL2RhdGUtZm9ybWF0dGVyLnNlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUFBLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFFM0M7SUFFRTtRQUNFLEVBQUU7SUFDSixDQUFDO0lBRUQ7Ozs7Ozs7T0FPRzs7Ozs7Ozs7O0lBQ0kscUNBQU07Ozs7Ozs7O0lBQWIsVUFDRSxNQUFZLEVBQ1osT0FBZSxFQUNmLFVBQW9CLEVBQ3BCLFlBQXNCO1FBSnhCLGlCQTRDQzs7WUF0Q0ssWUFBWSxHQUFHLEVBQUU7O1lBQ2pCLFVBQVUsR0FBRyxHQUFHOztZQUNoQixHQUFXOztZQUNYLEtBQWE7O1lBQ2IsSUFBWTs7WUFDWixRQUFRLEdBQUcsT0FBTyxDQUFDLEtBQUssQ0FBQyxVQUFVLENBQUM7UUFDeEMsSUFBSSxRQUFRLENBQUMsTUFBTSxLQUFLLENBQUMsRUFBRTtZQUN6QixVQUFVLEdBQUcsR0FBRyxDQUFDO1lBQ2pCLFFBQVEsR0FBRyxPQUFPLENBQUMsS0FBSyxDQUFDLFVBQVUsQ0FBQyxDQUFDO1NBQ3RDO1FBQ0QsSUFBSSxRQUFRLENBQUMsTUFBTSxLQUFLLENBQUMsRUFBRTtZQUN6QixVQUFVLEdBQUcsR0FBRyxDQUFDO1lBQ2pCLFFBQVEsR0FBRyxPQUFPLENBQUMsS0FBSyxDQUFDLFVBQVUsQ0FBQyxDQUFDO1NBQ3RDO1FBQ0QsSUFBSSxRQUFRLENBQUMsTUFBTSxLQUFLLENBQUMsRUFBRTtZQUN6QixVQUFVLEdBQUcsR0FBRyxDQUFDO1lBQ2pCLFFBQVEsR0FBRyxPQUFPLENBQUMsS0FBSyxDQUFDLFVBQVUsQ0FBQyxDQUFDO1NBQ3RDO1FBQ0QsUUFBUSxDQUFDLE9BQU87Ozs7O1FBQUMsVUFBQyxXQUFXLEVBQUUsTUFBTTs7Z0JBQzdCLFNBQVMsR0FBUSxNQUFNOztnQkFDdkIsV0FBVyxHQUFHLFdBQVcsQ0FBQyxPQUFPLENBQUMsR0FBRyxFQUFFLEVBQUUsQ0FBQztZQUNoRCxJQUFJLFdBQVcsQ0FBQyxRQUFRLENBQUMsR0FBRyxDQUFDLElBQUksV0FBVyxDQUFDLFFBQVEsQ0FBQyxHQUFHLENBQUMsRUFBRTtnQkFDMUQsR0FBRyxHQUFHLEtBQUksQ0FBQyxNQUFNLENBQUMsU0FBUyxFQUFFLFdBQVcsRUFBRSxVQUFVLENBQUMsQ0FBQztnQkFDdEQsV0FBVyxHQUFHLFdBQVcsQ0FBQyxPQUFPLENBQUMsV0FBVyxFQUFFLEdBQUcsQ0FBQyxDQUFDO2FBQ3JEO2lCQUFNLElBQUksV0FBVyxDQUFDLFFBQVEsQ0FBQyxHQUFHLENBQUMsSUFBSSxXQUFXLENBQUMsUUFBUSxDQUFDLEdBQUcsQ0FBQyxFQUFFO2dCQUNqRSxLQUFLLEdBQUcsS0FBSSxDQUFDLFFBQVEsQ0FBQyxTQUFTLEVBQUUsV0FBVyxFQUFFLFlBQVksQ0FBQyxDQUFDO2dCQUM1RCxXQUFXLEdBQUcsV0FBVyxDQUFDLE9BQU8sQ0FBQyxXQUFXLEVBQUUsS0FBSyxDQUFDLENBQUM7YUFDdkQ7aUJBQU0sSUFBSSxXQUFXLENBQUMsUUFBUSxDQUFDLEdBQUcsQ0FBQyxJQUFJLFdBQVcsQ0FBQyxRQUFRLENBQUMsR0FBRyxDQUFDLEVBQUU7Z0JBQ2pFLElBQUksR0FBRyxLQUFJLENBQUMsT0FBTyxDQUFDLFNBQVMsRUFBRSxXQUFXLENBQUMsQ0FBQztnQkFDNUMsV0FBVyxHQUFHLFdBQVcsQ0FBQyxPQUFPLENBQUMsV0FBVyxFQUFFLElBQUksQ0FBQyxDQUFDO2FBQ3REO1lBQ0QsSUFBSSxNQUFNLEtBQUssUUFBUSxDQUFDLE1BQU0sR0FBRyxDQUFDLEVBQUU7Z0JBQ2xDLFlBQVksSUFBSSxXQUFXLEdBQUcsVUFBVSxDQUFDO2FBQzFDO2lCQUFNO2dCQUNMLFlBQVksSUFBSSxXQUFXLENBQUM7YUFDN0I7UUFDSCxDQUFDLEVBQUMsQ0FBQztRQUNILE9BQU8sWUFBWSxDQUFDO0lBQ3RCLENBQUM7SUFFRDs7OztPQUlHOzs7Ozs7SUFDSSw0Q0FBYTs7Ozs7SUFBcEIsVUFBcUIsSUFBWTtRQUMvQixJQUFJOztnQkFDSSxPQUFPLEdBQUcsSUFBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLEVBQUUsR0FBRyxDQUFDOztnQkFDakMsSUFBSSxHQUFRLE9BQU8sQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDOztnQkFDL0IsS0FBSyxHQUFHLFFBQVEsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLEVBQUUsU0FBUyxDQUFDLEdBQUcsQ0FBQztZQUM5QyxJQUFJLElBQUksQ0FBQyxNQUFNLEtBQUssQ0FBQyxFQUFFO2dCQUNyQixPQUFPLElBQUksSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsRUFBRSxLQUFLLEVBQUUsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7YUFDMUM7aUJBQU07Z0JBQ0wsT0FBTyxJQUFJLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLEVBQUUsS0FBSyxFQUFFLElBQUksQ0FBQyxDQUFDLENBQUMsRUFBRSxJQUFJLENBQUMsQ0FBQyxDQUFDLEVBQUUsSUFBSSxDQUFDLENBQUMsQ0FBQyxFQUFFLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO2FBQ3JFO1NBQ0Y7UUFBQyxPQUFPLFVBQVUsRUFBRTtZQUNuQixPQUFPLFNBQVMsQ0FBQztTQUNsQjtJQUNILENBQUM7Ozs7OztJQUVPLHNDQUFPOzs7OztJQUFmLFVBQWdCLE9BQWU7UUFDN0IsT0FBTyxPQUFPLEdBQUcsRUFBRSxDQUFDLENBQUMsQ0FBQyxHQUFHLEdBQUcsT0FBTyxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUMsUUFBUSxFQUFFLENBQUM7SUFDM0QsQ0FBQzs7Ozs7Ozs7SUFFTyxxQ0FBTTs7Ozs7OztJQUFkLFVBQWUsS0FBVyxFQUFFLE9BQWUsRUFBRSxVQUFvQjs7WUFDM0QsR0FBVztRQUNmLElBQUksT0FBTyxDQUFDLE1BQU0sS0FBSyxDQUFDLEVBQUU7WUFDeEIsd0NBQXdDO1lBQ3hDLEdBQUcsR0FBRyxVQUFVLENBQUMsS0FBSyxDQUFDLE1BQU0sRUFBRSxDQUFDLENBQUM7U0FDbEM7YUFBTSxJQUFJLE9BQU8sQ0FBQyxNQUFNLEtBQUssQ0FBQyxFQUFFO1lBQy9CLDZDQUE2QztZQUM3QyxHQUFHLEdBQUcsVUFBVSxDQUFDLEtBQUssQ0FBQyxNQUFNLEVBQUUsQ0FBQyxDQUFDLFNBQVMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUM7U0FDbEQ7YUFBTSxJQUFJLE9BQU8sQ0FBQyxNQUFNLEtBQUssQ0FBQyxJQUFJLE9BQU8sQ0FBQyxNQUFNLEtBQUssQ0FBQyxFQUFFO1lBQ3ZELGdDQUFnQztZQUNoQyxHQUFHLEdBQUcsSUFBSSxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsT0FBTyxFQUFFLENBQUMsQ0FBQztTQUNyQztRQUNELCtDQUErQztRQUMvQyxJQUFJLE9BQU8sS0FBSyxPQUFPLENBQUMsV0FBVyxFQUFFLEVBQUU7WUFDckMsb0JBQW9CO1lBQ3BCLEdBQUcsR0FBRyxHQUFHLENBQUMsV0FBVyxFQUFFLENBQUM7U0FDekI7UUFDRCxPQUFPLEdBQUcsQ0FBQztJQUNiLENBQUM7Ozs7Ozs7O0lBRU8sdUNBQVE7Ozs7Ozs7SUFBaEIsVUFDRSxLQUFXLEVBQ1gsT0FBZSxFQUNmLFlBQXNCOztZQUVsQixLQUFhO1FBQ2pCLElBQUksT0FBTyxDQUFDLE1BQU0sS0FBSyxDQUFDLEVBQUU7WUFDeEIsMENBQTBDO1lBQzFDLEtBQUssR0FBRyxZQUFZLENBQUMsS0FBSyxDQUFDLFFBQVEsRUFBRSxDQUFDLENBQUM7U0FDeEM7YUFBTSxJQUFJLE9BQU8sQ0FBQyxNQUFNLEtBQUssQ0FBQyxFQUFFO1lBQy9CLDZDQUE2QztZQUM3QyxLQUFLLEdBQUcsWUFBWSxDQUFDLEtBQUssQ0FBQyxRQUFRLEVBQUUsQ0FBQyxDQUFDLFNBQVMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUM7U0FDeEQ7YUFBTSxJQUFJLE9BQU8sQ0FBQyxNQUFNLEtBQUssQ0FBQyxFQUFFO1lBQy9CLGdDQUFnQztZQUNoQyxLQUFLLEdBQUcsSUFBSSxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsUUFBUSxFQUFFLEdBQUcsQ0FBQyxDQUFDLENBQUM7U0FDNUM7UUFDRCwrQ0FBK0M7UUFDL0MsSUFBSSxPQUFPLEtBQUssT0FBTyxDQUFDLFdBQVcsRUFBRSxFQUFFO1lBQ3JDLG9CQUFvQjtZQUNwQixLQUFLLEdBQUcsS0FBSyxDQUFDLFdBQVcsRUFBRSxDQUFDO1NBQzdCO1FBQ0QsT0FBTyxLQUFLLENBQUM7SUFDZixDQUFDOzs7Ozs7O0lBRU8sc0NBQU87Ozs7OztJQUFmLFVBQWdCLEtBQVcsRUFBRSxPQUFlOztZQUN0QyxJQUFZO1FBQ2hCLElBQUksT0FBTyxDQUFDLE1BQU0sS0FBSyxDQUFDLEVBQUU7WUFDeEIsNkJBQTZCO1lBQzdCLElBQUksR0FBRyxFQUFFLEdBQUcsS0FBSyxDQUFDLFdBQVcsRUFBRSxDQUFDO1NBQ2pDO2FBQU07WUFDTCxxREFBcUQ7WUFDckQsSUFBSSxHQUFHLEVBQUUsR0FBRyxLQUFLLENBQUMsV0FBVyxFQUFFLENBQUM7WUFDaEMsSUFBSSxHQUFHLElBQUksQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDLENBQUM7U0FDMUI7UUFDRCxPQUFPLElBQUksQ0FBQztJQUNkLENBQUM7O2dCQTNJRixVQUFVOzs7O0lBNElYLDJCQUFDO0NBQUEsQUE1SUQsSUE0SUM7U0EzSVksb0JBQW9CIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSW5qZWN0YWJsZSB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuXG5ASW5qZWN0YWJsZSgpXG5leHBvcnQgY2xhc3MgRGF0ZUZvcm1hdHRlclNlcnZpY2Uge1xuICBjb25zdHJ1Y3RvcigpIHtcbiAgICAvL1xuICB9XG5cbiAgLyoqXG4gICAqIEBkZXNjcmlwdGlvbiBGb3JtYXRzIGEgZGF0ZSBvYmplY3QgdG8gYSBzdHJpbmcgZ2l2ZW4gYSBkYXRlIGZvcm1hdCBmcm9tIGEgbGFuZ3VhZ2VcbiAgICogQHBhcmFtIHZhbHVlIFRoZSBkYXRlIHZhbHVlIHRvIGZvcm1hdFxuICAgKiBAcGFyYW0gZm9ybWF0IFRoZSBmb3JtYXQgdG8gY29tcGx5LCBlLnguIEREIE1NLCBZWVlZXG4gICAqIEBwYXJhbSBkYXlzTmFtZXMgU3RyaW5nIGFycmF5IG9mIHRoZSB3ZWVrZGF5cycgbmFtZXNcbiAgICogQHBhcmFtIG1vbnRoc05hbWVzIFN0cmluZyBhcnJheSBvZiB0aGUgbW9udGhzJyBuYW1lc1xuICAgKiBAcmV0dXJucyBTdHJpbmcgb2YgdGhlIGZvcm1hdHRlZCBkYXRlXG4gICAqL1xuICBwdWJsaWMgZm9ybWF0KFxuICAgICR2YWx1ZTogRGF0ZSxcbiAgICAkZm9ybWF0OiBzdHJpbmcsXG4gICAgJGRheXNOYW1lczogc3RyaW5nW10sXG4gICAgJG1vbnRoc05hbWVzOiBzdHJpbmdbXVxuICApOiBzdHJpbmcge1xuICAgIGxldCBkYXRlQXNTdHJpbmcgPSAnJztcbiAgICBsZXQgJHNlcGFyYXRvciA9ICcvJztcbiAgICBsZXQgZGF5OiBzdHJpbmc7XG4gICAgbGV0IG1vbnRoOiBzdHJpbmc7XG4gICAgbGV0IHllYXI6IHN0cmluZztcbiAgICBsZXQgJGZvcm1hdHMgPSAkZm9ybWF0LnNwbGl0KCRzZXBhcmF0b3IpO1xuICAgIGlmICgkZm9ybWF0cy5sZW5ndGggPT09IDEpIHtcbiAgICAgICRzZXBhcmF0b3IgPSAnLSc7XG4gICAgICAkZm9ybWF0cyA9ICRmb3JtYXQuc3BsaXQoJHNlcGFyYXRvcik7XG4gICAgfVxuICAgIGlmICgkZm9ybWF0cy5sZW5ndGggPT09IDEpIHtcbiAgICAgICRzZXBhcmF0b3IgPSAnICc7XG4gICAgICAkZm9ybWF0cyA9ICRmb3JtYXQuc3BsaXQoJHNlcGFyYXRvcik7XG4gICAgfVxuICAgIGlmICgkZm9ybWF0cy5sZW5ndGggPT09IDEpIHtcbiAgICAgICRzZXBhcmF0b3IgPSAnLic7XG4gICAgICAkZm9ybWF0cyA9ICRmb3JtYXQuc3BsaXQoJHNlcGFyYXRvcik7XG4gICAgfVxuICAgICRmb3JtYXRzLmZvckVhY2goKCRmb3JtYXRJdGVtLCAkaW5kZXgpID0+IHtcbiAgICAgIGNvbnN0ICRhdXhWYWx1ZTogYW55ID0gJHZhbHVlO1xuICAgICAgY29uc3QgJGZvcm1hdENvZGUgPSAkZm9ybWF0SXRlbS5yZXBsYWNlKCcsJywgJycpO1xuICAgICAgaWYgKCRmb3JtYXRJdGVtLmluY2x1ZGVzKCdkJykgfHwgJGZvcm1hdEl0ZW0uaW5jbHVkZXMoJ0QnKSkge1xuICAgICAgICBkYXkgPSB0aGlzLmdldERheSgkYXV4VmFsdWUsICRmb3JtYXRDb2RlLCAkZGF5c05hbWVzKTtcbiAgICAgICAgJGZvcm1hdEl0ZW0gPSAkZm9ybWF0SXRlbS5yZXBsYWNlKCRmb3JtYXRDb2RlLCBkYXkpO1xuICAgICAgfSBlbHNlIGlmICgkZm9ybWF0SXRlbS5pbmNsdWRlcygnbScpIHx8ICRmb3JtYXRJdGVtLmluY2x1ZGVzKCdNJykpIHtcbiAgICAgICAgbW9udGggPSB0aGlzLmdldE1vbnRoKCRhdXhWYWx1ZSwgJGZvcm1hdENvZGUsICRtb250aHNOYW1lcyk7XG4gICAgICAgICRmb3JtYXRJdGVtID0gJGZvcm1hdEl0ZW0ucmVwbGFjZSgkZm9ybWF0Q29kZSwgbW9udGgpO1xuICAgICAgfSBlbHNlIGlmICgkZm9ybWF0SXRlbS5pbmNsdWRlcygneScpIHx8ICRmb3JtYXRJdGVtLmluY2x1ZGVzKCdZJykpIHtcbiAgICAgICAgeWVhciA9IHRoaXMuZ2V0WWVhcigkYXV4VmFsdWUsICRmb3JtYXRDb2RlKTtcbiAgICAgICAgJGZvcm1hdEl0ZW0gPSAkZm9ybWF0SXRlbS5yZXBsYWNlKCRmb3JtYXRDb2RlLCB5ZWFyKTtcbiAgICAgIH1cbiAgICAgIGlmICgkaW5kZXggIT09ICRmb3JtYXRzLmxlbmd0aCAtIDEpIHtcbiAgICAgICAgZGF0ZUFzU3RyaW5nICs9ICRmb3JtYXRJdGVtICsgJHNlcGFyYXRvcjtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGRhdGVBc1N0cmluZyArPSAkZm9ybWF0SXRlbTtcbiAgICAgIH1cbiAgICB9KTtcbiAgICByZXR1cm4gZGF0ZUFzU3RyaW5nO1xuICB9XG5cbiAgLyoqXG4gICAqIEBkZXNjcmlwdGlvbiBUcmFuc2Zvcm1zIGEgdmFsaWQgc3RyaW5nIHRvIGEgZGF0ZSBvYmplY3RcbiAgICogQHBhcmFtIGRhdGUgVGhlIGRhdGUgYXMgc3RyaW5nXG4gICAqIEByZXR1cm5zIEEgamF2YXNjcmlwdCBkYXRlIG9iamVjdFxuICAgKi9cbiAgcHVibGljIGdldERhdGVPYmplY3QoZGF0ZTogc3RyaW5nKTogRGF0ZSB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IGF1eERhdGUgPSBkYXRlLnJlcGxhY2UoLy1nLywgJy8nKTtcbiAgICAgIGNvbnN0IGJpdHM6IGFueSA9IGF1eERhdGUuc3BsaXQoL1xcRC8pO1xuICAgICAgY29uc3QgbW9udGggPSBwYXJzZUludChiaXRzWzFdLCB1bmRlZmluZWQpIC0gMTtcbiAgICAgIGlmIChiaXRzLmxlbmd0aCA9PT0gMykge1xuICAgICAgICByZXR1cm4gbmV3IERhdGUoYml0c1swXSwgbW9udGgsIGJpdHNbMl0pO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuIG5ldyBEYXRlKGJpdHNbMF0sIG1vbnRoLCBiaXRzWzJdLCBiaXRzWzNdLCBiaXRzWzRdLCBiaXRzWzVdKTtcbiAgICAgIH1cbiAgICB9IGNhdGNoICgkZXhjZXB0aW9uKSB7XG4gICAgICByZXR1cm4gdW5kZWZpbmVkO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgYWRkWmVybygkbnVtYmVyOiBudW1iZXIpOiBzdHJpbmcge1xuICAgIHJldHVybiAkbnVtYmVyIDwgMTAgPyAnMCcgKyAkbnVtYmVyIDogJG51bWJlci50b1N0cmluZygpO1xuICB9XG5cbiAgcHJpdmF0ZSBnZXREYXkoJGRhdGU6IERhdGUsICRmb3JtYXQ6IHN0cmluZywgJGRheXNOYW1lczogc3RyaW5nW10pOiBzdHJpbmcge1xuICAgIGxldCBkYXk6IHN0cmluZztcbiAgICBpZiAoJGZvcm1hdC5sZW5ndGggPT09IDQpIHtcbiAgICAgIC8vIHJlcXVpcmVzIHRoZSBjb21wbGV0ZSBuYW1lIG9mIHRoZSBkYXlcbiAgICAgIGRheSA9ICRkYXlzTmFtZXNbJGRhdGUuZ2V0RGF5KCldO1xuICAgIH0gZWxzZSBpZiAoJGZvcm1hdC5sZW5ndGggPT09IDMpIHtcbiAgICAgIC8vIHJlcXVpcmVzIGFuIGFiYnJldmlhdGlvbiBvZiB0aGUgZGF5J3MgbmFtZVxuICAgICAgZGF5ID0gJGRheXNOYW1lc1skZGF0ZS5nZXREYXkoKV0uc3Vic3RyaW5nKDAsIDMpO1xuICAgIH0gZWxzZSBpZiAoJGZvcm1hdC5sZW5ndGggPT09IDIgfHwgJGZvcm1hdC5sZW5ndGggPT09IDEpIHtcbiAgICAgIC8vIHJlcXVpcmVzIHRoZSB2YWx1ZSBvZiB0aGUgZGF5XG4gICAgICBkYXkgPSB0aGlzLmFkZFplcm8oJGRhdGUuZ2V0RGF0ZSgpKTtcbiAgICB9XG4gICAgLy8gY2hlY2sgaWYgbmFtZXMgc2hvdWxkIHVzZSBsb3dlciBvciB1cHBlcmNhc2VcbiAgICBpZiAoJGZvcm1hdCA9PT0gJGZvcm1hdC50b0xvd2VyQ2FzZSgpKSB7XG4gICAgICAvLyB0aGUgZm9ybWF0IHVzZXMgZFxuICAgICAgZGF5ID0gZGF5LnRvTG93ZXJDYXNlKCk7XG4gICAgfVxuICAgIHJldHVybiBkYXk7XG4gIH1cblxuICBwcml2YXRlIGdldE1vbnRoKFxuICAgICRkYXRlOiBEYXRlLFxuICAgICRmb3JtYXQ6IHN0cmluZyxcbiAgICAkbW9udGhzTmFtZXM6IHN0cmluZ1tdXG4gICk6IHN0cmluZyB7XG4gICAgbGV0IG1vbnRoOiBzdHJpbmc7XG4gICAgaWYgKCRmb3JtYXQubGVuZ3RoID09PSA0KSB7XG4gICAgICAvLyByZXF1aXJlcyB0aGUgY29tcGxldGUgbmFtZSBvZiB0aGUgbW9udGhcbiAgICAgIG1vbnRoID0gJG1vbnRoc05hbWVzWyRkYXRlLmdldE1vbnRoKCldO1xuICAgIH0gZWxzZSBpZiAoJGZvcm1hdC5sZW5ndGggPT09IDMpIHtcbiAgICAgIC8vIHJlcXVpcmVzIGFuIGFiYnJldmlhdGlvbiBvZiB0aGUgZGF5J3MgbmFtZVxuICAgICAgbW9udGggPSAkbW9udGhzTmFtZXNbJGRhdGUuZ2V0TW9udGgoKV0uc3Vic3RyaW5nKDAsIDMpO1xuICAgIH0gZWxzZSBpZiAoJGZvcm1hdC5sZW5ndGggPT09IDIpIHtcbiAgICAgIC8vIHJlcXVpcmVzIHRoZSB2YWx1ZSBvZiB0aGUgZGF5XG4gICAgICBtb250aCA9IHRoaXMuYWRkWmVybygkZGF0ZS5nZXRNb250aCgpICsgMSk7XG4gICAgfVxuICAgIC8vIGNoZWNrIGlmIG5hbWVzIHNob3VsZCB1c2UgbG93ZXIgb3IgdXBwZXJjYXNlXG4gICAgaWYgKCRmb3JtYXQgPT09ICRmb3JtYXQudG9Mb3dlckNhc2UoKSkge1xuICAgICAgLy8gdGhlIGZvcm1hdCB1c2VzIGRcbiAgICAgIG1vbnRoID0gbW9udGgudG9Mb3dlckNhc2UoKTtcbiAgICB9XG4gICAgcmV0dXJuIG1vbnRoO1xuICB9XG5cbiAgcHJpdmF0ZSBnZXRZZWFyKCRkYXRlOiBEYXRlLCAkZm9ybWF0OiBzdHJpbmcpOiBzdHJpbmcge1xuICAgIGxldCB5ZWFyOiBzdHJpbmc7XG4gICAgaWYgKCRmb3JtYXQubGVuZ3RoID09PSA0KSB7XG4gICAgICAvLyByZXF1aXJlcyB0aGUgY29tcGxldGUgeWVhclxuICAgICAgeWVhciA9ICcnICsgJGRhdGUuZ2V0RnVsbFllYXIoKTtcbiAgICB9IGVsc2Uge1xuICAgICAgLy8gcmVxdWlyZXMgb25seSB0aGUgbGFzdCAyIG51bWJlcnMgb2YgdGhlIHllYXIgdmFsdWVcbiAgICAgIHllYXIgPSAnJyArICRkYXRlLmdldEZ1bGxZZWFyKCk7XG4gICAgICB5ZWFyID0geWVhci5zdWJzdHJpbmcoMik7XG4gICAgfVxuICAgIHJldHVybiB5ZWFyO1xuICB9XG59XG4iXX0=
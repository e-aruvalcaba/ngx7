/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { Inject, Injectable, Optional } from '@angular/core';
import { HttpClient } from '@angular/common/http';
import { ReplaySubject } from 'rxjs';
var TranslationService = /** @class */ (function () {
    // we can change 'languageLoaded' to 'selectedLanguageSubject' in translation resolver  ???
    function TranslationService(httpClient, productPath, loadedLanguages, defaultLanguageISO // e.g.: en_US from america region || en_UK from europe region.
    ) {
        this.httpClient = httpClient;
        this.productPath = productPath;
        this.loadedLanguages = loadedLanguages;
        this.defaultLanguageISO = defaultLanguageISO;
        this.languageLoaded = new ReplaySubject(1);
        this.selectedLanguageSubject = new ReplaySubject(1);
        this.languagesSubject = new ReplaySubject(1);
        if (!this.loadedLanguages) {
            console.warn('The Translation Service can\'t init without Injected Languages.');
            console.warn('Inject the languages from your application: > ' +
                '{ provide: \'TRANSLATION_LANGUAGES, useValue: window[\'CMX_LANGUAGES\'] },\'');
            return;
        }
        if (!defaultLanguageISO) {
            console.warn('The Translation Service need defaultLanguageISO.');
        }
        TranslationService.languages = this.loadedLanguages;
        /** @type {?} */
        var localStorageLanguage = ((/** @type {?} */ (global))).localStorage.getItem('language');
        /** @type {?} */
        var allKeys = Object.keys(TranslationService.translations);
        if (allKeys.length === 0) {
            this.setLanguage(localStorageLanguage || defaultLanguageISO);
        }
        else {
            this.languageLoaded.next(true);
            // we can change 'languageLoaded' to 'selectedLanguageSubject' in translation resolver?
        }
    }
    /**
     * @description Gets the labels data from the server.
     * @param $lang Language code for the file
     */
    /**
     * \@description Gets the labels data from the server.
     * @param {?} $lang Language code for the file
     * @return {?}
     */
    TranslationService.prototype.getTranslations = /**
     * \@description Gets the labels data from the server.
     * @param {?} $lang Language code for the file
     * @return {?}
     */
    function ($lang) {
        /** @type {?} */
        var endpoint = "/translate/translate/" + this.productPath + "/" + $lang;
        return this.httpClient.get(endpoint);
    };
    /**
     * @description Observable to gets the languages that exist in the server
     */
    /**
     * \@description Observable to gets the languages that exist in the server
     * @return {?}
     */
    TranslationService.prototype.getLanguages = /**
     * \@description Observable to gets the languages that exist in the server
     * @return {?}
     */
    function () {
        return this.languagesSubject.asObservable();
    };
    /**
     * @return {?}
     */
    TranslationService.prototype.getSelectedLanguage = /**
     * @return {?}
     */
    function () {
        return this.selectedLanguageSubject.asObservable();
    };
    /**
     * @description Retrieve the public translation of a label
     * @param $textId Label id as written in the json file
     */
    /**
     * \@description Retrieve the public translation of a label
     * @param {?} $textId Label id as written in the json file
     * @return {?}
     */
    TranslationService.prototype.pt = /**
     * \@description Retrieve the public translation of a label
     * @param {?} $textId Label id as written in the json file
     * @return {?}
     */
    function ($textId) {
        /** @type {?} */
        var textValue = TranslationService.translations[$textId];
        if (!textValue || textValue === undefined) {
            return 'NOT:' + $textId;
        }
        return textValue;
    };
    /**
     * @description Retrieve the public translation of a label
     * @param $textId Label id as written in the json file
     */
    /**
     * \@description Retrieve the public translation of a label
     * @param {?} $textId Label id as written in the json file
     * @return {?}
     */
    TranslationService.prototype.getLabel = /**
     * \@description Retrieve the public translation of a label
     * @param {?} $textId Label id as written in the json file
     * @return {?}
     */
    function ($textId) {
        /** @type {?} */
        var textValue = TranslationService.translations[$textId];
        if (!textValue || textValue === undefined) {
            return 'NOT:' + $textId;
        }
        return textValue;
    };
    /**
     * @description Retrieve language published on the server.
     * @param $languageISO Can be the country code or the language iso combination
     */
    /**
     * \@description Retrieve language published on the server.
     * @param {?} $languageISO Can be the country code or the language iso combination
     * @return {?}
     */
    TranslationService.prototype.getLanguage = /**
     * \@description Retrieve language published on the server.
     * @param {?} $languageISO Can be the country code or the language iso combination
     * @return {?}
     */
    function ($languageISO) {
        if ($languageISO !== undefined && $languageISO !== null) {
            /** @type {?} */
            var langValue = void 0;
            langValue = TranslationService.languages.find((/**
             * @param {?} language
             * @return {?}
             */
            function (language) {
                return (language.languageISO === $languageISO ||
                    language.countryCode.toLowerCase() === $languageISO.toLowerCase() ||
                    language.languageISO.includes($languageISO));
            }));
            // if the language cannot reached, go for default
            if (langValue === undefined) {
                console.warn('The Language cannot reached', $languageISO);
                langValue = this.getDefaultLanguage();
            }
            langValue.momentConfig = this.getMomentConfig(langValue);
            return langValue;
        }
        else {
            console.warn('$languageIso param is undefined.');
            return this.getDefaultLanguage();
        }
    };
    /**
     * @description Retrieve language published on the server.
     * @param $countryCode Can be the country code or the language iso combination
     */
    /**
     * \@description Retrieve language published on the server.
     * @param {?} $countryCode Can be the country code or the language iso combination
     * @return {?}
     */
    TranslationService.prototype.getLanguageByCountryCode = /**
     * \@description Retrieve language published on the server.
     * @param {?} $countryCode Can be the country code or the language iso combination
     * @return {?}
     */
    function ($countryCode) {
        if ($countryCode !== undefined && $countryCode !== null) {
            /** @type {?} */
            var langValue = void 0;
            /** @type {?} */
            var countryLan = TranslationService.languages.filter((/**
             * @param {?} $language
             * @return {?}
             */
            function ($language) {
                return ($language.countryCode.toLowerCase() === $countryCode.toLowerCase());
            }));
            if (countryLan.length > 1) {
                /** @type {?} */
                var languageCode_1 = sessionStorage.getItem('language');
                langValue = countryLan.find((/**
                 * @param {?} $language
                 * @return {?}
                 */
                function ($language) {
                    return ($language.languageISO.toLowerCase() === languageCode_1.toLowerCase());
                }));
            }
            else {
                langValue =
                    countryLan && countryLan.length > 0 ? countryLan[0] : undefined;
            }
            // if the language cannot reached, go for default
            if (langValue === undefined) {
                console.warn('The Language cannot reached', $countryCode);
                langValue = this.getDefaultLanguage();
            }
            langValue.momentConfig = this.getMomentConfig(langValue);
            return langValue;
        }
        else {
            console.warn('$countryCode param is undefined.');
            return this.getDefaultLanguage();
        }
    };
    /**
     * @description Set language by languageISO or CountryCode.
     * @param $languageISO Can be the country code or the language iso combination
     */
    /**
     * \@description Set language by languageISO or CountryCode.
     * @param {?} $languageISO Can be the country code or the language iso combination
     * @return {?}
     */
    TranslationService.prototype.setLanguage = /**
     * \@description Set language by languageISO or CountryCode.
     * @param {?} $languageISO Can be the country code or the language iso combination
     * @return {?}
     */
    function ($languageISO) {
        var _this = this;
        var e_1, _a;
        this.selectedLanguage = this.getLanguage($languageISO);
        try {
            for (var _b = tslib_1.__values(TranslationService.languages), _c = _b.next(); !_c.done; _c = _b.next()) {
                var lang = _c.value;
                lang.isSelected = lang.languageISO === this.selectedLanguage.languageISO;
                lang.dir = lang.textFloat === 'right' ? 'rtl' : 'ltr';
                lang.rtl = lang.dir === 'rtl' ? true : false;
            }
        }
        catch (e_1_1) { e_1 = { error: e_1_1 }; }
        finally {
            try {
                if (_c && !_c.done && (_a = _b.return)) _a.call(_b);
            }
            finally { if (e_1) throw e_1.error; }
        }
        this.getTranslations(this.selectedLanguage.languageISO).subscribe((/**
         * @param {?} translations
         * @return {?}
         */
        function (translations) { return _this.populateTranslation(translations); }));
    };
    /**
     * @param {?} $result
     * @return {?}
     */
    TranslationService.prototype.populateTranslation = /**
     * @param {?} $result
     * @return {?}
     */
    function ($result) {
        TranslationService.translations = $result;
        // emit changes until populate is completed
        localStorage.setItem('language', this.selectedLanguage.languageISO);
        sessionStorage.setItem('language', this.selectedLanguage.languageISO);
        this.languageLoaded.next(true);
        // we can change 'languageLoaded' to 'selectedLanguageSubject' in translation resolver?
        this.selectedLanguageSubject.next(this.selectedLanguage);
        this.languagesSubject.next(TranslationService.languages);
    };
    Object.defineProperty(TranslationService.prototype, "selectedLanguage", {
        get: /**
         * @return {?}
         */
        function () {
            return TranslationService.currentLanguage;
        },
        set: /**
         * @param {?} language
         * @return {?}
         */
        function (language) {
            TranslationService.currentLanguage = language;
        },
        enumerable: true,
        configurable: true
    });
    /**
     * @return {?}
     */
    TranslationService.prototype.getDefaultLanguage = /**
     * @return {?}
     */
    function () {
        var _this = this;
        /** @type {?} */
        var defaultLangValue;
        defaultLangValue = TranslationService.languages.find((/**
         * @param {?} language
         * @return {?}
         */
        function (language) {
            return (language.languageISO === _this.defaultLanguageISO ||
                language.countryCode.toLowerCase() ===
                    _this.defaultLanguageISO.toLowerCase() ||
                language.languageISO.includes(_this.defaultLanguageISO));
        }));
        if (defaultLangValue === undefined) {
            console.warn('The Default Language cannot reached', this.defaultLanguageISO);
            defaultLangValue = TranslationService.languages[0];
            console.warn('Trying get the first language', defaultLangValue.languageISO);
        }
        else {
            console.warn('The Default Language is', defaultLangValue.languageISO);
        }
        return defaultLangValue;
    };
    /**
     * @param {?} countryCode
     * @return {?}
     */
    TranslationService.prototype.getLanguagesByCountryCode = /**
     * @param {?} countryCode
     * @return {?}
     */
    function (countryCode) {
        /** @type {?} */
        var languagesByContryCode = TranslationService.languages.filter((/**
         * @param {?} language
         * @return {?}
         */
        function (language) {
            return language.countryCode.toLowerCase() === countryCode.toLowerCase();
        }));
        return languagesByContryCode;
    };
    /**
     * @private
     * @param {?} language
     * @return {?}
     */
    TranslationService.prototype.getMomentConfig = /**
     * @private
     * @param {?} language
     * @return {?}
     */
    function (language) {
        return {
            months: language.monthNames.split(','),
            monthsShort: language.shortDayMonths.split(','),
            weekdays: language.dayNames.split(','),
            weekdaysMin: language.shortDayNames2.split(','),
            weekdaysShort: language.shortDayNames.split(',')
        };
    };
    TranslationService.TRANSLATION_PRODUCT_PATH = 'TRANSLATION_PRODUCT_PATH';
    TranslationService.TRANSLATION_LANGUAGES = 'TRANSLATION_LANGUAGES';
    TranslationService.DEFAULT_LANGUAGE_ISO = 'DEFAULT_LANGUAGE_ISO';
    TranslationService.currentLanguage = undefined;
    TranslationService.translations = {};
    TranslationService.languages = [];
    TranslationService.decorators = [
        { type: Injectable }
    ];
    /** @nocollapse */
    TranslationService.ctorParameters = function () { return [
        { type: HttpClient },
        { type: String, decorators: [{ type: Inject, args: [TranslationService.TRANSLATION_PRODUCT_PATH,] }, { type: Optional }] },
        { type: undefined, decorators: [{ type: Inject, args: [TranslationService.TRANSLATION_LANGUAGES,] }, { type: Optional }] },
        { type: undefined, decorators: [{ type: Inject, args: [TranslationService.DEFAULT_LANGUAGE_ISO,] }, { type: Optional }] }
    ]; };
    return TranslationService;
}());
export { TranslationService };
if (false) {
    /** @type {?} */
    TranslationService.TRANSLATION_PRODUCT_PATH;
    /** @type {?} */
    TranslationService.TRANSLATION_LANGUAGES;
    /** @type {?} */
    TranslationService.DEFAULT_LANGUAGE_ISO;
    /** @type {?} */
    TranslationService.currentLanguage;
    /**
     * @type {?}
     * @private
     */
    TranslationService.translations;
    /**
     * @type {?}
     * @private
     */
    TranslationService.languages;
    /** @type {?} */
    TranslationService.prototype.languageLoaded;
    /**
     * @type {?}
     * @private
     */
    TranslationService.prototype.selectedLanguageSubject;
    /**
     * @type {?}
     * @private
     */
    TranslationService.prototype.languagesSubject;
    /**
     * @type {?}
     * @private
     */
    TranslationService.prototype.httpClient;
    /**
     * @type {?}
     * @private
     */
    TranslationService.prototype.productPath;
    /**
     * @type {?}
     * @private
     */
    TranslationService.prototype.loadedLanguages;
    /**
     * @type {?}
     * @private
     */
    TranslationService.prototype.defaultLanguageISO;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidHJhbnNsYXRpb24uc2VydmljZS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BjZW1leC1jb3JlL2FuZ3VsYXItbG9jYWxpemF0aW9uLXY3LyIsInNvdXJjZXMiOlsibGliL3NlcnZpY2VzL3RyYW5zbGF0aW9uLnNlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBQSxPQUFPLEVBQUUsTUFBTSxFQUFFLFVBQVUsRUFBRSxRQUFRLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDN0QsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLHNCQUFzQixDQUFDO0FBRWxELE9BQU8sRUFBYyxhQUFhLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFPakQ7SUFhRSwyRkFBMkY7SUFFM0YsNEJBQ1UsVUFBc0IsRUFHdEIsV0FBbUIsRUFHbkIsZUFBb0IsRUFHcEIsa0JBQXVCLENBQUMsK0RBQStEOztRQVR2RixlQUFVLEdBQVYsVUFBVSxDQUFZO1FBR3RCLGdCQUFXLEdBQVgsV0FBVyxDQUFRO1FBR25CLG9CQUFlLEdBQWYsZUFBZSxDQUFLO1FBR3BCLHVCQUFrQixHQUFsQixrQkFBa0IsQ0FBSztRQWYxQixtQkFBYyxHQUFHLElBQUksYUFBYSxDQUFVLENBQUMsQ0FBQyxDQUFDO1FBQzlDLDRCQUF1QixHQUFHLElBQUksYUFBYSxDQUFZLENBQUMsQ0FBQyxDQUFDO1FBQzFELHFCQUFnQixHQUFHLElBQUksYUFBYSxDQUFjLENBQUMsQ0FBQyxDQUFDO1FBZTNELElBQUksQ0FBQyxJQUFJLENBQUMsZUFBZSxFQUFFO1lBQ3pCLE9BQU8sQ0FBQyxJQUFJLENBQ1YsaUVBQWlFLENBQ2xFLENBQUM7WUFDRixPQUFPLENBQUMsSUFBSSxDQUNWLGdEQUFnRDtnQkFDOUMsOEVBQThFLENBQ2pGLENBQUM7WUFDRixPQUFPO1NBQ1I7UUFFRCxJQUFJLENBQUMsa0JBQWtCLEVBQUU7WUFDdkIsT0FBTyxDQUFDLElBQUksQ0FBQyxrREFBa0QsQ0FBQyxDQUFDO1NBQ2xFO1FBRUQsa0JB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SUFFdEMsK0JBQVksR0FBUSxFQUFFLENBQUM7SUFDdkIsNEJBQVMsR0FBZ0IsRUFBRSxDQUFDOztnQkFSNUMsVUFBVTs7OztnQkFURixVQUFVOzZDQTBCZCxNQUFNLFNBQUMsa0JBQWtCLENBQUMsd0JBQXdCLGNBQ2xELFFBQVE7Z0RBRVIsTUFBTSxTQUFDLGtCQUFrQixDQUFDLHFCQUFxQixjQUMvQyxRQUFRO2dEQUVSLE1BQU0sU0FBQyxrQkFBa0IsQ0FBQyxvQkFBb0IsY0FDOUMsUUFBUTs7SUEwT2IseUJBQUM7Q0FBQSxBQWxRRCxJQWtRQztTQWpRWSxrQkFBa0I7OztJQUM3Qiw0Q0FBb0U7O0lBQ3BFLHlDQUE4RDs7SUFDOUQsd0NBQTREOztJQUM1RCxtQ0FBcUQ7Ozs7O0lBRXJELGdDQUFzQzs7Ozs7SUFDdEMsNkJBQTJDOztJQUUzQyw0Q0FBc0Q7Ozs7O0lBQ3RELHFEQUFrRTs7Ozs7SUFDbEUsOENBQTZEOzs7OztJQUkzRCx3Q0FBOEI7Ozs7O0lBQzlCLHlDQUUyQjs7Ozs7SUFDM0IsNkNBRTRCOzs7OztJQUM1QixnREFFK0IiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBJbmplY3QsIEluamVjdGFibGUsIE9wdGlvbmFsIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBIdHRwQ2xpZW50IH0gZnJvbSAnQGFuZ3VsYXIvY29tbW9uL2h0dHAnO1xuXG5pbXBvcnQgeyBPYnNlcnZhYmxlLCBSZXBsYXlTdWJqZWN0IH0gZnJvbSAncnhqcyc7XG5cbmltcG9ydCB7IElMYW5ndWFnZSB9IGZyb20gJy4vLi4vaW50ZXJmYWNlcy9sYW5ndWFnZS5pbnRlcmZhY2UnO1xuaW1wb3J0IHsgSVRyYW5zbGF0aW9uSW50ZXJmYWNlIH0gZnJvbSAnLi4vaW50ZXJmYWNlcy90cmFuc2xhdGlvbi5pbnRlcmZhY2UnO1xuXG5kZWNsYXJlIHZhciBnbG9iYWw6IGFueTtcblxuQEluamVjdGFibGUoKVxuZXhwb3J0IGNsYXNzIFRyYW5zbGF0aW9uU2VydmljZSBpbXBsZW1lbnRzIElUcmFuc2xhdGlvbkludGVyZmFjZSB7XG4gIHB1YmxpYyBzdGF0aWMgVFJBTlNMQVRJT05fUFJPRFVDVF9QQVRIID0gJ1RSQU5TTEFUSU9OX1BST0RVQ1RfUEFUSCc7XG4gIHB1YmxpYyBzdGF0aWMgVFJBTlNMQVRJT05fTEFOR1VBR0VTID0gJ1RSQU5TTEFUSU9OX0xBTkdVQUdFUyc7XG4gIHB1YmxpYyBzdGF0aWMgREVGQVVMVF9MQU5HVUFHRV9JU08gPSAnREVGQVVMVF9MQU5HVUFHRV9JU08nO1xuICBwdWJsaWMgc3RhdGljIGN1cnJlbnRMYW5ndWFnZTogSUxhbmd1YWdlID0gdW5kZWZpbmVkO1xuXG4gIHByaXZhdGUgc3RhdGljIHRyYW5zbGF0aW9uczogYW55ID0ge307XG4gIHByaXZhdGUgc3RhdGljIGxhbmd1YWdlczogSUxhbmd1YWdlW10gPSBbXTtcblxuICBwdWJsaWMgbGFuZ3VhZ2VMb2FkZWQgPSBuZXcgUmVwbGF5U3ViamVjdDxib29sZWFuPigxKTtcbiAgcHJpdmF0ZSBzZWxlY3RlZExhbmd1YWdlU3ViamVjdCA9IG5ldyBSZXBsYXlTdWJqZWN0PElMYW5ndWFnZT4oMSk7XG4gIHByaXZhdGUgbGFuZ3VhZ2VzU3ViamVjdCA9IG5ldyBSZXBsYXlTdWJqZWN0PElMYW5ndWFnZVtdPigxKTtcbiAgLy8gd2UgY2FuIGNoYW5nZSAnbGFuZ3VhZ2VMb2FkZWQnIHRvICdzZWxlY3RlZExhbmd1YWdlU3ViamVjdCcgaW4gdHJhbnNsYXRpb24gcmVzb2x2ZXIgID8/P1xuXG4gIGNvbnN0cnVjdG9yKFxuICAgIHByaXZhdGUgaHR0cENsaWVudDogSHR0cENsaWVudCxcbiAgICBASW5qZWN0KFRyYW5zbGF0aW9uU2VydmljZS5UUkFOU0xBVElPTl9QUk9EVUNUX1BBVEgpXG4gICAgQE9wdGlvbmFsKClcbiAgICBwcml2YXRlIHByb2R1Y3RQYXRoOiBzdHJpbmcsXG4gICAgQEluamVjdChUcmFuc2xhdGlvblNlcnZpY2UuVFJBTlNMQVRJT05fTEFOR1VBR0VTKVxuICAgIEBPcHRpb25hbCgpXG4gICAgcHJpdmF0ZSBsb2FkZWRMYW5ndWFnZXM6IGFueSxcbiAgICBASW5qZWN0KFRyYW5zbGF0aW9uU2VydmljZS5ERUZBVUxUX0xBTkdVQUdFX0lTTylcbiAgICBAT3B0aW9uYWwoKVxuICAgIHByaXZhdGUgZGVmYXVsdExhbmd1YWdlSVNPOiBhbnkgLy8gZS5nLjogZW5fVVMgZnJvbSBhbWVyaWNhIHJlZ2lvbiB8fCBlbl9VSyBmcm9tIGV1cm9wZSByZWdpb24uXG4gICkge1xuICAgIGlmICghdGhpcy5sb2FkZWRMYW5ndWFnZXMpIHtcbiAgICAgIGNvbnNvbGUud2FybihcbiAgICAgICAgJ1RoZSBUcmFuc2xhdGlvbiBTZXJ2aWNlIGNhblxcJ3QgaW5pdCB3aXRob3V0IEluamVjdGVkIExhbmd1YWdlcy4nXG4gICAgICApO1xuICAgICAgY29uc29sZS53YXJuKFxuICAgICAgICAnSW5qZWN0IHRoZSBsYW5ndWFnZXMgZnJvbSB5b3VyIGFwcGxpY2F0aW9uOiA+ICcgK1xuICAgICAgICAgICd7IHByb3ZpZGU6IFxcJ1RSQU5TTEFUSU9OX0xBTkdVQUdFUywgdXNlVmFsdWU6IHdpbmRvd1tcXCdDTVhfTEFOR1VBR0VTXFwnXSB9LFxcJydcbiAgICAgICk7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgaWYgKCFkZWZhdWx0TGFuZ3VhZ2VJU08pIHtcbiAgICAgIGNvbnNvbGUud2FybignVGhlIFRyYW5zbGF0aW9uIFNlcnZpY2UgbmVlZCBkZWZhdWx0TGFuZ3VhZ2VJU08uJyk7XG4gICAgfVxuXG4gICAgVHJhbnNsYXRpb25TZXJ2aWNlLmxhbmd1YWdlcyA9IHRoaXMubG9hZGVkTGFuZ3VhZ2VzO1xuICAgIGNvbnN0IGxvY2FsU3RvcmFnZUxhbmd1YWdlID0gKGdsb2JhbCBhcyBhbnkpLmxvY2FsU3RvcmFnZS5nZXRJdGVtKFxuICAgICAgJ2xhbmd1YWdlJ1xuICAgICk7XG5cbiAgICBjb25zdCBhbGxLZXlzID0gT2JqZWN0LmtleXMoVHJhbnNsYXRpb25TZXJ2aWNlLnRyYW5zbGF0aW9ucyk7XG4gICAgaWYgKGFsbEtleXMubGVuZ3RoID09PSAwKSB7XG4gICAgICB0aGlzLnNldExhbmd1YWdlKGxvY2FsU3RvcmFnZUxhbmd1YWdlIHx8IGRlZmF1bHRMYW5ndWFnZUlTTyk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMubGFuZ3VhZ2VMb2FkZWQubmV4dCh0cnVlKTtcbiAgICAgIC8vIHdlIGNhbiBjaGFuZ2UgJ2xhbmd1YWdlTG9hZGVkJyB0byAnc2VsZWN0ZWRMYW5ndWFnZVN1YmplY3QnIGluIHRyYW5zbGF0aW9uIHJlc29sdmVyP1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBAZGVzY3JpcHRpb24gR2V0cyB0aGUgbGFiZWxzIGRhdGEgZnJvbSB0aGUgc2VydmVyLlxuICAgKiBAcGFyYW0gJGxhbmcgTGFuZ3VhZ2UgY29kZSBmb3IgdGhlIGZpbGVcbiAgICovXG4gIHB1YmxpYyBnZXRUcmFuc2xhdGlvbnMoJGxhbmc6IHN0cmluZyk6IE9ic2VydmFibGU8YW55PiB7XG4gICAgY29uc3QgZW5kcG9pbnQgPSBgL3RyYW5zbGF0ZS90cmFuc2xhdGUvJHt0aGlzLnByb2R1Y3RQYXRofS8keyRsYW5nfWA7XG4gICAgcmV0dXJuIHRoaXMuaHR0cENsaWVudC5nZXQ8YW55PihlbmRwb2ludCk7XG4gIH1cblxuICAvKipcbiAgICogQGRlc2NyaXB0aW9uIE9ic2VydmFibGUgdG8gZ2V0cyB0aGUgbGFuZ3VhZ2VzIHRoYXQgZXhpc3QgaW4gdGhlIHNlcnZlclxuICAgKi9cbiAgcHVibGljIGdldExhbmd1YWdlcygpOiBPYnNlcnZhYmxlPElMYW5ndWFnZVtdPiB7XG4gICAgcmV0dXJuIHRoaXMubGFuZ3VhZ2VzU3ViamVjdC5hc09ic2VydmFibGUoKTtcbiAgfVxuXG4gIHB1YmxpYyBnZXRTZWxlY3RlZExhbmd1YWdlKCk6IE9ic2VydmFibGU8SUxhbmd1YWdlPiB7XG4gICAgcmV0dXJuIHRoaXMuc2VsZWN0ZWRMYW5ndWFnZVN1YmplY3QuYXNPYnNlcnZhYmxlKCk7XG4gIH1cblxuICAvKipcbiAgICogQGRlc2NyaXB0aW9uIFJldHJpZXZlIHRoZSBwdWJsaWMgdHJhbnNsYXRpb24gb2YgYSBsYWJlbFxuICAgKiBAcGFyYW0gJHRleHRJZCBMYWJlbCBpZCBhcyB3cml0dGVuIGluIHRoZSBqc29uIGZpbGVcbiAgICovXG4gIHB1YmxpYyBwdCgkdGV4dElkOiBzdHJpbmcpOiBzdHJpbmcge1xuICAgIGNvbnN0IHRleHRWYWx1ZSA9IFRyYW5zbGF0aW9uU2VydmljZS50cmFuc2xhdGlvbnNbJHRleHRJZF07XG4gICAgaWYgKCF0ZXh0VmFsdWUgfHwgdGV4dFZhbHVlID09PSB1bmRlZmluZWQpIHtcbiAgICAgIHJldHVybiAnTk9UOicgKyAkdGV4dElkO1xuICAgIH1cbiAgICByZXR1cm4gdGV4dFZhbHVlO1xuICB9XG5cbiAgLyoqXG4gICAqIEBkZXNjcmlwdGlvbiBSZXRyaWV2ZSB0aGUgcHVibGljIHRyYW5zbGF0aW9uIG9mIGEgbGFiZWxcbiAgICogQHBhcmFtICR0ZXh0SWQgTGFiZWwgaWQgYXMgd3JpdHRlbiBpbiB0aGUganNvbiBmaWxlXG4gICAqL1xuICBwdWJsaWMgZ2V0TGFiZWwoJHRleHRJZDogc3RyaW5nKTogc3RyaW5nIHtcbiAgICBjb25zdCB0ZXh0VmFsdWUgPSBUcmFuc2xhdGlvblNlcnZpY2UudHJhbnNsYXRpb25zWyR0ZXh0SWRdO1xuICAgIGlmICghdGV4dFZhbHVlIHx8IHRleHRWYWx1ZSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICByZXR1cm4gJ05PVDonICsgJHRleHRJZDtcbiAgICB9XG4gICAgcmV0dXJuIHRleHRWYWx1ZTtcbiAgfVxuXG4gIC8qKlxuICAgKiBAZGVzY3JpcHRpb24gUmV0cmlldmUgbGFuZ3VhZ2UgcHVibGlzaGVkIG9uIHRoZSBzZXJ2ZXIuXG4gICAqIEBwYXJhbSAkbGFuZ3VhZ2VJU08gQ2FuIGJlIHRoZSBjb3VudHJ5IGNvZGUgb3IgdGhlIGxhbmd1YWdlIGlzbyBjb21iaW5hdGlvblxuICAgKi9cbiAgcHVibGljIGdldExhbmd1YWdlKCRsYW5ndWFnZUlTTzogc3RyaW5nKTogSUxhbmd1YWdlIHtcbiAgICBpZiAoJGxhbmd1YWdlSVNPICE9PSB1bmRlZmluZWQgJiYgJGxhbmd1YWdlSVNPICE9PSBudWxsKSB7XG4gICAgICBsZXQgbGFuZ1ZhbHVlOiBJTGFuZ3VhZ2U7XG5cbiAgICAgIGxhbmdWYWx1ZSA9IFRyYW5zbGF0aW9uU2VydmljZS5sYW5ndWFnZXMuZmluZChsYW5ndWFnZSA9PiB7XG4gICAgICAgIHJldHVybiAoXG4gICAgICAgICAgbGFuZ3VhZ2UubGFuZ3VhZ2VJU08gPT09ICRsYW5ndWFnZUlTTyB8fFxuICAgICAgICAgIGxhbmd1YWdlLmNvdW50cnlDb2RlLnRvTG93ZXJDYXNlKCkgPT09ICRsYW5ndWFnZUlTTy50b0xvd2VyQ2FzZSgpIHx8XG4gICAgICAgICAgbGFuZ3VhZ2UubGFuZ3VhZ2VJU08uaW5jbHVkZXMoJGxhbmd1YWdlSVNPKVxuICAgICAgICApO1xuICAgICAgfSk7XG5cbiAgICAgIC8vIGlmIHRoZSBsYW5ndWFnZSBjYW5ub3QgcmVhY2hlZCwgZ28gZm9yIGRlZmF1bHRcbiAgICAgIGlmIChsYW5nVmFsdWUgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICBjb25zb2xlLndhcm4oJ1RoZSBMYW5ndWFnZSBjYW5ub3QgcmVhY2hlZCcsICRsYW5ndWFnZUlTTyk7XG4gICAgICAgIGxhbmdWYWx1ZSA9IHRoaXMuZ2V0RGVmYXVsdExhbmd1YWdlKCk7XG4gICAgICB9XG5cbiAgICAgIGxhbmdWYWx1ZS5tb21lbnRDb25maWcgPSB0aGlzLmdldE1vbWVudENvbmZpZyhsYW5nVmFsdWUpO1xuXG4gICAgICByZXR1cm4gbGFuZ1ZhbHVlO1xuICAgIH0gZWxzZSB7XG4gICAgICBjb25zb2xlLndhcm4oJyRsYW5ndWFnZUlzbyBwYXJhbSBpcyB1bmRlZmluZWQuJyk7XG4gICAgICByZXR1cm4gdGhpcy5nZXREZWZhdWx0TGFuZ3VhZ2UoKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogQGRlc2NyaXB0aW9uIFJldHJpZXZlIGxhbmd1YWdlIHB1Ymxpc2hlZCBvbiB0aGUgc2VydmVyLlxuICAgKiBAcGFyYW0gJGNvdW50cnlDb2RlIENhbiBiZSB0aGUgY291bnRyeSBjb2RlIG9yIHRoZSBsYW5ndWFnZSBpc28gY29tYmluYXRpb25cbiAgICovXG4gIHB1YmxpYyBnZXRMYW5ndWFnZUJ5Q291bnRyeUNvZGUoJGNvdW50cnlDb2RlOiBzdHJpbmcpOiBJTGFuZ3VhZ2Uge1xuICAgIGlmICgkY291bnRyeUNvZGUgIT09IHVuZGVmaW5lZCAmJiAkY291bnRyeUNvZGUgIT09IG51bGwpIHtcbiAgICAgIGxldCBsYW5nVmFsdWU6IElMYW5ndWFnZTtcbiAgICAgIGNvbnN0IGNvdW50cnlMYW46IElMYW5ndWFnZVtdID0gVHJhbnNsYXRpb25TZXJ2aWNlLmxhbmd1YWdlcy5maWx0ZXIoXG4gICAgICAgICRsYW5ndWFnZSA9PiB7XG4gICAgICAgICAgcmV0dXJuIChcbiAgICAgICAgICAgICRsYW5ndWFnZS5jb3VudHJ5Q29kZS50b0xvd2VyQ2FzZSgpID09PSAkY291bnRyeUNvZGUudG9Mb3dlckNhc2UoKVxuICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICAgICk7XG5cbiAgICAgIGlmIChjb3VudHJ5TGFuLmxlbmd0aCA+IDEpIHtcbiAgICAgICAgY29uc3QgbGFuZ3VhZ2VDb2RlID0gc2Vzc2lvblN0b3JhZ2UuZ2V0SXRlbSgnbGFuZ3VhZ2UnKTtcbiAgICAgICAgbGFuZ1ZhbHVlID0gY291bnRyeUxhbi5maW5kKCRsYW5ndWFnZSA9PiB7XG4gICAgICAgICAgcmV0dXJuIChcbiAgICAgICAgICAgICRsYW5ndWFnZS5sYW5ndWFnZUlTTy50b0xvd2VyQ2FzZSgpID09PSBsYW5ndWFnZUNvZGUudG9Mb3dlckNhc2UoKVxuICAgICAgICAgICk7XG4gICAgICAgIH0pO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgbGFuZ1ZhbHVlID1cbiAgICAgICAgICBjb3VudHJ5TGFuICYmIGNvdW50cnlMYW4ubGVuZ3RoID4gMCA/IGNvdW50cnlMYW5bMF0gOiB1bmRlZmluZWQ7XG4gICAgICB9XG5cbiAgICAgIC8vIGlmIHRoZSBsYW5ndWFnZSBjYW5ub3QgcmVhY2hlZCwgZ28gZm9yIGRlZmF1bHRcbiAgICAgIGlmIChsYW5nVmFsdWUgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICBjb25zb2xlLndhcm4oJ1RoZSBMYW5ndWFnZSBjYW5ub3QgcmVhY2hlZCcsICRjb3VudHJ5Q29kZSk7XG4gICAgICAgIGxhbmdWYWx1ZSA9IHRoaXMuZ2V0RGVmYXVsdExhbmd1YWdlKCk7XG4gICAgICB9XG5cbiAgICAgIGxhbmdWYWx1ZS5tb21lbnRDb25maWcgPSB0aGlzLmdldE1vbWVudENvbmZpZyhsYW5nVmFsdWUpO1xuXG4gICAgICByZXR1cm4gbGFuZ1ZhbHVlO1xuICAgIH0gZWxzZSB7XG4gICAgICBjb25zb2xlLndhcm4oJyRjb3VudHJ5Q29kZSBwYXJhbSBpcyB1bmRlZmluZWQuJyk7XG4gICAgICByZXR1cm4gdGhpcy5nZXREZWZhdWx0TGFuZ3VhZ2UoKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogQGRlc2NyaXB0aW9uIFNldCBsYW5ndWFnZSBieSBsYW5ndWFnZUlTTyBvciBDb3VudHJ5Q29kZS5cbiAgICogQHBhcmFtICRsYW5ndWFnZUlTTyBDYW4gYmUgdGhlIGNvdW50cnkgY29kZSBvciB0aGUgbGFuZ3VhZ2UgaXNvIGNvbWJpbmF0aW9uXG4gICAqL1xuICBwdWJsaWMgc2V0TGFuZ3VhZ2UoJGxhbmd1YWdlSVNPOiBzdHJpbmcpIHtcbiAgICB0aGlzLnNlbGVjdGVkTGFuZ3VhZ2UgPSB0aGlzLmdldExhbmd1YWdlKCRsYW5ndWFnZUlTTyk7XG5cbiAgICBmb3IgKGNvbnN0IGxhbmcgb2YgVHJhbnNsYXRpb25TZXJ2aWNlLmxhbmd1YWdlcykge1xuICAgICAgbGFuZy5pc1NlbGVjdGVkID0gbGFuZy5sYW5ndWFnZUlTTyA9PT0gdGhpcy5zZWxlY3RlZExhbmd1YWdlLmxhbmd1YWdlSVNPO1xuICAgICAgbGFuZy5kaXIgPSBsYW5nLnRleHRGbG9hdCA9PT0gJ3JpZ2h0JyA/ICdydGwnIDogJ2x0cic7XG4gICAgICBsYW5nLnJ0bCA9IGxhbmcuZGlyID09PSAncnRsJyA/IHRydWUgOiBmYWxzZTtcbiAgICB9XG5cbiAgICB0aGlzLmdldFRyYW5zbGF0aW9ucyh0aGlzLnNlbGVjdGVkTGFuZ3VhZ2UubGFuZ3VhZ2VJU08pLnN1YnNjcmliZShcbiAgICAgIHRyYW5zbGF0aW9ucyA9PiB0aGlzLnBvcHVsYXRlVHJhbnNsYXRpb24odHJhbnNsYXRpb25zKVxuICAgICk7XG4gIH1cblxuICBwdWJsaWMgcG9wdWxhdGVUcmFuc2xhdGlvbigkcmVzdWx0OiBhbnkpIHtcbiAgICBUcmFuc2xhdGlvblNlcnZpY2UudHJhbnNsYXRpb25zID0gJHJlc3VsdDtcblxuICAgIC8vIGVtaXQgY2hhbmdlcyB1bnRpbCBwb3B1bGF0ZSBpcyBjb21wbGV0ZWRcbiAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSgnbGFuZ3VhZ2UnLCB0aGlzLnNlbGVjdGVkTGFuZ3VhZ2UubGFuZ3VhZ2VJU08pO1xuICAgIHNlc3Npb25TdG9yYWdlLnNldEl0ZW0oJ2xhbmd1YWdlJywgdGhpcy5zZWxlY3RlZExhbmd1YWdlLmxhbmd1YWdlSVNPKTtcbiAgICB0aGlzLmxhbmd1YWdlTG9hZGVkLm5leHQodHJ1ZSk7XG4gICAgLy8gd2UgY2FuIGNoYW5nZSAnbGFuZ3VhZ2VMb2FkZWQnIHRvICdzZWxlY3RlZExhbmd1YWdlU3ViamVjdCcgaW4gdHJhbnNsYXRpb24gcmVzb2x2ZXI/XG4gICAgdGhpcy5zZWxlY3RlZExhbmd1YWdlU3ViamVjdC5uZXh0KHRoaXMuc2VsZWN0ZWRMYW5ndWFnZSk7XG4gICAgdGhpcy5sYW5ndWFnZXNTdWJqZWN0Lm5leHQoVHJhbnNsYXRpb25TZXJ2aWNlLmxhbmd1YWdlcyk7XG4gIH1cblxuICBwdWJsaWMgZ2V0IHNlbGVjdGVkTGFuZ3VhZ2UoKSB7XG4gICAgcmV0dXJuIFRyYW5zbGF0aW9uU2VydmljZS5jdXJyZW50TGFuZ3VhZ2U7XG4gIH1cblxuICBwdWJsaWMgc2V0IHNlbGVjdGVkTGFuZ3VhZ2UobGFuZ3VhZ2U6IElMYW5ndWFnZSkge1xuICAgIFRyYW5zbGF0aW9uU2VydmljZS5jdXJyZW50TGFuZ3VhZ2UgPSBsYW5ndWFnZTtcbiAgfVxuXG4gIHB1YmxpYyBnZXREZWZhdWx0TGFuZ3VhZ2UoKSB7XG4gICAgbGV0IGRlZmF1bHRMYW5nVmFsdWU6IElMYW5ndWFnZTtcblxuICAgIGRlZmF1bHRMYW5nVmFsdWUgPSBUcmFuc2xhdGlvblNlcnZpY2UubGFuZ3VhZ2VzLmZpbmQobGFuZ3VhZ2UgPT4ge1xuICAgICAgcmV0dXJuIChcbiAgICAgICAgbGFuZ3VhZ2UubGFuZ3VhZ2VJU08gPT09IHRoaXMuZGVmYXVsdExhbmd1YWdlSVNPIHx8XG4gICAgICAgIGxhbmd1YWdlLmNvdW50cnlDb2RlLnRvTG93ZXJDYXNlKCkgPT09XG4gICAgICAgICAgdGhpcy5kZWZhdWx0TGFuZ3VhZ2VJU08udG9Mb3dlckNhc2UoKSB8fFxuICAgICAgICBsYW5ndWFnZS5sYW5ndWFnZUlTTy5pbmNsdWRlcyh0aGlzLmRlZmF1bHRMYW5ndWFnZUlTTylcbiAgICAgICk7XG4gICAgfSk7XG5cbiAgICBpZiAoZGVmYXVsdExhbmdWYWx1ZSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICBjb25zb2xlLndhcm4oXG4gICAgICAgICdUaGUgRGVmYXVsdCBMYW5ndWFnZSBjYW5ub3QgcmVhY2hlZCcsXG4gICAgICAgIHRoaXMuZGVmYXVsdExhbmd1YWdlSVNPXG4gICAgICApO1xuXG4gICAgICBkZWZhdWx0TGFuZ1ZhbHVlID0gVHJhbnNsYXRpb25TZXJ2aWNlLmxhbmd1YWdlc1swXTtcbiAgICAgIGNvbnNvbGUud2FybihcbiAgICAgICAgJ1RyeWluZyBnZXQgdGhlIGZpcnN0IGxhbmd1YWdlJyxcbiAgICAgICAgZGVmYXVsdExhbmdWYWx1ZS5sYW5ndWFnZUlTT1xuICAgICAgKTtcbiAgICB9IGVsc2Uge1xuICAgICAgY29uc29sZS53YXJuKCdUaGUgRGVmYXVsdCBMYW5ndWFnZSBpcycsIGRlZmF1bHRMYW5nVmFsdWUubGFuZ3VhZ2VJU08pO1xuICAgIH1cblxuICAgIHJldHVybiBkZWZhdWx0TGFuZ1ZhbHVlO1xuICB9XG5cbiAgcHVibGljIGdldExhbmd1YWdlc0J5Q291bnRyeUNvZGUoY291bnRyeUNvZGU6IHN0cmluZyk6IElMYW5ndWFnZVtdIHtcbiAgICBjb25zdCBsYW5ndWFnZXNCeUNvbnRyeUNvZGU6IElMYW5ndWFnZVtdID0gVHJhbnNsYXRpb25TZXJ2aWNlLmxhbmd1YWdlcy5maWx0ZXIoXG4gICAgICBsYW5ndWFnZSA9PlxuICAgICAgICBsYW5ndWFnZS5jb3VudHJ5Q29kZS50b0xvd2VyQ2FzZSgpID09PSBjb3VudHJ5Q29kZS50b0xvd2VyQ2FzZSgpXG4gICAgKTtcbiAgICByZXR1cm4gbGFuZ3VhZ2VzQnlDb250cnlDb2RlO1xuICB9XG5cbiAgcHJpdmF0ZSBnZXRNb21lbnRDb25maWcobGFuZ3VhZ2UpIHtcbiAgICByZXR1cm4ge1xuICAgICAgbW9udGhzOiBsYW5ndWFnZS5tb250aE5hbWVzLnNwbGl0KCcsJyksXG4gICAgICBtb250aHNTaG9ydDogbGFuZ3VhZ2Uuc2hvcnREYXlNb250aHMuc3BsaXQoJywnKSxcbiAgICAgIHdlZWtkYXlzOiBsYW5ndWFnZS5kYXlOYW1lcy5zcGxpdCgnLCcpLFxuICAgICAgd2Vla2RheXNNaW46IGxhbmd1YWdlLnNob3J0RGF5TmFtZXMyLnNwbGl0KCcsJyksXG4gICAgICB3ZWVrZGF5c1Nob3J0OiBsYW5ndWFnZS5zaG9ydERheU5hbWVzLnNwbGl0KCcsJylcbiAgICB9O1xuICB9XG59XG4iXX0=
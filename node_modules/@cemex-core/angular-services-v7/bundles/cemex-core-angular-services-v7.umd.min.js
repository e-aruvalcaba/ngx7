!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/router"),require("@angular/http"),require("rxjs"),require("rxjs/operators"),require("@cemex-core/constants-v2/dist"),require("@cemex-core/events-v7"),require("@angular/core")):"function"==typeof define&&define.amd?define("@cemex-core/angular-services-v7",["exports","@angular/router","@angular/http","rxjs","rxjs/operators","@cemex-core/constants-v2/dist","@cemex-core/events-v7","@angular/core"],t):t((e["cemex-core"]=e["cemex-core"]||{},e["cemex-core"]["angular-services-v7"]={}),e.ng.router,e.ng.http,e.rxjs,e.rxjs.operators,e.dist,e.eventsV7,e.ng.core)}(this,function(e,t,d,u,s,i,p,n){"use strict";function l(r,o){var i,s,a,e,u={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return e={next:t(0),"throw":t(1),"return":t(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function n(e){if(i)throw new TypeError("Generator is already executing.");for(;u;)try{if(i=1,s&&(a=2&e[0]?s["return"]:e[0]?s["throw"]||((a=s["return"])&&a.call(s),0):s.next)&&!(a=a.call(s,e[1])).done)return a;switch(s=0,a&&(e=[2&e[0],a.value]),e[0]){case 0:case 1:a=e;break;case 4:return u.label++,{value:e[1],done:!1};case 5:u.label++,s=e[1],e=[0];continue;case 7:e=u.ops.pop(),u.trys.pop();continue;default:if(!(a=0<(a=u.trys).length&&a[a.length-1])&&(6===e[0]||2===e[0])){u=0;continue}if(3===e[0]&&(!a||e[1]>a[0]&&e[1]<a[3])){u.label=e[1];break}if(6===e[0]&&u.label<a[1]){u.label=a[1],a=e;break}if(a&&u.label<a[2]){u.label=a[2],u.ops.push(e);break}a[2]&&u.ops.pop(),u.trys.pop();continue}e=o.call(r,u)}catch(t){e=[6,t],s=0}finally{i=a=0}if(5&e[0])throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}([t,e])}}}function y(e){var t="function"==typeof Symbol&&e[Symbol.iterator],n=0;return t?t.call(e):{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}}}var r=function(){function e(){var e="API_ENV",t="API_HOST",n="API_ORG",r="APP_CODE",o="CLIENT_ID";this._appCode=global[r],this._clientId=global[o],this._apiBasePath=global[t],this._apiOrg=global[n],this._apiEnv=global[e],this._apiBasePath===undefined&&console.warn("environment variable 'API_HOST' is missing !!")}return Object.defineProperty(e.prototype,"appCode",{get:function(){return this._appCode},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"clientId",{get:function(){return this._clientId},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"apiBasePath",{get:function(){return this._apiBasePath},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"apiOrg",{get:function(){return this._apiOrg},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"apiEnv",{get:function(){return this._apiEnv},enumerable:!0,configurable:!0}),e.prototype.generateEndpoint=function(e){return""+this._apiBasePath+this._apiOrg+this._apiEnv+e},e.prototype.getBaseOrgEnvPath=function(){return this._apiBasePath+this._apiOrg+this._apiEnv},e.prototype.setAppKeys=function(e){this._appCode=e.APP_CODE,this._clientId=e.CLIENT_ID,this._apiBasePath===undefined&&console.warn("environment variable 'API_HOST' is missing !!")},e.decorators=[{type:n.Injectable}],e.ctorParameters=function(){return[]},e}(),o=function(){function e(e,t){this.http=e,this.projectSettings=t,this._validSettings=!1,this._validSettings=this.validateProjectSettings()}return e.prototype.generateEndpoint=function(e){return this.projectSettings.generateEndpoint(e)},Object.defineProperty(e.prototype,"clientId",{get:function(){return this.projectSettings.clientId},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"appCode",{get:function(){return this.projectSettings.appCode},enumerable:!0,configurable:!0}),e.prototype.request=function(e,t){var n=this.createAuthorizationHeader(t);return this.http.request(e,n)},e.prototype.get=function(e,t,n){var r=this.createAuthorizationHeader(t,n);return this.http.get(e,r)},e.prototype.post=function(e,t,n,r){if(!this._validSettings){return u.Observable["throw"](new Error("Set missing environment variables of API_HOST, API_ORG, API_ENV, APP_CODE, CLIENT_ID"))}var o=this.createAuthorizationHeader(n,r);return this.http.post(e,t,o)},e.prototype.put=function(e,t,n,r){var o=this.createAuthorizationHeader(n,r);return this.http.put(e,t,o)},e.prototype.patch=function(e,t,n,r){var o=this.createAuthorizationHeader(n,r);return this.http.patch(e,t,o)},e.prototype["delete"]=function(e,t,n){var r=this.createAuthorizationHeader(t,n);return this.http["delete"](e,r)},e.prototype.head=function(e,t,n){var r=this.createAuthorizationHeader(t,n);return this.http.head(e,r)},e.prototype.isRunningOnBrowser=function(){return null!==global&&global!==undefined},e.prototype.encrypt=function(e){return window.btoa(unescape(encodeURIComponent(e)))},e.prototype.decrypt=function(e){return e?decodeURIComponent(escape(window.atob(e))):e},e.prototype.setProjectSettingsNewKeys=function(e){this.projectSettings.setAppKeys(e)},e.prototype.createAuthorizationHeader=function(e,t){var n,r,o=e&&e.headers&&0<e.headers.keys().length,i=e?Object.assign({},e):new d.RequestOptions,s=new d.Headers,a=this.isRunningOnBrowser()&&window.localStorage.getItem("language")||"en";s.append("Accept","application/json"),s.append("X-IBM-Client-Id",this.projectSettings.clientId),s.append("App-Code",this.projectSettings.appCode),s.append("Accept-Language",a);var u=sessionStorage.getItem("access_token");u&&u!==undefined&&s.append("Authorization","Bearer "+u);var c=sessionStorage.getItem("jwt");this.isRunningOnBrowser()&&c&&c!==undefined&&s.append("jwt",c);var p=o?e.headers.keys():[];try{for(var l=y(p),h=l.next();!h.done;h=l.next()){var g=h.value;s.set(g,e.headers.get(g))}}catch(f){n={error:f}}finally{try{h&&!h.done&&(r=l["return"])&&r.call(l)}finally{if(n)throw n.error}}return i.headers=s,t&&o&&(i.headers=e.headers),i},e.prototype.validateProjectSettings=function(){var e=this.projectSettings;return e.apiBasePath!==undefined&&e.apiEnv!==undefined&&e.apiOrg!==undefined&&e.appCode!==undefined&&e.clientId!==undefined},e.decorators=[{type:n.Injectable}],e.ctorParameters=function(){return[{type:d.Http},{type:r}]},e}(),a=function(){function c(e,t,n){if(this.http=e,this.eventBroadcaster=t,this.authTokenVersion=n,this.siteDomain="SITE_DOMAIN",this._siteDomain=window[this.siteDomain]||"",this._menuApplication=new u.BehaviorSubject([]),this._currentLegalEntity=new u.BehaviorSubject(null),this._userProfile=null,this._beforeLogout=null,n)switch(n.toLocaleLowerCase()){case"v6":this._endpoint=i.SessionServiceConstants.LOGIN_TOKEN_V6;break;default:this._endpoint=i.SessionServiceConstants.LOGIN_TOKEN_DEFAULT}else this._endpoint=i.SessionServiceConstants.LOGIN_TOKEN_DEFAULT;(localStorage.getItem("language")===undefined||null===localStorage.getItem("language")&&sessionStorage.getItem("language")!==undefined&&null!==sessionStorage.getItem("language"))&&localStorage.setItem("language",sessionStorage.getItem("language"))}return Object.defineProperty(c.prototype,"menuApplicationItems",{get:function(){return 0===this._menuApplication.getValue().length&&this.reloadAppMenuItems(),this._menuApplication.asObservable()},enumerable:!0,configurable:!0}),c.prototype.setLegalEntity=function(e){sessionStorage.setItem("user_legal_entity",JSON.stringify(e)),this.eventBroadcaster.broadcast(p.Broadcaster.DCM_LEGAL_ENTITY_CHANGE,JSON.stringify(e)),this._currentLegalEntity.next(e)},Object.defineProperty(c.prototype,"currentLegalEntity",{get:function(){return this._currentLegalEntity.asObservable()},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"isLoggedIn",{get:function(){var e=sessionStorage.getItem("access_token"),t=sessionStorage.getItem("jwt");return null!==e&&e!==undefined&&""!==e&&null!=t&&t!==undefined&&""!==t},enumerable:!0,configurable:!0}),c.prototype.logout=function(){var n=this;return new u.Observable(function(t){return n._beforeLogout?n._beforeLogout.subscribe(function(e){n.logoutApp(),t.next({message:"success",success:!0})},function(e){t.next({message:e,success:!1})}):(n.logoutApp(),t.next({message:"success",success:!0})),t})},c.prototype.login=function(e,t,r,n,o){var i=this;this.clean();var s=new d.RequestOptions({headers:new d.Headers({"Content-Type":"application/x-www-form-urlencoded",accept:"text/plain, */*"})}),a=this.http.generateEndpoint(this._endpoint),u=this.generateUrlString(e,t,n);return this.http.post(a,u,s).toPromise().then(function(n){return function e(t,s,a,u){return new(a||(a=Promise))(function(e,n){function r(e){try{i(u.next(e))}catch(t){n(t)}}function o(e){try{i(u["throw"](e))}catch(t){n(t)}}function i(t){t.done?e(t.value):new a(function(e){e(t.value)}).then(r,o)}i((u=u.apply(t,s||[])).next())})}(i,void 0,void 0,function(){var t;return l(this,function(e){return t=n.json(),"v6"===this.authTokenVersion&&t.userId?t.userId:t.profile.userId,this.processDataFromLogin(t,r),this.eventBroadcaster.broadcast(c.LOGIN_SUCCESS_EVENT),o&&t.profile&&t.profile.hasTemporaryPassword?[2,Promise.resolve(t)]:[2]})})})["catch"](function(e){return console.error(e),i.eventBroadcaster.broadcast(c.LOGIN_FAIL_EVENT),Promise.reject(e)})},Object.defineProperty(c.prototype,"userRegion",{get:function(){return sessionStorage.getItem("region")||"US"},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"userCountry",{get:function(){return sessionStorage.getItem("country")||""},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"userProfile",{get:function(){return this._userProfile||this.setUserProfile(),this._userProfile},enumerable:!0,configurable:!0}),c.prototype.getLegalEntities=function(e,t,n){var r=this,o=this.http.generateEndpoint(i.SessionServiceConstants.USER_LEGAL_ENTITIES);return o=this.addQueryParams(o,e,t,n),this.http.get(o).pipe(s.map(function(e){var t=[];return e.json()&&(t=e.json()),t}),s.catchError(function(e){return u.Observable["throw"](r.handleError(e))}))},c.prototype.setBeforeLogout=function(e){this._beforeLogout=e},c.prototype.getBeforeLogout=function(){return this._beforeLogout},c.prototype.reloadAppMenuItems=function(){var t=this;this.getDCMApplications().subscribe(function(e){t._menuApplication.next(e)})},c.prototype.createCookie=function(e,t,n){var r="";if(n){var o=new Date;o.setTime(o.getTime()+24*n*60*60*1e3),r=o.toUTCString()}else n=0;var i=e+"="+t+";expires="+r+";domain="+this._siteDomain+";path=/";document.cookie=i},c.prototype.readCookie=function(e){for(var t,n=document.cookie.split(";"),r=n.length,o=e+"=",i=0;i<r;i+=1)if(0===(t=n[i].replace(/^\s+/g,"")).indexOf(o))return t.substring(o.length,t.length);return null},c.prototype.clearCookie=function(e){this.createCookie(e,"",-1)},c.prototype.setUserProfile=function(){var e=sessionStorage.getItem("user_profile"),t=this.convertJsonTo(e);if(t){var n=sessionStorage.getItem("user_customer"),r=this.convertJsonTo(n);r?t.customer=r:console.warn("Exception at parsing User Customer from sessionStore"),this._userProfile=t}else console.warn("Exception at parsing User Profile from sessionStore")},c.prototype.clean=function(){this.clearCookie("CemexGoRegion"),this.clearCookie("up_session"),sessionStorage.removeItem("access_token"),sessionStorage.removeItem("refresh_token"),sessionStorage.removeItem("expires_in"),sessionStorage.removeItem("jwt"),sessionStorage.removeItem("region"),sessionStorage.removeItem("user_profile"),sessionStorage.removeItem("user_customer"),sessionStorage.removeItem("user_legal_entity"),sessionStorage.removeItem("user_applications"),sessionStorage.removeItem("auth_token"),sessionStorage.removeItem("userInfo"),sessionStorage.removeItem("country"),sessionStorage.removeItem("token_data"),sessionStorage.removeItem("applications"),sessionStorage.removeItem("role"),sessionStorage.removeItem("username"),sessionStorage.removeItem("userAuthV6"),sessionStorage.removeItem("userInfoV6"),sessionStorage.removeItem("userProfileV6"),sessionStorage.removeItem("userCustomerV6"),sessionStorage.removeItem("userApplicationsV6"),sessionStorage.removeItem("userRolesV6")},c.prototype.generateUrlString=function(e,t,n){var r="grant_type=password&scope=security&username="+e+"&password="+encodeURIComponent(t)+"&client_id="+this.http.clientId;return n&&(r=r+"&app_name="+n),this.authTokenVersion&&"v6"===this.authTokenVersion.toLowerCase()&&(r+="&userinformation=false&include=userinfo,profile,applications,roles,customers,oldVersion"),r},c.prototype.processDataFromLogin=function(e,t){if(t){var n={auth:e.oauth2.access_token,expires_in:e.oauth2.expires_in,jwt:e.jwt,refresh_token:e.oauth2.refresh_token,region:e.oauth2.region};this.createCookie("up_session",JSON.stringify(n),null)}this.createCookie("CemexGoRegion",e.oauth2.region,null),sessionStorage.setItem("access_token",e.oauth2.access_token),sessionStorage.setItem("refresh_token",e.oauth2.refresh_token),sessionStorage.setItem("expires_in",e.oauth2.expires_in),sessionStorage.setItem("jwt",e.jwt),sessionStorage.setItem("auth_token",e.oauth2.access_token),sessionStorage.setItem("user_profile",JSON.stringify(e.profile)),sessionStorage.setItem("user_customer",JSON.stringify(e.customer)),sessionStorage.setItem("user_applications",JSON.stringify(e.applications)),sessionStorage.setItem("userInfo",JSON.stringify(e)),sessionStorage.setItem("country",e.country),sessionStorage.setItem("token_data",JSON.stringify(e)),sessionStorage.setItem("applications",JSON.stringify(e.applications)),sessionStorage.setItem("region",e.oauth2.region),sessionStorage.setItem("role",e.role),sessionStorage.setItem("username",e.profile.userAccount),this.setUserProfile();var r={oauth2:e.oauth2,jwt:e.jwt,userId:e.userId?e.userId:e.profile.userId},o=this.encrypt(JSON.stringify(r));if(sessionStorage.setItem("userAuthV6",o),e._users){var i=e._users[0],s={accountType:i.accountType,countryCode:i.country.countryCode,customerId:i.customer?i.customer.customerId:0,firstName:i.firstName,fullName:i.fullName,lastName:i.lastName,phoneNumber:i.phoneNumber,userAccount:i.userAccount,userId:i.userId,userSelectedId:i.userSelectedId,userStatus:i.userStatus,userType:i.userType},a=this.encrypt(JSON.stringify(s));sessionStorage.setItem("userInfoV6",a)}if(e._profile){var u=e._profile,c={allowEmailUpdates:u.allowEmailUpdates,allowInformationShare:u.allowInformationShare,hasTemporaryPassword:u.hasTemporaryPassword,userEmail:u.userEmail,userId:u.userId,userPosition:u.userPosition,userProfileId:u.userProfileId},p=this.encrypt(JSON.stringify(c));sessionStorage.setItem("userProfileV6",p)}if(e._customers){var l=e._customers,h={countryCode:l.country.countryCode,customerCode:l.customerCode,customerCodeLZR:l.customerCodeLZR,customerDesc:l.customerDesc,customerDesc2:l.customerDesc2,customerId:l.customerId,email:l.email,faxNumber:l.faxNumber,phoneNumber:l.phoneNumber,regionId:l.region.regionId,vAT:l.vAT},g=this.encrypt(JSON.stringify(h));sessionStorage.setItem("userCustomerV6",g)}if(e._applications){var f=e._applications.map(function(e){return{applicationCode:e.applicationCode,applicationId:e.applicationId,applicationType:e.applicationType,isVisible:e.isVisible}}),d=this.encrypt(JSON.stringify(f));sessionStorage.setItem("userApplicationsV6",d)}if(e._roles){var y=e._roles.map(function(e){return{applicationId:e.application.applicationId,isInternal:e.isInternal,isOptional:e.isOptional,isVisible:e.isVisible,roleCode:e.roleCode,roleId:e.roleId,roleType:e.roleType}}),m=this.encrypt(JSON.stringify(y));sessionStorage.setItem("userRolesV6",m)}},c.prototype.getDCMApplications=function(){var t=this,e=this.http.generateEndpoint(i.SessionServiceConstants.USER_APPLICATION_MENU);return this.http.get(e).pipe(s.map(function(e){var t=e.json();return t&&t!==undefined?e.json():(console.warn("Configuration of menu application is empty!!"),[])}),s.catchError(function(e){return u.Observable["throw"](t.handleError(e))}))},c.prototype.convertJsonTo=function(e){try{return JSON.parse(e)}catch(t){console.warn("Exception at parsing object from sessionStore:",t)}return null},Object.defineProperty(c.prototype,"customer",{get:function(){var e,t=sessionStorage.getItem("user_customer");if(t)try{e=JSON.parse(t)}catch(n){return console.warn("Exception at parsing user_customer from sessionStore:",n),null}else console.warn("There is no user customer at session storage");return e},enumerable:!0,configurable:!0}),c.prototype.handleError=function(e){if(e instanceof d.Response){e.json();e.status+" - "+(e.statusText||"")}else e.message?e.message:e.toString();return console.error(e),u.throwError(e)},c.prototype.addQueryParams=function(e,t,n,r){var o=Number.isInteger(t)&&Number.isInteger(n);return e+=o?"?fetch="+t+"&page="+n:"",e+=r&&o?"&legalEntityCode="+r:r&&!o?"?legalEntityCode="+r:""},c.prototype.logoutApp=function(){this.clean(),this.eventBroadcaster.broadcast(p.Broadcaster.DCM_APP_LOGOUT)},Object.defineProperty(c.prototype,"userAuth",{get:function(){return JSON.parse(this.decrypt(sessionStorage.getItem("userAuthV6")))},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"userInfo",{get:function(){return JSON.parse(this.decrypt(sessionStorage.getItem("userInfoV6")))},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"userProfileV6",{get:function(){return JSON.parse(this.decrypt(sessionStorage.getItem("userProfileV6")))},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"userCustomer",{get:function(){return JSON.parse(this.decrypt(sessionStorage.getItem("userCustomerV6")))},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"userApplications",{get:function(){return JSON.parse(this.decrypt(sessionStorage.getItem("userApplicationsV6")))},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"userRoles",{get:function(){return JSON.parse(this.decrypt(sessionStorage.getItem("userRolesV6")))},enumerable:!0,configurable:!0}),c.prototype.encrypt=function(e){return window.btoa(unescape(encodeURIComponent(e)))},c.prototype.decrypt=function(e){return e?decodeURIComponent(escape(window.atob(e))):e},c.LOGIN_SUCCESS_EVENT="LOGIN_SUCCESS_EVENT",c.LOGIN_FAIL_EVENT="LOGIN_FAIL_EVENT",c.LOGIN_LOGOUT_EVENT="LOGIN_LOGOUT_EVENT",c.AUTH_TOKEN_VERSION="auth_token_version",c.decorators=[{type:n.Injectable}],c.ctorParameters=function(){return[{type:o},{type:p.Broadcaster},{type:String,decorators:[{type:n.Inject,args:[c.AUTH_TOKEN_VERSION]},{type:n.Optional}]}]},c}(),c=function(){function e(e,t){this.http=e,this.endpoints=t}return e.prototype.getLegalEntity=function(){return this.http.get(this.getUrl("legalentity")).pipe(s.map(function(e){return e.json()})).toPromise().then(function(e){return e})["catch"](function(e){return e})},e.prototype.getAllLegalEntityCustomers=function(){return this.http.get(this.getUrl("legalentitycustomers")).pipe(s.map(function(e){return e.json().responseLegalEntity.customer})).toPromise().then(function(e){return e})["catch"](function(e){return e})},e.prototype.getLegalEntityByCustomer=function(e){return this.http.get(this.getUrl("legalentity?customerCode="+e)).pipe(s.map(function(e){return e.json().responseLegalEntity.company})).toPromise().then(function(e){return e})["catch"](function(e){return e})},e.prototype.getLegalEntityByCompany=function(e){return this.http.get(this.getUrl("legalentity?companyCode="+e)).pipe(s.map(function(e){return e.json().responseLegalEntity.customer})).toPromise().then(function(e){return e})["catch"](function(e){return e})},e.prototype.getLegalEntityJobsites=function(e,t){var n="legalentityjobsites?companyCode="+t+"&customerCode="+e;return this.http.get(this.getUrl(n)).pipe(s.map(function(e){return e.json().responseLegalEntity.jobSite})).toPromise().then(function(e){return e})["catch"](function(e){return e})},e.prototype.getUrl=function(e){return this.http.generateEndpoint(this.endpoints.V1+this.endpoints.armCapability+e)},e.decorators=[{type:n.Injectable}],e.ctorParameters=function(){return[{type:o},{type:i.EndpointsConstants}]},e}(),h=function(){function e(e,t){this.http=e,this.endpoints=t}return e.prototype.getLegalEntity=function(){return this.http.get(this.getUrl("legalentity")).pipe(s.map(function(e){return e.json()})).toPromise().then(function(e){return e})["catch"](function(e){return e})},e.prototype.getAllLegalEntityCustomers=function(){return this.http.get(this.getUrl("legalentitycustomers")).pipe(s.map(function(e){return e.json().responseLegalEntity.customer})).toPromise().then(function(e){return e})["catch"](function(e){return e})},e.prototype.getLegalEntityByCustomer=function(e){return this.http.get(this.getUrl("legalentity?customerCode="+e)).pipe(s.map(function(e){return e.json().responseLegalEntity.company})).toPromise().then(function(e){return e})["catch"](function(e){return e})},e.prototype.getLegalEntityByCompany=function(e){return this.http.get(this.getUrl("legalentity?companyCode="+e)).pipe(s.map(function(e){return e.json().responseLegalEntity.customer})).toPromise().then(function(e){return e})["catch"](function(e){return e})},e.prototype.getLegalEntityJobsites=function(e,t){var n="legalentityjobsites?companyCode="+t+"&customerCode="+e;return this.http.get(this.getUrl(n)).pipe(s.map(function(e){return e.json().responseLegalEntity.jobSite})).toPromise().then(function(e){return e})["catch"](function(e){return e})},e.prototype.getUrl=function(e){return this.http.generateEndpoint(this.endpoints.V1+this.endpoints.armCapability+e)},e.decorators=[{type:n.Injectable}],e.ctorParameters=function(){return[{type:o},{type:i.EndpointsConstants}]},e}(),g=function(){function e(e,t){this.router=e,this.sessionService=t}return e.prototype.canActivate=function(){return!!this.sessionService.isLoggedIn||(this.router.navigate(["/login"]),!1)},e.decorators=[{type:n.Injectable}],e.ctorParameters=function(){return[{type:t.Router},{type:a}]},e}(),f=function(){function a(e,t,n,r,o){if(this.eventBroadcaster=e,this.http=t,this._productPath=n,this.useTranslationServer=r,this._translationUrl=o,this._useTranslationServer=!1,this.productPath="",this._localeData=new u.Subject,this.productPath=n||"/",this._useTranslationServer=r||!1,null===this._translationUrl&&(this._translationUrl="/translate/translate"),this.isRunningOnBrowser()){var i=global.sessionStorage.getItem("language")||"en_US",s=global.localStorage.getItem("language");-1===i.indexOf("es")||this._useTranslationServer?-1===i.indexOf("en")||this._useTranslationServer?(s=i,global.localStorage.setItem("language",s)):(s="en",global.localStorage.setItem("language","en")):(s="es",global.localStorage.setItem("language","es"));var a=void 0;"en"===(a=this._useTranslationServer?(this.lang(s||"en_US"),s||"en_US"):(this.lang(s||"en"),s||"en"))?a+="_US":"es"===a&&(a+="_MX"),global.sessionStorage.setItem("language",a)}else this._useTranslationServer?this.lang("en_US"):this.lang("en")}return a.st=function(e){var t=this.translation.get(e);return t&&t!==undefined?t:"NOT:"+e},a.all=function(){return this.translation},Object.defineProperty(a.prototype,"localeData",{get:function(){return this._localeData.asObservable()},enumerable:!0,configurable:!0}),a.prototype.isRunningOnBrowser=function(){return null!==global&&global!==undefined},a.prototype.onChange=function(e){this.labels=e,this._localeData.next(e)},a.prototype.lang=function(e){var t=this;if(e!==a.language){var n=a.language=e;"en"===n?n+="_US":"es"===n&&(n+="_MX"),this.isRunningOnBrowser()&&sessionStorage.setItem("language",n),this._useTranslationServer?this.http.get(this._translationUrl+this.productPath+n).toPromise().then(function(e){return t.populateTranslation(e.json())})["catch"](this.handleError):this.http.get(this.productPath+"vendor/locale-"+e+".json").toPromise().then(function(e){return t.populateTranslation(e.json())})["catch"](this.handleError)}},a.prototype.isoLang=function(e){-1===e.indexOf("-")&&-1===e.indexOf("_")||(a.language=e,global.sessionStorage.setItem("language",e))},a.prototype.file=function(e){var t=this;this.http.get(e).toPromise().then(function(e){return t.populateTranslation(e.json())})["catch"](this.handleError)},a.prototype.pt=function(e){var t=a.translation.get(e);return t&&t!==undefined?t:"NOT:"+e},a.prototype.getLabel=function(e){var t=a.translation.get(e);return t||undefined},a.prototype.getlang=function(){return a.language},a.prototype.getCountryCode=function(){return a.language.split("_")[1]},a.prototype.populateTranslation=function(e){var t,n;try{for(var r=y(Object.keys(e)),o=r.next();!o.done;o=r.next()){var i=o.value;a.translation.set(i,e[i])}}catch(s){t={error:s}}finally{try{o&&!o.done&&(n=r["return"])&&n.call(r)}finally{if(t)throw t.error}}this.eventBroadcaster.broadcast(p.Broadcaster.DCM_LANGUAGE_FETCHED,a.language),this.onChange(e)},a.prototype.handleError=function(e){return Promise.reject(e.message||e)},a.translation=new Map,a.language="",a.PRODUCT_PATH="PRODUCT_PATH",a.USE_TRANSLATION_SERVER="USE_TRANSLATION_SERVER",a.TRANSLATION_BASE_URL="TRANSLATION_BASE_URL",a.decorators=[{type:n.Injectable}],a.ctorParameters=function(){return[{type:p.Broadcaster},{type:d.Http},{type:String,decorators:[{type:n.Inject,args:[a.PRODUCT_PATH]},{type:n.Optional}]},{type:Boolean,decorators:[{type:n.Inject,args:[a.USE_TRANSLATION_SERVER]},{type:n.Optional}]},{type:String,decorators:[{type:n.Inject,args:[a.TRANSLATION_BASE_URL]},{type:n.Optional}]}]},a}(),m=function(){function e(){}return e.log=function(e){console.log(e)},e.error=function(e){console.error(e)},e.warn=function(e){console.warn(e)},e.logf=function(e){console.log(e)},e.decorators=[{type:n.Injectable}],e}(),v=function(){function u(e,t,n,r,o){this.eventBroadcaster=e,this.http=t,this._productPath=n,this._productEnvironment=r,this.localManifest=o,this.productPath="",this.productEnvironment="",this.productPath=n||"/",this.productEnvironment=r||"development",this.getFeatureList(this.localManifest||!1)}return u.all=function(){return this.featureList},u.prototype.feature=function(e,t,n,r){var o=this;return"string"==typeof e?this.coreValidator(e,t,n,r):(e.forEach(function(e){if(!o.coreValidator(e,t,n,r))return!1}),!0)},u.prototype.getAll=function(){return u.featureList},u.prototype.getFeatureList=function(e){var t=this;e?this.http.get(this.productPath+"vendor/local-feature.json").toPromise().then(function(e){return t.populateFeatures(e.json())})["catch"](this.handleError):this.http.get("/feature/api"+this.productPath).toPromise().then(function(e){return t.populateFeatures(e.json())})["catch"](this.handleError)},u.prototype.coreValidator=function(e,t,n,r){var o=u.featureList.get(e);if(o===undefined)return!1;if(null!==o.country&&o.country!==undefined&&-1===window.sessionStorage.getItem("country").indexOf(o.country))return!1;if(null!==o.role&&o.role!==undefined){var i=!1;if(JSON.parse(window.sessionStorage.getItem("applications")).forEach(function(e){e.roles.forEach(function(e){e.roleCode===o.role&&(i=!0)})}),!i)return!1}if(null!==o.role_match&&o.role_match!==undefined){var s=0;if(JSON.parse(window.sessionStorage.getItem("applications")).forEach(function(e){e.roles.forEach(function(e){-1!==o.role_match.indexOf(e.roleCode)&&(s+=1)})}),s!==o.role_match.split(",").length)return!1}if(null!==o.role_any&&o.role_any!==undefined){var a=0;if(JSON.parse(window.sessionStorage.getItem("applications")).forEach(function(e){e.roles.forEach(function(e){-1!==o.role_any.indexOf(e.roleCode)&&(a+=1)})}),0===a)return!1}return(null===o.environment||o.environment===undefined||o.environment===this.productEnvironment)&&((null===o.release_version||o.release_version===undefined||o.release_version===t)&&((null===o.feature_version||o.feature_version===undefined||o.feature_version===n)&&(null===o.host_name||o.host_name===undefined||o.host_name===r)))},u.prototype.handleError=function(e){return Promise.reject(e.message||e)},u.prototype.populateFeatures=function(e){var t,n;try{for(var r=y(Object.keys(e)),o=r.next();!o.done;o=r.next()){var i=o.value;u.featureList.set(e[i].feature,e[i])}}catch(s){t={error:s}}finally{try{o&&!o.done&&(n=r["return"])&&n.call(r)}finally{if(t)throw t.error}}},u.featureList=new Map,u.language="",u.PRODUCT_PATH="PRODUCT_PATH",u.ENVIRONMENT="PRODUCT_PATH",u.USE_LOCAL_MANIFEST="USE_LOCAL_MANIFEST",u.decorators=[{type:n.Injectable}],u.ctorParameters=function(){return[{type:p.Broadcaster},{type:d.Http},{type:String,decorators:[{type:n.Inject,args:[u.PRODUCT_PATH]},{type:n.Optional}]},{type:String,decorators:[{type:n.Inject,args:[u.ENVIRONMENT]},{type:n.Optional}]},{type:Boolean,decorators:[{type:n.Inject,args:[u.USE_LOCAL_MANIFEST]},{type:n.Optional}]}]},u}(),S=function(){function e(e,t,n){var r=this;this.http=e,this.projectEnv=t,this.sessionService=n,this._countryConfig=new u.BehaviorSubject(null),this._countryConfigApiPath="/v5/secm/console/countryconfig",this._countryConfig.getValue()||this.getCountryConfiguration().subscribe(function(e){r._countryConfig.next(e)})}return Object.defineProperty(e.prototype,"countryConfig",{get:function(){return this._countryConfig.asObservable()},enumerable:!0,configurable:!0}),e.prototype.getCountryConfiguration=function(){var e=this.sessionService.userCountry||"US",t=""+this.projectEnv.getBaseOrgEnvPath()+this._countryConfigApiPath+"?countryCode="+e;return this.http.get(t).pipe(s.map(function(e){return e.json()}),s.catchError(this.handleError))},e.prototype.handleError=function(e){if(e instanceof d.Response){var t=e.json()||"";t.error||JSON.stringify(t);e.status+" - "+(e.statusText||"")}else e.message?e.message:e.toString();return console.error(e),u.Observable["throw"](e)},e.decorators=[{type:n.Injectable}],e.ctorParameters=function(){return[{type:o},{type:r},{type:a}]},e}(),_=function(){function e(){}return e.pattern=function(e){return/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(e.value)?null:{patternInvalid:!0}},e}(),I=function(){function e(){}return e.isNumeric=function(e){return!isNaN(parseFloat(e.value))&&isFinite(e.value)?null:{notNumeric:!0}},e.onlyTwoDecimals=function(e){return/^\d+(\.\d{1,2})?$/.test(e.value)?null:{patternInvalid:!0}},e.greaterThanZero=function(e){return 0<parseFloat(e.value)?null:{lessThanZero:!0}},e.isPositive=function(e){return 0<=parseFloat(e.value)?null:{isNegative:!0}},e.lessThan=function(e){var n=e;return function(e){var t=+e.value;return isNaN(t)||n<t?{isGreater:!0}:null}},e.greaterThan=function(e){var n=e;return function(e){var t=+e.value;return isNaN(t)||t<n?{isLess:!0}:null}},e}(),b=function(){function e(e,t){this.http=e,this.endpoints=t,this.apiCashDocuments="cashdocuments"}return e.prototype.getCreditDocs=function(e,t,n){var r=this,o="companyCode="+e+"&customerCode="+t+"&jobSiteCode="+n,i=this.apiCashDocuments+"?"+o;return this.http.get(this.getUrl(i)).pipe(s.map(function(e){var t=e.json();return r.handleCashDocumentsData(t)})).toPromise().then(function(e){return e})["catch"](function(e){return e})},e.prototype.handleCashDocumentsData=function(e){return e.forEach(function(e,t){if(e.index=t,e.flagInvalidAmnt=!1,e.errMsg="",e.toCommit=0,e.createDate){var n=e.createDate.split("T")[0].split("-"),r=e.createDate.split("T")[1];e.createDate=n[2]+"-"+n[1]+"-"+n[0]+"T"+r}e.amount=e.amount?e.amount:0,e.reconciledAmount=e.reconciledAmount?e.reconciledAmount:0,e.commitedAmount=e.commitedAmount?e.commitedAmount:0}),e},e.prototype.getUrl=function(e){return this.http.generateEndpoint(this.endpoints.V1+this.endpoints.peCapability+e)},e.decorators=[{type:n.Injectable}],e.ctorParameters=function(){return[{type:o},{type:i.EndpointsConstants}]},e}(),C=function(){function e(){this.defaultTrackings=[["track_pageview"],["track_clicks"],["track_errors"],["track_links"],["track_forms"],["collect_from_forms"]],this.Countly=window.Countly}return e.prototype.init=function(){this.addTracking("track_sessions"),this.Countly.init()},e.prototype.debug=function(e){this.Countly.debug=e},e.prototype.startService=function(e,t){this.Countly!==undefined&&(this.Countly.url=e,this.Countly.app_key=t,this.Countly.q=this.defaultTrackings)},e.prototype.addTracking=function(e,t){t?this.Countly.q.push([e,t]):this.Countly.q.push([e])},e.prototype.addTrackingPage=function(e){this.Countly.q.push(["track_pageview",e])},e.prototype.changeId=function(e,t){this.Countly.q.push(["change_id",e+t])},e.prototype.identifyUser=function(e){this.Countly.q.push(["user_details",e])},e.prototype.endSession=function(){this.Countly.q.push(["end_session"])},e.prototype.removeTracking=function(t){this.Countly.q.forEach(function(e){-1!==e.indexOf(t)&&(e[0]="canceled")})},e}(),P=function(){function r(){}return r.prototype.createService=function(e,t){switch(e){case r.Type.Countly:var n=new C;return n.startService(t.url,t.key),n;case r.Type.Clevertap:case r.Type.Other:default:return null}},r.Type={Countly:1,Clevertap:2,Other:0},r}(),E=function(){function e(){this.appCode=window.APP_CODE,this.apiClientId=window.CLIENT_ID,this.apiHost=window.API_HOST,this.appLanguage=window.LANGUAGE,this.authToken="Bearer "+sessionStorage.getItem("auth_token"),this.jwt=sessionStorage.getItem("jwt"),this.urlServiceWorker="service-worker/push_sw.js",this.deviceApi=this.apiHost+"v5/cm/notifications/devices",this.sourcePush="postMessageSW",this.vapidPublicKey=""}return e.prototype.getAppCode=function(){return this.appCode},e.prototype.getClientId=function(){return this.apiClientId},e.prototype.getApiBasePath=function(){return this.apiBasePath},e.prototype.getAppLanguage=function(){return this.appLanguage},e.prototype.getAuthToken=function(){return this.authToken},e.prototype.getJwt=function(){return this.jwt},e.prototype.getUrlSW=function(){return this.urlServiceWorker},e.prototype.getDevicesPath=function(){return this.deviceApi},e.prototype.getSourcePush=function(){return this.sourcePush},e.prototype.getVapidPublicKey=function(){return this.vapidPublicKey},e.prototype.setVapidPublicKey=function(e){this.vapidPublicKey=e},e.prototype.setUrlSW=function(e){this.urlServiceWorker=e},e.decorators=[{type:n.Injectable}],e.ctorParameters=function(){return[]},e}(),O=function(){function e(e){this.constants=e,this._devUUID="",this._devId="",this._platform="",this._token=""}return e.prototype.initialize=function(e){if(this._methodCallBack=e,this._vapidPublicKey=this.constants.getVapidPublicKey(),this.validateSw()){var t=this.registerSw()["catch"](function(e){console.log("Push Service Worker registration has failed: "+e)});this.subscriptionSw(t)["catch"](function(e){console.log("Push Service Worker subscription has failed: "+e)})}},e.prototype.validateSw=function(){var e=!1;return"serviceWorker"in navigator&&"PushManager"in window&&(e=!0,console.log("Service Workers is supported")),e},e.prototype.registerSw=function(){return navigator.serviceWorker.register(this.constants.getUrlSW()).then(function(e){return e.installing?console.log("Service worker installing"):e.waiting?console.log("Service worker installed"):e.active&&console.log("Service worker active"),e.showNotification||console.log("Notifications aren't supported on service workers."),e})},e.prototype.subscriptionSw=function(e){var r=this.setSubscription,o=this;return e.then(function(n){n.pushManager.getSubscription().then(function(e){if(e)return r(e,o);var t={applicationServerKey:o._vapidPublicKey?o.urlB64ToUint8Array(o._vapidPublicKey):null,userVisibleOnly:!0};return n.pushManager.subscribe(t).then(function(e){return console.log(e),r(e,o)})["catch"](function(e){console.log("Unable to subscribe to push.",e)})})})},e.prototype.setSubscription=function(e,t){t.generateTokenForRegisterDevice(e),t.registerBroadcastListener()},e.prototype.registerBroadcastListener=function(){var n=this._methodCallBack,r=this.constants.getSourcePush();navigator.serviceWorker.addEventListener("message",function(e){var t=e.data;t&&t.source===r&&(console.log(e.data),n&&n(t.payload))})},e.prototype.generateTokenForRegisterDevice=function(e){localStorage.setItem("token",JSON.stringify(e)),localStorage.getItem("deviceUUID")?(this._devUUID=localStorage.getItem("deviceUUID"),localStorage.getItem("deviceId")||(this._devId=localStorage.getItem("deviceId"))):this.generateUUID(""),this._platform="",this._devUUID=localStorage.getItem("deviceUUID"),this._devId=localStorage.getItem("deviceId");var t=e.getKey?e.getKey("p256dh"):"",n=t?btoa(String.fromCharCode.apply(null,new Uint8Array(t))):"",r=e.getKey?e.getKey("auth"):"",o=r?btoa(String.fromCharCode.apply(null,new Uint8Array(r))):"",i={endpoint:e.endpoint,userAuth:o,userPublicKey:n};this._token=JSON.stringify(i),-1!==navigator.userAgent.indexOf("Firefox")?this._platform="F":-1!==navigator.userAgent.indexOf("Chrome")&&(this._platform="C");var s=null;s=this.validateInput(this._devId)?{deviceId:this._devId,platform:this._platform,token:this._token,uuid:this._devUUID}:{platform:this._platform,token:this._token,uuid:this._devUUID},this.registerDevice(s)},e.prototype.registerDevice=function(e){console.log("Device details:",e);var t=this.setRequest(this.constants.getDevicesPath(),"POST",!0);t.onreadystatechange=function(){4===t.readyState&&200===t.status&&(console.log("Response register,",t),localStorage.setItem("deviceId",t.responseText))},t.send(JSON.stringify(e))},e.prototype.unRegisterDevice=function(){var r=this;return new Promise(function(t,e){r._devId=localStorage.getItem("deviceId");var n=r;navigator.serviceWorker.ready.then(function(e){e.unregister().then(function(e){e||(console.log("unregister failed"),t()),n.unsubscribeDevice(n._devId,n).then(function(){t()})})})["catch"](function(e){console.log("Registration failed with "+e),t()})})},e.prototype.unsubscribeDevice=function(o,i){return new Promise(function(e,t){localStorage.getItem("deviceId");var n={devices:{deviceId:i._devId,platform:i._platform,token:i._token,uuid:i._devUUID}};if(o){var r=i.setRequest(i.constants.getDevicesPath()+"/"+o,"DELETE",!0);r.onreadystatechange=function(){4===r.readyState&&200===r.status&&(console.log("The response is ,",r),console.log("Successfully unregistered the device"),localStorage.setItem("deviceUUID",""),localStorage.setItem("deviceId",""),localStorage.setItem("token",""),e())},r.send(JSON.stringify(n))}else e()})},e.prototype.setRequest=function(e,t,n){var r=new XMLHttpRequest;return r.open(t,e,n),r=this.setHeaders(r,t)},e.prototype.setHeaders=function(e,t){return e.setRequestHeader("Accept","application/json"),e.setRequestHeader("x-ibm-client-id",this.constants.getClientId()),e.setRequestHeader("App-Code",this.constants.getAppCode()),e.setRequestHeader("Accept-Language",this.constants.getAppLanguage()),e.setRequestHeader("Authorization",this.constants.getAuthToken()),e.setRequestHeader("jwt",this.constants.getJwt()),e.timeout=3e3,"POST"!==t&&"PUT"!==t||e.setRequestHeader("Content-Type","application/json; charset=UTF-8"),e},e.prototype.generateUUID=function(e){var t=(new Date).getTime();window.performance&&"function"==typeof window.performance.now&&(t+=performance.now());var n=window.location.hostname,r=[];r.push(this.hashCode(t)),r.push(this.hashCode(e)),r.push(this.hashCode(n)),r.push(this.hashCode(this._platform));for(var o=r.join("").replace(/[-.]/g,"").replace(/[,.]/g,""),i="",s=0;s<32;s++)i+=o.charAt(Math.floor(Math.random()*o.length));return localStorage.setItem("deviceUUID",i),this._devUUID=i,this._devUUID},e.prototype.hashCode=function(e){var t,n,r=0;if(0===e.length)return r;for(t=0,n=e.length;t<n;t++)r=(r<<5)-r+e.charCodeAt(t),r|=0;return r},e.prototype.validateInput=function(e){return!(e===undefined||null==e||e.length<=0||""===e)},e.prototype.urlB64ToUint8Array=function(e){for(var t=(e+"=".repeat((4-e.length%4)%4)).replace(/\-/g,"+").replace(/_/g,"/"),n=window.atob(t),r=new Uint8Array(n.length),o=0;o<n.length;++o)r[o]=n.charCodeAt(o);return r},e.decorators=[{type:n.Injectable}],e.ctorParameters=function(){return[{type:E}]},e}(),w=[r,o,a,p.Broadcaster,g,f],T=function(){function e(){}return e.decorators=[{type:n.NgModule,args:[{declarations:[],exports:[],imports:[],providers:[w]}]}],e}();e.CORE_COMMON_PROVIDERS=w,e.CmxCoreCommonModule=T,e.HttpCemex=o,e.SessionService=a,e.LegalEntity=c,e.FinancialDocuments=h,e.ProjectSettings=r,e.AuthGuard=g,e.TranslationService=f,e.Logger=m,e.FeatureToggleService=v,e.CountryConfigService=S,e.EmailValidators=_,e.NumberValidators=I,e.CashSalesService=b,e.AnalyticsFactory=P,e.CountlyService=C,e.PushNotificationsConstants=E,e.PushNotificationService=O,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=cemex-core-angular-services-v7.umd.min.js.map
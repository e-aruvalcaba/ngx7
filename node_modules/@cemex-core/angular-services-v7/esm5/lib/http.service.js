/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { Injectable } from '@angular/core';
import { Headers, Http, RequestOptions } from '@angular/http';
import { Observable } from 'rxjs';
import { ProjectSettings } from './project.settings';
var HttpCemex = /** @class */ (function () {
    function HttpCemex(http, projectSettings) {
        this.http = http;
        this.projectSettings = projectSettings;
        this._validSettings = false;
        this._validSettings = this.validateProjectSettings();
    }
    /**
     * @param {?} apiEndpoint
     * @return {?}
     */
    HttpCemex.prototype.generateEndpoint = /**
     * @param {?} apiEndpoint
     * @return {?}
     */
    function (apiEndpoint) {
        return this.projectSettings.generateEndpoint(apiEndpoint);
    };
    Object.defineProperty(HttpCemex.prototype, "clientId", {
        get: /**
         * @return {?}
         */
        function () {
            return this.projectSettings.clientId;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(HttpCemex.prototype, "appCode", {
        get: /**
         * @return {?}
         */
        function () {
            return this.projectSettings.appCode;
        },
        enumerable: true,
        configurable: true
    });
    /**
     * @param {?} url
     * @param {?=} options
     * @return {?}
     */
    HttpCemex.prototype.request = /**
     * @param {?} url
     * @param {?=} options
     * @return {?}
     */
    function (url, options) {
        /** @type {?} */
        var loptions = this.createAuthorizationHeader(options);
        return this.http.request(url, loptions);
    };
    /**
     * @param {?} url
     * @param {?=} options
     * @param {?=} overrideHeader
     * @return {?}
     */
    HttpCemex.prototype.get = /**
     * @param {?} url
     * @param {?=} options
     * @param {?=} overrideHeader
     * @return {?}
     */
    function (url, options, overrideHeader) {
        /** @type {?} */
        var loptions = this.createAuthorizationHeader(options, overrideHeader);
        return this.http.get(url, loptions);
    };
    /**
     * @param {?} url
     * @param {?} body
     * @param {?=} options
     * @param {?=} overrideHeader
     * @return {?}
     */
    HttpCemex.prototype.post = /**
     * @param {?} url
     * @param {?} body
     * @param {?=} options
     * @param {?=} overrideHeader
     * @return {?}
     */
    function (url, body, options, overrideHeader) {
        if (!this._validSettings) {
            /** @type {?} */
            var message = 'Set missing environment variables of API_HOST, API_ORG, API_ENV, APP_CODE, CLIENT_ID';
            return Observable.throw(new Error(message));
        }
        /** @type {?} */
        var loptions = this.createAuthorizationHeader(options, overrideHeader);
        return this.http.post(url, body, loptions);
    };
    /**
     * @param {?} url
     * @param {?} body
     * @param {?=} options
     * @param {?=} overrideHeader
     * @return {?}
     */
    HttpCemex.prototype.put = /**
     * @param {?} url
     * @param {?} body
     * @param {?=} options
     * @param {?=} overrideHeader
     * @return {?}
     */
    function (url, body, options, overrideHeader) {
        /** @type {?} */
        var loptions = this.createAuthorizationHeader(options, overrideHeader);
        return this.http.put(url, body, loptions);
    };
    /**
     * @param {?} url
     * @param {?} body
     * @param {?=} options
     * @param {?=} overrideHeader
     * @return {?}
     */
    HttpCemex.prototype.patch = /**
     * @param {?} url
     * @param {?} body
     * @param {?=} options
     * @param {?=} overrideHeader
     * @return {?}
     */
    function (url, body, options, overrideHeader) {
        /** @type {?} */
        var loptions = this.createAuthorizationHeader(options, overrideHeader);
        return this.http.patch(url, body, loptions);
    };
    /**
     * @param {?} url
     * @param {?=} options
     * @param {?=} overrideHeader
     * @return {?}
     */
    HttpCemex.prototype.delete = /**
     * @param {?} url
     * @param {?=} options
     * @param {?=} overrideHeader
     * @return {?}
     */
    function (url, options, overrideHeader) {
        /** @type {?} */
        var loptions = this.createAuthorizationHeader(options, overrideHeader);
        return this.http.delete(url, loptions);
    };
    /**
     * @param {?} url
     * @param {?=} options
     * @param {?=} overrideHeader
     * @return {?}
     */
    HttpCemex.prototype.head = /**
     * @param {?} url
     * @param {?=} options
     * @param {?=} overrideHeader
     * @return {?}
     */
    function (url, options, overrideHeader) {
        /** @type {?} */
        var loptions = this.createAuthorizationHeader(options, overrideHeader);
        return this.http.head(url, loptions);
    };
    /**
     * @return {?}
     */
    HttpCemex.prototype.isRunningOnBrowser = /**
     * @return {?}
     */
    function () {
        return ((/** @type {?} */ (global))) !== null && ((/** @type {?} */ (global))) !== undefined;
    };
    /**
     * @param {?} str
     * @return {?}
     */
    HttpCemex.prototype.encrypt = /**
     * @param {?} str
     * @return {?}
     */
    function (str) {
        return window.btoa(unescape(encodeURIComponent(str)));
    };
    /**
     * @param {?} str
     * @return {?}
     */
    HttpCemex.prototype.decrypt = /**
     * @param {?} str
     * @return {?}
     */
    function (str) {
        return str ? decodeURIComponent(escape(window.atob(str))) : str;
    };
    /**
     * @param {?} newKeys
     * @return {?}
     */
    HttpCemex.prototype.setProjectSettingsNewKeys = /**
     * @param {?} newKeys
     * @return {?}
     */
    function (newKeys) {
        this.projectSettings.setAppKeys(newKeys);
    };
    /**
     * @protected
     * @param {?} options
     * @param {?=} overrideHeader
     * @return {?}
     */
    HttpCemex.prototype.createAuthorizationHeader = /**
     * @protected
     * @param {?} options
     * @param {?=} overrideHeader
     * @return {?}
     */
    function (options, overrideHeader) {
        var e_1, _a;
        /** @type {?} */
        var containsHeader = options && options.headers && options.headers.keys().length > 0;
        /** @type {?} */
        var result = options
            ? Object.assign({}, options)
            : new RequestOptions();
        /** @type {?} */
        var headers = new Headers();
        /** @type {?} */
        var language = this.isRunningOnBrowser()
            ? ((/** @type {?} */ (window))).localStorage.getItem('language') || 'en'
            : 'en';
        headers.append('Accept', 'application/json');
        headers.append('X-IBM-Client-Id', this.projectSettings.clientId);
        headers.append('App-Code', this.projectSettings.appCode);
        headers.append('Accept-Language', language);
        /** @type {?} */
        var accessToken = sessionStorage.getItem('access_token');
        /** @type {?} */
        var isContainsToken = accessToken && accessToken !== undefined;
        if (isContainsToken) {
            headers.append('Authorization', 'Bearer ' + accessToken);
        }
        /** @type {?} */
        var jwtApp = sessionStorage.getItem('jwt');
        if (this.isRunningOnBrowser() && jwtApp && jwtApp !== undefined) {
            headers.append('jwt', jwtApp);
        }
        // overwrite existing headers or add new headers
        /** @type {?} */
        var headerKeys = containsHeader ? options.headers.keys() : [];
        try {
            for (var headerKeys_1 = tslib_1.__values(headerKeys), headerKeys_1_1 = headerKeys_1.next(); !headerKeys_1_1.done; headerKeys_1_1 = headerKeys_1.next()) {
                var keyHeader = headerKeys_1_1.value;
                headers.set(keyHeader, options.headers.get(keyHeader));
            }
        }
        catch (e_1_1) { e_1 = { error: e_1_1 }; }
        finally {
            try {
                if (headerKeys_1_1 && !headerKeys_1_1.done && (_a = headerKeys_1.return)) _a.call(headerKeys_1);
            }
            finally { if (e_1) throw e_1.error; }
        }
        result.headers = headers;
        if (overrideHeader && containsHeader) {
            result.headers = options.headers;
        }
        return result;
    };
    /**
     * @private
     * @return {?}
     */
    HttpCemex.prototype.validateProjectSettings = /**
     * @private
     * @return {?}
     */
    function () {
        /** @type {?} */
        var settings = this.projectSettings;
        return (settings.apiBasePath !== undefined &&
            settings.apiEnv !== undefined &&
            settings.apiOrg !== undefined &&
            settings.appCode !== undefined &&
            settings.clientId !== undefined);
    };
    HttpCemex.decorators = [
        { type: Injectable }
    ];
    /** @nocollapse */
    HttpCemex.ctorParameters = function () { return [
        { type: Http },
        { type: ProjectSettings }
    ]; };
    return HttpCemex;
}());
export { HttpCemex };
if (false) {
    /**
     * @type {?}
     * @private
     */
    HttpCemex.prototype._validSettings;
    /**
     * @type {?}
     * @protected
     */
    HttpCemex.prototype.http;
    /**
     * @type {?}
     * @private
     */
    HttpCemex.prototype.projectSettings;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaHR0cC5zZXJ2aWNlLmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGNlbWV4LWNvcmUvYW5ndWxhci1zZXJ2aWNlcy12Ny8iLCJzb3VyY2VzIjpbImxpYi9odHRwLnNlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBQSxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQzNDLE9BQU8sRUFDTCxPQUFPLEVBQ1AsSUFBSSxFQUVKLGNBQWMsRUFFZixNQUFNLGVBQWUsQ0FBQztBQUV2QixPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sTUFBTSxDQUFDO0FBRWxDLE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBTSxvQkFBb0IsQ0FBQztBQUlyRDtJQUlFLG1CQUFzQixJQUFVLEVBQVUsZUFBZ0M7UUFBcEQsU0FBSSxHQUFKLElBQUksQ0FBTTtRQUFVLG9CQUFlLEdBQWYsZUFBZSxDQUFpQjtRQUZsRSxtQkFBYyxHQUFHLEtBQUssQ0FBQztRQUc3QixJQUFJLENBQUMsY0FBYyxHQUFHLElBQUksQ0FBQyx1QkFBdUIsRUFBRSxDQUFDO0lBQ3ZELENBQUM7Ozs7O0lBRU0sb0NBQWdCOzs7O0lBQXZCLFVBQXdCLFdBQW1CO1FBQ3pDLE9BQU8sSUFBSSxDQUFDLGVBQWUsQ0FBQyxnQkFBZ0IsQ0FBQyxXQUFXLENBQUMsQ0FBQztJQUM1RCxDQUFDO0lBRUQsc0JBQUksK0JBQVE7Ozs7UUFBWjtZQUNFLE9BQU8sSUFBSSxDQUFDLGVBQWUsQ0FBQyxRQUFRLENBQUM7UUFDdkMsQ0FBQzs7O09BQUE7SUFFRCxzQkFBSSw4QkFBTzs7OztRQUFYO1lBQ0UsT0FBTyxJQUFJLENBQUMsZUFBZSxDQUFDLE9BQU8sQ0FBQztRQUN0QyxDQUFDOzs7T0FBQTs7Ozs7O0lBRU0sMkJBQU87Ozs7O0lBQWQsVUFBZSxHQUFxQixFQUFFLE9BQTRCOztZQUMxRCxRQUFRLEdBQXVCLElBQUksQ0FBQyx5QkFBeUIsQ0FDakUsT0FBTyxDQUNSO1FBQ0QsT0FBTyxJQUFJ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QUFDLFFBQVEsS0FBSyxTQUFTLENBQ2hDLENBQUM7SUFDSixDQUFDOztnQkFqTEYsVUFBVTs7OztnQkFaVCxJQUFJO2dCQVFHLGVBQWU7O0lBc0x4QixnQkFBQztDQUFBLEFBbExELElBa0xDO1NBakxZLFNBQVM7Ozs7OztJQUNwQixtQ0FBK0I7Ozs7O0lBRW5CLHlCQUFvQjs7Ozs7SUFBRSxvQ0FBd0MiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBJbmplY3RhYmxlIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQge1xuICBIZWFkZXJzLFxuICBIdHRwLFxuICBSZXF1ZXN0LFxuICBSZXF1ZXN0T3B0aW9ucyxcbiAgUmVxdWVzdE9wdGlvbnNBcmdzXG59IGZyb20gJ0Bhbmd1bGFyL2h0dHAnO1xuXG5pbXBvcnQgeyBPYnNlcnZhYmxlIH0gZnJvbSAncnhqcyc7XG5cbmltcG9ydCB7IFByb2plY3RTZXR0aW5ncyB9IGZyb20gJy4vcHJvamVjdC5zZXR0aW5ncyc7XG5cbmRlY2xhcmUgdmFyIGdsb2JhbDogYW55O1xuXG5ASW5qZWN0YWJsZSgpXG5leHBvcnQgY2xhc3MgSHR0cENlbWV4IHtcbiAgcHJpdmF0ZSBfdmFsaWRTZXR0aW5ncyA9IGZhbHNlO1xuXG4gIGNvbnN0cnVjdG9yKHByb3RlY3RlZCBodHRwOiBIdHRwLCBwcml2YXRlIHByb2plY3RTZXR0aW5nczogUHJvamVjdFNldHRpbmdzKSB7XG4gICAgdGhpcy5fdmFsaWRTZXR0aW5ncyA9IHRoaXMudmFsaWRhdGVQcm9qZWN0U2V0dGluZ3MoKTtcbiAgfVxuXG4gIHB1YmxpYyBnZW5lcmF0ZUVuZHBvaW50KGFwaUVuZHBvaW50OiBzdHJpbmcpOiBzdHJpbmcge1xuICAgIHJldHVybiB0aGlzLnByb2plY3RTZXR0aW5ncy5nZW5lcmF0ZUVuZHBvaW50KGFwaUVuZHBvaW50KTtcbiAgfVxuXG4gIGdldCBjbGllbnRJZCgpOiBzdHJpbmcge1xuICAgIHJldHVybiB0aGlzLnByb2plY3RTZXR0aW5ncy5jbGllbnRJZDtcbiAgfVxuXG4gIGdldCBhcHBDb2RlKCk6IHN0cmluZyB7XG4gICAgcmV0dXJuIHRoaXMucHJvamVjdFNldHRpbmdzLmFwcENvZGU7XG4gIH1cblxuICBwdWJsaWMgcmVxdWVzdCh1cmw6IHN0cmluZyB8IFJlcXVlc3QsIG9wdGlvbnM/OiBSZXF1ZXN0T3B0aW9uc0FyZ3MpIHtcbiAgICBjb25zdCBsb3B0aW9uczogUmVxdWVzdE9wdGlvbnNBcmdzID0gdGhpcy5jcmVhdGVBdXRob3JpemF0aW9uSGVhZGVyKFxuICAgICAgb3B0aW9uc1xuICAgICk7XG4gICAgcmV0dXJuIHRoaXMuaHR0cC5yZXF1ZXN0KHVybCwgbG9wdGlvbnMpO1xuICB9XG5cbiAgcHVibGljIGdldChcbiAgICB1cmw6IHN0cmluZyxcbiAgICBvcHRpb25zPzogUmVxdWVzdE9wdGlvbnNBcmdzLFxuICAgIG92ZXJyaWRlSGVhZGVyPzogYm9vbGVhblxuICApIHtcbiAgICBjb25zdCBsb3B0aW9uczogUmVxdWVzdE9wdGlvbnNBcmdzID0gdGhpcy5jcmVhdGVBdXRob3JpemF0aW9uSGVhZGVyKFxuICAgICAgb3B0aW9ucyxcbiAgICAgIG92ZXJyaWRlSGVhZGVyXG4gICAgKTtcbiAgICByZXR1cm4gdGhpcy5odHRwLmdldCh1cmwsIGxvcHRpb25zKTtcbiAgfVxuXG4gIHB1YmxpYyBwb3N0KFxuICAgIHVybDogc3RyaW5nLFxuICAgIGJvZHk6IGFueSxcbiAgICBvcHRpb25zPzogUmVxdWVzdE9wdGlvbnNBcmdzLFxuICAgIG92ZXJyaWRlSGVhZGVyPzogYm9vbGVhblxuICApOiBhbnkge1xuICAgIGlmICghdGhpcy5fdmFsaWRTZXR0aW5ncykge1xuICAgICAgY29uc3QgbWVzc2FnZSA9XG4gICAgICAgICdTZXQgbWlzc2luZyBlbnZpcm9ubWVudCB2YXJpYWJsZXMgb2YgQVBJX0hPU1QsIEFQSV9PUkcsIEFQSV9FTlYsIEFQUF9DT0RFLCBDTElFTlRfSUQnO1xuICAgICAgcmV0dXJuIE9ic2VydmFibGUudGhyb3cobmV3IEVycm9yKG1lc3NhZ2UpKTtcbiAgICB9XG5cbiAgICBjb25zdCBsb3B0aW9uczogUmVxdWVzdE9wdGlvbnNBcmdzID0gdGhpcy5jcmVhdGVBdXRob3JpemF0aW9uSGVhZGVyKFxuICAgICAgb3B0aW9ucyxcbiAgICAgIG92ZXJyaWRlSGVhZGVyXG4gICAgKTtcbiAgICByZXR1cm4gdGhpcy5odHRwLnBvc3QodXJsLCBib2R5LCBsb3B0aW9ucyk7XG4gIH1cblxuICBwdWJsaWMgcHV0KFxuICAgIHVybDogc3RyaW5nLFxuICAgIGJvZHk6IGFueSxcbiAgICBvcHRpb25zPzogUmVxdWVzdE9wdGlvbnNBcmdzLFxuICAgIG92ZXJyaWRlSGVhZGVyPzogYm9vbGVhblxuICApIHtcbiAgICBjb25zdCBsb3B0aW9uczogUmVxdWVzdE9wdGlvbnNBcmdzID0gdGhpcy5jcmVhdGVBdXRob3JpemF0aW9uSGVhZGVyKFxuICAgICAgb3B0aW9ucyxcbiAgICAgIG92ZXJyaWRlSGVhZGVyXG4gICAgKTtcbiAgICByZXR1cm4gdGhpcy5odHRwLnB1dCh1cmwsIGJvZHksIGxvcHRpb25zKTtcbiAgfVxuXG4gIHB1YmxpYyBwYXRjaChcbiAgICB1cmw6IHN0cmluZyxcbiAgICBib2R5OiBhbnksXG4gICAgb3B0aW9ucz86IFJlcXVlc3RPcHRpb25zQXJncyxcbiAgICBvdmVycmlkZUhlYWRlcj86IGJvb2xlYW5cbiAgKSB7XG4gICAgY29uc3QgbG9wdGlvbnM6IFJlcXVlc3RPcHRpb25zQXJncyA9IHRoaXMuY3JlYXRlQXV0aG9yaXphdGlvbkhlYWRlcihcbiAgICAgIG9wdGlvbnMsXG4gICAgICBvdmVycmlkZUhlYWRlclxuICAgICk7XG4gICAgcmV0dXJuIHRoaXMuaHR0cC5wYXRjaCh1cmwsIGJvZHksIGxvcHRpb25zKTtcbiAgfVxuXG4gIHB1YmxpYyBkZWxldGUoXG4gICAgdXJsOiBzdHJpbmcsXG4gICAgb3B0aW9ucz86IFJlcXVlc3RPcHRpb25zQXJncyxcbiAgICBvdmVycmlkZUhlYWRlcj86IGJvb2xlYW5cbiAgKSB7XG4gICAgY29uc3QgbG9wdGlvbnM6IFJlcXVlc3RPcHRpb25zQXJncyA9IHRoaXMuY3JlYXRlQXV0aG9yaXphdGlvbkhlYWRlcihcbiAgICAgIG9wdGlvbnMsXG4gICAgICBvdmVycmlkZUhlYWRlclxuICAgICk7XG4gICAgcmV0dXJuIHRoaXMuaHR0cC5kZWxldGUodXJsLCBsb3B0aW9ucyk7XG4gIH1cblxuICBwdWJsaWMgaGVhZChcbiAgICB1cmw6IHN0cmluZyxcbiAgICBvcHRpb25zPzogUmVxdWVzdE9wdGlvbnNBcmdzLFxuICAgIG92ZXJyaWRlSGVhZGVyPzogYm9vbGVhblxuICApIHtcbiAgICBjb25zdCBsb3B0aW9uczogUmVxdWVzdE9wdGlvbnNBcmdzID0gdGhpcy5jcmVhdGVBdXRob3JpemF0aW9uSGVhZGVyKFxuICAgICAgb3B0aW9ucyxcbiAgICAgIG92ZXJyaWRlSGVhZGVyXG4gICAgKTtcbiAgICByZXR1cm4gdGhpcy5odHRwLmhlYWQodXJsLCBsb3B0aW9ucyk7XG4gIH1cblxuICBwdWJsaWMgaXNSdW5uaW5nT25Ccm93c2VyKCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiAoZ2xvYmFsIGFzIGFueSkgIT09IG51bGwgJiYgKGdsb2JhbCBhcyBhbnkpICE9PSB1bmRlZmluZWQ7XG4gIH1cblxuICBwdWJsaWMgZW5jcnlwdChzdHIpIHtcbiAgICByZXR1cm4gd2luZG93LmJ0b2EodW5lc2NhcGUoZW5jb2RlVVJJQ29tcG9uZW50KHN0cikpKTtcbiAgfVxuXG4gIHB1YmxpYyBkZWNyeXB0KHN0cikge1xuICAgIHJldHVybiBzdHIgPyBkZWNvZGVVUklDb21wb25lbnQoZXNjYXBlKHdpbmRvdy5hdG9iKHN0cikpKSA6IHN0cjtcbiAgfVxuXG4gIHB1YmxpYyBzZXRQcm9qZWN0U2V0dGluZ3NOZXdLZXlzKG5ld0tleXMpOiB2b2lkIHtcbiAgICB0aGlzLnByb2plY3RTZXR0aW5ncy5zZXRBcHBLZXlzKG5ld0tleXMpO1xuICB9XG5cbiAgcHJvdGVjdGVkIGNyZWF0ZUF1dGhvcml6YXRpb25IZWFkZXIoXG4gICAgb3B0aW9uczogUmVxdWVzdE9wdGlvbnNBcmdzLFxuICAgIG92ZXJyaWRlSGVhZGVyPzogYm9vbGVhblxuICApOiBSZXF1ZXN0T3B0aW9uc0FyZ3Mge1xuICAgIGNvbnN0IGNvbnRhaW5zSGVhZGVyID1cbiAgICAgIG9wdGlvbnMgJiYgb3B0aW9ucy5oZWFkZXJzICYmIG9wdGlvbnMuaGVhZGVycy5rZXlzKCkubGVuZ3RoID4gMDtcbiAgICBjb25zdCByZXN1bHQ6IFJlcXVlc3RPcHRpb25zQXJncyA9IG9wdGlvbnNcbiAgICAgID8gT2JqZWN0LmFzc2lnbih7fSwgb3B0aW9ucylcbiAgICAgIDogbmV3IFJlcXVlc3RPcHRpb25zKCk7XG4gICAgY29uc3QgaGVhZGVycyA9IG5ldyBIZWFkZXJzKCk7XG4gICAgY29uc3QgbGFuZ3VhZ2UgPSB0aGlzLmlzUnVubmluZ09uQnJvd3NlcigpXG4gICAgICA/ICh3aW5kb3cgYXMgYW55KS5sb2NhbFN0b3JhZ2UuZ2V0SXRlbSgnbGFuZ3VhZ2UnKSB8fCAnZW4nXG4gICAgICA6ICdlbic7XG5cbiAgICBoZWFkZXJzLmFwcGVuZCgnQWNjZXB0JywgJ2FwcGxpY2F0aW9uL2pzb24nKTtcbiAgICBoZWFkZXJzLmFwcGVuZCgnWC1JQk0tQ2xpZW50LUlkJywgdGhpcy5wcm9qZWN0U2V0dGluZ3MuY2xpZW50SWQpO1xuICAgIGhlYWRlcnMuYXBwZW5kKCdBcHAtQ29kZScsIHRoaXMucHJvamVjdFNldHRpbmdzLmFwcENvZGUpO1xuICAgIGhlYWRlcnMuYXBwZW5kKCdBY2NlcHQtTGFuZ3VhZ2UnLCBsYW5ndWFnZSk7XG4gICAgY29uc3QgYWNjZXNzVG9rZW4gPSBzZXNzaW9uU3RvcmFnZS5nZXRJdGVtKCdhY2Nlc3NfdG9rZW4nKTtcbiAgICBjb25zdCBpc0NvbnRhaW5zVG9rZW4gPSBhY2Nlc3NUb2tlbiAmJiBhY2Nlc3NUb2tlbiAhPT0gdW5kZWZpbmVkO1xuICAgIGlmIChpc0NvbnRhaW5zVG9rZW4pIHtcbiAgICAgIGhlYWRlcnMuYXBwZW5kKCdBdXRob3JpemF0aW9uJywgJ0JlYXJlciAnICsgYWNjZXNzVG9rZW4pO1xuICAgIH1cblxuICAgIGNvbnN0IGp3dEFwcCA9IHNlc3Npb25TdG9yYWdlLmdldEl0ZW0oJ2p3dCcpO1xuICAgIGlmICh0aGlzLmlzUnVubmluZ09uQnJvd3NlcigpICYmIGp3dEFwcCAmJiBqd3RBcHAgIT09IHVuZGVmaW5lZCkge1xuICAgICAgaGVhZGVycy5hcHBlbmQoJ2p3dCcsIGp3dEFwcCk7XG4gICAgfVxuXG4gICAgLy8gb3ZlcndyaXRlIGV4aXN0aW5nIGhlYWRlcnMgb3IgYWRkIG5ldyBoZWFkZXJzXG4gICAgY29uc3QgaGVhZGVyS2V5cyA9IGNvbnRhaW5zSGVhZGVyID8gb3B0aW9ucy5oZWFkZXJzLmtleXMoKSA6IFtdO1xuICAgIGZvciAoY29uc3Qga2V5SGVhZGVyIG9mIGhlYWRlcktleXMpIHtcbiAgICAgIGhlYWRlcnMuc2V0KGtleUhlYWRlciwgb3B0aW9ucy5oZWFkZXJzLmdldChrZXlIZWFkZXIpKTtcbiAgICB9XG5cbiAgICByZXN1bHQuaGVhZGVycyA9IGhlYWRlcnM7XG5cbiAgICBpZiAob3ZlcnJpZGVIZWFkZXIgJiYgY29udGFpbnNIZWFkZXIpIHtcbiAgICAgIHJlc3VsdC5oZWFkZXJzID0gb3B0aW9ucy5oZWFkZXJzO1xuICAgIH1cblxuICAgIHJldHVybiByZXN1bHQ7XG4gIH1cblxuICBwcml2YXRlIHZhbGlkYXRlUHJvamVjdFNldHRpbmdzKCk6IGJvb2xlYW4ge1xuICAgIGNvbnN0IHNldHRpbmdzID0gdGhpcy5wcm9qZWN0U2V0dGluZ3M7XG4gICAgcmV0dXJuIChcbiAgICAgIHNldHRpbmdzLmFwaUJhc2VQYXRoICE9PSB1bmRlZmluZWQgJiZcbiAgICAgIHNldHRpbmdzLmFwaUVudiAhPT0gdW5kZWZpbmVkICYmXG4gICAgICBzZXR0aW5ncy5hcGlPcmcgIT09IHVuZGVmaW5lZCAmJlxuICAgICAgc2V0dGluZ3MuYXBwQ29kZSAhPT0gdW5kZWZpbmVkICYmXG4gICAgICBzZXR0aW5ncy5jbGllbnRJZCAhPT0gdW5kZWZpbmVkXG4gICAgKTtcbiAgfVxufVxuIl19
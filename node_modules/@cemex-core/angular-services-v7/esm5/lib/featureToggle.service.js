/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { Inject, Injectable, Optional } from '@angular/core';
import { Http } from '@angular/http';
import { Broadcaster } from '@cemex-core/events-v7';
var FeatureToggleService = /** @class */ (function () {
    function FeatureToggleService(eventBroadcaster, http, _productPath, _productEnvironment, localManifest) {
        this.eventBroadcaster = eventBroadcaster;
        this.http = http;
        this._productPath = _productPath;
        this._productEnvironment = _productEnvironment;
        this.localManifest = localManifest;
        this.productPath = '';
        this.productEnvironment = '';
        this.productPath = _productPath || '/';
        this.productEnvironment = _productEnvironment || 'development';
        this.getFeatureList(this.localManifest || false);
    }
    /**
     * gets all features
     */
    /**
     * gets all features
     * @return {?}
     */
    FeatureToggleService.all = /**
     * gets all features
     * @return {?}
     */
    function () {
        /** @type {?} */
        var result = this.featureList;
        return result;
    };
    /**
     * this method returns either true or false if the list of the features
     * requested is enabled in this environment and for this user
     */
    /**
     * this method returns either true or false if the list of the features
     * requested is enabled in this environment and for this user
     * @param {?} featureId
     * @param {?=} releaseVersion
     * @param {?=} featureVersion
     * @param {?=} hostName
     * @return {?}
     */
    FeatureToggleService.prototype.feature = /**
     * this method returns either true or false if the list of the features
     * requested is enabled in this environment and for this user
     * @param {?} featureId
     * @param {?=} releaseVersion
     * @param {?=} featureVersion
     * @param {?=} hostName
     * @return {?}
     */
    function (featureId, releaseVersion, featureVersion, hostName) {
        var _this = this;
        if (typeof featureId === 'string') {
            return this.coreValidator(featureId, releaseVersion, featureVersion, hostName);
        }
        else {
            featureId.forEach((/**
             * @param {?} singleFeature
             * @return {?}
             */
            function (singleFeature) {
                if (!_this.coreValidator(singleFeature, releaseVersion, featureVersion, hostName)) {
                    return false;
                }
            }));
        }
        return true;
    };
    /**
     * this method returns all list of features
     */
    /**
     * this method returns all list of features
     * @return {?}
     */
    FeatureToggleService.prototype.getAll = /**
     * this method returns all list of features
     * @return {?}
     */
    function () {
        return FeatureToggleService.featureList;
    };
    /**
     * this method allows to load the feature list from the file
     */
    /**
     * this method allows to load the feature list from the file
     * @param {?} loadFromLocalList
     * @return {?}
     */
    FeatureToggleService.prototype.getFeatureList = /**
     * this method allows to load the feature list from the file
     * @param {?} loadFromLocalList
     * @return {?}
     */
    function (loadFromLocalList) {
        var _this = this;
        // if the loadfromlocallist is true, then load the local-feature.json file
        if (loadFromLocalList) {
            this.http
                .get(this.productPath + 'vendor/local-feature.json')
                .toPromise()
                .then((/**
             * @param {?} response
             * @return {?}
             */
            function (response) { return _this.populateFeatures(response.json()); }))
                .catch(this.handleError);
        }
        else {
            // if the API is ready then switch is this one
            this.http
                .get('/feature/api' + this.productPath)
                .toPromise()
                .then((/**
             * @param {?} response
             * @return {?}
             */
            function (response) { return _this.populateFeatures(response.json()); }))
                .catch(this.handleError);
        }
    };
    /**
     * @param {?} featureId
     * @param {?=} releaseVersion
     * @param {?=} featureVersion
     * @param {?=} hostName
     * @return {?}
     */
    FeatureToggleService.prototype.coreValidator = /**
     * @param {?} featureId
     * @param {?=} releaseVersion
     * @param {?=} featureVersion
     * @param {?=} hostName
     * @return {?}
     */
    function (featureId, releaseVersion, featureVersion, hostName) {
        // todo smaller refactor
        /** @type {?} */
        var localFind = FeatureToggleService.featureList.get(featureId);
        if (localFind === undefined) {
            return false;
        }
        // if it is found then verify against the country
        if (localFind.country !== null && localFind.country !== undefined) {
            // we can take the country from the session storage
            if (window.sessionStorage.getItem('country').indexOf(localFind.country) ===
                -1) {
                return false;
            }
        }
        if (localFind.role !== null && localFind.role !== undefined) {
            /** @type {?} */
            var isRoleAssigned_1 = false;
            /** @type {?} */
            var appsAvailable = JSON.parse(window.sessionStorage.getItem('applications'));
            appsAvailable.forEach((/**
             * @param {?} app
             * @return {?}
             */
            function (app) {
                app.roles.forEach((/**
                 * @param {?} role
                 * @return {?}
                 */
                function (role) {
                    if (((/** @type {?} */ (role))).roleCode === localFind.role) {
                        isRoleAssigned_1 = true;
                    }
                }));
            }));
            if (!isRoleAssigned_1) {
                return false;
            }
        }
        if (localFind.role_match !== null && localFind.role_match !== undefined) {
            /** @type {?} */
            var rolesAssigned_1 = 0;
            /** @type {?} */
            var appsAvailable = JSON.parse(window.sessionStorage.getItem('applications'));
            appsAvailable.forEach((/**
             * @param {?} app
             * @return {?}
             */
            function (app) {
                app.roles.forEach((/**
                 * @param {?} role
                 * @return {?}
                 */
                function (role) {
                    if (localFind.role_match.indexOf(((/** @type {?} */ (role))).roleCode) !== -1) {
                        rolesAssigned_1 = rolesAssigned_1 + 1;
                    }
                }));
            }));
            if (rolesAssigned_1 !== localFind.role_match.split(',').length) {
                return false;
            }
        }
        if (localFind.role_any !== null && localFind.role_any !== undefined) {
            /** @type {?} */
            var rolesAssigned_2 = 0;
            /** @type {?} */
            var appsAvailable = JSON.parse(window.sessionStorage.getItem('applications'));
            appsAvailable.forEach((/**
             * @param {?} app
             * @return {?}
             */
            function (app) {
                app.roles.forEach((/**
                 * @param {?} role
                 * @return {?}
                 */
                function (role) {
                    if (localFind.role_any.indexOf(((/** @type {?} */ (role))).roleCode) !== -1) {
                        rolesAssigned_2 = rolesAssigned_2 + 1;
                    }
                }));
            }));
            if (rolesAssigned_2 === 0) {
                return false;
            }
        }
        if (localFind.environment !== null && localFind.environment !== undefined) {
            // verify the injection of the environment
            if (localFind.environment !== this.productEnvironment) {
                return false;
            }
        }
        if (localFind.release_version !== null &&
            localFind.release_version !== undefined) {
            // verify the injection of the environment
            if (localFind.release_version !== releaseVersion) {
                return false;
            }
        }
        if (localFind.feature_version !== null &&
            localFind.feature_version !== undefined) {
            // verify the injection of the environment
            if (localFind.feature_version !== featureVersion) {
                return false;
            }
        }
        if (localFind.host_name !== null && localFind.host_name !== undefined) {
            // verify the injection of the environment
            if (localFind.host_name !== hostName) {
                return false;
            }
        }
        return true;
    };
    /**
     * @param {?} error
     * @return {?}
     */
    FeatureToggleService.prototype.handleError = /**
     * @param {?} error
     * @return {?}
     */
    function (error) {
        return Promise.reject(error.message || error);
    };
    /**
     * @param {?} result
     * @return {?}
     */
    FeatureToggleService.prototype.populateFeatures = /**
     * @param {?} result
     * @return {?}
     */
    function (result) {
        var e_1, _a;
        try {
            for (var _b = tslib_1.__values(Object.keys(result)), _c = _b.next(); !_c.done; _c = _b.next()) {
                var item = _c.value;
                FeatureToggleService.featureList.set(((/** @type {?} */ (result[item]))).feature, result[item]);
            }
        }
        catch (e_1_1) { e_1 = { error: e_1_1 }; }
        finally {
            try {
                if (_c && !_c.done && (_a = _b.return)) _a.call(_b);
            }
            finally { if (e_1) throw e_1.error; }
        }
        // this.eventBroadcaster.broadcast(Broadcaster.DCM_LANGUAGE_FETCHED, TranslationService.language);
        // this.onChange(result);
    };
    FeatureToggleService.featureList = new Map();
    FeatureToggleService.language = '';
    // Must be set on path constants
    FeatureToggleService.PRODUCT_PATH = 'PRODUCT_PATH';
    FeatureToggleService.ENVIRONMENT = 'PRODUCT_PATH';
    FeatureToggleService.USE_LOCAL_MANIFEST = 'USE_LOCAL_MANIFEST';
    FeatureToggleService.decorators = [
        { type: Injectable }
    ];
    /** @nocollapse */
    FeatureToggleService.ctorParameters = function () { return [
        { type: Broadcaster },
        { type: Http },
        { type: String, decorators: [{ type: Inject, args: [FeatureToggleService.PRODUCT_PATH,] }, { type: Optional }] },
        { type: String, decorators: [{ type: Inject, args: [FeatureToggleService.ENVIRONMENT,] }, { type: Optional }] },
        { type: Boolean, decorators: [{ type: Inject, args: [FeatureToggleService.USE_LOCAL_MANIFEST,] }, { type: Optional }] }
    ]; };
    return FeatureToggleService;
}());
export { FeatureToggleService };
if (false) {
    /** @type {?} */
    FeatureToggleService.featureList;
    /** @type {?} */
    FeatureToggleService.language;
    /** @type {?} */
    FeatureToggleService.PRODUCT_PATH;
    /** @type {?} */
    FeatureToggleService.ENVIRONMENT;
    /** @type {?} */
    FeatureToggleService.USE_LOCAL_MANIFEST;
    /** @type {?} */
    FeatureToggleService.prototype.productPath;
    /** @type {?} */
    FeatureToggleService.prototype.productEnvironment;
    /** @type {?} */
    FeatureToggleService.prototype.eventBroadcaster;
    /** @type {?} */
    FeatureToggleService.prototype.http;
    /** @type {?} */
    FeatureToggleService.prototype._productPath;
    /** @type {?} */
    FeatureToggleService.prototype._productEnvironment;
    /** @type {?} */
    FeatureToggleService.prototype.localManifest;
}
/**
 * @record
 */
export function IFeatureItem() { }
if (false) {
    /** @type {?} */
    IFeatureItem.prototype.feature;
    /** @type {?} */
    IFeatureItem.prototype.option;
    /** @type {?} */
    IFeatureItem.prototype.environment;
    /** @type {?} */
    IFeatureItem.prototype.role;
    /** @type {?} */
    IFeatureItem.prototype.country;
    /** @type {?} */
    IFeatureItem.prototype.release_version;
    /** @type {?} */
    IFeatureItem.prototype.feature_version;
    /** @type {?} */
    IFeatureItem.prototype.host_name;
    /** @type {?} */
    IFeatureItem.prototype.role_match;
    /** @type {?} */
    IFeatureItem.prototype.role_any;
}
/**
 * @record
 */
export function IApplication() { }
if (false) {
    /** @type {?} */
    IApplication.prototype.applicationCode;
    /** @type {?} */
    IApplication.prototype.applicationId;
    /** @type {?} */
    IApplication.prototype.roles;
}
/**
 * @record
 */
export function IRole() { }
if (false) {
    /** @type {?} */
    IRole.prototype.roleCode;
    /** @type {?} */
    IRole.prototype.roleId;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZmVhdHVyZVRvZ2dsZS5zZXJ2aWNlLmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGNlbWV4LWNvcmUvYW5ndWxhci1zZXJ2aWNlcy12Ny8iLCJzb3VyY2VzIjpbImxpYi9mZWF0dXJlVG9nZ2xlLnNlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBQSxPQUFPLEVBQUUsTUFBTSxFQUFFLFVBQVUsRUFBRSxRQUFRLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDN0QsT0FBTyxFQUFFLElBQUksRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUVyQyxPQUFPLEVBQUUsV0FBVyxFQUFFLE1BQU0sdUJBQXVCLENBQUM7QUFFcEQ7SUF3QkUsOEJBQ1MsZ0JBQTZCLEVBQzdCLElBQVUsRUFHVixZQUFvQixFQUdwQixtQkFBMkIsRUFHM0IsYUFBc0I7UUFWdEIscUJBQWdCLEdBQWhCLGdCQUFnQixDQUFhO1FBQzdCLFNBQUksR0FBSixJQUFJLENBQU07UUFHVixpQkFBWSxHQUFaLFlBQVksQ0FBUTtRQUdwQix3QkFBbUIsR0FBbkIsbUJBQW1CLENBQVE7UUFHM0Isa0JBQWEsR0FBYixhQUFhLENBQVM7UUF0QnhCLGdCQUFXLEdBQUcsRUFBRSxDQUFDO1FBQ2pCLHVCQUFrQixHQUFHLEVBQUUsQ0FBQztRQXVCN0IsSUFBSSxDQUFDLFdBQVcsR0FBRyxZQUFZLElBQUksR0FBRyxDQUFDO1FBQ3ZDLElBQUksQ0FBQyxrQkFBa0IsR0FBRyxtQkFBbUIsSUFBSSxhQUFhLENBQUM7UUFDL0QsSUFBSSxDQUFDLGNBQWMsQ0FBQyxJQUFJLENBQUMsYUFBYSxJQUFJLEtBQUssQ0FBQyxDQUFDO0lBQ25ELENBQUM7SUF4QkQ7O09BRUc7Ozs7O0lBQ1csd0JBQUc7Ozs7SUFBakI7O1lBQ1EsTUFBTSxHQUFHLElBQUksQ0FBQyxXQUFXO1FBQy9CLE9BQU8sTUFBTSxDQUFDO0lBQ2hCLENBQUM7SUFtQkQ7OztPQUdHOzs7Ozs7Ozs7O0lBQ0ksc0NBQU87Ozs7Ozs7OztJQUFkLFVB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SUFDL0IsaUNBR0k7O0lBQ0osOEJBQTRCOztJQUc1QixrQ0FBNEM7O0lBQzVDLGlDQUEyQzs7SUFDM0Msd0NBQXdEOztJQUV4RCwyQ0FBd0I7O0lBQ3hCLGtEQUErQjs7SUFXN0IsZ0RBQW9DOztJQUNwQyxvQ0FBaUI7O0lBQ2pCLDRDQUUyQjs7SUFDM0IsbURBRWtDOztJQUNsQyw2Q0FFNkI7Ozs7O0FBMkxqQyxrQ0FXQzs7O0lBVkMsK0JBQWdCOztJQUNoQiw4QkFBd0I7O0lBQ3hCLG1DQUFvQjs7SUFDcEIsNEJBQWE7O0lBQ2IsK0JBQWdCOztJQUNoQix1Q0FBd0I7O0lBQ3hCLHVDQUF3Qjs7SUFDeEIsaUNBQWtCOztJQUNsQixrQ0FBbUI7O0lBQ25CLGdDQUFpQjs7Ozs7QUFFbkIsa0NBSUM7OztJQUhDLHVDQUF3Qjs7SUFDeEIscUNBQXNCOztJQUN0Qiw2QkFBZTs7Ozs7QUFHakIsMkJBR0M7OztJQUZDLHlCQUFpQjs7SUFDakIsdUJBQWUiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBJbmplY3QsIEluamVjdGFibGUsIE9wdGlvbmFsIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBIdHRwIH0gZnJvbSAnQGFuZ3VsYXIvaHR0cCc7XG5cbmltcG9ydCB7IEJyb2FkY2FzdGVyIH0gZnJvbSAnQGNlbWV4LWNvcmUvZXZlbnRzLXY3JztcblxuQEluamVjdGFibGUoKVxuZXhwb3J0IGNsYXNzIEZlYXR1cmVUb2dnbGVTZXJ2aWNlIHtcbiAgcHVibGljIHN0YXRpYyBmZWF0dXJlTGlzdDogTWFwPHN0cmluZywgSUZlYXR1cmVJdGVtPiA9IG5ldyBNYXA8XG4gICAgc3RyaW5nLFxuICAgIElGZWF0dXJlSXRlbVxuICA+KCk7XG4gIHB1YmxpYyBzdGF0aWMgbGFuZ3VhZ2UgPSAnJztcbiAgLy8gTXVzdCBiZSBzZXQgb24gcGF0aCBjb25zdGFudHNcblxuICBwdWJsaWMgc3RhdGljIFBST0RVQ1RfUEFUSCA9ICdQUk9EVUNUX1BBVEgnO1xuICBwdWJsaWMgc3RhdGljIEVOVklST05NRU5UID0gJ1BST0RVQ1RfUEFUSCc7XG4gIHB1YmxpYyBzdGF0aWMgVVNFX0xPQ0FMX01BTklGRVNUID0gJ1VTRV9MT0NBTF9NQU5JRkVTVCc7XG5cbiAgcHVibGljIHByb2R1Y3RQYXRoID0gJyc7XG4gIHB1YmxpYyBwcm9kdWN0RW52aXJvbm1lbnQgPSAnJztcblxuICAvKipcbiAgICogZ2V0cyBhbGwgZmVhdHVyZXNcbiAgICovXG4gIHB1YmxpYyBzdGF0aWMgYWxsKCk6IE1hcDxzdHJpbmcsIElGZWF0dXJlSXRlbT4ge1xuICAgIGNvbnN0IHJlc3VsdCA9IHRoaXMuZmVhdHVyZUxpc3Q7XG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfVxuXG4gIGNvbnN0cnVjdG9yKFxuICAgIHB1YmxpYyBldmVudEJyb2FkY2FzdGVyOiBCcm9hZGNhc3RlcixcbiAgICBwdWJsaWMgaHR0cDogSHR0cCxcbiAgICBASW5qZWN0KEZlYXR1cmVUb2dnbGVTZXJ2aWNlLlBST0RVQ1RfUEFUSClcbiAgICBAT3B0aW9uYWwoKVxuICAgIHB1YmxpYyBfcHJvZHVjdFBhdGg6IHN0cmluZyxcbiAgICBASW5qZWN0KEZlYXR1cmVUb2dnbGVTZXJ2aWNlLkVOVklST05NRU5UKVxuICAgIEBPcHRpb25hbCgpXG4gICAgcHVibGljIF9wcm9kdWN0RW52aXJvbm1lbnQ6IHN0cmluZyxcbiAgICBASW5qZWN0KEZlYXR1cmVUb2dnbGVTZXJ2aWNlLlVTRV9MT0NBTF9NQU5JRkVTVClcbiAgICBAT3B0aW9uYWwoKVxuICAgIHB1YmxpYyBsb2NhbE1hbmlmZXN0OiBib29sZWFuXG4gICkge1xuICAgIHRoaXMucHJvZHVjdFBhdGggPSBfcHJvZHVjdFBhdGggfHwgJy8nO1xuICAgIHRoaXMucHJvZHVjdEVudmlyb25tZW50ID0gX3Byb2R1Y3RFbnZpcm9ubWVudCB8fCAnZGV2ZWxvcG1lbnQnO1xuICAgIHRoaXMuZ2V0RmVhdHVyZUxpc3QodGhpcy5sb2NhbE1hbmlmZXN0IHx8IGZhbHNlKTtcbiAgfVxuICAvKipcbiAgICogdGhpcyBtZXRob2QgcmV0dXJucyBlaXRoZXIgdHJ1ZSBvciBmYWxzZSBpZiB0aGUgbGlzdCBvZiB0aGUgZmVhdHVyZXNcbiAgICogcmVxdWVzdGVkIGlzIGVuYWJsZWQgaW4gdGhpcyBlbnZpcm9ubWVudCBhbmQgZm9yIHRoaXMgdXNlclxuICAgKi9cbiAgcHVibGljIGZlYXR1cmUoXG4gICAgZmVhdHVyZUlkOiBzdHJpbmcgfCBzdHJpbmdbXSxcbiAgICByZWxlYXNlVmVyc2lvbj86IHN0cmluZyxcbiAgICBmZWF0dXJlVmVyc2lvbj86IHN0cmluZyxcbiAgICBob3N0TmFtZT86IHN0cmluZ1xuICApOiBib29sZWFuIHtcbiAgICBpZiAodHlwZW9mIGZlYXR1cmVJZCA9PT0gJ3N0cmluZycpIHtcbiAgICAgIHJldHVybiB0aGlzLmNvcmVWYWxpZGF0b3IoXG4gICAgICAgIGZlYXR1cmVJZCxcbiAgICAgICAgcmVsZWFzZVZlcnNpb24sXG4gICAgICAgIGZlYXR1cmVWZXJzaW9uLFxuICAgICAgICBob3N0TmFtZVxuICAgICAgKTtcbiAgICB9IGVsc2Uge1xuICAgICAgZmVhdHVyZUlkLmZvckVhY2goc2luZ2xlRmVhdHVyZSA9PiB7XG4gICAgICAgIGlmIChcbiAgICAgICAgICAhdGhpcy5jb3JlVmFsaWRhdG9yKFxuICAgICAgICAgICAgc2luZ2xlRmVhdHVyZSxcbiAgICAgICAgICAgIHJlbGVhc2VWZXJzaW9uLFxuICAgICAgICAgICAgZmVhdHVyZVZlcnNpb24sXG4gICAgICAgICAgICBob3N0TmFtZVxuICAgICAgICAgIClcbiAgICAgICAgKSB7XG4gICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9XG4gICAgcmV0dXJuIHRydWU7XG4gIH1cblxuICAvKipcbiAgICogdGhpcyBtZXRob2QgcmV0dXJucyBhbGwgbGlzdCBvZiBmZWF0dXJlc1xuICAgKi9cbiAgcHVibGljIGdldEFsbCgpOiBNYXA8c3RyaW5nLCBJRmVhdHVyZUl0ZW0+IHtcbiAgICByZXR1cm4gRmVhdHVyZVRvZ2dsZVNlcnZpY2UuZmVhdHVyZUxpc3Q7XG4gIH1cbiAgLyoqXG4gICAqIHRoaXMgbWV0aG9kIGFsbG93cyB0byBsb2FkIHRoZSBmZWF0dXJlIGxpc3QgZnJvbSB0aGUgZmlsZVxuICAgKi9cbiAgcHVibGljIGdldEZlYXR1cmVMaXN0KGxvYWRGcm9tTG9jYWxMaXN0OiBib29sZWFuKTogdm9pZCB7XG4gICAgLy8gaWYgdGhlIGxvYWRmcm9tbG9jYWxsaXN0IGlzIHRydWUsIHRoZW4gbG9hZCB0aGUgbG9jYWwtZmVhdHVyZS5qc29uIGZpbGVcbiAgICBpZiAobG9hZEZyb21Mb2NhbExpc3QpIHtcbiAgICAgIHRoaXMuaHR0cFxuICAgICAgICAuZ2V0KHRoaXMucHJvZHVjdFBhdGggKyAndmVuZG9yL2xvY2FsLWZlYXR1cmUuanNvbicpXG4gICAgICAgIC50b1Byb21pc2UoKVxuICAgICAgICAudGhlbihyZXNwb25zZSA9PiB0aGlzLnBvcHVsYXRlRmVhdHVyZXMocmVzcG9uc2UuanNvbigpKSlcbiAgICAgICAgLmNhdGNoKHRoaXMuaGFuZGxlRXJyb3IpO1xuICAgIH0gZWxzZSB7XG4gICAgICAvLyBpZiB0aGUgQVBJIGlzIHJlYWR5IHRoZW4gc3dpdGNoIGlzIHRoaXMgb25lXG4gICAgICB0aGlzLmh0dHBcbiAgICAgICAgLmdldCgnL2ZlYXR1cmUvYXBpJyArIHRoaXMucHJvZHVjdFBhdGgpXG4gICAgICAgIC50b1Byb21pc2UoKVxuICAgICAgICAudGhlbihyZXNwb25zZSA9PiB0aGlzLnBvcHVsYXRlRmVhdHVyZXMocmVzcG9uc2UuanNvbigpKSlcbiAgICAgICAgLmNhdGNoKHRoaXMuaGFuZGxlRXJyb3IpO1xuICAgIH1cbiAgfVxuXG4gIHB1YmxpYyBjb3JlVmFsaWRhdG9yKFxuICAgIGZlYXR1cmVJZDogc3RyaW5nLFxuICAgIHJlbGVhc2VWZXJzaW9uPzogc3RyaW5nLFxuICAgIGZlYXR1cmVWZXJzaW9uPzogc3RyaW5nLFxuICAgIGhvc3ROYW1lPzogc3RyaW5nXG4gICk6IGJvb2xlYW4ge1xuICAgIC8vIHRvZG8gc21hbGxlciByZWZhY3RvclxuICAgIGNvbnN0IGxvY2FsRmluZDogSUZlYXR1cmVJdGVtID0gRmVhdHVyZVRvZ2dsZVNlcnZpY2UuZmVhdHVyZUxpc3QuZ2V0KFxuICAgICAgZmVhdHVyZUlkXG4gICAgKTtcbiAgICBpZiAobG9jYWxGaW5kID09PSB1bmRlZmluZWQpIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgLy8gaWYgaXQgaXMgZm91bmQgdGhlbiB2ZXJpZnkgYWdhaW5zdCB0aGUgY291bnRyeVxuICAgIGlmIChsb2NhbEZpbmQuY291bnRyeSAhPT0gbnVsbCAmJiBsb2NhbEZpbmQuY291bnRyeSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAvLyB3ZSBjYW4gdGFrZSB0aGUgY291bnRyeSBmcm9tIHRoZSBzZXNzaW9uIHN0b3JhZ2VcbiAgICAgIGlmIChcbiAgICAgICAgd2luZG93LnNlc3Npb25TdG9yYWdlLmdldEl0ZW0oJ2NvdW50cnknKS5pbmRleE9mKGxvY2FsRmluZC5jb3VudHJ5KSA9PT1cbiAgICAgICAgLTFcbiAgICAgICkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9XG4gICAgfVxuICAgIGlmIChsb2NhbEZpbmQucm9sZSAhPT0gbnVsbCAmJiBsb2NhbEZpbmQucm9sZSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICBsZXQgaXNSb2xlQXNzaWduZWQgPSBmYWxzZTtcbiAgICAgIGNvbnN0IGFwcHNBdmFpbGFibGUgPSBKU09OLnBhcnNlKFxuICAgICAgICB3aW5kb3cuc2Vzc2lvblN0b3JhZ2UuZ2V0SXRlbSgnYXBwbGljYXRpb25zJylcbiAgICAgICk7XG4gICAgICBhcHBzQXZhaWxhYmxlLmZvckVhY2goKGFwcDogSUFwcGxpY2F0aW9uKSA9PiB7XG4gICAgICAgIGFwcC5yb2xlcy5mb3JFYWNoKHJvbGUgPT4ge1xuICAgICAgICAgIGlmICgocm9sZSBhcyBJUm9sZSkucm9sZUNvZGUgPT09IGxvY2FsRmluZC5yb2xlKSB7XG4gICAgICAgICAgICBpc1JvbGVBc3NpZ25lZCA9IHRydWU7XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgIH0pO1xuICAgICAgaWYgKCFpc1JvbGVBc3NpZ25lZCkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9XG4gICAgfVxuICAgIGlmIChsb2NhbEZpbmQucm9sZV9tYXRjaCAhPT0gbnVsbCAmJiBsb2NhbEZpbmQucm9sZV9tYXRjaCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICBsZXQgcm9sZXNBc3NpZ25lZCA9IDA7XG4gICAgICBjb25zdCBhcHBzQXZhaWxhYmxlID0gSlNPTi5wYXJzZShcbiAgICAgICAgd2luZG93LnNlc3Npb25TdG9yYWdlLmdldEl0ZW0oJ2FwcGxpY2F0aW9ucycpXG4gICAgICApO1xuICAgICAgYXBwc0F2YWlsYWJsZS5mb3JFYWNoKChhcHA6IElBcHBsaWNhdGlvbikgPT4ge1xuICAgICAgICBhcHAucm9sZXMuZm9yRWFjaChyb2xlID0+IHtcbiAgICAgICAgICBpZiAobG9jYWxGaW5kLnJvbGVfbWF0Y2guaW5kZXhPZigocm9sZSBhcyBJUm9sZSkucm9sZUNvZGUpICE9PSAtMSkge1xuICAgICAgICAgICAgcm9sZXNBc3NpZ25lZCA9IHJvbGVzQXNzaWduZWQgKyAxO1xuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICAgIGlmIChyb2xlc0Fzc2lnbmVkICE9PSBsb2NhbEZpbmQucm9sZV9tYXRjaC5zcGxpdCgnLCcpLmxlbmd0aCkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9XG4gICAgfVxuICAgIGlmIChsb2NhbEZpbmQucm9sZV9hbnkgIT09IG51bGwgJiYgbG9jYWxGaW5kLnJvbGVfYW55ICE9PSB1bmRlZmluZWQpIHtcbiAgICAgIGxldCByb2xlc0Fzc2lnbmVkID0gMDtcbiAgICAgIGNvbnN0IGFwcHNBdmFpbGFibGUgPSBKU09OLnBhcnNlKFxuICAgICAgICB3aW5kb3cuc2Vzc2lvblN0b3JhZ2UuZ2V0SXRlbSgnYXBwbGljYXRpb25zJylcbiAgICAgICk7XG4gICAgICBhcHBzQXZhaWxhYmxlLmZvckVhY2goKGFwcDogSUFwcGxpY2F0aW9uKSA9PiB7XG4gICAgICAgIGFwcC5yb2xlcy5mb3JFYWNoKHJvbGUgPT4ge1xuICAgICAgICAgIGlmIChsb2NhbEZpbmQucm9sZV9hbnkuaW5kZXhPZigocm9sZSBhcyBJUm9sZSkucm9sZUNvZGUpICE9PSAtMSkge1xuICAgICAgICAgICAgcm9sZXNBc3NpZ25lZCA9IHJvbGVzQXNzaWduZWQgKyAxO1xuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICAgIGlmIChyb2xlc0Fzc2lnbmVkID09PSAwKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH1cbiAgICB9XG4gICAgaWYgKGxvY2FsRmluZC5lbnZpcm9ubWVudCAhPT0gbnVsbCAmJiBsb2NhbEZpbmQuZW52aXJvbm1lbnQgIT09IHVuZGVmaW5lZCkge1xuICAgICAgLy8gdmVyaWZ5IHRoZSBpbmplY3Rpb24gb2YgdGhlIGVudmlyb25tZW50XG4gICAgICBpZiAobG9jYWxGaW5kLmVudmlyb25tZW50ICE9PSB0aGlzLnByb2R1Y3RFbnZpcm9ubWVudCkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9XG4gICAgfVxuICAgIGlmIChcbiAgICAgIGxvY2FsRmluZC5yZWxlYXNlX3ZlcnNpb24gIT09IG51bGwgJiZcbiAgICAgIGxvY2FsRmluZC5yZWxlYXNlX3ZlcnNpb24gIT09IHVuZGVmaW5lZFxuICAgICkge1xuICAgICAgLy8gdmVyaWZ5IHRoZSBpbmplY3Rpb24gb2YgdGhlIGVudmlyb25tZW50XG4gICAgICBpZiAobG9jYWxGaW5kLnJlbGVhc2VfdmVyc2lvbiAhPT0gcmVsZWFzZVZlcnNpb24pIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfVxuICAgIH1cbiAgICBpZiAoXG4gICAgICBsb2NhbEZpbmQuZmVhdHVyZV92ZXJzaW9uICE9PSBudWxsICYmXG4gICAgICBsb2NhbEZpbmQuZmVhdHVyZV92ZXJzaW9uICE9PSB1bmRlZmluZWRcbiAgICApIHtcbiAgICAgIC8vIHZlcmlmeSB0aGUgaW5qZWN0aW9uIG9mIHRoZSBlbnZpcm9ubWVudFxuICAgICAgaWYgKGxvY2FsRmluZC5mZWF0dXJlX3ZlcnNpb24gIT09IGZlYXR1cmVWZXJzaW9uKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH1cbiAgICB9XG4gICAgaWYgKGxvY2FsRmluZC5ob3N0X25hbWUgIT09IG51bGwgJiYgbG9jYWxGaW5kLmhvc3RfbmFtZSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAvLyB2ZXJpZnkgdGhlIGluamVjdGlvbiBvZiB0aGUgZW52aXJvbm1lbnRcbiAgICAgIGlmIChsb2NhbEZpbmQuaG9zdF9uYW1lICE9PSBob3N0TmFtZSkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiB0cnVlO1xuICB9XG5cbiAgcHVibGljIGhhbmRsZUVycm9yKGVycm9yOiBhbnkpOiBQcm9taXNlPGFueT4ge1xuICAgIHJldHVybiBQcm9taXNlLnJlamVjdChlcnJvci5tZXNzYWdlIHx8IGVycm9yKTtcbiAgfVxuXG4gIHB1YmxpYyBwb3B1bGF0ZUZlYXR1cmVzKHJlc3VsdCkge1xuICAgIGZvciAoY29uc3QgaXRlbSBvZiBPYmplY3Qua2V5cyhyZXN1bHQpKSB7XG4gICAgICBGZWF0dXJlVG9nZ2xlU2VydmljZS5mZWF0dXJlTGlzdC5zZXQoXG4gICAgICAgIChyZXN1bHRbaXRlbV0gYXMgSUZlYXR1cmVJdGVtKS5mZWF0dXJlLFxuICAgICAgICByZXN1bHRbaXRlbV1cbiAgICAgICk7XG4gICAgfVxuICAgIC8vIHRoaXMuZXZlbnRCcm9hZGNhc3Rlci5icm9hZGNhc3QoQnJvYWRjYXN0ZXIuRENNX0xBTkdVQUdFX0ZFVENIRUQsIFRyYW5zbGF0aW9uU2VydmljZS5sYW5ndWFnZSk7XG4gICAgLy8gdGhpcy5vbkNoYW5nZShyZXN1bHQpO1xuICB9XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgSUZlYXR1cmVJdGVtIHtcbiAgZmVhdHVyZTogc3RyaW5nO1xuICBvcHRpb246IHN0cmluZyB8IG51bWJlcjtcbiAgZW52aXJvbm1lbnQ6IHN0cmluZztcbiAgcm9sZTogc3RyaW5nO1xuICBjb3VudHJ5OiBzdHJpbmc7XG4gIHJlbGVhc2VfdmVyc2lvbjogc3RyaW5nO1xuICBmZWF0dXJlX3ZlcnNpb246IHN0cmluZztcbiAgaG9zdF9uYW1lOiBzdHJpbmc7XG4gIHJvbGVfbWF0Y2g6IHN0cmluZztcbiAgcm9sZV9hbnk6IHN0cmluZztcbn1cbmV4cG9ydCBpbnRlcmZhY2UgSUFwcGxpY2F0aW9uIHtcbiAgYXBwbGljYXRpb25Db2RlOiBzdHJpbmc7XG4gIGFwcGxpY2F0aW9uSWQ6IG51bWJlcjtcbiAgcm9sZXM6IElSb2xlW107XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgSVJvbGUge1xuICByb2xlQ29kZTogc3RyaW5nO1xuICByb2xlSWQ6IG51bWJlcjtcbn1cbiJdfQ==
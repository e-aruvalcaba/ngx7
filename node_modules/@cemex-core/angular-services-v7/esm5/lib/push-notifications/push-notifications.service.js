/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Injectable } from '@angular/core';
import { PushNotificationsConstants } from './push-notifications.constants';
var PushNotificationService = /** @class */ (function () {
    function PushNotificationService(constants) {
        this.constants = constants;
        this._devUUID = '';
        this._devId = '';
        this._platform = '';
        this._token = '';
        // this.initialize();
    }
    /**
     * @param {?} methodCallBack
     * @return {?}
     */
    PushNotificationService.prototype.initialize = /**
     * @param {?} methodCallBack
     * @return {?}
     */
    function (methodCallBack) {
        this._methodCallBack = methodCallBack;
        this._vapidPublicKey = this.constants.getVapidPublicKey();
        if (this.validateSw()) {
            // tslint:disable-next-line:only-arrow-functions
            /** @type {?} */
            var swReg = this.registerSw().catch((/**
             * @param {?} error
             * @return {?}
             */
            function (error) {
                console.log('Push Service Worker registration has failed: ' + error);
            }));
            // tslint:disable-next-line:only-arrow-functions
            this.subscriptionSw(swReg).catch((/**
             * @param {?} error
             * @return {?}
             */
            function (error) {
                console.log('Push Service Worker subscription has failed: ' + error);
            }));
        }
    };
    /**
     * @return {?}
     */
    PushNotificationService.prototype.validateSw = /**
     * @return {?}
     */
    function () {
        /** @type {?} */
        var isValid = false;
        if ('serviceWorker' in navigator && 'PushManager' in window) {
            isValid = true;
            console.log('Service Workers is supported');
        }
        return isValid;
    };
    /**
     * @private
     * @return {?}
     */
    PushNotificationService.prototype.registerSw = /**
     * @private
     * @return {?}
     */
    function () {
        // tslint:disable-next-line:only-arrow-functions
        return navigator.serviceWorker
            .register(this.constants.getUrlSW())
            .then((/**
         * @param {?} swReg
         * @return {?}
         */
        function (swReg) {
            if (swReg.installing) {
                console.log('Service worker installing');
            }
            else if (swReg.waiting) {
                console.log('Service worker installed');
            }
            else if (swReg.active) {
                console.log('Service worker active');
            }
            if (!swReg.showNotification) {
                console.log('Notifications aren\'t supported on service workers.');
            }
            return swReg;
        }));
    };
    /**
     * @private
     * @param {?} registration
     * @return {?}
     */
    PushNotificationService.prototype.subscriptionSw = /**
     * @private
     * @param {?} registration
     * @return {?}
     */
    function (registration) {
        /** @type {?} */
        var mSetSubscription = this.setSubscription;
        /** @type {?} */
        var global = this;
        // tslint:disable-next-line:only-arrow-functions
        return registration.then((/**
         * @param {?} swReg
         * @return {?}
         */
        function (swReg) {
            swReg.pushManager
                .getSubscription()
                // tslint:disable-next-line:only-arrow-functions
                .then((/**
             * @param {?} subscriptionInit
             * @return {?}
             */
            function (subscriptionInit) {
                if (subscriptionInit) {
                    return mSetSubscription(subscriptionInit, global);
                }
                else {
                    /** @type {?} */
                    var options = {
                        // tslint:disable-next-line:max-line-length
                        applicationServerKey: !global._vapidPublicKey
                            ? null
                            : global.urlB64ToUint8Array(global._vapidPublicKey),
                        userVisibleOnly: true
                    };
                    return (swReg.pushManager
                        .subscribe(options)
                        // tslint:disable-next-line:only-arrow-functions
                        .then((/**
                     * @param {?} subscription
                     * @return {?}
                     */
                    function (subscription) {
                        console.log(subscription);
                        return mSetSubscription(subscription, global);
                        // tslint:disable-next-line:only-arrow-functions
                    }))
                        .catch((/**
                     * @param {?} error
                     * @return {?}
                     */
                    function (error) {
                        console.log('Unable to subscribe to push.', error);
                    })));
                }
            }));
        }));
    };
    /**
     * @private
     * @param {?} subscription
     * @param {?} global
     * @return {?}
     */
    PushNotificationService.prototype.setSubscription = /**
     * @private
     * @param {?} subscription
     * @param {?} global
     * @return {?}
     */
    function (subscription, global) {
        global.generateTokenForRegisterDevice(subscription);
        global.registerBroadcastListener();
    };
    /**
     * @private
     * @return {?}
     */
    PushNotificationService.prototype.registerBroadcastListener = /**
     * @private
     * @return {?}
     */
    function () {
        /** @type {?} */
        var callBack = this._methodCallBack;
        /** @type {?} */
        var sPush = this.constants.getSourcePush();
        navigator.serviceWorker.addEventListener('message', (/**
         * @param {?} event
         * @return {?}
         */
        function handler(event) {
            /** @type {?} */
            var data = event.data;
            if (data && data.source === sPush) {
                console.log(event.data);
                if (callBack) {
                    callBack(data.payload);
                }
            }
        }));
    };
    // tslint:disable-next-line:member-ordering
    // tslint:disable-next-line:member-ordering
    /**
     * @param {?} subscription
     * @return {?}
     */
    PushNotificationService.prototype.generateTokenForRegisterDevice = 
    // tslint:disable-next-line:member-ordering
    /**
     * @param {?} subscription
     * @return {?}
     */
    function (subscription) {
        localStorage.setItem('token', JSON.stringify(subscription));
        if (!localStorage.getItem('deviceUUID')) {
            this.generateUUID('');
        }
        else {
            this._devUUID = localStorage.getItem('deviceUUID');
            if (!localStorage.getItem('deviceId')) {
                this._devId = localStorage.getItem('deviceId');
            }
        }
        this._platform = '';
        this._devUUID = localStorage.getItem('deviceUUID');
        this._devId = localStorage.getItem('deviceId');
        /** @type {?} */
        var rawKey = subscription.getKey ? subscription.getKey('p256dh') : '';
        /** @type {?} */
        var key = rawKey
            ? btoa(String.fromCharCode.apply(null, new Uint8Array(rawKey)))
            : '';
        /** @type {?} */
        var rawAuthSecret = subscription.getKey
            ? subscription.getKey('auth')
            : '';
        /** @type {?} */
        var authSecret = rawAuthSecret
            ? btoa(String.fromCharCode.apply(null, new Uint8Array(rawAuthSecret)))
            : '';
        /** @type {?} */
        var tokenValue = {
            endpoint: subscription.endpoint,
            userAuth: authSecret,
            userPublicKey: key
        };
        this._token = JSON.stringify(tokenValue);
        if (navigator.userAgent.indexOf('Firefox') !== -1) {
            this._platform = 'F'; // Firefox Browser
        }
        else if (navigator.userAgent.indexOf('Chrome') !== -1) {
            this._platform = 'C'; // Chrome Browser
        }
        /** @type {?} */
        var device = null;
        if (this.validateInput(this._devId)) {
            device = {
                deviceId: this._devId,
                platform: this._platform,
                token: this._token,
                uuid: this._devUUID
            };
        }
        else {
            device = {
                platform: this._platform,
                token: this._token,
                uuid: this._devUUID
            };
        }
        this.registerDevice(device);
    };
    // tslint:disable-next-line:member-ordering
    // tslint:disable-next-line:member-ordering
    /**
     * @param {?} device
     * @return {?}
     */
    PushNotificationService.prototype.registerDevice = 
    // tslint:disable-next-line:member-ordering
    /**
     * @param {?} device
     * @return {?}
     */
    function (device) {
        console.log('Device details:', device);
        /** @type {?} */
        var xhr = this.setRequest(this.constants.getDevicesPath(), 'POST', true);
        /*this.http.post(this.constants.getDevicesPath(), device)
            .then((response) => {
                console.log('Response register,', response);
                localStorage.setItem('deviceId', response);
            });*/
        // tslint:disable-next-line:only-arrow-functions
        xhr.onreadystatechange = (/**
         * @return {?}
         */
        function () {
            if (xhr.readyState === 4 && xhr.status === 200) {
                console.log('Response register,', xhr);
                localStorage.setItem('deviceId', xhr.responseText);
            }
        });
        xhr.send(JSON.stringify(device));
    };
    // tslint:disable-next-line:member-ordering
    // tslint:disable-next-line:member-ordering
    /**
     * @return {?}
     */
    PushNotificationService.prototype.unRegisterDevice = 
    // tslint:disable-next-line:member-ordering
    /**
     * @return {?}
     */
    function () {
        var _this = this;
        /** @type {?} */
        var promise = new Promise((/**
         * @param {?} resolve
         * @param {?} reject
         * @return {?}
         */
        function (resolve, reject) {
            _this._devId = localStorage.getItem('deviceId');
            /** @type {?} */
            var global = _this;
            // tslint:disable-next-line:only-arrow-functions
            navigator.serviceWorker.ready
                .then((/**
             * @param {?} registration
             * @return {?}
             */
            function (registration) {
                registration
                    .unregister()
                    // tslint:disable-next-line:only-arrow-functions
                    .then((/**
                 * @param {?} checkUnregister
                 * @return {?}
                 */
                function (checkUnregister) {
                    if (!checkUnregister) {
                        console.log('unregister failed');
                        resolve();
                    }
                    global
                        .unsubscribeDevice(global._devId, global)
                        // tslint:disable-next-line:only-arrow-functions
                        .then((/**
                     * @return {?}
                     */
                    function () {
                        resolve();
                    }));
                }));
            }))
                // tslint:disable-next-line:only-arrow-functions
                .catch((/**
             * @param {?} error
             * @return {?}
             */
            function (error) {
                console.log('Registration failed with ' + error);
                resolve();
            }));
        }));
        return promise;
    };
    // tslint:disable-next-line:member-ordering
    // tslint:disable-next-line:member-ordering
    /**
     * @param {?} deviceID
     * @param {?} global
     * @return {?}
     */
    PushNotificationService.prototype.unsubscribeDevice = 
    // tslint:disable-next-line:member-ordering
    /**
     * @param {?} deviceID
     * @param {?} global
     * @return {?}
     */
    function (deviceID, global) {
        /** @type {?} */
        var promise = new Promise((/**
         * @param {?} resolve
         * @param {?} reject
         * @return {?}
         */
        function (resolve, reject) {
            /** @type {?} */
            var deviceId = localStorage.getItem('deviceId');
            /** @type {?} */
            var device = {
                devices: {
                    deviceId: global._devId,
                    platform: global._platform,
                    token: global._token,
                    uuid: global._devUUID
                }
            };
            if (deviceID) {
                /** @type {?} */
                var xhr_1 = global.setRequest(global.constants.getDevicesPath() + '/' + deviceID, 'DELETE', true);
                // tslint:disable-next-line:only-arrow-functions
                xhr_1.onreadystatechange = (/**
                 * @return {?}
                 */
                function () {
                    if (xhr_1.readyState === 4 && xhr_1.status === 200) {
                        console.log('The response is ,', xhr_1);
                        console.log('Successfully unregistered the device');
                        localStorage.setItem('deviceUUID', '');
                        localStorage.setItem('deviceId', '');
                        localStorage.setItem('token', '');
                        resolve();
                    }
                });
                xhr_1.send(JSON.stringify(device));
            }
            else {
                resolve();
            }
        }));
        return promise;
    };
    /**
     * @private
     * @param {?} url
     * @param {?} method
     * @param {?} asyncP
     * @return {?}
     */
    PushNotificationService.prototype.setRequest = /**
     * @private
     * @param {?} url
     * @param {?} method
     * @param {?} asyncP
     * @return {?}
     */
    function (url, method, asyncP) {
        /** @type {?} */
        var xhr = new XMLHttpRequest();
        xhr.open(method, url, asyncP);
        xhr = this.setHeaders(xhr, method);
        return xhr;
    };
    /**
     * @private
     * @param {?} xhr
     * @param {?} method
     * @return {?}
     */
    PushNotificationService.prototype.setHeaders = /**
     * @private
     * @param {?} xhr
     * @param {?} method
     * @return {?}
     */
    function (xhr, method) {
        xhr.setRequestHeader('Accept', 'application/json');
        xhr.setRequestHeader('x-ibm-client-id', this.constants.getClientId());
        xhr.setRequestHeader('App-Code', this.constants.getAppCode());
        xhr.setRequestHeader('Accept-Language', this.constants.getAppLanguage());
        xhr.setRequestHeader('Authorization', this.constants.getAuthToken());
        xhr.setRequestHeader('jwt', this.constants.getJwt());
        xhr.timeout = 3000;
        if (method === 'POST' || method === 'PUT') {
            xhr.setRequestHeader('Content-Type', 'application/json; charset=UTF-8');
        }
        return xhr;
    };
    /**
     * @private
     * @param {?} token
     * @return {?}
     */
    PushNotificationService.prototype.generateUUID = /**
     * @private
     * @param {?} token
     * @return {?}
     */
    function (token) {
        /** @type {?} */
        var dateTime = new Date().getTime();
        if (window.performance && typeof window.performance.now === 'function') {
            dateTime += performance.now(); // use high-precision timer if available
        }
        /** @type {?} */
        var hostname = window.location.hostname;
        /** @type {?} */
        var arrayData = [];
        arrayData.push(this.hashCode(dateTime));
        arrayData.push(this.hashCode(token));
        arrayData.push(this.hashCode(hostname));
        arrayData.push(this.hashCode(this._platform));
        /** @type {?} */
        var finalString = arrayData
            .join('')
            .replace(/[-.]/g, '')
            .replace(/[,.]/g, '');
        /** @type {?} */
        var uuid = '';
        for (var i = 0; i < 32; i++) {
            uuid += finalString.charAt(Math.floor(Math.random() * finalString.length));
        }
        localStorage.setItem('deviceUUID', uuid);
        this._devUUID = uuid;
        return this._devUUID;
    };
    /**
     * @private
     * @param {?} str
     * @return {?}
     */
    PushNotificationService.prototype.hashCode = /**
     * @private
     * @param {?} str
     * @return {?}
     */
    function (str) {
        /** @type {?} */
        var hash = 0;
        /** @type {?} */
        var i;
        /** @type {?} */
        var chr;
        /** @type {?} */
        var len;
        if (str.length === 0) {
            return hash;
        }
        for (i = 0, len = str.length; i < len; i++) {
            chr = str.charCodeAt(i);
            // tslint:disable-next-line:no-bitwise
            hash = (hash << 5) - hash + chr;
            // tslint:disable-next-line:no-bitwise
            hash |= 0; // Convert to 32bit integer
        }
        return hash;
    };
    /**
     * @private
     * @param {?} stringValue
     * @return {?}
     */
    PushNotificationService.prototype.validateInput = /**
     * @private
     * @param {?} stringValue
     * @return {?}
     */
    function (stringValue) {
        // tslint:disable-next-line:max-line-length
        return stringValue === undefined ||
            stringValue == null ||
            stringValue.length <= 0 ||
            stringValue === ''
            ? false
            : true;
    };
    /**
     * @private
     * @param {?} base64String
     * @return {?}
     */
    PushNotificationService.prototype.urlB64ToUint8Array = /**
     * @private
     * @param {?} base64String
     * @return {?}
     */
    function (base64String) {
        /** @type {?} */
        var padding = '='.repeat((4 - (base64String.length % 4)) % 4);
        /** @type {?} */
        var base64 = (base64String + padding)
            .replace(/\-/g, '+')
            .replace(/_/g, '/');
        /** @type {?} */
        var rawData = window.atob(base64);
        /** @type {?} */
        var outputArray = new Uint8Array(rawData.length);
        for (var i = 0; i < rawData.length; ++i) {
            outputArray[i] = rawData.charCodeAt(i);
        }
        return outputArray;
    };
    PushNotificationService.decorators = [
        { type: Injectable }
    ];
    /** @nocollapse */
    PushNotificationService.ctorParameters = function () { return [
        { type: PushNotificationsConstants }
    ]; };
    return PushNotificationService;
}());
export { PushNotificationService };
if (false) {
    /**
     * @type {?}
     * @private
     */
    PushNotificationService.prototype._devUUID;
    /**
     * @type {?}
     * @private
     */
    PushNotificationService.prototype._devId;
    /**
     * @type {?}
     * @private
     */
    PushNotificationService.prototype._platform;
    /**
     * @type {?}
     * @private
     */
    PushNotificationService.prototype._token;
    /**
     * @type {?}
     * @private
     */
    PushNotificationService.prototype._methodCallBack;
    /**
     * @type {?}
     * @private
     */
    PushNotificationService.prototype._vapidPublicKey;
    /**
     * @type {?}
     * @private
     */
    PushNotificationService.prototype.constants;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicHVzaC1ub3RpZmljYXRpb25zLnNlcnZpY2UuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AY2VtZXgtY29yZS9hbmd1bGFyLXNlcnZpY2VzLXY3LyIsInNvdXJjZXMiOlsibGliL3B1c2gtbm90aWZpY2F0aW9ucy9wdXNoLW5vdGlmaWNhdGlvbnMuc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O0FBQUEsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUMzQyxPQUFPLEVBQUUsMEJBQTBCLEVBQUUsTUFBTSxnQ0FBZ0MsQ0FBQztBQUU1RTtJQVNFLGlDQUFvQixTQUFxQztRQUFyQyxjQUFTLEdBQVQsU0FBUyxDQUE0QjtRQVBqRCxhQUFRLEdBQUcsRUFBRSxDQUFDO1FBQ2QsV0FBTSxHQUFHLEVBQUUsQ0FBQztRQUNaLGNBQVMsR0FBRyxFQUFFLENBQUM7UUFDZixXQUFNLEdBQUcsRUFBRSxDQUFDO1FBS2xCLHFCQUFxQjtJQUN2QixDQUFDOzs7OztJQUVNLDRDQUFVOzs7O0lBQWpCLFVBQWtCLGNBQW1CO1FBQ25DLElBQUksQ0FBQyxlQUFlLEdBQUcsY0FBYyxDQUFDO1FBQ3RDLElBQUksQ0FBQyxlQUFlLEdBQUcsSUFBSSxDQUFDLFNBQVMsQ0FBQyxpQkFBaUIsRUFBRSxDQUFDO1FBQzFELElBQUksSUFBSSxDQUFDLFVBQVUsRUFBRSxFQUFFOzs7Z0JBRWYsS0FBSyxHQUFHLElBQUksQ0FBQyxVQUFVLEVBQUUsQ0FBQyxLQUFLOzs7O1lBQUMsVUFBUyxLQUFLO2dCQUNsRCxPQUFPLENBQUMsR0FBRyxDQUFDLCtDQUErQyxHQUFHLEtBQUssQ0FBQyxDQUFDO1lBQ3ZFLENBQUMsRUFBQztZQUNGLGdEQUFnRDtZQUNoRCxJQUFJLENBQUMsY0FBYyxDQUFDLEtBQUssQ0FBQyxDQUFDLEtBQUs7Ozs7WUFBQyxVQUFTLEtBQUs7Z0JBQzdDLE9BQU8sQ0FBQyxHQUFHLENBQUMsK0NBQStDLEdBQUcsS0FBSyxDQUFDLENBQUM7WUFD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LENBQUMsS0FBSztZQUNQLENBQUMsQ0FBQyxJQUFJLENBQUM7SUFDWCxDQUFDOzs7Ozs7SUFFTyxvREFBa0I7Ozs7O0lBQTFCLFVBQTJCLFlBQVk7O1lBQy9CLE9BQU8sR0FBRyxHQUFHLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsWUFBWSxDQUFDLE1BQU0sR0FBRyxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQzs7WUFDekQsTUFBTSxHQUFHLENBQUMsWUFBWSxHQUFHLE9BQU8sQ0FBQzthQUNwQyxPQUFPLENBQUMsS0FBSyxFQUFFLEdBQUcsQ0FBQzthQUNuQixPQUFPLENBQUMsSUFBSSxFQUFFLEdBQUcsQ0FBQzs7WUFFZixPQUFPLEdBQUcsTUFBTSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUM7O1lBQzdCLFdBQVcsR0FBRyxJQUFJLFVBQVUsQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDO1FBRWxELEtBQUssSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxPQUFPLENBQUMsTUFBTSxFQUFFLEVBQUUsQ0FBQyxFQUFFO1lBQ3ZDLFdBQVcsQ0FBQyxDQUFDLENBQUMsR0FBRyxPQUFPLENBQUMsVUFBVSxDQUFDLENBQUMsQ0FBQyxDQUFDO1NBQ3hDO1FBQ0QsT0FBTyxXQUFXLENBQUM7SUFDckIsQ0FBQzs7Z0JBaFdGLFVBQVU7Ozs7Z0JBRkYsMEJBQTBCOztJQW1XbkMsOEJBQUM7Q0FBQSxBQWpXRCxJQWlXQztTQWhXWSx1QkFBdUI7Ozs7OztJQUNsQywyQ0FBc0I7Ozs7O0lBQ3RCLHlDQUFvQjs7Ozs7SUFDcEIsNENBQXVCOzs7OztJQUN2Qix5Q0FBb0I7Ozs7O0lBQ3BCLGtEQUE2Qjs7Ozs7SUFDN0Isa0RBQWdDOzs7OztJQUVwQiw0Q0FBNkMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBJbmplY3RhYmxlIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBQdXNoTm90aWZpY2F0aW9uc0NvbnN0YW50cyB9IGZyb20gJy4vcHVzaC1ub3RpZmljYXRpb25zLmNvbnN0YW50cyc7XG5cbkBJbmplY3RhYmxlKClcbmV4cG9ydCBjbGFzcyBQdXNoTm90aWZpY2F0aW9uU2VydmljZSB7XG4gIHByaXZhdGUgX2RldlVVSUQgPSAnJztcbiAgcHJpdmF0ZSBfZGV2SWQgPSAnJztcbiAgcHJpdmF0ZSBfcGxhdGZvcm0gPSAnJztcbiAgcHJpdmF0ZSBfdG9rZW4gPSAnJztcbiAgcHJpdmF0ZSBfbWV0aG9kQ2FsbEJhY2s6IGFueTtcbiAgcHJpdmF0ZSBfdmFwaWRQdWJsaWNLZXk6IHN0cmluZztcblxuICBjb25zdHJ1Y3Rvcihwcml2YXRlIGNvbnN0YW50czogUHVzaE5vdGlmaWNhdGlvbnNDb25zdGFudHMpIHtcbiAgICAvLyB0aGlzLmluaXRpYWxpemUoKTtcbiAgfVxuXG4gIHB1YmxpYyBpbml0aWFsaXplKG1ldGhvZENhbGxCYWNrOiBhbnkpOiB2b2lkIHtcbiAgICB0aGlzLl9tZXRob2RDYWxsQmFjayA9IG1ldGhvZENhbGxCYWNrO1xuICAgIHRoaXMuX3ZhcGlkUHVibGljS2V5ID0gdGhpcy5jb25zdGFudHMuZ2V0VmFwaWRQdWJsaWNLZXkoKTtcbiAgICBpZiAodGhpcy52YWxpZGF0ZVN3KCkpIHtcbiAgICAgIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTpvbmx5LWFycm93LWZ1bmN0aW9uc1xuICAgICAgY29uc3Qgc3dSZWcgPSB0aGlzLnJlZ2lzdGVyU3coKS5jYXRjaChmdW5jdGlvbihlcnJvcikge1xuICAgICAgICBjb25zb2xlLmxvZygnUHVzaCBTZXJ2aWNlIFdvcmtlciByZWdpc3RyYXRpb24gaGFzIGZhaWxlZDogJyArIGVycm9yKTtcbiAgICAgIH0pO1xuICAgICAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOm9ubHktYXJyb3ctZnVuY3Rpb25zXG4gICAgICB0aGlzLnN1YnNjcmlwdGlvblN3KHN3UmVnKS5jYXRjaChmdW5jdGlvbihlcnJvcikge1xuICAgICAgICBjb25zb2xlLmxvZygnUHVzaCBTZXJ2aWNlIFdvcmtlciBzdWJzY3JpcHRpb24gaGFzIGZhaWxlZDogJyArIGVycm9yKTtcbiAgICAgIH0pO1xuICAgIH1cbiAgfVxuXG4gIHB1YmxpYyB2YWxpZGF0ZVN3KCk6IGJvb2xlYW4ge1xuICAgIGxldCBpc1ZhbGlkID0gZmFsc2U7XG4gICAgaWYgKCdzZXJ2aWNlV29ya2VyJyBpbiBuYXZpZ2F0b3IgJiYgJ1B1c2hNYW5hZ2VyJyBpbiB3aW5kb3cpIHtcbiAgICAgIGlzVmFsaWQgPSB0cnVlO1xuICAgICAgY29uc29sZS5sb2coJ1NlcnZpY2UgV29ya2VycyBpcyBzdXBwb3J0ZWQnKTtcbiAgICB9XG4gICAgcmV0dXJuIGlzVmFsaWQ7XG4gIH1cblxuICBwcml2YXRlIHJlZ2lzdGVyU3coKSB7XG4gICAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOm9ubHktYXJyb3ctZnVuY3Rpb25zXG4gICAgcmV0dXJuIG5hdmlnYXRvci5zZXJ2aWNlV29ya2VyXG4gICAgICAucmVnaXN0ZXIodGhpcy5jb25zdGFudHMuZ2V0VXJsU1coKSlcbiAgICAgIC50aGVuKGZ1bmN0aW9uKHN3UmVnKSB7XG4gICAgICAgIGlmIChzd1JlZy5pbnN0YWxsaW5nKSB7XG4gICAgICAgICAgY29uc29sZS5sb2coJ1NlcnZpY2Ugd29ya2VyIGluc3RhbGxpbmcnKTtcbiAgICAgICAgfSBlbHNlIGlmIChzd1JlZy53YWl0aW5nKSB7XG4gICAgICAgICAgY29uc29sZS5sb2coJ1NlcnZpY2Ugd29ya2VyIGluc3RhbGxlZCcpO1xuICAgICAgICB9IGVsc2UgaWYgKHN3UmVnLmFjdGl2ZSkge1xuICAgICAgICAgIGNvbnNvbGUubG9nKCdTZXJ2aWNlIHdvcmtlciBhY3RpdmUnKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoIXN3UmVnLnNob3dOb3RpZmljYXRpb24pIHtcbiAgICAgICAgICBjb25zb2xlLmxvZygnTm90aWZpY2F0aW9ucyBhcmVuXFwndCBzdXBwb3J0ZWQgb24gc2VydmljZSB3b3JrZXJzLicpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBzd1JlZztcbiAgICAgIH0pO1xuICB9XG5cbiAgcHJpdmF0ZSBzdWJzY3JpcHRpb25TdyhyZWdpc3RyYXRpb24pIHtcbiAgICBjb25zdCBtU2V0U3Vic2NyaXB0aW9uID0gdGhpcy5zZXRTdWJzY3JpcHRpb247XG4gICAgY29uc3QgZ2xvYmFsID0gdGhpcztcbiAgICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6b25seS1hcnJvdy1mdW5jdGlvbnNcbiAgICByZXR1cm4gcmVnaXN0cmF0aW9uLnRoZW4oZnVuY3Rpb24oc3dSZWcpIHtcbiAgICAgIHN3UmVnLnB1c2hNYW5hZ2VyXG4gICAgICAgIC5nZXRTdWJzY3JpcHRpb24oKVxuICAgICAgICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6b25seS1hcnJvdy1mdW5jdGlvbnNcbiAgICAgICAgLnRoZW4oZnVuY3Rpb24oc3Vic2NyaXB0aW9uSW5pdCkge1xuICAgICAgICAgIGlmIChzdWJzY3JpcHRpb25Jbml0KSB7XG4gICAgICAgICAgICByZXR1cm4gbVNldFN1YnNjcmlwdGlvbihzdWJzY3JpcHRpb25Jbml0LCBnbG9iYWwpO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBjb25zdCBvcHRpb25zID0ge1xuICAgICAgICAgICAgICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6bWF4LWxpbmUtbGVuZ3RoXG4gICAgICAgICAgICAgIGFwcGxpY2F0aW9uU2VydmVyS2V5OiAhZ2xvYmFsLl92YXBpZFB1YmxpY0tleVxuICAgICAgICAgICAgICAgID8gbnVsbFxuICAgICAgICAgICAgICAgIDogZ2xvYmFsLnVybEI2NFRvVWludDhBcnJheShnbG9iYWwuX3ZhcGlkUHVibGljS2V5KSxcbiAgICAgICAgICAgICAgdXNlclZpc2libGVPbmx5OiB0cnVlXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgcmV0dXJuIChcbiAgICAgICAgICAgICAgc3dSZWcucHVzaE1hbmFnZXJcbiAgICAgICAgICAgICAgICAuc3Vic2NyaWJlKG9wdGlvbnMpXG4gICAgICAgICAgICAgICAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOm9ubHktYXJyb3ctZnVuY3Rpb25zXG4gICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24oc3Vic2NyaXB0aW9uKSB7XG4gICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhzdWJzY3JpcHRpb24pO1xuICAgICAgICAgICAgICAgICAgcmV0dXJuIG1TZXRTdWJzY3JpcHRpb24oc3Vic2NyaXB0aW9uLCBnbG9iYWwpO1xuICAgICAgICAgICAgICAgICAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOm9ubHktYXJyb3ctZnVuY3Rpb25zXG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAuY2F0Y2goZnVuY3Rpb24oZXJyb3IpIHtcbiAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdVbmFibGUgdG8gc3Vic2NyaWJlIHRvIHB1c2guJywgZXJyb3IpO1xuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICApO1xuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfSk7XG4gIH1cblxuICBwcml2YXRlIHNldFN1YnNjcmlwdGlvbihzdWJzY3JpcHRpb24sIGdsb2JhbCkge1xuICAgIGdsb2JhbC5nZW5lcmF0ZVRva2VuRm9yUmVnaXN0ZXJEZXZpY2Uoc3Vic2NyaXB0aW9uKTtcbiAgICBnbG9iYWwucmVnaXN0ZXJCcm9hZGNhc3RMaXN0ZW5lcigpO1xuICB9XG5cbiAgcHJpdmF0ZSByZWdpc3RlckJyb2FkY2FzdExpc3RlbmVyKCkge1xuICAgIGNvbnN0IGNhbGxCYWNrID0gdGhpcy5fbWV0aG9kQ2FsbEJhY2s7XG4gICAgY29uc3Qgc1B1c2ggPSB0aGlzLmNvbnN0YW50cy5nZXRTb3VyY2VQdXNoKCk7XG4gICAgbmF2aWdhdG9yLnNlcnZpY2VXb3JrZXIuYWRkRXZlbnRMaXN0ZW5lcignbWVzc2FnZScsIGZ1bmN0aW9uIGhhbmRsZXIoXG4gICAgICBldmVudFxuICAgICkge1xuICAgICAgY29uc3QgZGF0YSA9IGV2ZW50LmRhdGE7XG4gICAgICBpZiAoZGF0YSAmJiBkYXRhLnNvdXJjZSA9PT0gc1B1c2gpIHtcbiAgICAgICAgY29uc29sZS5sb2coZXZlbnQuZGF0YSk7XG4gICAgICAgIGlmIChjYWxsQmFjaykge1xuICAgICAgICAgIGNhbGxCYWNrKGRhdGEucGF5bG9hZCk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTptZW1iZXItb3JkZXJpbmdcbiAgcHVibGljIGdlbmVyYXRlVG9rZW5Gb3JSZWdpc3RlckRldmljZShzdWJzY3JpcHRpb24pOiB2b2lkIHtcbiAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSgndG9rZW4nLCBKU09OLnN0cmluZ2lmeShzdWJzY3JpcHRpb24pKTtcbiAgICBpZiAoIWxvY2FsU3RvcmFnZS5nZXRJdGVtKCdkZXZpY2VVVUlEJykpIHtcbiAgICAgIHRoaXMuZ2VuZXJhdGVVVUlEKCcnKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5fZGV2VVVJRCA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKCdkZXZpY2VVVUlEJyk7XG4gICAgICBpZiAoIWxvY2FsU3RvcmFnZS5nZXRJdGVtKCdkZXZpY2VJZCcpKSB7XG4gICAgICAgIHRoaXMuX2RldklkID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oJ2RldmljZUlkJyk7XG4gICAgICB9XG4gICAgfVxuICAgIHRoaXMuX3BsYXRmb3JtID0gJyc7XG4gICAgdGhpcy5fZGV2VVVJRCA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKCdkZXZpY2VVVUlEJyk7XG4gICAgdGhpcy5fZGV2SWQgPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgnZGV2aWNlSWQnKTtcblxuICAgIGNvbnN0IHJhd0tleSA9IHN1YnNjcmlwdGlvbi5nZXRLZXkgPyBzdWJzY3JpcHRpb24uZ2V0S2V5KCdwMjU2ZGgnKSA6ICcnO1xuICAgIGNvbnN0IGtleSA9IHJhd0tleVxuICAgICAgPyBidG9hKFN0cmluZy5mcm9tQ2hhckNvZGUuYXBwbHkobnVsbCwgbmV3IFVpbnQ4QXJyYXkocmF3S2V5KSkpXG4gICAgICA6ICcnO1xuICAgIGNvbnN0IHJhd0F1dGhTZWNyZXQgPSBzdWJzY3JpcHRpb24uZ2V0S2V5XG4gICAgICA/IHN1YnNjcmlwdGlvbi5nZXRLZXkoJ2F1dGgnKVxuICAgICAgOiAnJztcbiAgICBjb25zdCBhdXRoU2VjcmV0ID0gcmF3QXV0aFNlY3JldFxuICAgICAgPyBidG9hKFN0cmluZy5mcm9tQ2hhckNvZGUuYXBwbHkobnVsbCwgbmV3IFVpbnQ4QXJyYXkocmF3QXV0aFNlY3JldCkpKVxuICAgICAgOiAnJztcblxuICAgIGNvbnN0IHRva2VuVmFsdWUgPSB7XG4gICAgICBlbmRwb2ludDogc3Vic2NyaXB0aW9uLmVuZHBvaW50LFxuICAgICAgdXNlckF1dGg6IGF1dGhTZWNyZXQsXG4gICAgICB1c2VyUHVibGljS2V5OiBrZXlcbiAgICB9O1xuICAgIHRoaXMuX3Rva2VuID0gSlNPTi5zdHJpbmdpZnkodG9rZW5WYWx1ZSk7XG4gICAgaWYgKG5hdmlnYXRvci51c2VyQWdlbnQuaW5kZXhPZignRmlyZWZveCcpICE9PSAtMSkge1xuICAgICAgdGhpcy5fcGxhdGZvcm0gPSAnRic7IC8vIEZpcmVmb3ggQnJvd3NlclxuICAgIH0gZWxzZSBpZiAobmF2aWdhdG9yLnVzZXJBZ2VudC5pbmRleE9mKCdDaHJvbWUnKSAhPT0gLTEpIHtcbiAgICAgIHRoaXMuX3BsYXRmb3JtID0gJ0MnOyAvLyBDaHJvbWUgQnJvd3NlclxuICAgIH1cblxuICAgIGxldCBkZXZpY2UgPSBudWxsO1xuICAgIGlmICh0aGlzLnZhbGlkYXRlSW5wdXQodGhpcy5fZGV2SWQpKSB7XG4gICAgICBkZXZpY2UgPSB7XG4gICAgICAgIGRldmljZUlkOiB0aGlzLl9kZXZJZCxcbiAgICAgICAgcGxhdGZvcm06IHRoaXMuX3BsYXRmb3JtLFxuICAgICAgICB0b2tlbjogdGhpcy5fdG9rZW4sXG4gICAgICAgIHV1aWQ6IHRoaXMuX2RldlVVSURcbiAgICAgIH07XG4gICAgfSBlbHNlIHtcbiAgICAgIGRldmljZSA9IHtcbiAgICAgICAgcGxhdGZvcm06IHRoaXMuX3BsYXRmb3JtLFxuICAgICAgICB0b2tlbjogdGhpcy5fdG9rZW4sXG4gICAgICAgIHV1aWQ6IHRoaXMuX2RldlVVSURcbiAgICAgIH07XG4gICAgfVxuICAgIHRoaXMucmVnaXN0ZXJEZXZpY2UoZGV2aWNlKTtcbiAgfVxuXG4gIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTptZW1iZXItb3JkZXJpbmdcbiAgcHVibGljIHJlZ2lzdGVyRGV2aWNlKGRldmljZSk6IHZvaWQge1xuICAgIGNvbnNvbGUubG9nKCdEZXZpY2UgZGV0YWlsczonLCBkZXZpY2UpO1xuICAgIGNvbnN0IHhociA9IHRoaXMuc2V0UmVxdWVzdCh0aGlzLmNvbnN0YW50cy5nZXREZXZpY2VzUGF0aCgpLCAnUE9TVCcsIHRydWUpO1xuXG4gICAgLyp0aGlzLmh0dHAucG9zdCh0aGlzLmNvbnN0YW50cy5nZXREZXZpY2VzUGF0aCgpLCBkZXZpY2UpXG4gICAgICAgIC50aGVuKChyZXNwb25zZSkgPT4ge1xuICAgICAgICAgICAgY29uc29sZS5sb2coJ1Jlc3BvbnNlIHJlZ2lzdGVyLCcsIHJlc3BvbnNlKTtcbiAgICAgICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKCdkZXZpY2VJZCcsIHJlc3BvbnNlKTtcbiAgICAgICAgfSk7Ki9cbiAgICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6b25seS1hcnJvdy1mdW5jdGlvbnNcbiAgICB4aHIub25yZWFkeXN0YXRlY2hhbmdlID0gZnVuY3Rpb24oKSB7XG4gICAgICBpZiAoeGhyLnJlYWR5U3RhdGUgPT09IDQgJiYgeGhyLnN0YXR1cyA9PT0gMjAwKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKCdSZXNwb25zZSByZWdpc3RlciwnLCB4aHIpO1xuICAgICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSgnZGV2aWNlSWQnLCB4aHIucmVzcG9uc2VUZXh0KTtcbiAgICAgIH1cbiAgICB9O1xuICAgIHhoci5zZW5kKEpTT04uc3RyaW5naWZ5KGRldmljZSkpO1xuICB9XG5cbiAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOm1lbWJlci1vcmRlcmluZ1xuICBwdWJsaWMgdW5SZWdpc3RlckRldmljZSgpOiBQcm9taXNlPGFueT4ge1xuICAgIGNvbnN0IHByb21pc2UgPSBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICB0aGlzLl9kZXZJZCA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKCdkZXZpY2VJZCcpO1xuICAgICAgY29uc3QgZ2xvYmFsID0gdGhpcztcbiAgICAgIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTpvbmx5LWFycm93LWZ1bmN0aW9uc1xuICAgICAgbmF2aWdhdG9yLnNlcnZpY2VXb3JrZXIucmVhZHlcbiAgICAgICAgLnRoZW4oZnVuY3Rpb24ocmVnaXN0cmF0aW9uKSB7XG4gICAgICAgICAgcmVnaXN0cmF0aW9uXG4gICAgICAgICAgICAudW5yZWdpc3RlcigpXG4gICAgICAgICAgICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6b25seS1hcnJvdy1mdW5jdGlvbnNcbiAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKGNoZWNrVW5yZWdpc3Rlcikge1xuICAgICAgICAgICAgICBpZiAoIWNoZWNrVW5yZWdpc3Rlcikge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCd1bnJlZ2lzdGVyIGZhaWxlZCcpO1xuICAgICAgICAgICAgICAgIHJlc29sdmUoKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBnbG9iYWxcbiAgICAgICAgICAgICAgICAudW5zdWJzY3JpYmVEZXZpY2UoZ2xvYmFsLl9kZXZJZCwgZ2xvYmFsKVxuICAgICAgICAgICAgICAgIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTpvbmx5LWFycm93LWZ1bmN0aW9uc1xuICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgcmVzb2x2ZSgpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pXG4gICAgICAgIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTpvbmx5LWFycm93LWZ1bmN0aW9uc1xuICAgICAgICAuY2F0Y2goZnVuY3Rpb24oZXJyb3IpIHtcbiAgICAgICAgICBjb25zb2xlLmxvZygnUmVnaXN0cmF0aW9uIGZhaWxlZCB3aXRoICcgKyBlcnJvcik7XG4gICAgICAgICAgcmVzb2x2ZSgpO1xuICAgICAgICB9KTtcbiAgICB9KTtcbiAgICByZXR1cm4gcHJvbWlzZTtcbiAgfVxuXG4gIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTptZW1iZXItb3JkZXJpbmdcbiAgcHVibGljIHVuc3Vic2NyaWJlRGV2aWNlKGRldmljZUlELCBnbG9iYWwpOiBQcm9taXNlPGFueT4ge1xuICAgIGNvbnN0IHByb21pc2UgPSBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICBjb25zdCBkZXZpY2VJZCA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKCdkZXZpY2VJZCcpO1xuICAgICAgY29uc3QgZGV2aWNlID0ge1xuICAgICAgICBkZXZpY2VzOiB7XG4gICAgICAgICAgZGV2aWNlSWQ6IGdsb2JhbC5fZGV2SWQsXG4gICAgICAgICAgcGxhdGZvcm06IGdsb2JhbC5fcGxhdGZvcm0sXG4gICAgICAgICAgdG9rZW46IGdsb2JhbC5fdG9rZW4sXG4gICAgICAgICAgdXVpZDogZ2xvYmFsLl9kZXZVVUlEXG4gICAgICAgIH1cbiAgICAgIH07XG4gICAgICBpZiAoZGV2aWNlSUQpIHtcbiAgICAgICAgY29uc3QgeGhyID0gZ2xvYmFsLnNldFJlcXVlc3QoXG4gICAgICAgICAgZ2xvYmFsLmNvbnN0YW50cy5nZXREZXZpY2VzUGF0aCgpICsgJy8nICsgZGV2aWNlSUQsXG4gICAgICAgICAgJ0RFTEVURScsXG4gICAgICAgICAgdHJ1ZVxuICAgICAgICApO1xuICAgICAgICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6b25seS1hcnJvdy1mdW5jdGlvbnNcbiAgICAgICAgeGhyLm9ucmVhZHlzdGF0ZWNoYW5nZSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgIGlmICh4aHIucmVhZHlTdGF0ZSA9PT0gNCAmJiB4aHIuc3RhdHVzID09PSAyMDApIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdUaGUgcmVzcG9uc2UgaXMgLCcsIHhocik7XG4gICAgICAgICAgICBjb25zb2xlLmxvZygnU3VjY2Vzc2Z1bGx5IHVucmVnaXN0ZXJlZCB0aGUgZGV2aWNlJyk7XG4gICAgICAgICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSgnZGV2aWNlVVVJRCcsICcnKTtcbiAgICAgICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKCdkZXZpY2VJZCcsICcnKTtcbiAgICAgICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKCd0b2tlbicsICcnKTtcbiAgICAgICAgICAgIHJlc29sdmUoKTtcbiAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIHhoci5zZW5kKEpTT04uc3RyaW5naWZ5KGRldmljZSkpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmVzb2x2ZSgpO1xuICAgICAgfVxuICAgIH0pO1xuICAgIHJldHVybiBwcm9taXNlO1xuICB9XG5cbiAgcHJpdmF0ZSBzZXRSZXF1ZXN0KHVybCwgbWV0aG9kLCBhc3luY1ApIHtcbiAgICBsZXQgeGhyID0gbmV3IFhNTEh0dHBSZXF1ZXN0KCk7XG4gICAgeGhyLm9wZW4obWV0aG9kLCB1cmwsIGFzeW5jUCk7XG4gICAgeGhyID0gdGhpcy5zZXRIZWFkZXJzKHhociwgbWV0aG9kKTtcbiAgICByZXR1cm4geGhyO1xuICB9XG5cbiAgcHJpdmF0ZSBzZXRIZWFkZXJzKHhociwgbWV0aG9kKSB7XG4gICAgeGhyLnNldFJlcXVlc3RIZWFkZXIoJ0FjY2VwdCcsICdhcHBsaWNhdGlvbi9qc29uJyk7XG4gICAgeGhyLnNldFJlcXVlc3RIZWFkZXIoJ3gtaWJtLWNsaWVudC1pZCcsIHRoaXMuY29uc3RhbnRzLmdldENsaWVudElkKCkpO1xuICAgIHhoci5zZXRSZXF1ZXN0SGVhZGVyKCdBcHAtQ29kZScsIHRoaXMuY29uc3RhbnRzLmdldEFwcENvZGUoKSk7XG4gICAgeGhyLnNldFJlcXVlc3RIZWFkZXIoJ0FjY2VwdC1MYW5ndWFnZScsIHRoaXMuY29uc3RhbnRzLmdldEFwcExhbmd1YWdlKCkpO1xuICAgIHhoci5zZXRSZXF1ZXN0SGVhZGVyKCdBdXRob3JpemF0aW9uJywgdGhpcy5jb25zdGFudHMuZ2V0QXV0aFRva2VuKCkpO1xuICAgIHhoci5zZXRSZXF1ZXN0SGVhZGVyKCdqd3QnLCB0aGlzLmNvbnN0YW50cy5nZXRKd3QoKSk7XG4gICAgeGhyLnRpbWVvdXQgPSAzMDAwO1xuXG4gICAgaWYgKG1ldGhvZCA9PT0gJ1BPU1QnIHx8IG1ldGhvZCA9PT0gJ1BVVCcpIHtcbiAgICAgIHhoci5zZXRSZXF1ZXN0SGVhZGVyKCdDb250ZW50LVR5cGUnLCAnYXBwbGljYXRpb24vanNvbjsgY2hhcnNldD1VVEYtOCcpO1xuICAgIH1cblxuICAgIHJldHVybiB4aHI7XG4gIH1cblxuICBwcml2YXRlIGdlbmVyYXRlVVVJRCh0b2tlbik6IHN0cmluZyB7XG4gICAgbGV0IGRhdGVUaW1lID0gbmV3IERhdGUoKS5nZXRUaW1lKCk7XG4gICAgaWYgKHdpbmRvdy5wZXJmb3JtYW5jZSAmJiB0eXBlb2Ygd2luZG93LnBlcmZvcm1hbmNlLm5vdyA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgZGF0ZVRpbWUgKz0gcGVyZm9ybWFuY2Uubm93KCk7IC8vIHVzZSBoaWdoLXByZWNpc2lvbiB0aW1lciBpZiBhdmFpbGFibGVcbiAgICB9XG5cbiAgICBjb25zdCBob3N0bmFtZSA9IHdpbmRvdy5sb2NhdGlvbi5ob3N0bmFtZTtcbiAgICBjb25zdCBhcnJheURhdGEgPSBbXTtcbiAgICBhcnJheURhdGEucHVzaCh0aGlzLmhhc2hDb2RlKGRhdGVUaW1lKSk7XG4gICAgYXJyYXlEYXRhLnB1c2godGhpcy5oYXNoQ29kZSh0b2tlbikpO1xuICAgIGFycmF5RGF0YS5wdXNoKHRoaXMuaGFzaENvZGUoaG9zdG5hbWUpKTtcbiAgICBhcnJheURhdGEucHVzaCh0aGlzLmhhc2hDb2RlKHRoaXMuX3BsYXRmb3JtKSk7XG5cbiAgICBjb25zdCBmaW5hbFN0cmluZyA9IGFycmF5RGF0YVxuICAgICAgLmpvaW4oJycpXG4gICAgICAucmVwbGFjZSgvWy0uXS9nLCAnJylcbiAgICAgIC5yZXBsYWNlKC9bLC5dL2csICcnKTtcbiAgICBsZXQgdXVpZCA9ICcnO1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgMzI7IGkrKykge1xuICAgICAgdXVpZCArPSBmaW5hbFN0cmluZy5jaGFyQXQoXG4gICAgICAgIE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIGZpbmFsU3RyaW5nLmxlbmd0aClcbiAgICAgICk7XG4gICAgfVxuICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKCdkZXZpY2VVVUlEJywgdXVpZCk7XG4gICAgdGhpcy5fZGV2VVVJRCA9IHV1aWQ7XG4gICAgcmV0dXJuIHRoaXMuX2RldlVVSUQ7XG4gIH1cblxuICBwcml2YXRlIGhhc2hDb2RlKHN0cik6IG51bWJlciB7XG4gICAgbGV0IGhhc2ggPSAwO1xuICAgIGxldCBpO1xuICAgIGxldCBjaHI7XG4gICAgbGV0IGxlbjtcbiAgICBpZiAoc3RyLmxlbmd0aCA9PT0gMCkge1xuICAgICAgcmV0dXJuIGhhc2g7XG4gICAgfVxuICAgIGZvciAoaSA9IDAsIGxlbiA9IHN0ci5sZW5ndGg7IGkgPCBsZW47IGkrKykge1xuICAgICAgY2hyID0gc3RyLmNoYXJDb2RlQXQoaSk7XG4gICAgICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6bm8tYml0d2lzZVxuICAgICAgaGFzaCA9IChoYXNoIDw8IDUpIC0gaGFzaCArIGNocjtcbiAgICAgIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTpuby1iaXR3aXNlXG4gICAgICBoYXNoIHw9IDA7IC8vIENvbnZlcnQgdG8gMzJiaXQgaW50ZWdlclxuICAgIH1cbiAgICByZXR1cm4gaGFzaDtcbiAgfVxuXG4gIHByaXZhdGUgdmFsaWRhdGVJbnB1dChzdHJpbmdWYWx1ZSkge1xuICAgIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTptYXgtbGluZS1sZW5ndGhcbiAgICByZXR1cm4gc3RyaW5nVmFsdWUgPT09IHVuZGVmaW5lZCB8fFxuICAgICAgc3RyaW5nVmFsdWUgPT0gbnVsbCB8fFxuICAgICAgc3RyaW5nVmFsdWUubGVuZ3RoIDw9IDAgfHxcbiAgICAgIHN0cmluZ1ZhbHVlID09PSAnJ1xuICAgICAgPyBmYWxzZVxuICAgICAgOiB0cnVlO1xuICB9XG5cbiAgcHJpdmF0ZSB1cmxCNjRUb1VpbnQ4QXJyYXkoYmFzZTY0U3RyaW5nKSB7XG4gICAgY29uc3QgcGFkZGluZyA9ICc9Jy5yZXBlYXQoKDQgLSAoYmFzZTY0U3RyaW5nLmxlbmd0aCAlIDQpKSAlIDQpO1xuICAgIGNvbnN0IGJhc2U2NCA9IChiYXNlNjRTdHJpbmcgKyBwYWRkaW5nKVxuICAgICAgLnJlcGxhY2UoL1xcLS9nLCAnKycpXG4gICAgICAucmVwbGFjZSgvXy9nLCAnLycpO1xuXG4gICAgY29uc3QgcmF3RGF0YSA9IHdpbmRvdy5hdG9iKGJhc2U2NCk7XG4gICAgY29uc3Qgb3V0cHV0QXJyYXkgPSBuZXcgVWludDhBcnJheShyYXdEYXRhLmxlbmd0aCk7XG5cbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHJhd0RhdGEubGVuZ3RoOyArK2kpIHtcbiAgICAgIG91dHB1dEFycmF5W2ldID0gcmF3RGF0YS5jaGFyQ29kZUF0KGkpO1xuICAgIH1cbiAgICByZXR1cm4gb3V0cHV0QXJyYXk7XG4gIH1cbn1cbiJdfQ==
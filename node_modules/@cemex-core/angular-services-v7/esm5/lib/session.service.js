/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { Inject, Injectable, Optional } from '@angular/core';
import { Headers, RequestOptions, Response } from '@angular/http';
import { BehaviorSubject, Observable, throwError } from 'rxjs';
import { map, catchError } from 'rxjs/operators';
import { SessionServiceConstants } from '@cemex-core/constants-v2/dist';
import { Broadcaster } from '@cemex-core/events-v7';
import { HttpCemex } from './http.service';
var SessionService = /** @class */ (function () {
    function SessionService(http, eventBroadcaster, authTokenVersion) {
        this.http = http;
        this.eventBroadcaster = eventBroadcaster;
        this.authTokenVersion = authTokenVersion;
        this.siteDomain = 'SITE_DOMAIN';
        this._siteDomain = window[this.siteDomain] || '';
        this._menuApplication = new BehaviorSubject([]);
        this._currentLegalEntity = new BehaviorSubject(null);
        this._userProfile = null;
        this._beforeLogout = null;
        if (authTokenVersion) {
            switch (authTokenVersion.toLocaleLowerCase()) {
                case 'v6':
                    this._endpoint = SessionServiceConstants.LOGIN_TOKEN_V6;
                    break;
                default:
                    this._endpoint = SessionServiceConstants.LOGIN_TOKEN_DEFAULT;
            }
        }
        else {
            this._endpoint = SessionServiceConstants.LOGIN_TOKEN_DEFAULT;
        }
        if (localStorage.getItem('language') === undefined ||
            (localStorage.getItem('language') === null &&
                (sessionStorage.getItem('language') !== undefined && sessionStorage.getItem('language') !== null))) {
            localStorage.setItem('language', sessionStorage.getItem('language'));
        }
    }
    Object.defineProperty(SessionService.prototype, "menuApplicationItems", {
        get: /**
         * @return {?}
         */
        function () {
            if (this._menuApplication.getValue().length === 0) {
                this.reloadAppMenuItems();
            }
            return this._menuApplication.asObservable();
        },
        enumerable: true,
        configurable: true
    });
    /**
     * @param {?} value
     * @return {?}
     */
    SessionService.prototype.setLegalEntity = /**
     * @param {?} value
     * @return {?}
     */
    function (value) {
        sessionStorage.setItem('user_legal_entity', JSON.stringify(value));
        this.eventBroadcaster.broadcast(Broadcaster.DCM_LEGAL_ENTITY_CHANGE, JSON.stringify(value));
        this._currentLegalEntity.next(value);
    };
    Object.defineProperty(SessionService.prototype, "currentLegalEntity", {
        get: /**
         * @return {?}
         */
        function () {
            return this._currentLegalEntity.asObservable();
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(SessionService.prototype, "isLoggedIn", {
        get: /**
         * @return {?}
         */
        function () {
            /** @type {?} */
            var accessToken = sessionStorage.getItem('access_token');
            /** @type {?} */
            var jwtToken = sessionStorage.getItem('jwt');
            return (accessToken !== null &&
                accessToken !== undefined &&
                accessToken !== '' &&
                jwtToken != null &&
                jwtToken !== undefined &&
                jwtToken !== '');
        },
        enumerable: true,
        configurable: true
    });
    /**
     * @return {?}
     */
    SessionService.prototype.logout = /**
     * @return {?}
     */
    function () {
        var _this = this;
        return new Observable((/**
         * @param {?} observer
         * @return {?}
         */
        function (observer) {
            if (_this._beforeLogout) {
                _this._beforeLogout.subscribe((/**
                 * @param {?} result
                 * @return {?}
                 */
                function (result) {
                    _this.logoutApp();
                    observer.next({
                        message: 'success',
                        success: true
                    });
                }), (/**
                 * @param {?} error
                 * @return {?}
                 */
                function (error) {
                    observer.next({
                        message: error,
                        success: false
                    });
                }));
            }
            else {
                _this.logoutApp();
                observer.next({
                    message: 'success',
                    success: true
                });
            }
            return observer;
        }));
    };
    /**
     * @param {?} user
     * @param {?} password
     * @param {?=} generateCookie
     * @param {?=} appName
     * @param {?=} validateTempPassword
     * @return {?}
     */
    SessionService.prototype.login = /**
     * @param {?} user
     * @param {?} password
     * @param {?=} generateCookie
     * @param {?=} appName
     * @param {?=} validateTempPassword
     * @return {?}
     */
    function (user, password, generateCookie, appName, validateTempPassword) {
        var _this = this;
        this.clean();
        /** @type {?} */
        var options = new RequestOptions({
            headers: new Headers({
                'Content-Type': 'application/x-www-form-urlencoded',
                accept: 'text/plain, */*'
            })
        });
        /** @type {?} */
        var endpoint = this.http.generateEndpoint(this._endpoint);
        /** @type {?} */
        var urlPost = this.generateUrlString(user, password, appName);
        return this.http
            .post(endpoint, urlPost, options)
            .toPromise()
            .then((/**
         * @param {?} response
         * @return {?}
         */
        function (response) { return tslib_1.__awaiter(_this, void 0, void 0, function () {
            var data, userId;
            return tslib_1.__generator(this, function (_a) {
                data = response.json();
                userId = this.authTokenVersion === 'v6'
                    ? data.userId
                        ? data.userId
                        : data.profile.userId
                    : data.profile.userId;
                this.processDataFromLogin(data, generateCookie);
                this.eventBroadcaster.broadcast(SessionService.LOGIN_SUCCESS_EVENT);
                if (validateTempPassword &&
                    data.profile &&
                    data.profile.hasTemporaryPassword) {
                    return [2 /*return*/, Promise.resolve(data)];
                }
                return [2 /*return*/];
            });
        }); }))
            .catch((/**
         * @param {?} error
         * @return {?}
         */
        function (error) {
            console.error(error);
            _this.eventBroadcaster.broadcast(SessionService.LOGIN_FAIL_EVENT);
            return Promise.reject(error);
        }));
    };
    Object.defineProperty(SessionService.prototype, "userRegion", {
        get: /**
         * @return {?}
         */
        function () {
            return sessionStorage.getItem('region') || 'US';
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(SessionService.prototype, "userCountry", {
        get: /**
         * @return {?}
         */
        function () {
            return sessionStorage.getItem('country') || '';
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(SessionService.prototype, "userProfile", {
        get: /**
         * @return {?}
         */
        function () {
            if (!this._userProfile) {
                this.setUserProfile();
            }
            return this._userProfile;
        },
        enumerable: true,
        configurable: true
    });
    /**
     * @param {?=} fetch
     * @param {?=} page
     * @param {?=} legalEntityCode
     * @return {?}
     */
    SessionService.prototype.getLegalEntities = /**
     * @param {?=} fetch
     * @param {?=} page
     * @param {?=} legalEntityCode
     * @return {?}
     */
    function (fetch, page, legalEntityCode) {
        var _this = this;
        /** @type {?} */
        var endpoint = this.http.generateEndpoint(SessionServiceConstants.USER_LEGAL_ENTITIES);
        endpoint = this.addQueryParams(endpoint, fetch, page, legalEntityCode);
        return this.http.get(endpoint).pipe(map((/**
         * @param {?} response
         * @return {?}
         */
        function (response) {
            /** @type {?} */
            var responseMap = [];
            /** @type {?} */
            var tmpJson = response.json();
            if (tmpJson) {
                responseMap = response.json();
            }
            return responseMap;
        })), catchError((/**
         * @param {?} e
         * @return {?}
         */
        function (e) { return Observable.throw(_this.handleError(e)); })));
    };
    /**
     * @param {?} method
     * @return {?}
     */
    SessionService.prototype.setBeforeLogout = /**
     * @param {?} method
     * @return {?}
     */
    function (method) {
        this._beforeLogout = method;
    };
    /**
     * @return {?}
     */
    SessionService.prototype.getBeforeLogout = /**
     * @return {?}
     */
    function () {
        return this._beforeLogout;
    };
    /**
     * @return {?}
     */
    SessionService.prototype.reloadAppMenuItems = /**
     * @return {?}
     */
    function () {
        var _this = this;
        this.getDCMApplications().subscribe((/**
         * @param {?} result
         * @return {?}
         */
        function (result) {
            _this._menuApplication.next(result);
        }));
    };
    /**
     * @param {?} name
     * @param {?} value
     * @param {?=} days
     * @return {?}
     */
    SessionService.prototype.createCookie = /**
     * @param {?} name
     * @param {?} value
     * @param {?=} days
     * @return {?}
     */
    function (name, value, days) {
        /** @type {?} */
        var expires = '';
        if (days) {
            /** @type {?} */
            var date = new Date();
            date.setTime(date.getTime() + days * 24 * 60 * 60 * 1000);
            expires = date.toUTCString();
        }
        else {
            days = 0;
        }
        /** @type {?} */
        var cookie = name + "=" + value + ";expires=" + expires + ";domain=" + this._siteDomain + ";path=/";
        document.cookie = cookie;
    };
    /**
     * @param {?} name
     * @return {?}
     */
    SessionService.prototype.readCookie = /**
     * @param {?} name
     * @return {?}
     */
    function (name) {
        /** @type {?} */
        var ca = document.cookie.split(';');
        /** @type {?} */
        var caLen = ca.length;
        /** @type {?} */
        var cookieName = name + "=";
        /** @type {?} */
        var c;
        for (var i = 0; i < caLen; i += 1) {
            c = ca[i].replace(/^\s+/g, '');
            if (c.indexOf(cookieName) === 0) {
                return c.substring(cookieName.length, c.length);
            }
        }
        return null;
    };
    /**
     * @param {?} name
     * @return {?}
     */
    SessionService.prototype.clearCookie = /**
     * @param {?} name
     * @return {?}
     */
    function (name) {
        this.createCookie(name, '', -1);
    };
    /**
     * @return {?}
     */
    SessionService.prototype.setUserProfile = /**
     * @return {?}
     */
    function () {
        /** @type {?} */
        var strProfile = sessionStorage.getItem('user_profile');
        /** @type {?} */
        var tmpProfile = this.convertJsonTo(strProfile);
        if (tmpProfile) {
            /** @type {?} */
            var strCustomer = sessionStorage.getItem('user_customer');
            /** @type {?} */
            var userCustomer = this.convertJsonTo(strCustomer);
            if (userCustomer) {
                tmpProfile.customer = userCustomer;
            }
            else {
                console.warn('Exception at parsing User Customer from sessionStore');
            }
            this._userProfile = tmpProfile;
        }
        else {
            console.warn('Exception at parsing User Profile from sessionStore');
        }
    };
    /**
     * @return {?}
     */
    SessionService.prototype.clean = /**
     * @return {?}
     */
    function () {
        this.clearCookie('CemexGoRegion');
        this.clearCookie('up_session');
        sessionStorage.removeItem('access_token');
        sessionStorage.removeItem('refresh_token');
        sessionStorage.removeItem('expires_in');
        sessionStorage.removeItem('jwt');
        sessionStorage.removeItem('region');
        sessionStorage.removeItem('user_profile');
        sessionStorage.removeItem('user_customer');
        sessionStorage.removeItem('user_legal_entity');
        sessionStorage.removeItem('user_applications');
        // patch-fix for react
        sessionStorage.removeItem('auth_token');
        sessionStorage.removeItem('userInfo');
        sessionStorage.removeItem('country');
        sessionStorage.removeItem('token_data');
        sessionStorage.removeItem('applications');
        sessionStorage.removeItem('role');
        sessionStorage.removeItem('username');
        // new verssion API ( v6 )
        sessionStorage.removeItem('userAuthV6');
        sessionStorage.removeItem('userInfoV6');
        sessionStorage.removeItem('userProfileV6');
        sessionStorage.removeItem('userCustomerV6');
        sessionStorage.removeItem('userApplicationsV6');
        sessionStorage.removeItem('userRolesV6');
    };
    /**
     * @param {?} user
     * @param {?} password
     * @param {?=} appName
     * @return {?}
     */
    SessionService.prototype.generateUrlString = /**
     * @param {?} user
     * @param {?} password
     * @param {?=} appName
     * @return {?}
     */
    function (user, password, appName) {
        /** @type {?} */
        var include = '&include=userinfo,profile,applications,roles,customers,oldVersion';
        /** @type {?} */
        var url = 'grant_type=password&scope=security&username=' +
            user +
            '&password=' +
            encodeURIComponent(password) +
            '&client_id=' +
            this.http.clientId;
        if (appName) {
            url = url + '&app_name=' + appName;
        }
        if (this.authTokenVersion) {
            if (this.authTokenVersion.toLowerCase() === 'v6') {
                url = url + "&userinformation=false" + include;
            }
        }
        return url;
    };
    /**
     * @param {?} data
     * @param {?=} generateCookie
     * @return {?}
     */
    SessionService.prototype.processDataFromLogin = /**
     * @param {?} data
     * @param {?=} generateCookie
     * @return {?}
     */
    function (data, generateCookie) {
        // session cookie
        if (generateCookie) {
            /** @type {?} */
            var sessionCookie = {
                auth: data.oauth2.access_token,
                expires_in: data.oauth2.expires_in,
                jwt: data.jwt,
                refresh_token: data.oauth2.refresh_token,
                region: data.oauth2.region,
            };
            this.createCookie('up_session', JSON.stringify(sessionCookie), null);
        }
        this.createCookie('CemexGoRegion', data.oauth2.region, null);
        sessionStorage.setItem('access_token', data.oauth2.access_token);
        sessionStorage.setItem('refresh_token', data.oauth2.refresh_token);
        sessionStorage.setItem('expires_in', data.oauth2.expires_in);
        sessionStorage.setItem('jwt', data.jwt);
        sessionStorage.setItem('auth_token', data.oauth2.access_token);
        sessionStorage.setItem('user_profile', JSON.stringify(data.profile));
        sessionStorage.setItem('user_customer', JSON.stringify(data.customer));
        sessionStorage.setItem('user_applications', JSON.stringify(data.applications));
        // react
        sessionStorage.setItem('userInfo', JSON.stringify(data));
        sessionStorage.setItem('country', data.country);
        sessionStorage.setItem('token_data', JSON.stringify(data));
        sessionStorage.setItem('applications', JSON.stringify(data.applications));
        sessionStorage.setItem('region', data.oauth2.region);
        sessionStorage.setItem('role', data.role);
        sessionStorage.setItem('username', data.profile.userAccount);
        this.setUserProfile();
        // call API V6 ( New Model)
        /** @type {?} */
        var accessToKen = {
            oauth2: data.oauth2,
            // tslint:disable-next-line:object-literal-sort-keys
            jwt: data.jwt,
            userId: data.userId ? data.userId : data.profile.userId,
        };
        /** @type {?} */
        var encryptData = this.encrypt(JSON.stringify(accessToKen));
        sessionStorage.setItem('userAuthV6', encryptData);
        if (data._users) {
            /** @type {?} */
            var firstUser = data._users[0];
            /** @type {?} */
            var user = {
                accountType: firstUser.accountType,
                countryCode: firstUser.country.countryCode,
                customerId: (firstUser.customer) ? firstUser.customer.customerId : 0,
                firstName: firstUser.firstName,
                fullName: firstUser.fullName,
                lastName: firstUser.lastName,
                phoneNumber: firstUser.phoneNumber,
                userAccount: firstUser.userAccount,
                userId: firstUser.userId,
                userSelectedId: firstUser.userSelectedId,
                userStatus: firstUser.userStatus,
                userType: firstUser.userType,
            };
            /** @type {?} */
            var encryptUser = this.encrypt(JSON.stringify(user));
            sessionStorage.setItem('userInfoV6', encryptUser);
        }
        if (data._profile) {
            /** @type {?} */
            var dataProfile = data._profile;
            /** @type {?} */
            var profile = {
                allowEmailUpdates: dataProfile.allowEmailUpdates,
                allowInformationShare: dataProfile.allowInformationShare,
                hasTemporaryPassword: dataProfile.hasTemporaryPassword,
                userEmail: dataProfile.userEmail,
                userId: dataProfile.userId,
                userPosition: dataProfile.userPosition,
                userProfileId: dataProfile.userProfileId,
            };
            /** @type {?} */
            var encryptProfile = this.encrypt(JSON.stringify(profile));
            sessionStorage.setItem('userProfileV6', encryptProfile);
        }
        if (data._customers) {
            /** @type {?} */
            var dataCustomer = data._customers;
            /** @type {?} */
            var customer = {
                countryCode: dataCustomer.country.countryCode,
                customerCode: dataCustomer.customerCode,
                customerCodeLZR: dataCustomer.customerCodeLZR,
                customerDesc: dataCustomer.customerDesc,
                customerDesc2: dataCustomer.customerDesc2,
                customerId: dataCustomer.customerId,
                email: dataCustomer.email,
                faxNumber: dataCustomer.faxNumber,
                phoneNumber: dataCustomer.phoneNumber,
                regionId: dataCustomer.region.regionId,
                vAT: dataCustomer.vAT,
            };
            /** @type {?} */
            var encryptcustomer = this.encrypt(JSON.stringify(customer));
            sessionStorage.setItem('userCustomerV6', encryptcustomer);
        }
        if (data._applications) {
            /** @type {?} */
            var apps = data._applications.map((/**
             * @param {?} app
             * @return {?}
             */
            function (app) {
                return {
                    applicationCode: app.applicationCode,
                    applicationId: app.applicationId,
                    applicationType: app.applicationType,
                    isVisible: app.isVisible,
                };
            }));
            /** @type {?} */
            var encryptApplications = this.encrypt(JSON.stringify(apps));
            sessionStorage.setItem('userApplicationsV6', encryptApplications);
        }
        if (data._roles) {
            /** @type {?} */
            var roles = data._roles.map((/**
             * @param {?} role
             * @return {?}
             */
            function (role) {
                return {
                    applicationId: role.application.applicationId,
                    isInternal: role.isInternal,
                    isOptional: role.isOptional,
                    isVisible: role.isVisible,
                    roleCode: role.roleCode,
                    roleId: role.roleId,
                    roleType: role.roleType,
                };
            }));
            /** @type {?} */
            var encryptRoles = this.encrypt(JSON.stringify(roles));
            sessionStorage.setItem('userRolesV6', encryptRoles);
        }
    };
    /**
     * @return {?}
     */
    SessionService.prototype.getDCMApplications = /**
     * @return {?}
     */
    function () {
        var _this = this;
        /** @type {?} */
        var endpoint = this.http.generateEndpoint(SessionServiceConstants.USER_APPLICATION_MENU);
        return this.http.get(endpoint).pipe(map((/**
         * @param {?} response
         * @return {?}
         */
        function (response) {
            /** @type {?} */
            var tmpJson = response.json();
            if (!tmpJson || tmpJson === undefined) {
                console.warn('Configuration of menu application is empty!!');
                return [];
            }
            /** @type {?} */
            var responseMap = (/** @type {?} */ (response.json()));
            return responseMap;
        })), catchError((/**
         * @param {?} e
         * @return {?}
         */
        function (e) { return Observable.throw(_this.handleError(e)); })));
    };
    /**
     * @template T
     * @param {?} obj
     * @return {?}
     */
    SessionService.prototype.convertJsonTo = /**
     * @template T
     * @param {?} obj
     * @return {?}
     */
    function (obj) {
        try {
            /** @type {?} */
            var tmpJson = JSON.parse(obj);
            return (/** @type {?} */ (tmpJson));
        }
        catch (e) {
            console.warn('Exception at parsing object from sessionStore:', e);
        }
        return null;
    };
    Object.defineProperty(SessionService.prototype, "customer", {
        get: /**
         * @return {?}
         */
        function () {
            /** @type {?} */
            var result;
            /** @type {?} */
            var str = sessionStorage.getItem('user_customer');
            if (str) {
                try {
                    /** @type {?} */
                    var profile = JSON.parse(str);
                    result = (/** @type {?} */ (profile));
                }
                catch (e) {
                    console.warn('Exception at parsing user_customer from sessionStore:', e);
                    return null;
                }
            }
            else {
                console.warn('There is no user customer at session storage');
            }
            return result;
        },
        enumerable: true,
        configurable: true
    });
    /**
     * @param {?} error
     * @return {?}
     */
    SessionService.prototype.handleError = /**
     * @param {?} error
     * @return {?}
     */
    function (error) {
        // In a real world app, we might use a remote logging infrastructure
        /** @type {?} */
        var errMsg;
        if (error instanceof Response) {
            /** @type {?} */
            var body = error.json() || '';
            errMsg = error.status + " - " + (error.statusText || '');
        }
        else {
            errMsg = error.message ? error.message : error.toString();
        }
        console.error(error);
        return throwError(error);
    };
    /**
     * @param {?} endpoint
     * @param {?=} fetch
     * @param {?=} page
     * @param {?=} legalEntityCode
     * @return {?}
     */
    SessionService.prototype.addQueryParams = /**
     * @param {?} endpoint
     * @param {?=} fetch
     * @param {?=} page
     * @param {?=} legalEntityCode
     * @return {?}
     */
    function (endpoint, fetch, page, legalEntityCode) {
        /** @type {?} */
        var validPagination = Number.isInteger(fetch) && Number.isInteger(page);
        endpoint += validPagination ? '?fetch=' + fetch + '&page=' + page : '';
        endpoint +=
            legalEntityCode && validPagination
                ? '&legalEntityCode=' + legalEntityCode
                : legalEntityCode && !validPagination
                    ? '?legalEntityCode=' + legalEntityCode
                    : '';
        return endpoint;
    };
    /**
     * @return {?}
     */
    SessionService.prototype.logoutApp = /**
     * @return {?}
     */
    function () {
        this.clean();
        this.eventBroadcaster.broadcast(Broadcaster.DCM_APP_LOGOUT);
    };
    Object.defineProperty(SessionService.prototype, "userAuth", {
        get: /**
         * @return {?}
         */
        function () {
            return JSON.parse(this.decrypt(sessionStorage.getItem('userAuthV6')));
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(SessionService.prototype, "userInfo", {
        get: /**
         * @return {?}
         */
        function () {
            return JSON.parse(this.decrypt(sessionStorage.getItem('userInfoV6')));
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(SessionService.prototype, "userProfileV6", {
        get: /**
         * @return {?}
         */
        function () {
            return JSON.parse(this.decrypt(sessionStorage.getItem('userProfileV6')));
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(SessionService.prototype, "userCustomer", {
        get: /**
         * @return {?}
         */
        function () {
            return JSON.parse(this.decrypt(sessionStorage.getItem('userCustomerV6')));
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(SessionService.prototype, "userApplications", {
        get: /**
         * @return {?}
         */
        function () {
            return JSON.parse(this.decrypt(sessionStorage.getItem('userApplicationsV6')));
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(SessionService.prototype, "userRoles", {
        get: /**
         * @return {?}
         */
        function () {
            return JSON.parse(this.decrypt(sessionStorage.getItem('userRolesV6')));
        },
        enumerable: true,
        configurable: true
    });
    /**
     * @param {?} str
     * @return {?}
     */
    SessionService.prototype.encrypt = /**
     * @param {?} str
     * @return {?}
     */
    function (str) {
        return window.btoa(unescape(encodeURIComponent(str)));
    };
    /**
     * @param {?} str
     * @return {?}
     */
    SessionService.prototype.decrypt = /**
     * @param {?} str
     * @return {?}
     */
    function (str) {
        return str ? decodeURIComponent(escape(window.atob(str))) : str;
    };
    SessionService.LOGIN_SUCCESS_EVENT = 'LOGIN_SUCCESS_EVENT';
    SessionService.LOGIN_FAIL_EVENT = 'LOGIN_FAIL_EVENT';
    SessionService.LOGIN_LOGOUT_EVENT = 'LOGIN_LOGOUT_EVENT';
    SessionService.AUTH_TOKEN_VERSION = 'auth_token_version';
    SessionService.decorators = [
        { type: Injectable }
    ];
    /** @nocollapse */
    SessionService.ctorParameters = function () { return [
        { type: HttpCemex },
        { type: Broadcaster },
        { type: String, decorators: [{ type: Inject, args: [SessionService.AUTH_TOKEN_VERSION,] }, { type: Optional }] }
    ]; };
    return SessionService;
}());
export { SessionService };
if (false) {
    /** @type {?} */
    SessionService.LOGIN_SUCCESS_EVENT;
    /** @type {?} */
    SessionService.LOGIN_FAIL_EVENT;
    /** @type {?} */
    SessionService.LOGIN_LOGOUT_EVENT;
    /** @type {?} */
    SessionService.AUTH_TOKEN_VERSION;
    /**
     * @type {?}
     * @private
     */
    SessionService.prototype.siteDomain;
    /**
     * @type {?}
     * @private
     */
    SessionService.prototype._siteDomain;
    /**
     * @type {?}
     * @private
     */
    SessionService.prototype._endpoint;
    /**
     * @type {?}
     * @private
     */
    SessionService.prototype._menuApplication;
    /**
     * @type {?}
     * @private
     */
    SessionService.prototype._currentLegalEntity;
    /**
     * @type {?}
     * @private
     */
    SessionService.prototype._userProfile;
    /**
     * @type {?}
     * @private
     */
    SessionService.prototype._beforeLogout;
    /**
     * @type {?}
     * @protected
     */
    SessionService.prototype.http;
    /**
     * @type {?}
     * @protected
     */
    SessionService.prototype.eventBroadcaster;
    /**
     * @type {?}
     * @private
     */
    SessionService.prototype.authTokenVersion;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2Vzc2lvbi5zZXJ2aWNlLmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGNlbWV4LWNvcmUvYW5ndWxhci1zZXJ2aWNlcy12Ny8iLCJzb3VyY2VzIjpbImxpYi9zZXNzaW9uLnNlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBQSxPQUFPLEVBQUUsTUFBTSxFQUFFLFVBQVUsRUFBRSxRQUFRLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDN0QsT0FBTyxFQUFFLE9BQU8sRUFBRSxjQUFjLEVBQUUsUUFBUSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBRWxFLE9BQU8sRUFBRSxlQUFlLEVBQUUsVUFBVSxFQUFFLFVBQVUsRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUMvRCxPQUFPLEVBQUUsR0FBRyxFQUFFLFVBQVUsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBRWpELE9BQU8sRUFBRSx1QkFBdUIsRUFBRSxNQUFNLCtCQUErQixDQUFDO0FBQ3hFLE9BQU8sRUFBRSxXQUFXLEVBQUUsTUFBTSx1QkFBdUIsQ0FBQztBQVFwRCxPQUFPLEVBQUUsU0FBUyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFPM0M7SUFlRSx3QkFDWSxJQUFlLEVBQ2YsZ0JBQTZCLEVBRy9CLGdCQUF3QjtRQUp0QixTQUFJLEdBQUosSUFBSSxDQUFXO1FBQ2YscUJBQWdCLEdBQWhCLGdCQUFnQixDQUFhO1FBRy9CLHFCQUFnQixHQUFoQixnQkFBZ0IsQ0FBUTtRQWIxQixlQUFVLEdBQUcsYUFBYSxDQUFDO1FBQzNCLGdCQUFXLEdBQUcsTUFBTSxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsSUFBSSxFQUFFLENBQUM7UUFFNUMscUJBQWdCLEdBQUcsSUFBSSxlQUFlLENBQXFCLEVBQUUsQ0FBQyxDQUFDO1FBQy9ELHdCQUFtQixHQUFHLElBQUksZUFBZSxDQUFlLElBQUksQ0FBQyxDQUFDO1FBQzlELGlCQUFZLEdBQWlCLElBQUksQ0FBQztRQUNsQyxrQkFBYSxHQUFvQixJQUFJLENBQUM7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TUFBTSxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQztJQUNsRSxDQUFDO0lBamlCYSxrQ0FBbUIsR0FBRyxxQkFBcUIsQ0FBQztJQUM1QywrQkFBZ0IsR0FBRyxrQkFBa0IsQ0FBQztJQUN0QyxpQ0FBa0IsR0FBRyxvQkFBb0IsQ0FBQztJQUMxQyxpQ0FBa0IsR0FBRyxvQkFBb0IsQ0FBQzs7Z0JBTHpELFVBQVU7Ozs7Z0JBUEYsU0FBUztnQkFSVCxXQUFXOzZDQWlDZixNQUFNLFNBQUMsY0FBYyxDQUFDLGtCQUFrQixjQUN4QyxRQUFROztJQWtoQmIscUJBQUM7Q0FBQSxBQXJpQkQsSUFxaUJDO1NBcGlCWSxjQUFjOzs7SUFDekIsbUNBQTBEOztJQUMxRCxnQ0FBb0Q7O0lBQ3BELGtDQUF3RDs7SUFDeEQsa0NBQXdEOzs7OztJQUV4RCxvQ0FBbUM7Ozs7O0lBQ25DLHFDQUFvRDs7Ozs7SUFDcEQsbUNBQTBCOzs7OztJQUMxQiwwQ0FBdUU7Ozs7O0lBQ3ZFLDZDQUFzRTs7Ozs7SUFDdEUsc0NBQTBDOzs7OztJQUMxQyx1Q0FBOEM7Ozs7O0lBRzVDLDhCQUF5Qjs7Ozs7SUFDekIsMENBQXVDOzs7OztJQUN2QywwQ0FFZ0MiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBJbmplY3QsIEluamVjdGFibGUsIE9wdGlvbmFsIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBIZWFkZXJzLCBSZXF1ZXN0T3B0aW9ucywgUmVzcG9uc2UgfSBmcm9tICdAYW5ndWxhci9odHRwJztcblxuaW1wb3J0IHsgQmVoYXZpb3JTdWJqZWN0LCBPYnNlcnZhYmxlLCB0aHJvd0Vycm9yIH0gZnJvbSAncnhqcyc7XG5pbXBvcnQgeyBtYXAsIGNhdGNoRXJyb3IgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XG5cbmltcG9ydCB7IFNlc3Npb25TZXJ2aWNlQ29uc3RhbnRzIH0gZnJvbSAnQGNlbWV4LWNvcmUvY29uc3RhbnRzLXYyL2Rpc3QnO1xuaW1wb3J0IHsgQnJvYWRjYXN0ZXIgfSBmcm9tICdAY2VtZXgtY29yZS9ldmVudHMtdjcnO1xuaW1wb3J0IHtcbiAgSUFwcGxpY2F0aW9uTWVudSxcbiAgSUN1c3RvbWVyLFxuICBJTGVnYWxFbnRpdHksXG4gIElVc2VyUHJvZmlsZVxufSBmcm9tICdAY2VtZXgtY29yZS90eXBlcy12Mi9kaXN0L2luZGV4LmludGVyZmFjZSc7XG5cbmltcG9ydCB7IEh0dHBDZW1leCB9IGZyb20gJy4vaHR0cC5zZXJ2aWNlJztcbmltcG9ydCB7IFByb2ZpbGUgfSBmcm9tICcuL21vZGVscy9wcm9maWxlJztcbmltcG9ydCB7IEN1c3RvbWVyIH0gZnJvbSAnLi9tb2RlbHMvY3VzdG9tZXInO1xuaW1wb3J0IHsgVXNlciB9IGZyb20gJy4vbW9kZWxzL3VzZXInO1xuaW1wb3J0IHsgUm9sZSB9IGZyb20gJy4vbW9kZWxzL3JvbGUnO1xuaW1wb3J0IHsgQXBwbGljYXRpb24gfSBmcm9tICcuL21vZGVscy9hcHBsaWNhdGlvbic7XG5cbkBJbmplY3RhYmxlKClcbmV4cG9ydCBjbGFzcyBTZXNzaW9uU2VydmljZSB7XG4gIHB1YmxpYyBzdGF0aWMgTE9HSU5fU1VDQ0VTU19FVkVOVCA9ICdMT0dJTl9TVUNDRVNTX0VWRU5UJztcbiAgcHVibGljIHN0YXRpYyBMT0dJTl9GQUlMX0VWRU5UID0gJ0xPR0lOX0ZBSUxfRVZFTlQnO1xuICBwdWJsaWMgc3RhdGljIExPR0lOX0xPR09VVF9FVkVOVCA9ICdMT0dJTl9MT0dPVVRfRVZFTlQnO1xuICBwdWJsaWMgc3RhdGljIEFVVEhfVE9LRU5fVkVSU0lPTiA9ICdhdXRoX3Rva2VuX3ZlcnNpb24nO1xuXG4gIHByaXZhdGUgc2l0ZURvbWFpbiA9ICdTSVRFX0RPTUFJTic7XG4gIHByaXZhdGUgX3NpdGVEb21haW4gPSB3aW5kb3dbdGhpcy5zaXRlRG9tYWluXSB8fCAnJztcbiAgcHJpdmF0ZSBfZW5kcG9pbnQ6IHN0cmluZztcbiAgcHJpdmF0ZSBfbWVudUFwcGxpY2F0aW9uID0gbmV3IEJlaGF2aW9yU3ViamVjdDxJQXBwbGljYXRpb25NZW51W10+KFtdKTtcbiAgcHJpdmF0ZSBfY3VycmVudExlZ2FsRW50aXR5ID0gbmV3IEJlaGF2aW9yU3ViamVjdDxJTGVnYWxFbnRpdHk+KG51bGwpO1xuICBwcml2YXRlIF91c2VyUHJvZmlsZTogSVVzZXJQcm9maWxlID0gbnVsbDtcbiAgcHJpdmF0ZSBfYmVmb3JlTG9nb3V0OiBPYnNlcnZhYmxlPGFueT4gPSBudWxsO1xuXG4gIGNvbnN0cnVjdG9yKFxuICAgIHByb3RlY3RlZCBodHRwOiBIdHRwQ2VtZXgsXG4gICAgcHJvdGVjdGVkIGV2ZW50QnJvYWRjYXN0ZXI6IEJyb2FkY2FzdGVyLFxuICAgIEBJbmplY3QoU2Vzc2lvblNlcnZpY2UuQVVUSF9UT0tFTl9WRVJTSU9OKVxuICAgIEBPcHRpb25hbCgpXG4gICAgcHJpdmF0ZSBhdXRoVG9rZW5WZXJzaW9uOiBzdHJpbmdcbiAgKSB7XG4gICAgaWYgKGF1dGhUb2tlblZlcnNpb24pIHtcbiAgICAgIHN3aXRjaCAoYXV0aFRva2VuVmVyc2lvbi50b0xvY2FsZUxvd2VyQ2FzZSgpKSB7XG4gICAgICAgIGNhc2UgJ3Y2JzpcbiAgICAgICAgICB0aGlzLl9lbmRwb2ludCA9IFNlc3Npb25TZXJ2aWNlQ29uc3RhbnRzLkxPR0lOX1RPS0VOX1Y2O1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgIHRoaXMuX2VuZHBvaW50ID0gU2Vzc2lvblNlcnZpY2VDb25zdGFudHMuTE9HSU5fVE9LRU5fREVGQVVMVDtcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5fZW5kcG9pbnQgPSBTZXNzaW9uU2VydmljZUNvbnN0YW50cy5MT0dJTl9UT0tFTl9ERUZBVUxUO1xuICAgIH1cbiAgICBpZiAoXG4gICAgICBsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgnbGFuZ3VhZ2UnKSA9PT0gdW5kZWZpbmVkIHx8XG4gICAgICAobG9jYWxTdG9yYWdlLmdldEl0ZW0oJ2xhbmd1YWdlJykgPT09IG51bGwgJiZcbiAgICAgICAgKHNlc3Npb25TdG9yYWdlLmdldEl0ZW0oJ2xhbmd1YWdlJykgIT09IHVuZGVmaW5lZCAmJiBzZXNzaW9uU3RvcmFnZS5nZXRJdGVtKCdsYW5ndWFnZScpICE9PSBudWxsKSlcbiAgICApIHtcbiAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKCdsYW5ndWFnZScsIHNlc3Npb25TdG9yYWdlLmdldEl0ZW0oJ2xhbmd1YWdlJykpO1xuICAgIH1cbiAgfVxuXG4gIHB1YmxpYyBnZXQgbWVudUFwcGxpY2F0aW9uSXRlbXMoKTogT2JzZXJ2YWJsZTxJQXBwbGljYXRpb25NZW51W10+IHtcbiAgICBpZiAodGhpcy5fbWVudUFwcGxpY2F0aW9uLmdldFZhbHVlKCkubGVuZ3RoID09PSAwKSB7XG4gICAgICB0aGlzLnJlbG9hZEFwcE1lbnVJdGVtcygpO1xuICAgIH1cbiAgICByZXR1cm4gdGhpcy5fbWVudUFwcGxpY2F0aW9uLmFzT2JzZXJ2YWJsZSgpO1xuICB9XG5cbiAgcHVibGljIHNldExlZ2FsRW50aXR5KHZhbHVlOiBJTGVnYWxFbnRpdHkpIHtcbiAgICBzZXNzaW9uU3RvcmFnZS5zZXRJdGVtKCd1c2VyX2xlZ2FsX2VudGl0eScsIEpTT04uc3RyaW5naWZ5KHZhbHVlKSk7XG4gICAgdGhpcy5ldmVudEJyb2FkY2FzdGVyLmJyb2FkY2FzdChCcm9hZGNhc3Rlci5EQ01fTEVHQUxfRU5USVRZX0NIQU5HRSwgSlNPTi5zdHJpbmdpZnkodmFsdWUpKTtcbiAgICB0aGlzLl9jdXJyZW50TGVnYWxFbnRpdHkubmV4dCh2YWx1ZSk7XG4gIH1cblxuICBwdWJsaWMgZ2V0IGN1cnJlbnRMZWdhbEVudGl0eSgpOiBPYnNlcnZhYmxlPElMZWdhbEVudGl0eT4ge1xuICAgIHJldHVybiB0aGlzLl9jdXJyZW50TGVnYWxFbnRpdHkuYXNPYnNlcnZhYmxlKCk7XG4gIH1cblxuICBwdWJsaWMgZ2V0IGlzTG9nZ2VkSW4oKTogYm9vbGVhbiB7XG4gICAgY29uc3QgYWNjZXNzVG9rZW4gPSBzZXNzaW9uU3RvcmFnZS5nZXRJdGVtKCdhY2Nlc3NfdG9rZW4nKTtcbiAgICBjb25zdCBqd3RUb2tlbiA9IHNlc3Npb25TdG9yYWdlLmdldEl0ZW0oJ2p3dCcpO1xuICAgIHJldHVybiAoXG4gICAgICBhY2Nlc3NUb2tlbiAhPT0gbnVsbCAmJlxuICAgICAgYWNjZXNzVG9rZW4gIT09IHVuZGVmaW5lZCAmJlxuICAgICAgYWNjZXNzVG9rZW4gIT09ICcnICYmXG4gICAgICBqd3RUb2tlbiAhPSBudWxsICYmXG4gICAgICBqd3RUb2tlbiAhPT0gdW5kZWZpbmVkICYmXG4gICAgICBqd3RUb2tlbiAhPT0gJydcbiAgICApO1xuICB9XG5cbiAgcHVibGljIGxvZ291dCgpOiBPYnNlcnZhYmxlPHtcbiAgICBzdWNjZXNzOiBib29sZWFuO1xuICAgIG1lc3NhZ2U6IHN0cmluZztcbiAgfT4ge1xuICAgIHJldHVybiBuZXcgT2JzZXJ2YWJsZShvYnNlcnZlciA9PiB7XG4gICAgICBpZiAodGhpcy5fYmVmb3JlTG9nb3V0KSB7XG4gICAgICAgIHRoaXMuX2JlZm9yZUxvZ291dC5zdWJzY3JpYmUoXG4gICAgICAgICAgcmVzdWx0ID0+IHtcbiAgICAgICAgICAgIHRoaXMubG9nb3V0QXBwKCk7XG4gICAgICAgICAgICBvYnNlcnZlci5uZXh0KHtcbiAgICAgICAgICAgICAgbWVzc2FnZTogJ3N1Y2Nlc3MnLFxuICAgICAgICAgICAgICBzdWNjZXNzOiB0cnVlXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIGVycm9yID0+IHtcbiAgICAgICAgICAgIG9ic2VydmVyLm5leHQoe1xuICAgICAgICAgICAgICBtZXNzYWdlOiBlcnJvcixcbiAgICAgICAgICAgICAgc3VjY2VzczogZmFsc2VcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH1cbiAgICAgICAgKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMubG9nb3V0QXBwKCk7XG4gICAgICAgIG9ic2VydmVyLm5leHQoe1xuICAgICAgICAgIG1lc3NhZ2U6ICdzdWNjZXNzJyxcbiAgICAgICAgICBzdWNjZXNzOiB0cnVlXG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gb2JzZXJ2ZXI7XG4gICAgfSk7XG4gIH1cblxuICBwdWJsaWMgbG9naW4oXG4gICAgdXNlcjogc3RyaW5nLFxuICAgIHBhc3N3b3JkOiBzdHJpbmcsXG4gICAgZ2VuZXJhdGVDb29raWU/OiBib29sZWFuLFxuICAgIGFwcE5hbWU/OiBzdHJpbmcsXG4gICAgdmFsaWRhdGVUZW1wUGFzc3dvcmQ/OiBib29sZWFuXG4gICk6IFByb21pc2U8YW55PiB7XG4gICAgdGhpcy5jbGVhbigpO1xuICAgIGNvbnN0IG9wdGlvbnMgPSBuZXcgUmVxdWVzdE9wdGlvbnMoe1xuICAgICAgaGVhZGVyczogbmV3IEhlYWRlcnMoe1xuICAgICAgICAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL3gtd3d3LWZvcm0tdXJsZW5jb2RlZCcsXG4gICAgICAgIGFjY2VwdDogJ3RleHQvcGxhaW4sICovKidcbiAgICAgIH0pXG4gICAgfSk7XG5cbiAgICBjb25zdCBlbmRwb2ludCA9IHRoaXMuaHR0cC5nZW5lcmF0ZUVuZHBvaW50KHRoaXMuX2VuZHBvaW50KTtcbiAgICBjb25zdCB1cmxQb3N0ID0gdGhpcy5nZW5lcmF0ZVVybFN0cmluZyh1c2VyLCBwYXNzd29yZCwgYXBwTmFtZSk7XG4gICAgcmV0dXJuIHRoaXMuaHR0cFxuICAgICAgLnBvc3QoZW5kcG9pbnQsIHVybFBvc3QsIG9wdGlvbnMpXG4gICAgICAudG9Qcm9taXNlKClcbiAgICAgIC50aGVuKGFzeW5jIHJlc3BvbnNlID0+IHtcbiAgICAgICAgY29uc3QgZGF0YSA9IHJlc3BvbnNlLmpzb24oKTtcblxuICAgICAgICBjb25zdCB1c2VySWQgPVxuICAgICAgICAgIHRoaXMuYXV0aFRva2VuVmVyc2lvbiA9PT0gJ3Y2J1xuICAgICAgICAgICAgPyBkYXRhLnVzZXJJZFxuICAgICAgICAgICAgICA/IGRhdGEudXNlcklkXG4gICAgICAgICAgICAgIDogZGF0YS5wcm9maWxlLnVzZXJJZFxuICAgICAgICAgICAgOiBkYXRhLnByb2ZpbGUudXNlcklkO1xuICAgICAgICB0aGlzLnByb2Nlc3NEYXRhRnJvbUxvZ2luKGRhdGEsIGdlbmVyYXRlQ29va2llKTtcblxuICAgICAgICB0aGlzLmV2ZW50QnJvYWRjYXN0ZXIuYnJvYWRjYXN0KFNlc3Npb25TZXJ2aWNlLkxPR0lOX1NVQ0NFU1NfRVZFTlQpO1xuXG4gICAgICAgIGlmIChcbiAgICAgICAgICB2YWxpZGF0ZVRlbXBQYXNzd29yZCAmJlxuICAgICAgICAgIGRhdGEucHJvZmlsZSAmJlxuICAgICAgICAgIGRhdGEucHJvZmlsZS5oYXNUZW1wb3JhcnlQYXNzd29yZFxuICAgICAgICApIHtcbiAgICAgICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKGRhdGEpO1xuICAgICAgICB9XG4gICAgICB9KVxuICAgICAgLmNhdGNoKGVycm9yID0+IHtcbiAgICAgICAgY29uc29sZS5lcnJvcihlcnJvcik7XG4gICAgICAgIHRoaXMuZXZlbnRCcm9hZGNhc3Rlci5icm9hZGNhc3QoU2Vzc2lvblNlcnZpY2UuTE9HSU5fRkFJTF9FVkVOVCk7XG4gICAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChlcnJvcik7XG4gICAgICB9KTtcbiAgfVxuXG4gIHB1YmxpYyBnZXQgdXNlclJlZ2lvbigpOiBzdHJpbmcge1xuICAgIHJldHVybiBzZXNzaW9uU3RvcmFnZS5nZXRJdGVtKCdyZWdpb24nKSB8fCAnVVMnO1xuICB9XG5cbiAgcHVibGljIGdldCB1c2VyQ291bnRyeSgpOiBzdHJpbmcge1xuICAgIHJldHVybiBzZXNzaW9uU3RvcmFnZS5nZXRJdGVtKCdjb3VudHJ5JykgfHwgJyc7XG4gIH1cblxuICBwdWJsaWMgZ2V0IHVzZXJQcm9maWxlKCk6IElVc2VyUHJvZmlsZSB7XG4gICAgaWYgKCF0aGlzLl91c2VyUHJvZmlsZSkge1xuICAgICAgdGhpcy5zZXRVc2VyUHJvZmlsZSgpO1xuICAgIH1cblxuICAgIHJldHVybiB0aGlzLl91c2VyUHJvZmlsZTtcbiAgfVxuXG4gIHB1YmxpYyBnZXRMZWdhbEVudGl0aWVzKFxuICAgIGZldGNoPzogbnVtYmVyLFxuICAgIHBhZ2U/OiBudW1iZXIsXG4gICAgbGVnYWxFbnRpdHlDb2RlPzogc3RyaW5nLFxuICApOiBPYnNlcnZhYmxlPElMZWdhbEVudGl0eVtdPiB7XG4gICAgbGV0IGVuZHBvaW50ID0gdGhpcy5odHRwLmdlbmVyYXRlRW5kcG9pbnQoU2Vzc2lvblNlcnZpY2VDb25zdGFudHMuVVNFUl9MRUdBTF9FTlRJVElFUyk7XG4gICAgZW5kcG9pbnQgPSB0aGlzLmFkZFF1ZXJ5UGFyYW1zKGVuZHBvaW50LCBmZXRjaCwgcGFnZSwgbGVnYWxFbnRpdHlDb2RlKTtcblxuICAgIHJldHVybiB0aGlzLmh0dHAuZ2V0KGVuZHBvaW50KS5waXBlKFxuICAgICAgbWFwKChyZXNwb25zZTogUmVzcG9uc2UpID0+IHtcbiAgICAgICAgbGV0IHJlc3BvbnNlTWFwID0gW107XG4gICAgICAgIGNvbnN0IHRtcEpzb24gPSByZXNwb25zZS5qc29uKCk7XG4gICAgICAgIGlmICh0bXBKc29uKSB7XG4gICAgICAgICAgcmVzcG9uc2VNYXAgPSByZXNwb25zZS5qc29uKCk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHJlc3BvbnNlTWFwO1xuICAgICAgfSksXG4gICAgICBjYXRjaEVycm9yKGUgPT4gT2JzZXJ2YWJsZS50aHJvdyh0aGlzLmhhbmRsZUVycm9yKGUpKSlcbiAgICApO1xuICB9XG5cbiAgcHVibGljIHNldEJlZm9yZUxvZ291dChtZXRob2Q6IE9ic2VydmFibGU8YW55Pik6IHZvaWQge1xuICAgIHRoaXMuX2JlZm9yZUxvZ291dCA9IG1ldGhvZDtcbiAgfVxuXG4gIHB1YmxpYyBnZXRCZWZvcmVMb2dvdXQoKTogT2JzZXJ2YWJsZTxhbnk+IHtcbiAgICByZXR1cm4gdGhpcy5fYmVmb3JlTG9nb3V0O1xuICB9XG5cbiAgcHVibGljIHJlbG9hZEFwcE1lbnVJdGVtcygpOiB2b2lkIHtcbiAgICB0aGlzLmdldERDTUFwcGxpY2F0aW9ucygpLnN1YnNjcmliZShyZXN1bHQgPT4ge1xuICAgICAgdGhpcy5fbWVudUFwcGxpY2F0aW9uLm5leHQocmVzdWx0KTtcbiAgICB9KTtcbiAgfVxuXG4gIHB1YmxpYyBjcmVhdGVDb29raWUobmFtZTogc3RyaW5nLCB2YWx1ZTogc3RyaW5nLCBkYXlzPzogbnVtYmVyKSB7XG4gICAgbGV0IGV4cGlyZXMgPSAnJztcbiAgICBpZiAoZGF5cykge1xuICAgICAgY29uc3QgZGF0ZSA9IG5ldyBEYXRlKCk7XG4gICAgICBkYXRlLnNldFRpbWUoZGF0ZS5nZXRUaW1lKCkgKyBkYXlzICogMjQgKiA2MCAqIDYwICogMTAwMCk7XG4gICAgICBleHBpcmVzID0gZGF0ZS50b1VUQ1N0cmluZygpO1xuICAgIH0gZWxzZSB7XG4gICAgICBkYXlzID0gMDtcbiAgICB9XG5cbiAgICBjb25zdCBjb29raWUgPSBgJHtuYW1lfT0ke3ZhbHVlfTtleHBpcmVzPSR7ZXhwaXJlc307ZG9tYWluPSR7dGhpcy5fc2l0ZURvbWFpbn07cGF0aD0vYDtcbiAgICBkb2N1bWVudC5jb29raWUgPSBjb29raWU7XG4gIH1cblxuICBwdWJsaWMgcmVhZENvb2tpZShuYW1lOiBzdHJpbmcpOiBzdHJpbmcge1xuICAgIGNvbnN0IGNhID0gZG9jdW1lbnQuY29va2llLnNwbGl0KCc7Jyk7XG4gICAgY29uc3QgY2FMZW46IG51bWJlciA9IGNhLmxlbmd0aDtcbiAgICBjb25zdCBjb29raWVOYW1lID0gYCR7bmFtZX09YDtcbiAgICBsZXQgYzogc3RyaW5nO1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgY2FMZW47IGkgKz0gMSkge1xuICAgICAgYyA9IGNhW2ldLnJlcGxhY2UoL15cXHMrL2csICcnKTtcbiAgICAgIGlmIChjLmluZGV4T2YoY29va2llTmFtZSkgPT09IDApIHtcbiAgICAgICAgcmV0dXJuIGMuc3Vic3RyaW5nKGNvb2tpZU5hbWUubGVuZ3RoLCBjLmxlbmd0aCk7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBudWxsO1xuICB9XG5cbiAgcHVibGljIGNsZWFyQ29va2llKG5hbWUpIHtcbiAgICB0aGlzLmNyZWF0ZUNvb2tpZShuYW1lLCAnJywgLTEpO1xuICB9XG5cbiAgcHVibGljIHNldFVzZXJQcm9maWxlKCk6IHZvaWQge1xuICAgIGNvbnN0IHN0clByb2ZpbGU6IHN0cmluZyA9IHNlc3Npb25TdG9yYWdlLmdldEl0ZW0oJ3VzZXJfcHJvZmlsZScpO1xuICAgIGNvbnN0IHRtcFByb2ZpbGU6IElVc2VyUHJvZmlsZSA9IHRoaXMuY29udmVydEpzb25UbzxJVXNlclByb2ZpbGU+KHN0clByb2ZpbGUpO1xuICAgIGlmICh0bXBQcm9maWxlKSB7XG4gICAgICBjb25zdCBzdHJDdXN0b21lcjogc3RyaW5nID0gc2Vzc2lvblN0b3JhZ2UuZ2V0SXRlbSgndXNlcl9jdXN0b21lcicpO1xuICAgICAgY29uc3QgdXNlckN1c3RvbWVyID0gdGhpcy5jb252ZXJ0SnNvblRvPElDdXN0b21lcj4oc3RyQ3VzdG9tZXIpO1xuICAgICAgaWYgKHVzZXJDdXN0b21lcikge1xuICAgICAgICB0bXBQcm9maWxlLmN1c3RvbWVyID0gdXNlckN1c3RvbWVyO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgY29uc29sZS53YXJuKCdFeGNlcHRpb24gYXQgcGFyc2luZyBVc2VyIEN1c3RvbWVyIGZyb20gc2Vzc2lvblN0b3JlJyk7XG4gICAgICB9XG5cbiAgICAgIHRoaXMuX3VzZXJQcm9maWxlID0gdG1wUHJvZmlsZTtcbiAgICB9IGVsc2Uge1xuICAgICAgY29uc29sZS53YXJuKCdFeGNlcHRpb24gYXQgcGFyc2luZyBVc2VyIFByb2ZpbGUgZnJvbSBzZXNzaW9uU3RvcmUnKTtcbiAgICB9XG4gIH1cblxuICBwdWJsaWMgY2xlYW4oKTogdm9pZCB7XG4gICAgdGhpcy5jbGVhckNvb2tpZSgnQ2VtZXhHb1JlZ2lvbicpO1xuICAgIHRoaXMuY2xlYXJDb29raWUoJ3VwX3Nlc3Npb24nKTtcbiAgICBzZXNzaW9uU3RvcmFnZS5yZW1vdmVJdGVtKCdhY2Nlc3NfdG9rZW4nKTtcbiAgICBzZXNzaW9uU3RvcmFnZS5yZW1vdmVJdGVtKCdyZWZyZXNoX3Rva2VuJyk7XG4gICAgc2Vzc2lvblN0b3JhZ2UucmVtb3ZlSXRlbSgnZXhwaXJlc19pbicpO1xuICAgIHNlc3Npb25TdG9yYWdlLnJlbW92ZUl0ZW0oJ2p3dCcpO1xuICAgIHNlc3Npb25TdG9yYWdlLnJlbW92ZUl0ZW0oJ3JlZ2lvbicpO1xuICAgIHNlc3Npb25TdG9yYWdlLnJlbW92ZUl0ZW0oJ3VzZXJfcHJvZmlsZScpO1xuICAgIHNlc3Npb25TdG9yYWdlLnJlbW92ZUl0ZW0oJ3VzZXJfY3VzdG9tZXInKTtcbiAgICBzZXNzaW9uU3RvcmFnZS5yZW1vdmVJdGVtKCd1c2VyX2xlZ2FsX2VudGl0eScpO1xuICAgIHNlc3Npb25TdG9yYWdlLnJlbW92ZUl0ZW0oJ3VzZXJfYXBwbGljYXRpb25zJyk7XG4gICAgLy8gcGF0Y2gtZml4IGZvciByZWFjdFxuICAgIHNlc3Npb25TdG9yYWdlLnJlbW92ZUl0ZW0oJ2F1dGhfdG9rZW4nKTtcbiAgICBzZXNzaW9uU3RvcmFnZS5yZW1vdmVJdGVtKCd1c2VySW5mbycpO1xuICAgIHNlc3Npb25TdG9yYWdlLnJlbW92ZUl0ZW0oJ2NvdW50cnknKTtcbiAgICBzZXNzaW9uU3RvcmFnZS5yZW1vdmVJdGVtKCd0b2tlbl9kYXRhJyk7XG4gICAgc2Vzc2lvblN0b3JhZ2UucmVtb3ZlSXRlbSgnYXBwbGljYXRpb25zJyk7XG4gICAgc2Vzc2lvblN0b3JhZ2UucmVtb3ZlSXRlbSgncm9sZScpO1xuICAgIHNlc3Npb25TdG9yYWdlLnJlbW92ZUl0ZW0oJ3VzZXJuYW1lJyk7XG5cbiAgICAvLyBuZXcgdmVyc3Npb24gQVBJICggdjYgKVxuICAgIHNlc3Npb25TdG9yYWdlLnJlbW92ZUl0ZW0oJ3VzZXJBdXRoVjYnKTtcbiAgICBzZXNzaW9uU3RvcmFnZS5yZW1vdmVJdGVtKCd1c2VySW5mb1Y2Jyk7XG4gICAgc2Vzc2lvblN0b3JhZ2UucmVtb3ZlSXRlbSgndXNlclByb2ZpbGVWNicpO1xuICAgIHNlc3Npb25TdG9yYWdlLnJlbW92ZUl0ZW0oJ3VzZXJDdXN0b21lclY2Jyk7XG4gICAgc2Vzc2lvblN0b3JhZ2UucmVtb3ZlSXRlbSgndXNlckFwcGxpY2F0aW9uc1Y2Jyk7XG4gICAgc2Vzc2lvblN0b3JhZ2UucmVtb3ZlSXRlbSgndXNlclJvbGVzVjYnKTtcbiAgfVxuXG4gIHB1YmxpYyBnZW5lcmF0ZVVybFN0cmluZyhcbiAgICB1c2VyOiBzdHJpbmcsXG4gICAgcGFzc3dvcmQ6IHN0cmluZyxcbiAgICBhcHBOYW1lPzogc3RyaW5nXG4gICk6IHN0cmluZyB7XG4gICAgY29uc3QgaW5jbHVkZSA9ICcmaW5jbHVkZT11c2VyaW5mbyxwcm9maWxlLGFwcGxpY2F0aW9ucyxyb2xlcyxjdXN0b21lcnMsb2xkVmVyc2lvbic7XG4gICAgbGV0IHVybCA9XG4gICAgICAnZ3JhbnRfdHlwZT1wYXNzd29yZCZzY29wZT1zZWN1cml0eSZ1c2VybmFtZT0nICtcbiAgICAgIHVzZXIgK1xuICAgICAgJyZwYXNzd29yZD0nICtcbiAgICAgIGVuY29kZVVSSUNvbXBvbmVudChwYXNzd29yZCkgK1xuICAgICAgJyZjbGllbnRfaWQ9JyArXG4gICAgICB0aGlzLmh0dHAuY2xpZW50SWQ7XG5cbiAgICBpZiAoYXBwTmFtZSkgeyB1cmwgPSB1cmwgKyAnJmFwcF9uYW1lPScgKyBhcHBOYW1lOyB9XG4gICAgaWYgKHRoaXMuYXV0aFRva2VuVmVyc2lvbikge1xuICAgICAgaWYgKHRoaXMuYXV0aFRva2VuVmVyc2lvbi50b0xvd2VyQ2FzZSgpID09PSAndjYnKSB7XG4gICAgICAgIHVybCA9IGAke3VybH0mdXNlcmluZm9ybWF0aW9uPWZhbHNlJHtpbmNsdWRlfWA7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiB1cmw7XG4gIH1cblxuICBwdWJsaWMgcHJvY2Vzc0RhdGFGcm9tTG9naW4oZGF0YTogYW55LCBnZW5lcmF0ZUNvb2tpZT86IGJvb2xlYW4pOiB2b2lkIHtcbiAgICAvLyBzZXNzaW9uIGNvb2tpZVxuICAgIGlmIChnZW5lcmF0ZUNvb2tpZSkge1xuICAgICAgY29uc3Qgc2Vzc2lvbkNvb2tpZSA9IHtcbiAgICAgICAgYXV0aDogZGF0YS5vYXV0aDIuYWNjZXNzX3Rva2VuLFxuICAgICAgICBleHBpcmVzX2luOiBkYXRhLm9hdXRoMi5leHBpcmVzX2luLFxuICAgICAgICBqd3Q6IGRhdGEuand0LFxuICAgICAgICByZWZyZXNoX3Rva2VuOiBkYXRhLm9hdXRoMi5yZWZyZXNoX3Rva2VuLFxuICAgICAgICByZWdpb246IGRhdGEub2F1dGgyLnJlZ2lvbixcbiAgICAgIH07XG4gICAgICB0aGlzLmNyZWF0ZUNvb2tpZSgndXBfc2Vzc2lvbicsIEpTT04uc3RyaW5naWZ5KHNlc3Npb25Db29raWUpLCBudWxsKTtcbiAgICB9XG5cbiAgICB0aGlzLmNyZWF0ZUNvb2tpZSgnQ2VtZXhHb1JlZ2lvbicsIGRhdGEub2F1dGgyLnJlZ2lvbiwgbnVsbCk7XG5cbiAgICBzZXNzaW9uU3RvcmFnZS5zZXRJdGVtKCdhY2Nlc3NfdG9rZW4nLCBkYXRhLm9hdXRoMi5hY2Nlc3NfdG9rZW4pO1xuICAgIHNlc3Npb25TdG9yYWdlLnNldEl0ZW0oJ3JlZnJlc2hfdG9rZW4nLCBkYXRhLm9hdXRoMi5yZWZyZXNoX3Rva2VuKTtcbiAgICBzZXNzaW9uU3RvcmFnZS5zZXRJdGVtKCdleHBpcmVzX2luJywgZGF0YS5vYXV0aDIuZXhwaXJlc19pbik7XG4gICAgc2Vzc2lvblN0b3JhZ2Uuc2V0SXRlbSgnand0JywgZGF0YS5qd3QpO1xuICAgIHNlc3Npb25TdG9yYWdlLnNldEl0ZW0oJ2F1dGhfdG9rZW4nLCBkYXRhLm9hdXRoMi5hY2Nlc3NfdG9rZW4pO1xuICAgIHNlc3Npb25TdG9yYWdlLnNldEl0ZW0oJ3VzZXJfcHJvZmlsZScsIEpTT04uc3RyaW5naWZ5KGRhdGEucHJvZmlsZSkpO1xuICAgIHNlc3Npb25TdG9yYWdlLnNldEl0ZW0oJ3VzZXJfY3VzdG9tZXInLCBKU09OLnN0cmluZ2lmeShkYXRhLmN1c3RvbWVyKSk7XG4gICAgc2Vzc2lvblN0b3JhZ2Uuc2V0SXRlbSgndXNlcl9hcHBsaWNhdGlvbnMnLCBKU09OLnN0cmluZ2lmeShkYXRhLmFwcGxpY2F0aW9ucykpO1xuXG4gICAgLy8gcmVhY3RcbiAgICBzZXNzaW9uU3RvcmFnZS5zZXRJdGVtKCd1c2VySW5mbycsIEpTT04uc3RyaW5naWZ5KGRhdGEpKTtcbiAgICBzZXNzaW9uU3RvcmFnZS5zZXRJdGVtKCdjb3VudHJ5JywgZGF0YS5jb3VudHJ5KTtcbiAgICBzZXNzaW9uU3RvcmFnZS5zZXRJdGVtKCd0b2tlbl9kYXRhJywgSlNPTi5zdHJpbmdpZnkoZGF0YSkpO1xuICAgIHNlc3Npb25TdG9yYWdlLnNldEl0ZW0oJ2FwcGxpY2F0aW9ucycsIEpTT04uc3RyaW5naWZ5KGRhdGEuYXBwbGljYXRpb25zKSk7XG5cbiAgICBzZXNzaW9uU3RvcmFnZS5zZXRJdGVtKCdyZWdpb24nLCBkYXRhLm9hdXRoMi5yZWdpb24pO1xuICAgIHNlc3Npb25TdG9yYWdlLnNldEl0ZW0oJ3JvbGUnLCBkYXRhLnJvbGUpO1xuICAgIHNlc3Npb25TdG9yYWdlLnNldEl0ZW0oJ3VzZXJuYW1lJywgZGF0YS5wcm9maWxlLnVzZXJBY2NvdW50KTtcblxuICAgIHRoaXMuc2V0VXNlclByb2ZpbGUoKTtcblxuICAgICAgICAvLyBjYWxsIEFQSSBWNiAoIE5ldyBNb2RlbClcbiAgICAgICAgY29uc3QgYWNjZXNzVG9LZW4gPSB7XG4gICAgICAgICAgb2F1dGgyOiBkYXRhLm9hdXRoMixcbiAgICAgICAgICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6b2JqZWN0LWxpdGVyYWwtc29ydC1rZXlzXG4gICAgICAgICAgand0OiBkYXRhLmp3dCxcbiAgICAgICAgICB1c2VySWQ6IGRhdGEudXNlcklkID8gZGF0YS51c2VySWQgOiBkYXRhLnByb2ZpbGUudXNlcklkLFxuICAgICAgICB9O1xuICAgICAgICBjb25zdCBlbmNyeXB0RGF0YSA9IHRoaXMuZW5jcnlwdChKU09OLnN0cmluZ2lmeShhY2Nlc3NUb0tlbikpO1xuICAgICAgICBzZXNzaW9uU3RvcmFnZS5zZXRJdGVtKCd1c2VyQXV0aFY2JywgZW5jcnlwdERhdGEpO1xuXG4gICAgICAgIGlmIChkYXRhLl91c2Vycykge1xuICAgICAgICAgIGNvbnN0IGZpcnN0VXNlciA9IGRhdGEuX3VzZXJzWzBdO1xuICAgICAgICAgIGNvbnN0IHVzZXI6IFVzZXIgPSB7XG4gICAgICAgICAgICBhY2NvdW50VHlwZTogZmlyc3RVc2VyLmFjY291bnRUeXBlLFxuICAgICAgICAgICAgY291bnRyeUNvZGU6IGZpcnN0VXNlci5jb3VudHJ5LmNvdW50cnlDb2RlLFxuICAgICAgICAgICAgY3VzdG9tZXJJZDogKGZpcnN0VXNlci5jdXN0b21lcikgPyBmaXJzdFVzZXIuY3VzdG9tZXIuY3VzdG9tZXJJZCA6IDAsXG4gICAgICAgICAgICBmaXJzdE5hbWU6IGZpcnN0VXNlci5maXJzdE5hbWUsXG4gICAgICAgICAgICBmdWxsTmFtZTogZmlyc3RVc2VyLmZ1bGxOYW1lLFxuICAgICAgICAgICAgbGFzdE5hbWU6IGZpcnN0VXNlci5sYXN0TmFtZSxcbiAgICAgICAgICAgIHBob25lTnVtYmVyOiBmaXJzdFVzZXIucGhvbmVOdW1iZXIsXG4gICAgICAgICAgICB1c2VyQWNjb3VudDogZmlyc3RVc2VyLnVzZXJBY2NvdW50LFxuICAgICAgICAgICAgdXNlcklkOiBmaXJzdFVzZXIudXNlcklkLFxuICAgICAgICAgICAgdXNlclNlbGVjdGVkSWQ6IGZpcnN0VXNlci51c2VyU2VsZWN0ZWRJZCxcbiAgICAgICAgICAgIHVzZXJTdGF0dXM6IGZpcnN0VXNlci51c2VyU3RhdHVzLFxuICAgICAgICAgICAgdXNlclR5cGU6IGZpcnN0VXNlci51c2VyVHlwZSxcbiAgICAgICAgICB9O1xuICAgICAgICAgIGNvbnN0IGVuY3J5cHRVc2VyID0gdGhpcy5lbmNyeXB0KEpTT04uc3RyaW5naWZ5KHVzZXIpKTtcbiAgICAgICAgICBzZXNzaW9uU3RvcmFnZS5zZXRJdGVtKCd1c2VySW5mb1Y2JywgZW5jcnlwdFVzZXIpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGRhdGEuX3Byb2ZpbGUpIHtcbiAgICAgICAgICBjb25zdCBkYXRhUHJvZmlsZSA9IGRhdGEuX3Byb2ZpbGU7XG4gICAgICAgICAgY29uc3QgcHJvZmlsZTogUHJvZmlsZSA9IHtcbiAgICAgICAgICAgIGFsbG93RW1haWxVcGRhdGVzOiBkYXRhUHJvZmlsZS5hbGxvd0VtYWlsVXBkYXRlcyxcbiAgICAgICAgICAgIGFsbG93SW5mb3JtYXRpb25TaGFyZTogZGF0YVByb2ZpbGUuYWxsb3dJbmZvcm1hdGlvblNoYXJlLFxuICAgICAgICAgICAgaGFzVGVtcG9yYXJ5UGFzc3dvcmQ6IGRhdGFQcm9maWxlLmhhc1RlbXBvcmFyeVBhc3N3b3JkLFxuICAgICAgICAgICAgdXNlckVtYWlsOiBkYXRhUHJvZmlsZS51c2VyRW1haWwsXG4gICAgICAgICAgICB1c2VySWQ6IGRhdGFQcm9maWxlLnVzZXJJZCxcbiAgICAgICAgICAgIHVzZXJQb3NpdGlvbjogZGF0YVByb2ZpbGUudXNlclBvc2l0aW9uLFxuICAgICAgICAgICAgdXNlclByb2ZpbGVJZDogZGF0YVByb2ZpbGUudXNlclByb2ZpbGVJZCxcbiAgICAgICAgICB9O1xuICAgICAgICAgIGNvbnN0IGVuY3J5cHRQcm9maWxlID0gdGhpcy5lbmNyeXB0KEpTT04uc3RyaW5naWZ5KHByb2ZpbGUpKTtcbiAgICAgICAgICBzZXNzaW9uU3RvcmFnZS5zZXRJdGVtKCd1c2VyUHJvZmlsZVY2JywgZW5jcnlwdFByb2ZpbGUpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGRhdGEuX2N1c3RvbWVycykge1xuICAgICAgICAgIGNvbnN0IGRhdGFDdXN0b21lciA9IGRhdGEuX2N1c3RvbWVycztcbiAgICAgICAgICBjb25zdCBjdXN0b21lcjogQ3VzdG9tZXIgPSB7XG4gICAgICAgICAgICBjb3VudHJ5Q29kZTogZGF0YUN1c3RvbWVyLmNvdW50cnkuY291bnRyeUNvZGUsXG4gICAgICAgICAgICBjdXN0b21lckNvZGU6IGRhdGFDdXN0b21lci5jdXN0b21lckNvZGUsXG4gICAgICAgICAgICBjdXN0b21lckNvZGVMWlI6IGRhdGFDdXN0b21lci5jdXN0b21lckNvZGVMWlIsXG4gICAgICAgICAgICBjdXN0b21lckRlc2M6IGRhdGFDdXN0b21lci5jdXN0b21lckRlc2MsXG4gICAgICAgICAgICBjdXN0b21lckRlc2MyOiBkYXRhQ3VzdG9tZXIuY3VzdG9tZXJEZXNjMixcbiAgICAgICAgICAgIGN1c3RvbWVySWQ6IGRhdGFDdXN0b21lci5jdXN0b21lcklkLFxuICAgICAgICAgICAgZW1haWw6IGRhdGFDdXN0b21lci5lbWFpbCxcbiAgICAgICAgICAgIGZheE51bWJlcjogZGF0YUN1c3RvbWVyLmZheE51bWJlcixcbiAgICAgICAgICAgIHBob25lTnVtYmVyOiBkYXRhQ3VzdG9tZXIucGhvbmVOdW1iZXIsXG4gICAgICAgICAgICByZWdpb25JZDogZGF0YUN1c3RvbWVyLnJlZ2lvbi5yZWdpb25JZCxcbiAgICAgICAgICAgIHZBVDogZGF0YUN1c3RvbWVyLnZBVCxcbiAgICAgICAgICB9O1xuICAgICAgICAgIGNvbnN0IGVuY3J5cHRjdXN0b21lciA9IHRoaXMuZW5jcnlwdChKU09OLnN0cmluZ2lmeShjdXN0b21lcikpO1xuICAgICAgICAgIHNlc3Npb25TdG9yYWdlLnNldEl0ZW0oJ3VzZXJDdXN0b21lclY2JywgZW5jcnlwdGN1c3RvbWVyKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChkYXRhLl9hcHBsaWNhdGlvbnMpIHtcbiAgICAgICAgICBjb25zdCBhcHBzOiBBcHBsaWNhdGlvbltdID0gZGF0YS5fYXBwbGljYXRpb25zLm1hcCgoYXBwKSA9PiB7XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICBhcHBsaWNhdGlvbkNvZGU6IGFwcC5hcHBsaWNhdGlvbkNvZGUsXG4gICAgICAgICAgICAgIGFwcGxpY2F0aW9uSWQ6IGFwcC5hcHBsaWNhdGlvbklkLFxuICAgICAgICAgICAgICBhcHBsaWNhdGlvblR5cGU6IGFwcC5hcHBsaWNhdGlvblR5cGUsXG4gICAgICAgICAgICAgIGlzVmlzaWJsZTogYXBwLmlzVmlzaWJsZSxcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgfSk7XG4gICAgICAgICAgY29uc3QgZW5jcnlwdEFwcGxpY2F0aW9ucyA9IHRoaXMuZW5jcnlwdChKU09OLnN0cmluZ2lmeShhcHBzKSk7XG4gICAgICAgICAgc2Vzc2lvblN0b3JhZ2Uuc2V0SXRlbSgndXNlckFwcGxpY2F0aW9uc1Y2JywgZW5jcnlwdEFwcGxpY2F0aW9ucyk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoZGF0YS5fcm9sZXMpIHtcbiAgICAgICAgICBjb25zdCByb2xlczogUm9sZVtdID0gZGF0YS5fcm9sZXMubWFwKChyb2xlKSA9PiB7XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICBhcHBsaWNhdGlvbklkOiByb2xlLmFwcGxpY2F0aW9uLmFwcGxpY2F0aW9uSWQsXG4gICAgICAgICAgICAgIGlzSW50ZXJuYWw6IHJvbGUuaXNJbnRlcm5hbCxcbiAgICAgICAgICAgICAgaXNPcHRpb25hbDogcm9sZS5pc09wdGlvbmFsLFxuICAgICAgICAgICAgICBpc1Zpc2libGU6IHJvbGUuaXNWaXNpYmxlLFxuICAgICAgICAgICAgICByb2xlQ29kZTogcm9sZS5yb2xlQ29kZSxcbiAgICAgICAgICAgICAgcm9sZUlkOiByb2xlLnJvbGVJZCxcbiAgICAgICAgICAgICAgcm9sZVR5cGU6IHJvbGUucm9sZVR5cGUsXG4gICAgICAgICAgICB9O1xuICAgICAgICAgIH0pO1xuICAgICAgICAgIGNvbnN0IGVuY3J5cHRSb2xlcyA9IHRoaXMuZW5jcnlwdChKU09OLnN0cmluZ2lmeShyb2xlcykpO1xuICAgICAgICAgIHNlc3Npb25TdG9yYWdlLnNldEl0ZW0oJ3VzZXJSb2xlc1Y2JywgZW5jcnlwdFJvbGVzKTtcbiAgICAgICAgfVxuICB9XG5cbiAgcHVibGljIGdldERDTUFwcGxpY2F0aW9ucygpOiBPYnNlcnZhYmxlPElBcHBsaWNhdGlvbk1lbnVbXT4ge1xuICAgIGNvbnN0IGVuZHBvaW50ID0gdGhpcy5odHRwLmdlbmVyYXRlRW5kcG9pbnQoU2Vzc2lvblNlcnZpY2VDb25zdGFudHMuVVNFUl9BUFBMSUNBVElPTl9NRU5VKTtcbiAgICByZXR1cm4gdGhpcy5odHRwLmdldChlbmRwb2ludCkucGlwZShcbiAgICAgIG1hcCgocmVzcG9uc2U6IFJlc3BvbnNlKSA9PiB7XG4gICAgICAgIGNvbnN0IHRtcEpzb24gPSByZXNwb25zZS5qc29uKCk7XG4gICAgICAgIGlmICghdG1wSnNvbiB8fCB0bXBKc29uID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICBjb25zb2xlLndhcm4oJ0NvbmZpZ3VyYXRpb24gb2YgbWVudSBhcHBsaWNhdGlvbiBpcyBlbXB0eSEhJyk7XG4gICAgICAgICAgcmV0dXJuIFtdO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHJlc3BvbnNlTWFwOiBJQXBwbGljYXRpb25NZW51W10gPSByZXNwb25zZS5qc29uKCkgYXMgSUFwcGxpY2F0aW9uTWVudVtdO1xuICAgICAgICByZXR1cm4gcmVzcG9uc2VNYXA7XG4gICAgICB9KSxcbiAgICAgIGNhdGNoRXJyb3IoKGU6IGFueSkgPT4gT2JzZXJ2YWJsZS50aHJvdyh0aGlzLmhhbmRsZUVycm9yKGUpKSlcbiAgICApO1xuICB9XG5cbiAgcHVibGljIGNvbnZlcnRKc29uVG88VD4ob2JqOiBzdHJpbmcpOiBUIHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgdG1wSnNvbiA9IEpTT04ucGFyc2Uob2JqKTtcbiAgICAgIHJldHVybiB0bXBKc29uIGFzIFQ7XG4gICAgfSBjYXRjaCAoZSkge1xuICAgICAgY29uc29sZS53YXJuKCdFeGNlcHRpb24gYXQgcGFyc2luZyBvYmplY3QgZnJvbSBzZXNzaW9uU3RvcmU6JywgZSk7XG4gICAgfVxuXG4gICAgcmV0dXJuIG51bGw7XG4gIH1cblxuICBwdWJsaWMgZ2V0IGN1c3RvbWVyKCk6IElDdXN0b21lciB7XG4gICAgbGV0IHJlc3VsdDogSUN1c3RvbWVyO1xuICAgIGNvbnN0IHN0cjogc3RyaW5nID0gc2Vzc2lvblN0b3JhZ2UuZ2V0SXRlbSgndXNlcl9jdXN0b21lcicpO1xuICAgIGlmIChzdHIpIHtcbiAgICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IHByb2ZpbGUgPSBKU09OLnBhcnNlKHN0cik7XG4gICAgICAgIHJlc3VsdCA9IHByb2ZpbGUgYXMgSUN1c3RvbWVyO1xuICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICBjb25zb2xlLndhcm4oXG4gICAgICAgICAgJ0V4Y2VwdGlvbiBhdCBwYXJzaW5nIHVzZXJfY3VzdG9tZXIgZnJvbSBzZXNzaW9uU3RvcmU6JyxcbiAgICAgICAgICBlXG4gICAgICAgICk7XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICBjb25zb2xlLndhcm4oJ1RoZXJlIGlzIG5vIHVzZXIgY3VzdG9tZXIgYXQgc2Vzc2lvbiBzdG9yYWdlJyk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfVxuXG4gIHB1YmxpYyBoYW5kbGVFcnJvcihlcnJvcjogUmVzcG9uc2UgfCBhbnkpOiBhbnkge1xuICAgIC8vIEluIGEgcmVhbCB3b3JsZCBhcHAsIHdlIG1pZ2h0IHVzZSBhIHJlbW90ZSBsb2dnaW5nIGluZnJhc3RydWN0dXJlXG4gICAgbGV0IGVyck1zZzogc3RyaW5nO1xuICAgIGlmIChlcnJvciBpbnN0YW5jZW9mIFJlc3BvbnNlKSB7XG4gICAgICBjb25zdCBib2R5ID0gZXJyb3IuanNvbigpIHx8ICcnO1xuICAgICAgZXJyTXNnID0gYCR7ZXJyb3Iuc3RhdHVzfSAtICR7ZXJyb3Iuc3RhdHVzVGV4dCB8fCAnJ31gO1xuICAgIH0gZWxzZSB7XG4gICAgICBlcnJNc2cgPSBlcnJvci5tZXNzYWdlID8gZXJyb3IubWVzc2FnZSA6IGVycm9yLnRvU3RyaW5nKCk7XG4gICAgfVxuICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpO1xuICAgIHJldHVybiB0aHJvd0Vycm9yKGVycm9yKTtcbiAgfVxuXG4gIHB1YmxpYyBhZGRRdWVyeVBhcmFtcyhlbmRwb2ludDogc3RyaW5nLCBmZXRjaD86IG51bWJlciwgcGFnZT86IG51bWJlciwgbGVnYWxFbnRpdHlDb2RlPzogc3RyaW5nKSB7XG4gICAgY29uc3QgdmFsaWRQYWdpbmF0aW9uOiBib29sZWFuID0gTnVtYmVyLmlzSW50ZWdlcihmZXRjaCkgJiYgTnVtYmVyLmlzSW50ZWdlcihwYWdlKTtcblxuICAgIGVuZHBvaW50ICs9IHZhbGlkUGFnaW5hdGlvbiA/ICc/ZmV0Y2g9JyArIGZldGNoICsgJyZwYWdlPScgKyBwYWdlIDogJyc7XG4gICAgZW5kcG9pbnQgKz1cbiAgICAgIGxlZ2FsRW50aXR5Q29kZSAmJiB2YWxpZFBhZ2luYXRpb25cbiAgICAgICAgPyAnJmxlZ2FsRW50aXR5Q29kZT0nICsgbGVnYWxFbnRpdHlDb2RlXG4gICAgICAgIDogbGVnYWxFbnRpdHlDb2RlICYmICF2YWxpZFBhZ2luYXRpb25cbiAgICAgICAgICA/ICc/bGVnYWxFbnRpdHlDb2RlPScgKyBsZWdhbEVudGl0eUNvZGVcbiAgICAgICAgICA6ICcnO1xuXG4gICAgcmV0dXJuIGVuZHBvaW50O1xuICB9XG5cbiAgcHVibGljIGxvZ291dEFwcCgpOiB2b2lkIHtcbiAgICB0aGlzLmNsZWFuKCk7XG4gICAgdGhpcy5ldmVudEJyb2FkY2FzdGVyLmJyb2FkY2FzdChCcm9hZGNhc3Rlci5EQ01fQVBQX0xPR09VVCk7XG4gIH1cblxuICBwdWJsaWMgZ2V0IHVzZXJBdXRoKCkge1xuICAgIHJldHVybiBKU09OLnBhcnNlKHRoaXMuZGVjcnlwdChzZXNzaW9uU3RvcmFnZS5nZXRJdGVtKCd1c2VyQXV0aFY2JykpKTtcbiAgfVxuXG4gIHB1YmxpYyBnZXQgdXNlckluZm8oKSB7XG4gICAgcmV0dXJuIEpTT04ucGFyc2UodGhpcy5kZWNyeXB0KHNlc3Npb25TdG9yYWdlLmdldEl0ZW0oJ3VzZXJJbmZvVjYnKSkpO1xuICB9XG5cbiAgcHVibGljIGdldCB1c2VyUHJvZmlsZVY2KCkge1xuICAgIHJldHVybiBKU09OLnBhcnNlKHRoaXMuZGVjcnlwdChzZXNzaW9uU3RvcmFnZS5nZXRJdGVtKCd1c2VyUHJvZmlsZVY2JykpKTtcbiAgfVxuXG4gIHB1YmxpYyBnZXQgdXNlckN1c3RvbWVyKCkge1xuICAgIHJldHVybiBKU09OLnBhcnNlKHRoaXMuZGVjcnlwdChzZXNzaW9uU3RvcmFnZS5nZXRJdGVtKCd1c2VyQ3VzdG9tZXJWNicpKSk7XG4gIH1cblxuICBwdWJsaWMgZ2V0IHVzZXJBcHBsaWNhdGlvbnMoKSB7XG4gICAgcmV0dXJuIEpTT04ucGFyc2UodGhpcy5kZWNyeXB0KHNlc3Npb25TdG9yYWdlLmdldEl0ZW0oJ3VzZXJBcHBsaWNhdGlvbnNWNicpKSk7XG4gIH1cblxuICBwdWJsaWMgZ2V0IHVzZXJSb2xlcygpIHtcbiAgICByZXR1cm4gSlNPTi5wYXJzZSh0aGlzLmRlY3J5cHQoc2Vzc2lvblN0b3JhZ2UuZ2V0SXRlbSgndXNlclJvbGVzVjYnKSkpO1xuICB9XG5cbiAgcHVibGljIGVuY3J5cHQoc3RyKSB7XG4gICAgcmV0dXJuIHdpbmRvdy5idG9hKHVuZXNjYXBlKGVuY29kZVVSSUNvbXBvbmVudChzdHIpKSk7XG4gIH1cblxuICBwdWJsaWMgZGVjcnlwdChzdHIpIHtcbiAgICByZXR1cm4gc3RyID8gZGVjb2RlVVJJQ29tcG9uZW50KGVzY2FwZSh3aW5kb3cuYXRvYihzdHIpKSkgOiBzdHI7XG4gIH1cblxufVxuIl19
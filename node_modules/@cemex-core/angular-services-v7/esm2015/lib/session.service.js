/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { Inject, Injectable, Optional } from '@angular/core';
import { Headers, RequestOptions, Response } from '@angular/http';
import { BehaviorSubject, Observable, throwError } from 'rxjs';
import { map, catchError } from 'rxjs/operators';
import { SessionServiceConstants } from '@cemex-core/constants-v2/dist';
import { Broadcaster } from '@cemex-core/events-v7';
import { HttpCemex } from './http.service';
export class SessionService {
    /**
     * @param {?} http
     * @param {?} eventBroadcaster
     * @param {?} authTokenVersion
     */
    constructor(http, eventBroadcaster, authTokenVersion) {
        this.http = http;
        this.eventBroadcaster = eventBroadcaster;
        this.authTokenVersion = authTokenVersion;
        this.siteDomain = 'SITE_DOMAIN';
        this._siteDomain = window[this.siteDomain] || '';
        this._menuApplication = new BehaviorSubject([]);
        this._currentLegalEntity = new BehaviorSubject(null);
        this._userProfile = null;
        this._beforeLogout = null;
        if (authTokenVersion) {
            switch (authTokenVersion.toLocaleLowerCase()) {
                case 'v6':
                    this._endpoint = SessionServiceConstants.LOGIN_TOKEN_V6;
                    break;
                default:
                    this._endpoint = SessionServiceConstants.LOGIN_TOKEN_DEFAULT;
            }
        }
        else {
            this._endpoint = SessionServiceConstants.LOGIN_TOKEN_DEFAULT;
        }
        if (localStorage.getItem('language') === undefined ||
            (localStorage.getItem('language') === null &&
                (sessionStorage.getItem('language') !== undefined && sessionStorage.getItem('language') !== null))) {
            localStorage.setItem('language', sessionStorage.getItem('language'));
        }
    }
    /**
     * @return {?}
     */
    get menuApplicationItems() {
        if (this._menuApplication.getValue().length === 0) {
            this.reloadAppMenuItems();
        }
        return this._menuApplication.asObservable();
    }
    /**
     * @param {?} value
     * @return {?}
     */
    setLegalEntity(value) {
        sessionStorage.setItem('user_legal_entity', JSON.stringify(value));
        this.eventBroadcaster.broadcast(Broadcaster.DCM_LEGAL_ENTITY_CHANGE, JSON.stringify(value));
        this._currentLegalEntity.next(value);
    }
    /**
     * @return {?}
     */
    get currentLegalEntity() {
        return this._currentLegalEntity.asObservable();
    }
    /**
     * @return {?}
     */
    get isLoggedIn() {
        /** @type {?} */
        const accessToken = sessionStorage.getItem('access_token');
        /** @type {?} */
        const jwtToken = sessionStorage.getItem('jwt');
        return (accessToken !== null &&
            accessToken !== undefined &&
            accessToken !== '' &&
            jwtToken != null &&
            jwtToken !== undefined &&
            jwtToken !== '');
    }
    /**
     * @return {?}
     */
    logout() {
        return new Observable((/**
         * @param {?} observer
         * @return {?}
         */
        observer => {
            if (this._beforeLogout) {
                this._beforeLogout.subscribe((/**
                 * @param {?} result
                 * @return {?}
                 */
                result => {
                    this.logoutApp();
                    observer.next({
                        message: 'success',
                        success: true
                    });
                }), (/**
                 * @param {?} error
                 * @return {?}
                 */
                error => {
                    observer.next({
                        message: error,
                        success: false
                    });
                }));
            }
            else {
                this.logoutApp();
                observer.next({
                    message: 'success',
                    success: true
                });
            }
            return observer;
        }));
    }
    /**
     * @param {?} user
     * @param {?} password
     * @param {?=} generateCookie
     * @param {?=} appName
     * @param {?=} validateTempPassword
     * @return {?}
     */
    login(user, password, generateCookie, appName, validateTempPassword) {
        this.clean();
        /** @type {?} */
        const options = new RequestOptions({
            headers: new Headers({
                'Content-Type': 'application/x-www-form-urlencoded',
                accept: 'text/plain, */*'
            })
        });
        /** @type {?} */
        const endpoint = this.http.generateEndpoint(this._endpoint);
        /** @type {?} */
        const urlPost = this.generateUrlString(user, password, appName);
        return this.http
            .post(endpoint, urlPost, options)
            .toPromise()
            .then((/**
         * @param {?} response
         * @return {?}
         */
        (response) => tslib_1.__awaiter(this, void 0, void 0, function* () {
            /** @type {?} */
            const data = response.json();
            /** @type {?} */
            const userId = this.authTokenVersion === 'v6'
                ? data.userId
                    ? data.userId
                    : data.profile.userId
                : data.profile.userId;
            this.processDataFromLogin(data, generateCookie);
            this.eventBroadcaster.broadcast(SessionService.LOGIN_SUCCESS_EVENT);
            if (validateTempPassword &&
                data.profile &&
                data.profile.hasTemporaryPassword) {
                return Promise.resolve(data);
            }
        })))
            .catch((/**
         * @param {?} error
         * @return {?}
         */
        error => {
            console.error(error);
            this.eventBroadcaster.broadcast(SessionService.LOGIN_FAIL_EVENT);
            return Promise.reject(error);
        }));
    }
    /**
     * @return {?}
     */
    get userRegion() {
        return sessionStorage.getItem('region') || 'US';
    }
    /**
     * @return {?}
     */
    get userCountry() {
        return sessionStorage.getItem('country') || '';
    }
    /**
     * @return {?}
     */
    get userProfile() {
        if (!this._userProfile) {
            this.setUserProfile();
        }
        return this._userProfile;
    }
    /**
     * @param {?=} fetch
     * @param {?=} page
     * @param {?=} legalEntityCode
     * @return {?}
     */
    getLegalEntities(fetch, page, legalEntityCode) {
        /** @type {?} */
        let endpoint = this.http.generateEndpoint(SessionServiceConstants.USER_LEGAL_ENTITIES);
        endpoint = this.addQueryParams(endpoint, fetch, page, legalEntityCode);
        return this.http.get(endpoint).pipe(map((/**
         * @param {?} response
         * @return {?}
         */
        (response) => {
            /** @type {?} */
            let responseMap = [];
            /** @type {?} */
            const tmpJson = response.json();
            if (tmpJson) {
                responseMap = response.json();
            }
            return responseMap;
        })), catchError((/**
         * @param {?} e
         * @return {?}
         */
        e => Observable.throw(this.handleError(e)))));
    }
    /**
     * @param {?} method
     * @return {?}
     */
    setBeforeLogout(method) {
        this._beforeLogout = method;
    }
    /**
     * @return {?}
     */
    getBeforeLogout() {
        return this._beforeLogout;
    }
    /**
     * @return {?}
     */
    reloadAppMenuItems() {
        this.getDCMApplications().subscribe((/**
         * @param {?} result
         * @return {?}
         */
        result => {
            this._menuApplication.next(result);
        }));
    }
    /**
     * @param {?} name
     * @param {?} value
     * @param {?=} days
     * @return {?}
     */
    createCookie(name, value, days) {
        /** @type {?} */
        let expires = '';
        if (days) {
            /** @type {?} */
            const date = new Date();
            date.setTime(date.getTime() + days * 24 * 60 * 60 * 1000);
            expires = date.toUTCString();
        }
        else {
            days = 0;
        }
        /** @type {?} */
        const cookie = `${name}=${value};expires=${expires};domain=${this._siteDomain};path=/`;
        document.cookie = cookie;
    }
    /**
     * @param {?} name
     * @return {?}
     */
    readCookie(name) {
        /** @type {?} */
        const ca = document.cookie.split(';');
        /** @type {?} */
        const caLen = ca.length;
        /** @type {?} */
        const cookieName = `${name}=`;
        /** @type {?} */
        let c;
        for (let i = 0; i < caLen; i += 1) {
            c = ca[i].replace(/^\s+/g, '');
            if (c.indexOf(cookieName) === 0) {
                return c.substring(cookieName.length, c.length);
            }
        }
        return null;
    }
    /**
     * @param {?} name
     * @return {?}
     */
    clearCookie(name) {
        this.createCookie(name, '', -1);
    }
    /**
     * @return {?}
     */
    setUserProfile() {
        /** @type {?} */
        const strProfile = sessionStorage.getItem('user_profile');
        /** @type {?} */
        const tmpProfile = this.convertJsonTo(strProfile);
        if (tmpProfile) {
            /** @type {?} */
            const strCustomer = sessionStorage.getItem('user_customer');
            /** @type {?} */
            const userCustomer = this.convertJsonTo(strCustomer);
            if (userCustomer) {
                tmpProfile.customer = userCustomer;
            }
            else {
                console.warn('Exception at parsing User Customer from sessionStore');
            }
            this._userProfile = tmpProfile;
        }
        else {
            console.warn('Exception at parsing User Profile from sessionStore');
        }
    }
    /**
     * @return {?}
     */
    clean() {
        this.clearCookie('CemexGoRegion');
        this.clearCookie('up_session');
        sessionStorage.removeItem('access_token');
        sessionStorage.removeItem('refresh_token');
        sessionStorage.removeItem('expires_in');
        sessionStorage.removeItem('jwt');
        sessionStorage.removeItem('region');
        sessionStorage.removeItem('user_profile');
        sessionStorage.removeItem('user_customer');
        sessionStorage.removeItem('user_legal_entity');
        sessionStorage.removeItem('user_applications');
        // patch-fix for react
        sessionStorage.removeItem('auth_token');
        sessionStorage.removeItem('userInfo');
        sessionStorage.removeItem('country');
        sessionStorage.removeItem('token_data');
        sessionStorage.removeItem('applications');
        sessionStorage.removeItem('role');
        sessionStorage.removeItem('username');
        // new verssion API ( v6 )
        sessionStorage.removeItem('userAuthV6');
        sessionStorage.removeItem('userInfoV6');
        sessionStorage.removeItem('userProfileV6');
        sessionStorage.removeItem('userCustomerV6');
        sessionStorage.removeItem('userApplicationsV6');
        sessionStorage.removeItem('userRolesV6');
    }
    /**
     * @param {?} user
     * @param {?} password
     * @param {?=} appName
     * @return {?}
     */
    generateUrlString(user, password, appName) {
        /** @type {?} */
        const include = '&include=userinfo,profile,applications,roles,customers,oldVersion';
        /** @type {?} */
        let url = 'grant_type=password&scope=security&username=' +
            user +
            '&password=' +
            encodeURIComponent(password) +
            '&client_id=' +
            this.http.clientId;
        if (appName) {
            url = url + '&app_name=' + appName;
        }
        if (this.authTokenVersion) {
            if (this.authTokenVersion.toLowerCase() === 'v6') {
                url = `${url}&userinformation=false${include}`;
            }
        }
        return url;
    }
    /**
     * @param {?} data
     * @param {?=} generateCookie
     * @return {?}
     */
    processDataFromLogin(data, generateCookie) {
        // session cookie
        if (generateCookie) {
            /** @type {?} */
            const sessionCookie = {
                auth: data.oauth2.access_token,
                expires_in: data.oauth2.expires_in,
                jwt: data.jwt,
                refresh_token: data.oauth2.refresh_token,
                region: data.oauth2.region,
            };
            this.createCookie('up_session', JSON.stringify(sessionCookie), null);
        }
        this.createCookie('CemexGoRegion', data.oauth2.region, null);
        sessionStorage.setItem('access_token', data.oauth2.access_token);
        sessionStorage.setItem('refresh_token', data.oauth2.refresh_token);
        sessionStorage.setItem('expires_in', data.oauth2.expires_in);
        sessionStorage.setItem('jwt', data.jwt);
        sessionStorage.setItem('auth_token', data.oauth2.access_token);
        sessionStorage.setItem('user_profile', JSON.stringify(data.profile));
        sessionStorage.setItem('user_customer', JSON.stringify(data.customer));
        sessionStorage.setItem('user_applications', JSON.stringify(data.applications));
        // react
        sessionStorage.setItem('userInfo', JSON.stringify(data));
        sessionStorage.setItem('country', data.country);
        sessionStorage.setItem('token_data', JSON.stringify(data));
        sessionStorage.setItem('applications', JSON.stringify(data.applications));
        sessionStorage.setItem('region', data.oauth2.region);
        sessionStorage.setItem('role', data.role);
        sessionStorage.setItem('username', data.profile.userAccount);
        this.setUserProfile();
        // call API V6 ( New Model)
        /** @type {?} */
        const accessToKen = {
            oauth2: data.oauth2,
            // tslint:disable-next-line:object-literal-sort-keys
            jwt: data.jwt,
            userId: data.userId ? data.userId : data.profile.userId,
        };
        /** @type {?} */
        const encryptData = this.encrypt(JSON.stringify(accessToKen));
        sessionStorage.setItem('userAuthV6', encryptData);
        if (data._users) {
            /** @type {?} */
            const firstUser = data._users[0];
            /** @type {?} */
            const user = {
                accountType: firstUser.accountType,
                countryCode: firstUser.country.countryCode,
                customerId: (firstUser.customer) ? firstUser.customer.customerId : 0,
                firstName: firstUser.firstName,
                fullName: firstUser.fullName,
                lastName: firstUser.lastName,
                phoneNumber: firstUser.phoneNumber,
                userAccount: firstUser.userAccount,
                userId: firstUser.userId,
                userSelectedId: firstUser.userSelectedId,
                userStatus: firstUser.userStatus,
                userType: firstUser.userType,
            };
            /** @type {?} */
            const encryptUser = this.encrypt(JSON.stringify(user));
            sessionStorage.setItem('userInfoV6', encryptUser);
        }
        if (data._profile) {
            /** @type {?} */
            const dataProfile = data._profile;
            /** @type {?} */
            const profile = {
                allowEmailUpdates: dataProfile.allowEmailUpdates,
                allowInformationShare: dataProfile.allowInformationShare,
                hasTemporaryPassword: dataProfile.hasTemporaryPassword,
                userEmail: dataProfile.userEmail,
                userId: dataProfile.userId,
                userPosition: dataProfile.userPosition,
                userProfileId: dataProfile.userProfileId,
            };
            /** @type {?} */
            const encryptProfile = this.encrypt(JSON.stringify(profile));
            sessionStorage.setItem('userProfileV6', encryptProfile);
        }
        if (data._customers) {
            /** @type {?} */
            const dataCustomer = data._customers;
            /** @type {?} */
            const customer = {
                countryCode: dataCustomer.country.countryCode,
                customerCode: dataCustomer.customerCode,
                customerCodeLZR: dataCustomer.customerCodeLZR,
                customerDesc: dataCustomer.customerDesc,
                customerDesc2: dataCustomer.customerDesc2,
                customerId: dataCustomer.customerId,
                email: dataCustomer.email,
                faxNumber: dataCustomer.faxNumber,
                phoneNumber: dataCustomer.phoneNumber,
                regionId: dataCustomer.region.regionId,
                vAT: dataCustomer.vAT,
            };
            /** @type {?} */
            const encryptcustomer = this.encrypt(JSON.stringify(customer));
            sessionStorage.setItem('userCustomerV6', encryptcustomer);
        }
        if (data._applications) {
            /** @type {?} */
            const apps = data._applications.map((/**
             * @param {?} app
             * @return {?}
             */
            (app) => {
                return {
                    applicationCode: app.applicationCode,
                    applicationId: app.applicationId,
                    applicationType: app.applicationType,
                    isVisible: app.isVisible,
                };
            }));
            /** @type {?} */
            const encryptApplications = this.encrypt(JSON.stringify(apps));
            sessionStorage.setItem('userApplicationsV6', encryptApplications);
        }
        if (data._roles) {
            /** @type {?} */
            const roles = data._roles.map((/**
             * @param {?} role
             * @return {?}
             */
            (role) => {
                return {
                    applicationId: role.application.applicationId,
                    isInternal: role.isInternal,
                    isOptional: role.isOptional,
                    isVisible: role.isVisible,
                    roleCode: role.roleCode,
                    roleId: role.roleId,
                    roleType: role.roleType,
                };
            }));
            /** @type {?} */
            const encryptRoles = this.encrypt(JSON.stringify(roles));
            sessionStorage.setItem('userRolesV6', encryptRoles);
        }
    }
    /**
     * @return {?}
     */
    getDCMApplications() {
        /** @type {?} */
        const endpoint = this.http.generateEndpoint(SessionServiceConstants.USER_APPLICATION_MENU);
        return this.http.get(endpoint).pipe(map((/**
         * @param {?} response
         * @return {?}
         */
        (response) => {
            /** @type {?} */
            const tmpJson = response.json();
            if (!tmpJson || tmpJson === undefined) {
                console.warn('Configuration of menu application is empty!!');
                return [];
            }
            /** @type {?} */
            const responseMap = (/** @type {?} */ (response.json()));
            return responseMap;
        })), catchError((/**
         * @param {?} e
         * @return {?}
         */
        (e) => Observable.throw(this.handleError(e)))));
    }
    /**
     * @template T
     * @param {?} obj
     * @return {?}
     */
    convertJsonTo(obj) {
        try {
            /** @type {?} */
            const tmpJson = JSON.parse(obj);
            return (/** @type {?} */ (tmpJson));
        }
        catch (e) {
            console.warn('Exception at parsing object from sessionStore:', e);
        }
        return null;
    }
    /**
     * @return {?}
     */
    get customer() {
        /** @type {?} */
        let result;
        /** @type {?} */
        const str = sessionStorage.getItem('user_customer');
        if (str) {
            try {
                /** @type {?} */
                const profile = JSON.parse(str);
                result = (/** @type {?} */ (profile));
            }
            catch (e) {
                console.warn('Exception at parsing user_customer from sessionStore:', e);
                return null;
            }
        }
        else {
            console.warn('There is no user customer at session storage');
        }
        return result;
    }
    /**
     * @param {?} error
     * @return {?}
     */
    handleError(error) {
        // In a real world app, we might use a remote logging infrastructure
        /** @type {?} */
        let errMsg;
        if (error instanceof Response) {
            /** @type {?} */
            const body = error.json() || '';
            errMsg = `${error.status} - ${error.statusText || ''}`;
        }
        else {
            errMsg = error.message ? error.message : error.toString();
        }
        console.error(error);
        return throwError(error);
    }
    /**
     * @param {?} endpoint
     * @param {?=} fetch
     * @param {?=} page
     * @param {?=} legalEntityCode
     * @return {?}
     */
    addQueryParams(endpoint, fetch, page, legalEntityCode) {
        /** @type {?} */
        const validPagination = Number.isInteger(fetch) && Number.isInteger(page);
        endpoint += validPagination ? '?fetch=' + fetch + '&page=' + page : '';
        endpoint +=
            legalEntityCode && validPagination
                ? '&legalEntityCode=' + legalEntityCode
                : legalEntityCode && !validPagination
                    ? '?legalEntityCode=' + legalEntityCode
                    : '';
        return endpoint;
    }
    /**
     * @return {?}
     */
    logoutApp() {
        this.clean();
        this.eventBroadcaster.broadcast(Broadcaster.DCM_APP_LOGOUT);
    }
    /**
     * @return {?}
     */
    get userAuth() {
        return JSON.parse(this.decrypt(sessionStorage.getItem('userAuthV6')));
    }
    /**
     * @return {?}
     */
    get userInfo() {
        return JSON.parse(this.decrypt(sessionStorage.getItem('userInfoV6')));
    }
    /**
     * @return {?}
     */
    get userProfileV6() {
        return JSON.parse(this.decrypt(sessionStorage.getItem('userProfileV6')));
    }
    /**
     * @return {?}
     */
    get userCustomer() {
        return JSON.parse(this.decrypt(sessionStorage.getItem('userCustomerV6')));
    }
    /**
     * @return {?}
     */
    get userApplications() {
        return JSON.parse(this.decrypt(sessionStorage.getItem('userApplicationsV6')));
    }
    /**
     * @return {?}
     */
    get userRoles() {
        return JSON.parse(this.decrypt(sessionStorage.getItem('userRolesV6')));
    }
    /**
     * @param {?} str
     * @return {?}
     */
    encrypt(str) {
        return window.btoa(unescape(encodeURIComponent(str)));
    }
    /**
     * @param {?} str
     * @return {?}
     */
    decrypt(str) {
        return str ? decodeURIComponent(escape(window.atob(str))) : str;
    }
}
SessionService.LOGIN_SUCCESS_EVENT = 'LOGIN_SUCCESS_EVENT';
SessionService.LOGIN_FAIL_EVENT = 'LOGIN_FAIL_EVENT';
SessionService.LOGIN_LOGOUT_EVENT = 'LOGIN_LOGOUT_EVENT';
SessionService.AUTH_TOKEN_VERSION = 'auth_token_version';
SessionService.decorators = [
    { type: Injectable }
];
/** @nocollapse */
SessionService.ctorParameters = () => [
    { type: HttpCemex },
    { type: Broadcaster },
    { type: String, decorators: [{ type: Inject, args: [SessionService.AUTH_TOKEN_VERSION,] }, { type: Optional }] }
];
if (false) {
    /** @type {?} */
    SessionService.LOGIN_SUCCESS_EVENT;
    /** @type {?} */
    SessionService.LOGIN_FAIL_EVENT;
    /** @type {?} */
    SessionService.LOGIN_LOGOUT_EVENT;
    /** @type {?} */
    SessionService.AUTH_TOKEN_VERSION;
    /**
     * @type {?}
     * @private
     */
    SessionService.prototype.siteDomain;
    /**
     * @type {?}
     * @private
     */
    SessionService.prototype._siteDomain;
    /**
     * @type {?}
     * @private
     */
    SessionService.prototype._endpoint;
    /**
     * @type {?}
     * @private
     */
    SessionService.prototype._menuApplication;
    /**
     * @type {?}
     * @private
     */
    SessionService.prototype._currentLegalEntity;
    /**
     * @type {?}
     * @private
     */
    SessionService.prototype._userProfile;
    /**
     * @type {?}
     * @private
     */
    SessionService.prototype._beforeLogout;
    /**
     * @type {?}
     * @protected
     */
    SessionService.prototype.http;
    /**
     * @type {?}
     * @protected
     */
    SessionService.prototype.eventBroadcaster;
    /**
     * @type {?}
     * @private
     */
    SessionService.prototype.authTokenVersion;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2Vzc2lvbi5zZXJ2aWNlLmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGNlbWV4LWNvcmUvYW5ndWxhci1zZXJ2aWNlcy12Ny8iLCJzb3VyY2VzIjpbImxpYi9zZXNzaW9uLnNlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBQSxPQUFPLEVBQUUsTUFBTSxFQUFFLFVBQVUsRUFBRSxRQUFRLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDN0QsT0FBTyxFQUFFLE9BQU8sRUFBRSxjQUFjLEVBQUUsUUFBUSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBRWxFLE9BQU8sRUFBRSxlQUFlLEVBQUUsVUFBVSxFQUFFLFVBQVUsRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUMvRCxPQUFPLEVBQUUsR0FBRyxFQUFFLFVBQVUsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBRWpELE9BQU8sRUFBRSx1QkFBdUIsRUFBRSxNQUFNLCtCQUErQixDQUFDO0FBQ3hFLE9BQU8sRUFBRSxXQUFXLEVBQUUsTUFBTSx1QkFBdUIsQ0FBQztBQVFwRCxPQUFPLEVBQUUsU0FBUyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFRM0MsTUFBTSxPQUFPLGNBQWM7Ozs7OztJQWN6QixZQUNZLElBQWUsRUFDZixnQkFBNkIsRUFHL0IsZ0JBQXdCO1FBSnRCLFNBQUksR0FBSixJQUFJLENBQVc7UUFDZixxQkFBZ0IsR0FBaEIsZ0JBQWdCLENBQWE7UUFHL0IscUJBQWdCLEdBQWhCLGdCQUFnQixDQUFRO1FBYjFCLGVBQVUsR0FBRyxhQUFhLENBQUM7UUFDM0IsZ0JBQVcsR0FBRyxNQUFNLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxJQUFJLEVBQUUsQ0FBQztRQUU1QyxxQkFBZ0IsR0FBRyxJQUFJLGVBQWUsQ0FBcUIsRUFBRSxDQUFDLENBQUM7UUFDL0Qsd0JBQW1CLEdBQUcsSUFBSSxlQUFlLENBQWUsSUFBSSxDQUFDLENBQUM7UUFDOUQsaUJBQVksR0FBaUIsSUFBSSxDQUFDO1FBQ2xDLGtC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b0Q7Ozs7O0lBQ3BELG1DQUEwQjs7Ozs7SUFDMUIsMENBQXVFOzs7OztJQUN2RSw2Q0FBc0U7Ozs7O0lBQ3RFLHNDQUEwQzs7Ozs7SUFDMUMsdUNBQThDOzs7OztJQUc1Qyw4QkFBeUI7Ozs7O0lBQ3pCLDBDQUF1Qzs7Ozs7SUFDdkMsMENBRWdDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSW5qZWN0LCBJbmplY3RhYmxlLCBPcHRpb25hbCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgSGVhZGVycywgUmVxdWVzdE9wdGlvbnMsIFJlc3BvbnNlIH0gZnJvbSAnQGFuZ3VsYXIvaHR0cCc7XG5cbmltcG9ydCB7IEJlaGF2aW9yU3ViamVjdCwgT2JzZXJ2YWJsZSwgdGhyb3dFcnJvciB9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHsgbWFwLCBjYXRjaEVycm9yIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xuXG5pbXBvcnQgeyBTZXNzaW9uU2VydmljZUNvbnN0YW50cyB9IGZyb20gJ0BjZW1leC1jb3JlL2NvbnN0YW50cy12Mi9kaXN0JztcbmltcG9ydCB7IEJyb2FkY2FzdGVyIH0gZnJvbSAnQGNlbWV4LWNvcmUvZXZlbnRzLXY3JztcbmltcG9ydCB7XG4gIElBcHBsaWNhdGlvbk1lbnUsXG4gIElDdXN0b21lcixcbiAgSUxlZ2FsRW50aXR5LFxuICBJVXNlclByb2ZpbGVcbn0gZnJvbSAnQGNlbWV4LWNvcmUvdHlwZXMtdjIvZGlzdC9pbmRleC5pbnRlcmZhY2UnO1xuXG5pbXBvcnQgeyBIdHRwQ2VtZXggfSBmcm9tICcuL2h0dHAuc2VydmljZSc7XG5pbXBvcnQgeyBQcm9maWxlIH0gZnJvbSAnLi9tb2RlbHMvcHJvZmlsZSc7XG5pbXBvcnQgeyBDdXN0b21lciB9IGZyb20gJy4vbW9kZWxzL2N1c3RvbWVyJztcbmltcG9ydCB7IFVzZXIgfSBmcm9tICcuL21vZGVscy91c2VyJztcbmltcG9ydCB7IFJvbGUgfSBmcm9tICcuL21vZGVscy9yb2xlJztcbmltcG9ydCB7IEFwcGxpY2F0aW9uIH0gZnJvbSAnLi9tb2RlbHMvYXBwbGljYXRpb24nO1xuXG5ASW5qZWN0YWJsZSgpXG5leHBvcnQgY2xhc3MgU2Vzc2lvblNlcnZpY2Uge1xuICBwdWJsaWMgc3RhdGljIExPR0lOX1NVQ0NFU1NfRVZFTlQgPSAnTE9HSU5fU1VDQ0VTU19FVkVOVCc7XG4gIHB1YmxpYyBzdGF0aWMgTE9HSU5fRkFJTF9FVkVOVCA9ICdMT0dJTl9GQUlMX0VWRU5UJztcbiAgcHVibGljIHN0YXRpYyBMT0dJTl9MT0dPVVRfRVZFTlQgPSAnTE9HSU5fTE9HT1VUX0VWRU5UJztcbiAgcHVibGljIHN0YXRpYyBBVVRIX1RPS0VOX1ZFUlNJT04gPSAnYXV0aF90b2tlbl92ZXJzaW9uJztcblxuICBwcml2YXRlIHNpdGVEb21haW4gPSAnU0lURV9ET01BSU4nO1xuICBwcml2YXRlIF9zaXRlRG9tYWluID0gd2luZG93W3RoaXMuc2l0ZURvbWFpbl0gfHwgJyc7XG4gIHByaXZhdGUgX2VuZHBvaW50OiBzdHJpbmc7XG4gIHByaXZhdGUgX21lbnVBcHBsaWNhdGlvbiA9IG5ldyBCZWhhdmlvclN1YmplY3Q8SUFwcGxpY2F0aW9uTWVudVtdPihbXSk7XG4gIHByaXZhdGUgX2N1cnJlbnRMZWdhbEVudGl0eSA9IG5ldyBCZWhhdmlvclN1YmplY3Q8SUxlZ2FsRW50aXR5PihudWxsKTtcbiAgcHJpdmF0ZSBfdXNlclByb2ZpbGU6IElVc2VyUHJvZmlsZSA9IG51bGw7XG4gIHByaXZhdGUgX2JlZm9yZUxvZ291dDogT2JzZXJ2YWJsZTxhbnk+ID0gbnVsbDtcblxuICBjb25zdHJ1Y3RvcihcbiAgICBwcm90ZWN0ZWQgaHR0cDogSHR0cENlbWV4LFxuICAgIHByb3RlY3RlZCBldmVudEJyb2FkY2FzdGVyOiBCcm9hZGNhc3RlcixcbiAgICBASW5qZWN0KFNlc3Npb25TZXJ2aWNlLkFVVEhfVE9LRU5fVkVSU0lPTilcbiAgICBAT3B0aW9uYWwoKVxuICAgIHByaXZhdGUgYXV0aFRva2VuVmVyc2lvbjogc3RyaW5nXG4gICkge1xuICAgIGlmIChhdXRoVG9rZW5WZXJzaW9uKSB7XG4gICAgICBzd2l0Y2ggKGF1dGhUb2tlblZlcnNpb24udG9Mb2NhbGVMb3dlckNhc2UoKSkge1xuICAgICAgICBjYXNlICd2Nic6XG4gICAgICAgICAgdGhpcy5fZW5kcG9pbnQgPSBTZXNzaW9uU2VydmljZUNvbnN0YW50cy5MT0dJTl9UT0tFTl9WNjtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICB0aGlzLl9lbmRwb2ludCA9IFNlc3Npb25TZXJ2aWNlQ29uc3RhbnRzLkxPR0lOX1RPS0VOX0RFRkFVTFQ7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuX2VuZHBvaW50ID0gU2Vzc2lvblNlcnZpY2VDb25zdGFudHMuTE9HSU5fVE9LRU5fREVGQVVMVDtcbiAgICB9XG4gICAgaWYgKFxuICAgICAgbG9jYWxTdG9yYWdlLmdldEl0ZW0oJ2xhbmd1YWdlJykgPT09IHVuZGVmaW5lZCB8fFxuICAgICAgKGxvY2FsU3RvcmFnZS5nZXRJdGVtKCdsYW5ndWFnZScpID09PSBudWxsICYmXG4gICAgICAgIChzZXNzaW9uU3RvcmFnZS5nZXRJdGVtKCdsYW5ndWFnZScpICE9PSB1bmRlZmluZWQgJiYgc2Vzc2lvblN0b3JhZ2UuZ2V0SXRlbSgnbGFuZ3VhZ2UnKSAhPT0gbnVsbCkpXG4gICAgKSB7XG4gICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSgnbGFuZ3VhZ2UnLCBzZXNzaW9uU3RvcmFnZS5nZXRJdGVtKCdsYW5ndWFnZScpKTtcbiAgICB9XG4gIH1cblxuICBwdWJsaWMgZ2V0IG1lbnVBcHBsaWNhdGlvbkl0ZW1zKCk6IE9ic2VydmFibGU8SUFwcGxpY2F0aW9uTWVudVtdPiB7XG4gICAgaWYgKHRoaXMuX21lbnVBcHBsaWNhdGlvbi5nZXRWYWx1ZSgpLmxlbmd0aCA9PT0gMCkge1xuICAgICAgdGhpcy5yZWxvYWRBcHBNZW51SXRlbXMoKTtcbiAgICB9XG4gICAgcmV0dXJuIHRoaXMuX21lbnVBcHBsaWNhdGlvbi5hc09ic2VydmFibGUoKTtcbiAgfVxuXG4gIHB1YmxpYyBzZXRMZWdhbEVudGl0eSh2YWx1ZTogSUxlZ2FsRW50aXR5KSB7XG4gICAgc2Vzc2lvblN0b3JhZ2Uuc2V0SXRlbSgndXNlcl9sZWdhbF9lbnRpdHknLCBKU09OLnN0cmluZ2lmeSh2YWx1ZSkpO1xuICAgIHRoaXMuZXZlbnRCcm9hZGNhc3Rlci5icm9hZGNhc3QoQnJvYWRjYXN0ZXIuRENNX0xFR0FMX0VOVElUWV9DSEFOR0UsIEpTT04uc3RyaW5naWZ5KHZhbHVlKSk7XG4gICAgdGhpcy5fY3VycmVudExlZ2FsRW50aXR5Lm5leHQodmFsdWUpO1xuICB9XG5cbiAgcHVibGljIGdldCBjdXJyZW50TGVnYWxFbnRpdHkoKTogT2JzZXJ2YWJsZTxJTGVnYWxFbnRpdHk+IHtcbiAgICByZXR1cm4gdGhpcy5fY3VycmVudExlZ2FsRW50aXR5LmFzT2JzZXJ2YWJsZSgpO1xuICB9XG5cbiAgcHVibGljIGdldCBpc0xvZ2dlZEluKCk6IGJvb2xlYW4ge1xuICAgIGNvbnN0IGFjY2Vzc1Rva2VuID0gc2Vzc2lvblN0b3JhZ2UuZ2V0SXRlbSgnYWNjZXNzX3Rva2VuJyk7XG4gICAgY29uc3Qgand0VG9rZW4gPSBzZXNzaW9uU3RvcmFnZS5nZXRJdGVtKCdqd3QnKTtcbiAgICByZXR1cm4gKFxuICAgICAgYWNjZXNzVG9rZW4gIT09IG51bGwgJiZcbiAgICAgIGFjY2Vzc1Rva2VuICE9PSB1bmRlZmluZWQgJiZcbiAgICAgIGFjY2Vzc1Rva2VuICE9PSAnJyAmJlxuICAgICAgand0VG9rZW4gIT0gbnVsbCAmJlxuICAgICAgand0VG9rZW4gIT09IHVuZGVmaW5lZCAmJlxuICAgICAgand0VG9rZW4gIT09ICcnXG4gICAgKTtcbiAgfVxuXG4gIHB1YmxpYyBsb2dvdXQoKTogT2JzZXJ2YWJsZTx7XG4gICAgc3VjY2VzczogYm9vbGVhbjtcbiAgICBtZXNzYWdlOiBzdHJpbmc7XG4gIH0+IHtcbiAgICByZXR1cm4gbmV3IE9ic2VydmFibGUob2JzZXJ2ZXIgPT4ge1xuICAgICAgaWYgKHRoaXMuX2JlZm9yZUxvZ291dCkge1xuICAgICAgICB0aGlzLl9iZWZvcmVMb2dvdXQuc3Vic2NyaWJlKFxuICAgICAgICAgIHJlc3VsdCA9PiB7XG4gICAgICAgICAgICB0aGlzLmxvZ291dEFwcCgpO1xuICAgICAgICAgICAgb2JzZXJ2ZXIubmV4dCh7XG4gICAgICAgICAgICAgIG1lc3NhZ2U6ICdzdWNjZXNzJyxcbiAgICAgICAgICAgICAgc3VjY2VzczogdHJ1ZVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBlcnJvciA9PiB7XG4gICAgICAgICAgICBvYnNlcnZlci5uZXh0KHtcbiAgICAgICAgICAgICAgbWVzc2FnZTogZXJyb3IsXG4gICAgICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9XG4gICAgICAgICk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLmxvZ291dEFwcCgpO1xuICAgICAgICBvYnNlcnZlci5uZXh0KHtcbiAgICAgICAgICBtZXNzYWdlOiAnc3VjY2VzcycsXG4gICAgICAgICAgc3VjY2VzczogdHJ1ZVxuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIG9ic2VydmVyO1xuICAgIH0pO1xuICB9XG5cbiAgcHVibGljIGxvZ2luKFxuICAgIHVzZXI6IHN0cmluZyxcbiAgICBwYXNzd29yZDogc3RyaW5nLFxuICAgIGdlbmVyYXRlQ29va2llPzogYm9vbGVhbixcbiAgICBhcHBOYW1lPzogc3RyaW5nLFxuICAgIHZhbGlkYXRlVGVtcFBhc3N3b3JkPzogYm9vbGVhblxuICApOiBQcm9taXNlPGFueT4ge1xuICAgIHRoaXMuY2xlYW4oKTtcbiAgICBjb25zdCBvcHRpb25zID0gbmV3IFJlcXVlc3RPcHRpb25zKHtcbiAgICAgIGhlYWRlcnM6IG5ldyBIZWFkZXJzKHtcbiAgICAgICAgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi94LXd3dy1mb3JtLXVybGVuY29kZWQnLFxuICAgICAgICBhY2NlcHQ6ICd0ZXh0L3BsYWluLCAqLyonXG4gICAgICB9KVxuICAgIH0pO1xuXG4gICAgY29uc3QgZW5kcG9pbnQgPSB0aGlzLmh0dHAuZ2VuZXJhdGVFbmRwb2ludCh0aGlzLl9lbmRwb2ludCk7XG4gICAgY29uc3QgdXJsUG9zdCA9IHRoaXMuZ2VuZXJhdGVVcmxTdHJpbmcodXNlciwgcGFzc3dvcmQsIGFwcE5hbWUpO1xuICAgIHJldHVybiB0aGlzLmh0dHBcbiAgICAgIC5wb3N0KGVuZHBvaW50LCB1cmxQb3N0LCBvcHRpb25zKVxuICAgICAgLnRvUHJvbWlzZSgpXG4gICAgICAudGhlbihhc3luYyByZXNwb25zZSA9PiB7XG4gICAgICAgIGNvbnN0IGRhdGEgPSByZXNwb25zZS5qc29uKCk7XG5cbiAgICAgICAgY29uc3QgdXNlcklkID1cbiAgICAgICAgICB0aGlzLmF1dGhUb2tlblZlcnNpb24gPT09ICd2NidcbiAgICAgICAgICAgID8gZGF0YS51c2VySWRcbiAgICAgICAgICAgICAgPyBkYXRhLnVzZXJJZFxuICAgICAgICAgICAgICA6IGRhdGEucHJvZmlsZS51c2VySWRcbiAgICAgICAgICAgIDogZGF0YS5wcm9maWxlLnVzZXJJZDtcbiAgICAgICAgdGhpcy5wcm9jZXNzRGF0YUZyb21Mb2dpbihkYXRhLCBnZW5lcmF0ZUNvb2tpZSk7XG5cbiAgICAgICAgdGhpcy5ldmVudEJyb2FkY2FzdGVyLmJyb2FkY2FzdChTZXNzaW9uU2VydmljZS5MT0dJTl9TVUNDRVNTX0VWRU5UKTtcblxuICAgICAgICBpZiAoXG4gICAgICAgICAgdmFsaWRhdGVUZW1wUGFzc3dvcmQgJiZcbiAgICAgICAgICBkYXRhLnByb2ZpbGUgJiZcbiAgICAgICAgICBkYXRhLnByb2ZpbGUuaGFzVGVtcG9yYXJ5UGFzc3dvcmRcbiAgICAgICAgKSB7XG4gICAgICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZShkYXRhKTtcbiAgICAgICAgfVxuICAgICAgfSlcbiAgICAgIC5jYXRjaChlcnJvciA9PiB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpO1xuICAgICAgICB0aGlzLmV2ZW50QnJvYWRjYXN0ZXIuYnJvYWRjYXN0KFNlc3Npb25TZXJ2aWNlLkxPR0lOX0ZBSUxfRVZFTlQpO1xuICAgICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoZXJyb3IpO1xuICAgICAgfSk7XG4gIH1cblxuICBwdWJsaWMgZ2V0IHVzZXJSZWdpb24oKTogc3RyaW5nIHtcbiAgICByZXR1cm4gc2Vzc2lvblN0b3JhZ2UuZ2V0SXRlbSgncmVnaW9uJykgfHwgJ1VTJztcbiAgfVxuXG4gIHB1YmxpYyBnZXQgdXNlckNvdW50cnkoKTogc3RyaW5nIHtcbiAgICByZXR1cm4gc2Vzc2lvblN0b3JhZ2UuZ2V0SXRlbSgnY291bnRyeScpIHx8ICcnO1xuICB9XG5cbiAgcHVibGljIGdldCB1c2VyUHJvZmlsZSgpOiBJVXNlclByb2ZpbGUge1xuICAgIGlmICghdGhpcy5fdXNlclByb2ZpbGUpIHtcbiAgICAgIHRoaXMuc2V0VXNlclByb2ZpbGUoKTtcbiAgICB9XG5cbiAgICByZXR1cm4gdGhpcy5fdXNlclByb2ZpbGU7XG4gIH1cblxuICBwdWJsaWMgZ2V0TGVnYWxFbnRpdGllcyhcbiAgICBmZXRjaD86IG51bWJlcixcbiAgICBwYWdlPzogbnVtYmVyLFxuICAgIGxlZ2FsRW50aXR5Q29kZT86IHN0cmluZyxcbiAgKTogT2JzZXJ2YWJsZTxJTGVnYWxFbnRpdHlbXT4ge1xuICAgIGxldCBlbmRwb2ludCA9IHRoaXMuaHR0cC5nZW5lcmF0ZUVuZHBvaW50KFNlc3Npb25TZXJ2aWNlQ29uc3RhbnRzLlVTRVJfTEVHQUxfRU5USVRJRVMpO1xuICAgIGVuZHBvaW50ID0gdGhpcy5hZGRRdWVyeVBhcmFtcyhlbmRwb2ludCwgZmV0Y2gsIHBhZ2UsIGxlZ2FsRW50aXR5Q29kZSk7XG5cbiAgICByZXR1cm4gdGhpcy5odHRwLmdldChlbmRwb2ludCkucGlwZShcbiAgICAgIG1hcCgocmVzcG9uc2U6IFJlc3BvbnNlKSA9PiB7XG4gICAgICAgIGxldCByZXNwb25zZU1hcCA9IFtdO1xuICAgICAgICBjb25zdCB0bXBKc29uID0gcmVzcG9uc2UuanNvbigpO1xuICAgICAgICBpZiAodG1wSnNvbikge1xuICAgICAgICAgIHJlc3BvbnNlTWFwID0gcmVzcG9uc2UuanNvbigpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiByZXNwb25zZU1hcDtcbiAgICAgIH0pLFxuICAgICAgY2F0Y2hFcnJvcihlID0+IE9ic2VydmFibGUudGhyb3codGhpcy5oYW5kbGVFcnJvcihlKSkpXG4gICAgKTtcbiAgfVxuXG4gIHB1YmxpYyBzZXRCZWZvcmVMb2dvdXQobWV0aG9kOiBPYnNlcnZhYmxlPGFueT4pOiB2b2lkIHtcbiAgICB0aGlzLl9iZWZvcmVMb2dvdXQgPSBtZXRob2Q7XG4gIH1cblxuICBwdWJsaWMgZ2V0QmVmb3JlTG9nb3V0KCk6IE9ic2VydmFibGU8YW55PiB7XG4gICAgcmV0dXJuIHRoaXMuX2JlZm9yZUxvZ291dDtcbiAgfVxuXG4gIHB1YmxpYyByZWxvYWRBcHBNZW51SXRlbXMoKTogdm9pZCB7XG4gICAgdGhpcy5nZXREQ01BcHBsaWNhdGlvbnMoKS5zdWJzY3JpYmUocmVzdWx0ID0+IHtcbiAgICAgIHRoaXMuX21lbnVBcHBsaWNhdGlvbi5uZXh0KHJlc3VsdCk7XG4gICAgfSk7XG4gIH1cblxuICBwdWJsaWMgY3JlYXRlQ29va2llKG5hbWU6IHN0cmluZywgdmFsdWU6IHN0cmluZywgZGF5cz86IG51bWJlcikge1xuICAgIGxldCBleHBpcmVzID0gJyc7XG4gICAgaWYgKGRheXMpIHtcbiAgICAgIGNvbnN0IGRhdGUgPSBuZXcgRGF0ZSgpO1xuICAgICAgZGF0ZS5zZXRUaW1lKGRhdGUuZ2V0VGltZSgpICsgZGF5cyAqIDI0ICogNjAgKiA2MCAqIDEwMDApO1xuICAgICAgZXhwaXJlcyA9IGRhdGUudG9VVENTdHJpbmcoKTtcbiAgICB9IGVsc2Uge1xuICAgICAgZGF5cyA9IDA7XG4gICAgfVxuXG4gICAgY29uc3QgY29va2llID0gYCR7bmFtZX09JHt2YWx1ZX07ZXhwaXJlcz0ke2V4cGlyZXN9O2RvbWFpbj0ke3RoaXMuX3NpdGVEb21haW59O3BhdGg9L2A7XG4gICAgZG9jdW1lbnQuY29va2llID0gY29va2llO1xuICB9XG5cbiAgcHVibGljIHJlYWRDb29raWUobmFtZTogc3RyaW5nKTogc3RyaW5nIHtcbiAgICBjb25zdCBjYSA9IGRvY3VtZW50LmNvb2tpZS5zcGxpdCgnOycpO1xuICAgIGNvbnN0IGNhTGVuOiBudW1iZXIgPSBjYS5sZW5ndGg7XG4gICAgY29uc3QgY29va2llTmFtZSA9IGAke25hbWV9PWA7XG4gICAgbGV0IGM6IHN0cmluZztcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGNhTGVuOyBpICs9IDEpIHtcbiAgICAgIGMgPSBjYVtpXS5yZXBsYWNlKC9eXFxzKy9nLCAnJyk7XG4gICAgICBpZiAoYy5pbmRleE9mKGNvb2tpZU5hbWUpID09PSAwKSB7XG4gICAgICAgIHJldHVybiBjLnN1YnN0cmluZyhjb29raWVOYW1lLmxlbmd0aCwgYy5sZW5ndGgpO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gbnVsbDtcbiAgfVxuXG4gIHB1YmxpYyBjbGVhckNvb2tpZShuYW1lKSB7XG4gICAgdGhpcy5jcmVhdGVDb29raWUobmFtZSwgJycsIC0xKTtcbiAgfVxuXG4gIHB1YmxpYyBzZXRVc2VyUHJvZmlsZSgpOiB2b2lkIHtcbiAgICBjb25zdCBzdHJQcm9maWxlOiBzdHJpbmcgPSBzZXNzaW9uU3RvcmFnZS5nZXRJdGVtKCd1c2VyX3Byb2ZpbGUnKTtcbiAgICBjb25zdCB0bXBQcm9maWxlOiBJVXNlclByb2ZpbGUgPSB0aGlzLmNvbnZlcnRKc29uVG88SVVzZXJQcm9maWxlPihzdHJQcm9maWxlKTtcbiAgICBpZiAodG1wUHJvZmlsZSkge1xuICAgICAgY29uc3Qgc3RyQ3VzdG9tZXI6IHN0cmluZyA9IHNlc3Npb25TdG9yYWdlLmdldEl0ZW0oJ3VzZXJfY3VzdG9tZXInKTtcbiAgICAgIGNvbnN0IHVzZXJDdXN0b21lciA9IHRoaXMuY29udmVydEpzb25UbzxJQ3VzdG9tZXI+KHN0ckN1c3RvbWVyKTtcbiAgICAgIGlmICh1c2VyQ3VzdG9tZXIpIHtcbiAgICAgICAgdG1wUHJvZmlsZS5jdXN0b21lciA9IHVzZXJDdXN0b21lcjtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGNvbnNvbGUud2FybignRXhjZXB0aW9uIGF0IHBhcnNpbmcgVXNlciBDdXN0b21lciBmcm9tIHNlc3Npb25TdG9yZScpO1xuICAgICAgfVxuXG4gICAgICB0aGlzLl91c2VyUHJvZmlsZSA9IHRtcFByb2ZpbGU7XG4gICAgfSBlbHNlIHtcbiAgICAgIGNvbnNvbGUud2FybignRXhjZXB0aW9uIGF0IHBhcnNpbmcgVXNlciBQcm9maWxlIGZyb20gc2Vzc2lvblN0b3JlJyk7XG4gICAgfVxuICB9XG5cbiAgcHVibGljIGNsZWFuKCk6IHZvaWQge1xuICAgIHRoaXMuY2xlYXJDb29raWUoJ0NlbWV4R29SZWdpb24nKTtcbiAgICB0aGlzLmNsZWFyQ29va2llKCd1cF9zZXNzaW9uJyk7XG4gICAgc2Vzc2lvblN0b3JhZ2UucmVtb3ZlSXRlbSgnYWNjZXNzX3Rva2VuJyk7XG4gICAgc2Vzc2lvblN0b3JhZ2UucmVtb3ZlSXRlbSgncmVmcmVzaF90b2tlbicpO1xuICAgIHNlc3Npb25TdG9yYWdlLnJlbW92ZUl0ZW0oJ2V4cGlyZXNfaW4nKTtcbiAgICBzZXNzaW9uU3RvcmFnZS5yZW1vdmVJdGVtKCdqd3QnKTtcbiAgICBzZXNzaW9uU3RvcmFnZS5yZW1vdmVJdGVtKCdyZWdpb24nKTtcbiAgICBzZXNzaW9uU3RvcmFnZS5yZW1vdmVJdGVtKCd1c2VyX3Byb2ZpbGUnKTtcbiAgICBzZXNzaW9uU3RvcmFnZS5yZW1vdmVJdGVtKCd1c2VyX2N1c3RvbWVyJyk7XG4gICAgc2Vzc2lvblN0b3JhZ2UucmVtb3ZlSXRlbSgndXNlcl9sZWdhbF9lbnRpdHknKTtcbiAgICBzZXNzaW9uU3RvcmFnZS5yZW1vdmVJdGVtKCd1c2VyX2FwcGxpY2F0aW9ucycpO1xuICAgIC8vIHBhdGNoLWZpeCBmb3IgcmVhY3RcbiAgICBzZXNzaW9uU3RvcmFnZS5yZW1vdmVJdGVtKCdhdXRoX3Rva2VuJyk7XG4gICAgc2Vzc2lvblN0b3JhZ2UucmVtb3ZlSXRlbSgndXNlckluZm8nKTtcbiAgICBzZXNzaW9uU3RvcmFnZS5yZW1vdmVJdGVtKCdjb3VudHJ5Jyk7XG4gICAgc2Vzc2lvblN0b3JhZ2UucmVtb3ZlSXRlbSgndG9rZW5fZGF0YScpO1xuICAgIHNlc3Npb25TdG9yYWdlLnJlbW92ZUl0ZW0oJ2FwcGxpY2F0aW9ucycpO1xuICAgIHNlc3Npb25TdG9yYWdlLnJlbW92ZUl0ZW0oJ3JvbGUnKTtcbiAgICBzZXNzaW9uU3RvcmFnZS5yZW1vdmVJdGVtKCd1c2VybmFtZScpO1xuXG4gICAgLy8gbmV3IHZlcnNzaW9uIEFQSSAoIHY2IClcbiAgICBzZXNzaW9uU3RvcmFnZS5yZW1vdmVJdGVtKCd1c2VyQXV0aFY2Jyk7XG4gICAgc2Vzc2lvblN0b3JhZ2UucmVtb3ZlSXRlbSgndXNlckluZm9WNicpO1xuICAgIHNlc3Npb25TdG9yYWdlLnJlbW92ZUl0ZW0oJ3VzZXJQcm9maWxlVjYnKTtcbiAgICBzZXNzaW9uU3RvcmFnZS5yZW1vdmVJdGVtKCd1c2VyQ3VzdG9tZXJWNicpO1xuICAgIHNlc3Npb25TdG9yYWdlLnJlbW92ZUl0ZW0oJ3VzZXJBcHBsaWNhdGlvbnNWNicpO1xuICAgIHNlc3Npb25TdG9yYWdlLnJlbW92ZUl0ZW0oJ3VzZXJSb2xlc1Y2Jyk7XG4gIH1cblxuICBwdWJsaWMgZ2VuZXJhdGVVcmxTdHJpbmcoXG4gICAgdXNlcjogc3RyaW5nLFxuICAgIHBhc3N3b3JkOiBzdHJpbmcsXG4gICAgYXBwTmFtZT86IHN0cmluZ1xuICApOiBzdHJpbmcge1xuICAgIGNvbnN0IGluY2x1ZGUgPSAnJmluY2x1ZGU9dXNlcmluZm8scHJvZmlsZSxhcHBsaWNhdGlvbnMscm9sZXMsY3VzdG9tZXJzLG9sZFZlcnNpb24nO1xuICAgIGxldCB1cmwgPVxuICAgICAgJ2dyYW50X3R5cGU9cGFzc3dvcmQmc2NvcGU9c2VjdXJpdHkmdXNlcm5hbWU9JyArXG4gICAgICB1c2VyICtcbiAgICAgICcmcGFzc3dvcmQ9JyArXG4gICAgICBlbmNvZGVVUklDb21wb25lbnQocGFzc3dvcmQpICtcbiAgICAgICcmY2xpZW50X2lkPScgK1xuICAgICAgdGhpcy5odHRwLmNsaWVudElkO1xuXG4gICAgaWYgKGFwcE5hbWUpIHsgdXJsID0gdXJsICsgJyZhcHBfbmFtZT0nICsgYXBwTmFtZTsgfVxuICAgIGlmICh0aGlzLmF1dGhUb2tlblZlcnNpb24pIHtcbiAgICAgIGlmICh0aGlzLmF1dGhUb2tlblZlcnNpb24udG9Mb3dlckNhc2UoKSA9PT0gJ3Y2Jykge1xuICAgICAgICB1cmwgPSBgJHt1cmx9JnVzZXJpbmZvcm1hdGlvbj1mYWxzZSR7aW5jbHVkZX1gO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gdXJsO1xuICB9XG5cbiAgcHVibGljIHByb2Nlc3NEYXRhRnJvbUxvZ2luKGRhdGE6IGFueSwgZ2VuZXJhdGVDb29raWU/OiBib29sZWFuKTogdm9pZCB7XG4gICAgLy8gc2Vzc2lvbiBjb29raWVcbiAgICBpZiAoZ2VuZXJhdGVDb29raWUpIHtcbiAgICAgIGNvbnN0IHNlc3Npb25Db29raWUgPSB7XG4gICAgICAgIGF1dGg6IGRhdGEub2F1dGgyLmFjY2Vzc190b2tlbixcbiAgICAgICAgZXhwaXJlc19pbjogZGF0YS5vYXV0aDIuZXhwaXJlc19pbixcbiAgICAgICAgand0OiBkYXRhLmp3dCxcbiAgICAgICAgcmVmcmVzaF90b2tlbjogZGF0YS5vYXV0aDIucmVmcmVzaF90b2tlbixcbiAgICAgICAgcmVnaW9uOiBkYXRhLm9hdXRoMi5yZWdpb24sXG4gICAgICB9O1xuICAgICAgdGhpcy5jcmVhdGVDb29raWUoJ3VwX3Nlc3Npb24nLCBKU09OLnN0cmluZ2lmeShzZXNzaW9uQ29va2llKSwgbnVsbCk7XG4gICAgfVxuXG4gICAgdGhpcy5jcmVhdGVDb29raWUoJ0NlbWV4R29SZWdpb24nLCBkYXRhLm9hdXRoMi5yZWdpb24sIG51bGwpO1xuXG4gICAgc2Vzc2lvblN0b3JhZ2Uuc2V0SXRlbSgnYWNjZXNzX3Rva2VuJywgZGF0YS5vYXV0aDIuYWNjZXNzX3Rva2VuKTtcbiAgICBzZXNzaW9uU3RvcmFnZS5zZXRJdGVtKCdyZWZyZXNoX3Rva2VuJywgZGF0YS5vYXV0aDIucmVmcmVzaF90b2tlbik7XG4gICAgc2Vzc2lvblN0b3JhZ2Uuc2V0SXRlbSgnZXhwaXJlc19pbicsIGRhdGEub2F1dGgyLmV4cGlyZXNfaW4pO1xuICAgIHNlc3Npb25TdG9yYWdlLnNldEl0ZW0oJ2p3dCcsIGRhdGEuand0KTtcbiAgICBzZXNzaW9uU3RvcmFnZS5zZXRJdGVtKCdhdXRoX3Rva2VuJywgZGF0YS5vYXV0aDIuYWNjZXNzX3Rva2VuKTtcbiAgICBzZXNzaW9uU3RvcmFnZS5zZXRJdGVtKCd1c2VyX3Byb2ZpbGUnLCBKU09OLnN0cmluZ2lmeShkYXRhLnByb2ZpbGUpKTtcbiAgICBzZXNzaW9uU3RvcmFnZS5zZXRJdGVtKCd1c2VyX2N1c3RvbWVyJywgSlNPTi5zdHJpbmdpZnkoZGF0YS5jdXN0b21lcikpO1xuICAgIHNlc3Npb25TdG9yYWdlLnNldEl0ZW0oJ3VzZXJfYXBwbGljYXRpb25zJywgSlNPTi5zdHJpbmdpZnkoZGF0YS5hcHBsaWNhdGlvbnMpKTtcblxuICAgIC8vIHJlYWN0XG4gICAgc2Vzc2lvblN0b3JhZ2Uuc2V0SXRlbSgndXNlckluZm8nLCBKU09OLnN0cmluZ2lmeShkYXRhKSk7XG4gICAgc2Vzc2lvblN0b3JhZ2Uuc2V0SXRlbSgnY291bnRyeScsIGRhdGEuY291bnRyeSk7XG4gICAgc2Vzc2lvblN0b3JhZ2Uuc2V0SXRlbSgndG9rZW5fZGF0YScsIEpTT04uc3RyaW5naWZ5KGRhdGEpKTtcbiAgICBzZXNzaW9uU3RvcmFnZS5zZXRJdGVtKCdhcHBsaWNhdGlvbnMnLCBKU09OLnN0cmluZ2lmeShkYXRhLmFwcGxpY2F0aW9ucykpO1xuXG4gICAgc2Vzc2lvblN0b3JhZ2Uuc2V0SXRlbSgncmVnaW9uJywgZGF0YS5vYXV0aDIucmVnaW9uKTtcbiAgICBzZXNzaW9uU3RvcmFnZS5zZXRJdGVtKCdyb2xlJywgZGF0YS5yb2xlKTtcbiAgICBzZXNzaW9uU3RvcmFnZS5zZXRJdGVtKCd1c2VybmFtZScsIGRhdGEucHJvZmlsZS51c2VyQWNjb3VudCk7XG5cbiAgICB0aGlzLnNldFVzZXJQcm9maWxlKCk7XG5cbiAgICAgICAgLy8gY2FsbCBBUEkgVjYgKCBOZXcgTW9kZWwpXG4gICAgICAgIGNvbnN0IGFjY2Vzc1RvS2VuID0ge1xuICAgICAgICAgIG9hdXRoMjogZGF0YS5vYXV0aDIsXG4gICAgICAgICAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOm9iamVjdC1saXRlcmFsLXNvcnQta2V5c1xuICAgICAgICAgIGp3dDogZGF0YS5qd3QsXG4gICAgICAgICAgdXNlcklkOiBkYXRhLnVzZXJJZCA/IGRhdGEudXNlcklkIDogZGF0YS5wcm9maWxlLnVzZXJJZCxcbiAgICAgICAgfTtcbiAgICAgICAgY29uc3QgZW5jcnlwdERhdGEgPSB0aGlzLmVuY3J5cHQoSlNPTi5zdHJpbmdpZnkoYWNjZXNzVG9LZW4pKTtcbiAgICAgICAgc2Vzc2lvblN0b3JhZ2Uuc2V0SXRlbSgndXNlckF1dGhWNicsIGVuY3J5cHREYXRhKTtcblxuICAgICAgICBpZiAoZGF0YS5fdXNlcnMpIHtcbiAgICAgICAgICBjb25zdCBmaXJzdFVzZXIgPSBkYXRhLl91c2Vyc1swXTtcbiAgICAgICAgICBjb25zdCB1c2VyOiBVc2VyID0ge1xuICAgICAgICAgICAgYWNjb3VudFR5cGU6IGZpcnN0VXNlci5hY2NvdW50VHlwZSxcbiAgICAgICAgICAgIGNvdW50cnlDb2RlOiBmaXJzdFVzZXIuY291bnRyeS5jb3VudHJ5Q29kZSxcbiAgICAgICAgICAgIGN1c3RvbWVySWQ6IChmaXJzdFVzZXIuY3VzdG9tZXIpID8gZmlyc3RVc2VyLmN1c3RvbWVyLmN1c3RvbWVySWQgOiAwLFxuICAgICAgICAgICAgZmlyc3ROYW1lOiBmaXJzdFVzZXIuZmlyc3ROYW1lLFxuICAgICAgICAgICAgZnVsbE5hbWU6IGZpcnN0VXNlci5mdWxsTmFtZSxcbiAgICAgICAgICAgIGxhc3ROYW1lOiBmaXJzdFVzZXIubGFzdE5hbWUsXG4gICAgICAgICAgICBwaG9uZU51bWJlcjogZmlyc3RVc2VyLnBob25lTnVtYmVyLFxuICAgICAgICAgICAgdXNlckFjY291bnQ6IGZpcnN0VXNlci51c2VyQWNjb3VudCxcbiAgICAgICAgICAgIHVzZXJJZDogZmlyc3RVc2VyLnVzZXJJZCxcbiAgICAgICAgICAgIHVzZXJTZWxlY3RlZElkOiBmaXJzdFVzZXIudXNlclNlbGVjdGVkSWQsXG4gICAgICAgICAgICB1c2VyU3RhdHVzOiBmaXJzdFVzZXIudXNlclN0YXR1cyxcbiAgICAgICAgICAgIHVzZXJUeXBlOiBmaXJzdFVzZXIudXNlclR5cGUsXG4gICAgICAgICAgfTtcbiAgICAgICAgICBjb25zdCBlbmNyeXB0VXNlciA9IHRoaXMuZW5jcnlwdChKU09OLnN0cmluZ2lmeSh1c2VyKSk7XG4gICAgICAgICAgc2Vzc2lvblN0b3JhZ2Uuc2V0SXRlbSgndXNlckluZm9WNicsIGVuY3J5cHRVc2VyKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChkYXRhLl9wcm9maWxlKSB7XG4gICAgICAgICAgY29uc3QgZGF0YVByb2ZpbGUgPSBkYXRhLl9wcm9maWxlO1xuICAgICAgICAgIGNvbnN0IHByb2ZpbGU6IFByb2ZpbGUgPSB7XG4gICAgICAgICAgICBhbGxvd0VtYWlsVXBkYXRlczogZGF0YVByb2ZpbGUuYWxsb3dFbWFpbFVwZGF0ZXMsXG4gICAgICAgICAgICBhbGxvd0luZm9ybWF0aW9uU2hhcmU6IGRhdGFQcm9maWxlLmFsbG93SW5mb3JtYXRpb25TaGFyZSxcbiAgICAgICAgICAgIGhhc1RlbXBvcmFyeVBhc3N3b3JkOiBkYXRhUHJvZmlsZS5oYXNUZW1wb3JhcnlQYXNzd29yZCxcbiAgICAgICAgICAgIHVzZXJFbWFpbDogZGF0YVByb2ZpbGUudXNlckVtYWlsLFxuICAgICAgICAgICAgdXNlcklkOiBkYXRhUHJvZmlsZS51c2VySWQsXG4gICAgICAgICAgICB1c2VyUG9zaXRpb246IGRhdGFQcm9maWxlLnVzZXJQb3NpdGlvbixcbiAgICAgICAgICAgIHVzZXJQcm9maWxlSWQ6IGRhdGFQcm9maWxlLnVzZXJQcm9maWxlSWQsXG4gICAgICAgICAgfTtcbiAgICAgICAgICBjb25zdCBlbmNyeXB0UHJvZmlsZSA9IHRoaXMuZW5jcnlwdChKU09OLnN0cmluZ2lmeShwcm9maWxlKSk7XG4gICAgICAgICAgc2Vzc2lvblN0b3JhZ2Uuc2V0SXRlbSgndXNlclByb2ZpbGVWNicsIGVuY3J5cHRQcm9maWxlKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChkYXRhLl9jdXN0b21lcnMpIHtcbiAgICAgICAgICBjb25zdCBkYXRhQ3VzdG9tZXIgPSBkYXRhLl9jdXN0b21lcnM7XG4gICAgICAgICAgY29uc3QgY3VzdG9tZXI6IEN1c3RvbWVyID0ge1xuICAgICAgICAgICAgY291bnRyeUNvZGU6IGRhdGFDdXN0b21lci5jb3VudHJ5LmNvdW50cnlDb2RlLFxuICAgICAgICAgICAgY3VzdG9tZXJDb2RlOiBkYXRhQ3VzdG9tZXIuY3VzdG9tZXJDb2RlLFxuICAgICAgICAgICAgY3VzdG9tZXJDb2RlTFpSOiBkYXRhQ3VzdG9tZXIuY3VzdG9tZXJDb2RlTFpSLFxuICAgICAgICAgICAgY3VzdG9tZXJEZXNjOiBkYXRhQ3VzdG9tZXIuY3VzdG9tZXJEZXNjLFxuICAgICAgICAgICAgY3VzdG9tZXJEZXNjMjogZGF0YUN1c3RvbWVyLmN1c3RvbWVyRGVzYzIsXG4gICAgICAgICAgICBjdXN0b21lcklkOiBkYXRhQ3VzdG9tZXIuY3VzdG9tZXJJZCxcbiAgICAgICAgICAgIGVtYWlsOiBkYXRhQ3VzdG9tZXIuZW1haWwsXG4gICAgICAgICAgICBmYXhOdW1iZXI6IGRhdGFDdXN0b21lci5mYXhOdW1iZXIsXG4gICAgICAgICAgICBwaG9uZU51bWJlcjogZGF0YUN1c3RvbWVyLnBob25lTnVtYmVyLFxuICAgICAgICAgICAgcmVnaW9uSWQ6IGRhdGFDdXN0b21lci5yZWdpb24ucmVnaW9uSWQsXG4gICAgICAgICAgICB2QVQ6IGRhdGFDdXN0b21lci52QVQsXG4gICAgICAgICAgfTtcbiAgICAgICAgICBjb25zdCBlbmNyeXB0Y3VzdG9tZXIgPSB0aGlzLmVuY3J5cHQoSlNPTi5zdHJpbmdpZnkoY3VzdG9tZXIpKTtcbiAgICAgICAgICBzZXNzaW9uU3RvcmFnZS5zZXRJdGVtKCd1c2VyQ3VzdG9tZXJWNicsIGVuY3J5cHRjdXN0b21lcik7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoZGF0YS5fYXBwbGljYXRpb25zKSB7XG4gICAgICAgICAgY29uc3QgYXBwczogQXBwbGljYXRpb25bXSA9IGRhdGEuX2FwcGxpY2F0aW9ucy5tYXAoKGFwcCkgPT4ge1xuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgYXBwbGljYXRpb25Db2RlOiBhcHAuYXBwbGljYXRpb25Db2RlLFxuICAgICAgICAgICAgICBhcHBsaWNhdGlvbklkOiBhcHAuYXBwbGljYXRpb25JZCxcbiAgICAgICAgICAgICAgYXBwbGljYXRpb25UeXBlOiBhcHAuYXBwbGljYXRpb25UeXBlLFxuICAgICAgICAgICAgICBpc1Zpc2libGU6IGFwcC5pc1Zpc2libGUsXG4gICAgICAgICAgICB9O1xuICAgICAgICAgIH0pO1xuICAgICAgICAgIGNvbnN0IGVuY3J5cHRBcHBsaWNhdGlvbnMgPSB0aGlzLmVuY3J5cHQoSlNPTi5zdHJpbmdpZnkoYXBwcykpO1xuICAgICAgICAgIHNlc3Npb25TdG9yYWdlLnNldEl0ZW0oJ3VzZXJBcHBsaWNhdGlvbnNWNicsIGVuY3J5cHRBcHBsaWNhdGlvbnMpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGRhdGEuX3JvbGVzKSB7XG4gICAgICAgICAgY29uc3Qgcm9sZXM6IFJvbGVbXSA9IGRhdGEuX3JvbGVzLm1hcCgocm9sZSkgPT4ge1xuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgYXBwbGljYXRpb25JZDogcm9sZS5hcHBsaWNhdGlvbi5hcHBsaWNhdGlvbklkLFxuICAgICAgICAgICAgICBpc0ludGVybmFsOiByb2xlLmlzSW50ZXJuYWwsXG4gICAgICAgICAgICAgIGlzT3B0aW9uYWw6IHJvbGUuaXNPcHRpb25hbCxcbiAgICAgICAgICAgICAgaXNWaXNpYmxlOiByb2xlLmlzVmlzaWJsZSxcbiAgICAgICAgICAgICAgcm9sZUNvZGU6IHJvbGUucm9sZUNvZGUsXG4gICAgICAgICAgICAgIHJvbGVJZDogcm9sZS5yb2xlSWQsXG4gICAgICAgICAgICAgIHJvbGVUeXBlOiByb2xlLnJvbGVUeXBlLFxuICAgICAgICAgICAgfTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgICBjb25zdCBlbmNyeXB0Um9sZXMgPSB0aGlzLmVuY3J5cHQoSlNPTi5zdHJpbmdpZnkocm9sZXMpKTtcbiAgICAgICAgICBzZXNzaW9uU3RvcmFnZS5zZXRJdGVtKCd1c2VyUm9sZXNWNicsIGVuY3J5cHRSb2xlcyk7XG4gICAgICAgIH1cbiAgfVxuXG4gIHB1YmxpYyBnZXREQ01BcHBsaWNhdGlvbnMoKTogT2JzZXJ2YWJsZTxJQXBwbGljYXRpb25NZW51W10+IHtcbiAgICBjb25zdCBlbmRwb2ludCA9IHRoaXMuaHR0cC5nZW5lcmF0ZUVuZHBvaW50KFNlc3Npb25TZXJ2aWNlQ29uc3RhbnRzLlVTRVJfQVBQTElDQVRJT05fTUVOVSk7XG4gICAgcmV0dXJuIHRoaXMuaHR0cC5nZXQoZW5kcG9pbnQpLnBpcGUoXG4gICAgICBtYXAoKHJlc3BvbnNlOiBSZXNwb25zZSkgPT4ge1xuICAgICAgICBjb25zdCB0bXBKc29uID0gcmVzcG9uc2UuanNvbigpO1xuICAgICAgICBpZiAoIXRtcEpzb24gfHwgdG1wSnNvbiA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgY29uc29sZS53YXJuKCdDb25maWd1cmF0aW9uIG9mIG1lbnUgYXBwbGljYXRpb24gaXMgZW1wdHkhIScpO1xuICAgICAgICAgIHJldHVybiBbXTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCByZXNwb25zZU1hcDogSUFwcGxpY2F0aW9uTWVudVtdID0gcmVzcG9uc2UuanNvbigpIGFzIElBcHBsaWNhdGlvbk1lbnVbXTtcbiAgICAgICAgcmV0dXJuIHJlc3BvbnNlTWFwO1xuICAgICAgfSksXG4gICAgICBjYXRjaEVycm9yKChlOiBhbnkpID0+IE9ic2VydmFibGUudGhyb3codGhpcy5oYW5kbGVFcnJvcihlKSkpXG4gICAgKTtcbiAgfVxuXG4gIHB1YmxpYyBjb252ZXJ0SnNvblRvPFQ+KG9iajogc3RyaW5nKTogVCB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHRtcEpzb24gPSBKU09OLnBhcnNlKG9iaik7XG4gICAgICByZXR1cm4gdG1wSnNvbiBhcyBUO1xuICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgIGNvbnNvbGUud2FybignRXhjZXB0aW9uIGF0IHBhcnNpbmcgb2JqZWN0IGZyb20gc2Vzc2lvblN0b3JlOicsIGUpO1xuICAgIH1cblxuICAgIHJldHVybiBudWxsO1xuICB9XG5cbiAgcHVibGljIGdldCBjdXN0b21lcigpOiBJQ3VzdG9tZXIge1xuICAgIGxldCByZXN1bHQ6IElDdXN0b21lcjtcbiAgICBjb25zdCBzdHI6IHN0cmluZyA9IHNlc3Npb25TdG9yYWdlLmdldEl0ZW0oJ3VzZXJfY3VzdG9tZXInKTtcbiAgICBpZiAoc3RyKSB7XG4gICAgICB0cnkge1xuICAgICAgICBjb25zdCBwcm9maWxlID0gSlNPTi5wYXJzZShzdHIpO1xuICAgICAgICByZXN1bHQgPSBwcm9maWxlIGFzIElDdXN0b21lcjtcbiAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgY29uc29sZS53YXJuKFxuICAgICAgICAgICdFeGNlcHRpb24gYXQgcGFyc2luZyB1c2VyX2N1c3RvbWVyIGZyb20gc2Vzc2lvblN0b3JlOicsXG4gICAgICAgICAgZVxuICAgICAgICApO1xuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgY29uc29sZS53YXJuKCdUaGVyZSBpcyBubyB1c2VyIGN1c3RvbWVyIGF0IHNlc3Npb24gc3RvcmFnZScpO1xuICAgIH1cblxuICAgIHJldHVybiByZXN1bHQ7XG4gIH1cblxuICBwdWJsaWMgaGFuZGxlRXJyb3IoZXJyb3I6IFJlc3BvbnNlIHwgYW55KTogYW55IHtcbiAgICAvLyBJbiBhIHJlYWwgd29ybGQgYXBwLCB3ZSBtaWdodCB1c2UgYSByZW1vdGUgbG9nZ2luZyBpbmZyYXN0cnVjdHVyZVxuICAgIGxldCBlcnJNc2c6IHN0cmluZztcbiAgICBpZiAoZXJyb3IgaW5zdGFuY2VvZiBSZXNwb25zZSkge1xuICAgICAgY29uc3QgYm9keSA9IGVycm9yLmpzb24oKSB8fCAnJztcbiAgICAgIGVyck1zZyA9IGAke2Vycm9yLnN0YXR1c30gLSAke2Vycm9yLnN0YXR1c1RleHQgfHwgJyd9YDtcbiAgICB9IGVsc2Uge1xuICAgICAgZXJyTXNnID0gZXJyb3IubWVzc2FnZSA/IGVycm9yLm1lc3NhZ2UgOiBlcnJvci50b1N0cmluZygpO1xuICAgIH1cbiAgICBjb25zb2xlLmVycm9yKGVycm9yKTtcbiAgICByZXR1cm4gdGhyb3dFcnJvcihlcnJvcik7XG4gIH1cblxuICBwdWJsaWMgYWRkUXVlcnlQYXJhbXMoZW5kcG9pbnQ6IHN0cmluZywgZmV0Y2g/OiBudW1iZXIsIHBhZ2U/OiBudW1iZXIsIGxlZ2FsRW50aXR5Q29kZT86IHN0cmluZykge1xuICAgIGNvbnN0IHZhbGlkUGFnaW5hdGlvbjogYm9vbGVhbiA9IE51bWJlci5pc0ludGVnZXIoZmV0Y2gpICYmIE51bWJlci5pc0ludGVnZXIocGFnZSk7XG5cbiAgICBlbmRwb2ludCArPSB2YWxpZFBhZ2luYXRpb24gPyAnP2ZldGNoPScgKyBmZXRjaCArICcmcGFnZT0nICsgcGFnZSA6ICcnO1xuICAgIGVuZHBvaW50ICs9XG4gICAgICBsZWdhbEVudGl0eUNvZGUgJiYgdmFsaWRQYWdpbmF0aW9uXG4gICAgICAgID8gJyZsZWdhbEVudGl0eUNvZGU9JyArIGxlZ2FsRW50aXR5Q29kZVxuICAgICAgICA6IGxlZ2FsRW50aXR5Q29kZSAmJiAhdmFsaWRQYWdpbmF0aW9uXG4gICAgICAgICAgPyAnP2xlZ2FsRW50aXR5Q29kZT0nICsgbGVnYWxFbnRpdHlDb2RlXG4gICAgICAgICAgOiAnJztcblxuICAgIHJldHVybiBlbmRwb2ludDtcbiAgfVxuXG4gIHB1YmxpYyBsb2dvdXRBcHAoKTogdm9pZCB7XG4gICAgdGhpcy5jbGVhbigpO1xuICAgIHRoaXMuZXZlbnRCcm9hZGNhc3Rlci5icm9hZGNhc3QoQnJvYWRjYXN0ZXIuRENNX0FQUF9MT0dPVVQpO1xuICB9XG5cbiAgcHVibGljIGdldCB1c2VyQXV0aCgpIHtcbiAgICByZXR1cm4gSlNPTi5wYXJzZSh0aGlzLmRlY3J5cHQoc2Vzc2lvblN0b3JhZ2UuZ2V0SXRlbSgndXNlckF1dGhWNicpKSk7XG4gIH1cblxuICBwdWJsaWMgZ2V0IHVzZXJJbmZvKCkge1xuICAgIHJldHVybiBKU09OLnBhcnNlKHRoaXMuZGVjcnlwdChzZXNzaW9uU3RvcmFnZS5nZXRJdGVtKCd1c2VySW5mb1Y2JykpKTtcbiAgfVxuXG4gIHB1YmxpYyBnZXQgdXNlclByb2ZpbGVWNigpIHtcbiAgICByZXR1cm4gSlNPTi5wYXJzZSh0aGlzLmRlY3J5cHQoc2Vzc2lvblN0b3JhZ2UuZ2V0SXRlbSgndXNlclByb2ZpbGVWNicpKSk7XG4gIH1cblxuICBwdWJsaWMgZ2V0IHVzZXJDdXN0b21lcigpIHtcbiAgICByZXR1cm4gSlNPTi5wYXJzZSh0aGlzLmRlY3J5cHQoc2Vzc2lvblN0b3JhZ2UuZ2V0SXRlbSgndXNlckN1c3RvbWVyVjYnKSkpO1xuICB9XG5cbiAgcHVibGljIGdldCB1c2VyQXBwbGljYXRpb25zKCkge1xuICAgIHJldHVybiBKU09OLnBhcnNlKHRoaXMuZGVjcnlwdChzZXNzaW9uU3RvcmFnZS5nZXRJdGVtKCd1c2VyQXBwbGljYXRpb25zVjYnKSkpO1xuICB9XG5cbiAgcHVibGljIGdldCB1c2VyUm9sZXMoKSB7XG4gICAgcmV0dXJuIEpTT04ucGFyc2UodGhpcy5kZWNyeXB0KHNlc3Npb25TdG9yYWdlLmdldEl0ZW0oJ3VzZXJSb2xlc1Y2JykpKTtcbiAgfVxuXG4gIHB1YmxpYyBlbmNyeXB0KHN0cikge1xuICAgIHJldHVybiB3aW5kb3cuYnRvYSh1bmVzY2FwZShlbmNvZGVVUklDb21wb25lbnQoc3RyKSkpO1xuICB9XG5cbiAgcHVibGljIGRlY3J5cHQoc3RyKSB7XG4gICAgcmV0dXJuIHN0ciA/IGRlY29kZVVSSUNvbXBvbmVudChlc2NhcGUod2luZG93LmF0b2Ioc3RyKSkpIDogc3RyO1xuICB9XG5cbn1cbiJdfQ==